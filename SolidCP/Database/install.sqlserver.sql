IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
GO

BEGIN TRANSACTION;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [AdditionalGroups] (
        [ID] int NOT NULL IDENTITY,
        [UserID] int NOT NULL,
        [GroupName] nvarchar(255) NULL,
        CONSTRAINT [PK__Addition__3214EC272F1861EB] PRIMARY KEY ([ID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [AuditLog] (
        [RecordID] varchar(32) NOT NULL,
        [UserID] int NULL,
        [Username] nvarchar(50) NULL,
        [ItemID] int NULL,
        [SeverityID] int NOT NULL,
        [StartDate] datetime NOT NULL,
        [FinishDate] datetime NOT NULL,
        [SourceName] varchar(50) NOT NULL,
        [TaskName] varchar(50) NOT NULL,
        [ItemName] nvarchar(100) NULL,
        [ExecutionLog] ntext NULL,
        [PackageID] int NULL,
        CONSTRAINT [PK_Log] PRIMARY KEY ([RecordID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [AuditLogSources] (
        [SourceName] varchar(100) NOT NULL,
        CONSTRAINT [PK_AuditLogSources] PRIMARY KEY ([SourceName])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [AuditLogTasks] (
        [SourceName] varchar(100) NOT NULL,
        [TaskName] varchar(100) NOT NULL,
        [TaskDescription] nvarchar(100) NULL,
        CONSTRAINT [PK_LogActions] PRIMARY KEY ([SourceName], [TaskName])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [BackgroundTasks] (
        [ID] int NOT NULL IDENTITY,
        [Guid] uniqueidentifier NOT NULL,
        [TaskID] nvarchar(255) NULL,
        [ScheduleID] int NOT NULL,
        [PackageID] int NOT NULL,
        [UserID] int NOT NULL,
        [EffectiveUserID] int NOT NULL,
        [TaskName] nvarchar(255) NULL,
        [ItemID] int NULL,
        [ItemName] nvarchar(255) NULL,
        [StartDate] datetime NOT NULL,
        [FinishDate] datetime NULL,
        [IndicatorCurrent] int NOT NULL,
        [IndicatorMaximum] int NOT NULL,
        [MaximumExecutionTime] int NOT NULL,
        [Source] nvarchar(max) NULL,
        [Severity] int NOT NULL,
        [Completed] bit NULL,
        [NotifyOnComplete] bit NULL,
        [Status] int NOT NULL,
        CONSTRAINT [PK__Backgrou__3214EC271AFAB817] PRIMARY KEY ([ID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [Clusters] (
        [ClusterID] int NOT NULL IDENTITY,
        [ClusterName] nvarchar(100) NOT NULL,
        CONSTRAINT [PK_Clusters] PRIMARY KEY ([ClusterID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [ExchangeDeletedAccounts] (
        [ID] int NOT NULL IDENTITY,
        [AccountID] int NOT NULL,
        [OriginAT] int NOT NULL,
        [StoragePath] nvarchar(255) NULL,
        [FolderName] nvarchar(128) NULL,
        [FileName] nvarchar(128) NULL,
        [ExpirationDate] datetime NOT NULL,
        CONSTRAINT [PK__Exchange__3214EC27EF1C22C1] PRIMARY KEY ([ID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [ExchangeDisclaimers] (
        [ExchangeDisclaimerId] int NOT NULL IDENTITY,
        [ItemID] int NOT NULL,
        [DisclaimerName] nvarchar(300) NOT NULL,
        [DisclaimerText] nvarchar(max) NULL,
        CONSTRAINT [PK_ExchangeDisclaimers] PRIMARY KEY ([ExchangeDisclaimerId])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [ExchangeMailboxPlanRetentionPolicyTags] (
        [PlanTagID] int NOT NULL IDENTITY,
        [TagID] int NOT NULL,
        [MailboxPlanId] int NOT NULL,
        CONSTRAINT [PK__Exchange__E467073C50CD805B] PRIMARY KEY ([PlanTagID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [ExchangeRetentionPolicyTags] (
        [TagID] int NOT NULL IDENTITY,
        [ItemID] int NOT NULL,
        [TagName] nvarchar(255) NULL,
        [TagType] int NOT NULL,
        [AgeLimitForRetention] int NOT NULL,
        [RetentionAction] int NOT NULL,
        CONSTRAINT [PK__Exchange__657CFA4C02667D37] PRIMARY KEY ([TagID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [OCSUsers] (
        [OCSUserID] int NOT NULL IDENTITY,
        [AccountID] int NOT NULL,
        [InstanceID] nvarchar(50) NOT NULL,
        [CreatedDate] datetime NOT NULL DEFAULT ((getdate())),
        [ModifiedDate] datetime NOT NULL DEFAULT ((getdate())),
        CONSTRAINT [PK_OCSUsers] PRIMARY KEY ([OCSUserID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [PackageService] (
        [PackageId] int NOT NULL,
        [ServiceId] int NOT NULL,
        CONSTRAINT [PK_PackageService] PRIMARY KEY ([PackageId], [ServiceId])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [PackageSettings] (
        [PackageID] int NOT NULL,
        [SettingsName] nvarchar(50) NOT NULL,
        [PropertyName] nvarchar(50) NOT NULL,
        [PropertyValue] ntext NULL,
        CONSTRAINT [PK_PackageSettings] PRIMARY KEY ([PackageID], [SettingsName], [PropertyName])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [RDSCertificates] (
        [ID] int NOT NULL IDENTITY,
        [ServiceId] int NOT NULL,
        [Content] ntext NOT NULL,
        [Hash] nvarchar(255) NOT NULL,
        [FileName] nvarchar(255) NOT NULL,
        [ValidFrom] datetime NULL,
        [ExpiryDate] datetime NULL,
        CONSTRAINT [PK_RDSCertificates] PRIMARY KEY ([ID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [RDSCollections] (
        [ID] int NOT NULL IDENTITY,
        [ItemID] int NOT NULL,
        [Name] nvarchar(255) NULL,
        [Description] nvarchar(255) NULL,
        [DisplayName] nvarchar(255) NULL,
        CONSTRAINT [PK__RDSColle__3214EC27346D361D] PRIMARY KEY ([ID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [RDSServerSettings] (
        [RdsServerId] int NOT NULL,
        [SettingsName] nvarchar(50) NOT NULL,
        [PropertyName] nvarchar(50) NOT NULL,
        [PropertyValue] ntext NULL,
        [ApplyUsers] bit NOT NULL,
        [ApplyAdministrators] bit NOT NULL,
        CONSTRAINT [PK_RDSServerSettings] PRIMARY KEY ([RdsServerId], [SettingsName], [PropertyName])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [ResourceGroups] (
        [GroupID] int NOT NULL,
        [GroupName] nvarchar(100) NOT NULL,
        [GroupOrder] int NOT NULL DEFAULT 1,
        [GroupController] nvarchar(1000) NULL,
        [ShowGroup] bit NULL,
        CONSTRAINT [PK_ResourceGroups] PRIMARY KEY ([GroupID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [ScheduleTasks] (
        [TaskID] nvarchar(100) NOT NULL,
        [TaskType] nvarchar(500) NOT NULL,
        [RoleID] int NOT NULL,
        CONSTRAINT [PK_ScheduleTasks] PRIMARY KEY ([TaskID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [SfBUserPlans] (
        [SfBUserPlanId] int NOT NULL IDENTITY,
        [ItemID] int NOT NULL,
        [SfBUserPlanName] nvarchar(300) NOT NULL,
        [SfBUserPlanType] int NULL,
        [IM] bit NOT NULL,
        [Mobility] bit NOT NULL,
        [MobilityEnableOutsideVoice] bit NOT NULL,
        [Federation] bit NOT NULL,
        [Conferencing] bit NOT NULL,
        [EnterpriseVoice] bit NOT NULL,
        [VoicePolicy] int NOT NULL,
        [IsDefault] bit NOT NULL,
        [RemoteUserAccess] bit NOT NULL,
        [PublicIMConnectivity] bit NOT NULL,
        [AllowOrganizeMeetingsWithExternalAnonymous] bit NOT NULL,
        [Telephony] int NULL,
        [ServerURI] nvarchar(300) NULL,
        [ArchivePolicy] nvarchar(300) NULL,
        [TelephonyDialPlanPolicy] nvarchar(300) NULL,
        [TelephonyVoicePolicy] nvarchar(300) NULL,
        CONSTRAINT [PK_SfBUserPlans] PRIMARY KEY ([SfBUserPlanId])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [SfBUsers] (
        [SfBUserID] int NOT NULL IDENTITY,
        [AccountID] int NOT NULL,
        [SfBUserPlanID] int NOT NULL,
        [CreatedDate] datetime NOT NULL,
        [ModifiedDate] datetime NOT NULL,
        [SipAddress] nvarchar(300) NULL,
        CONSTRAINT [PK_SfBUsers] PRIMARY KEY ([SfBUserID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [SSLCertificates] (
        [ID] int NOT NULL IDENTITY,
        [UserID] int NOT NULL,
        [SiteID] int NOT NULL,
        [FriendlyName] nvarchar(255) NULL,
        [Hostname] nvarchar(255) NULL,
        [DistinguishedName] nvarchar(500) NULL,
        [CSR] ntext NULL,
        [CSRLength] int NULL,
        [Certificate] ntext NULL,
        [Hash] ntext NULL,
        [Installed] bit NULL,
        [IsRenewal] bit NULL,
        [ValidFrom] datetime NULL,
        [ExpiryDate] datetime NULL,
        [SerialNumber] nvarchar(250) NULL,
        [Pfx] ntext NULL,
        [PreviousId] int NULL,
        CONSTRAINT [PK_SSLCertificates] PRIMARY KEY ([ID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [StorageSpaceLevels] (
        [Id] int NOT NULL IDENTITY,
        [Name] nvarchar(300) NOT NULL,
        [Description] nvarchar(max) NOT NULL,
        CONSTRAINT [PK__StorageS__3214EC07B8D82363] PRIMARY KEY ([Id])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [SupportServiceLevels] (
        [LevelID] int NOT NULL IDENTITY,
        [LevelName] nvarchar(100) NOT NULL,
        [LevelDescription] nvarchar(1000) NULL,
        CONSTRAINT [PK__SupportS__09F03C065BA08AFB] PRIMARY KEY ([LevelID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [SystemSettings] (
        [SettingsName] nvarchar(50) NOT NULL,
        [PropertyName] nvarchar(50) NOT NULL,
        [PropertyValue] ntext NULL,
        CONSTRAINT [PK_SystemSettings] PRIMARY KEY ([SettingsName], [PropertyName])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [TempIds] (
        [Key] int NOT NULL IDENTITY,
        [Created] datetime2 NOT NULL,
        [Scope] uniqueidentifier NOT NULL,
        [Level] int NOT NULL,
        [Id] int NOT NULL,
        [Date] datetime2 NOT NULL,
        CONSTRAINT [PK_TempIds] PRIMARY KEY ([Key])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [Themes] (
        [ThemeID] int NOT NULL IDENTITY,
        [DisplayName] nvarchar(255) NULL,
        [LTRName] nvarchar(255) NULL,
        [RTLName] nvarchar(255) NULL,
        [Enabled] int NOT NULL,
        [DisplayOrder] int NOT NULL,
        CONSTRAINT [PK_Themes] PRIMARY KEY ([ThemeID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [ThemeSettings] (
        [ThemeID] int NOT NULL,
        [SettingsName] nvarchar(255) NOT NULL,
        [PropertyName] nvarchar(255) NOT NULL,
        [PropertyValue] nvarchar(255) NOT NULL,
        CONSTRAINT [PK_ThemeSettings] PRIMARY KEY ([ThemeID], [SettingsName], [PropertyName])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [Users] (
        [UserID] int NOT NULL IDENTITY,
        [OwnerID] int NULL,
        [RoleID] int NOT NULL,
        [StatusID] int NOT NULL,
        [IsDemo] bit NOT NULL,
        [IsPeer] bit NOT NULL,
        [Username] nvarchar(50) NULL,
        [Password] nvarchar(200) NULL,
        [FirstName] nvarchar(50) NULL,
        [LastName] nvarchar(50) NULL,
        [Email] nvarchar(255) NULL,
        [Created] datetime NULL,
        [Changed] datetime NULL,
        [Comments] ntext NULL,
        [SecondaryEmail] nvarchar(255) NULL,
        [Address] nvarchar(200) NULL,
        [City] nvarchar(50) NULL,
        [State] nvarchar(50) NULL,
        [Country] nvarchar(50) NULL,
        [Zip] varchar(20) NULL,
        [PrimaryPhone] varchar(30) NULL,
        [SecondaryPhone] varchar(30) NULL,
        [Fax] varchar(30) NULL,
        [InstantMessenger] varchar(100) NULL,
        [HtmlMail] bit NULL DEFAULT CAST(1 AS bit),
        [CompanyName] nvarchar(100) NULL,
        [EcommerceEnabled] bit NULL,
        [AdditionalParams] nvarchar(max) NULL,
        [LoginStatusId] int NULL,
        [FailedLogins] int NULL,
        [SubscriberNumber] nvarchar(32) NULL,
        [OneTimePasswordState] int NULL,
        [MfaMode] int NOT NULL,
        [PinSecret] nvarchar(255) NULL,
        CONSTRAINT [PK_Users] PRIMARY KEY ([UserID]),
        CONSTRAINT [FK_Users_Users] FOREIGN KEY ([OwnerID]) REFERENCES [Users] ([UserID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [Versions] (
        [DatabaseVersion] varchar(50) NOT NULL,
        [BuildDate] datetime NOT NULL,
        CONSTRAINT [PK_Versions] PRIMARY KEY ([DatabaseVersion])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [BackgroundTaskLogs] (
        [LogID] int NOT NULL IDENTITY,
        [TaskID] int NOT NULL,
        [Date] datetime NULL,
        [ExceptionStackTrace] ntext NULL,
        [InnerTaskStart] int NULL,
        [Severity] int NULL,
        [Text] ntext NULL,
        [TextIdent] int NULL,
        [XmlParameters] ntext NULL,
        CONSTRAINT [PK__Backgrou__5E5499A830A1D5BF] PRIMARY KEY ([LogID]),
        CONSTRAINT [FK__Backgroun__TaskI__06ADD4BD] FOREIGN KEY ([TaskID]) REFERENCES [BackgroundTasks] ([ID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [BackgroundTaskParameters] (
        [ParameterID] int NOT NULL IDENTITY,
        [TaskID] int NOT NULL,
        [Name] nvarchar(255) NULL,
        [SerializerValue] ntext NULL,
        [TypeName] nvarchar(255) NULL,
        CONSTRAINT [PK__Backgrou__F80C6297E2E5AF88] PRIMARY KEY ([ParameterID]),
        CONSTRAINT [FK__Backgroun__TaskI__03D16812] FOREIGN KEY ([TaskID]) REFERENCES [BackgroundTasks] ([ID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [BackgroundTaskStack] (
        [TaskStackID] int NOT NULL IDENTITY,
        [TaskID] int NOT NULL,
        CONSTRAINT [PK__Backgrou__5E44466F62E48BE6] PRIMARY KEY ([TaskStackID]),
        CONSTRAINT [FK__Backgroun__TaskI__098A4168] FOREIGN KEY ([TaskID]) REFERENCES [BackgroundTasks] ([ID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [RDSCollectionSettings] (
        [ID] int NOT NULL IDENTITY,
        [RDSCollectionId] int NOT NULL,
        [DisconnectedSessionLimitMin] int NULL,
        [ActiveSessionLimitMin] int NULL,
        [IdleSessionLimitMin] int NULL,
        [BrokenConnectionAction] nvarchar(20) NULL,
        [AutomaticReconnectionEnabled] bit NULL,
        [TemporaryFoldersDeletedOnExit] bit NULL,
        [TemporaryFoldersPerSession] bit NULL,
        [ClientDeviceRedirectionOptions] nvarchar(250) NULL,
        [ClientPrinterRedirected] bit NULL,
        [ClientPrinterAsDefault] bit NULL,
        [RDEasyPrintDriverEnabled] bit NULL,
        [MaxRedirectedMonitors] int NULL,
        [SecurityLayer] nvarchar(20) NULL,
        [EncryptionLevel] nvarchar(20) NULL,
        [AuthenticateUsingNLA] bit NULL,
        CONSTRAINT [PK_RDSCollectionSettings] PRIMARY KEY ([ID]),
        CONSTRAINT [FK_RDSCollectionSettings_RDSCollections] FOREIGN KEY ([RDSCollectionId]) REFERENCES [RDSCollections] ([ID]) ON DELETE CASCADE
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [RDSMessages] (
        [Id] int NOT NULL IDENTITY,
        [RDSCollectionId] int NOT NULL,
        [MessageText] ntext NOT NULL,
        [UserName] nchar(250) NOT NULL,
        [Date] datetime NOT NULL,
        CONSTRAINT [PK_RDSMessages] PRIMARY KEY ([Id]),
        CONSTRAINT [FK_RDSMessages_RDSCollections] FOREIGN KEY ([RDSCollectionId]) REFERENCES [RDSCollections] ([ID]) ON DELETE CASCADE
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [RDSServers] (
        [ID] int NOT NULL IDENTITY,
        [ItemID] int NULL,
        [Name] nvarchar(255) NULL,
        [FqdName] nvarchar(255) NULL,
        [Description] nvarchar(255) NULL,
        [RDSCollectionId] int NULL,
        [ConnectionEnabled] bit NOT NULL DEFAULT CAST(1 AS bit),
        [Controller] int NULL,
        CONSTRAINT [PK__RDSServe__3214EC27DBEBD4B5] PRIMARY KEY ([ID]),
        CONSTRAINT [FK_RDSServers_RDSCollectionId] FOREIGN KEY ([RDSCollectionId]) REFERENCES [RDSCollections] ([ID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [Providers] (
        [ProviderID] int NOT NULL,
        [GroupID] int NOT NULL,
        [ProviderName] nvarchar(100) NULL,
        [DisplayName] nvarchar(200) NOT NULL,
        [ProviderType] nvarchar(400) NULL,
        [EditorControl] nvarchar(100) NULL,
        [DisableAutoDiscovery] bit NULL,
        CONSTRAINT [PK_ServiceTypes] PRIMARY KEY ([ProviderID]),
        CONSTRAINT [FK_Providers_ResourceGroups] FOREIGN KEY ([GroupID]) REFERENCES [ResourceGroups] ([GroupID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [ResourceGroupDnsRecords] (
        [RecordID] int NOT NULL IDENTITY,
        [RecordOrder] int NOT NULL DEFAULT 1,
        [GroupID] int NOT NULL,
        [RecordType] varchar(50) NOT NULL,
        [RecordName] nvarchar(50) NOT NULL,
        [RecordData] nvarchar(200) NOT NULL,
        [MXPriority] int NULL,
        CONSTRAINT [PK_ResourceGroupDnsRecords] PRIMARY KEY ([RecordID]),
        CONSTRAINT [FK_ResourceGroupDnsRecords_ResourceGroups] FOREIGN KEY ([GroupID]) REFERENCES [ResourceGroups] ([GroupID]) ON DELETE CASCADE
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [Servers] (
        [ServerID] int NOT NULL IDENTITY,
        [ServerName] nvarchar(100) NOT NULL,
        [ServerUrl] nvarchar(255) NULL DEFAULT N'',
        [Password] nvarchar(100) NULL,
        [Comments] ntext NULL,
        [VirtualServer] bit NOT NULL,
        [InstantDomainAlias] nvarchar(200) NULL,
        [PrimaryGroupID] int NULL,
        [ADRootDomain] nvarchar(200) NULL,
        [ADUsername] nvarchar(100) NULL,
        [ADPassword] nvarchar(100) NULL,
        [ADAuthenticationType] varchar(50) NULL,
        [ADEnabled] bit NULL DEFAULT CAST(0 AS bit),
        [ADParentDomain] nvarchar(200) NULL,
        [ADParentDomainController] nvarchar(200) NULL,
        [OSPlatform] int NOT NULL,
        [IsCore] bit NULL,
        [PasswordIsSHA256] bit NOT NULL,
        CONSTRAINT [PK_Servers] PRIMARY KEY ([ServerID]),
        CONSTRAINT [FK_Servers_ResourceGroups] FOREIGN KEY ([PrimaryGroupID]) REFERENCES [ResourceGroups] ([GroupID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [ServiceItemTypes] (
        [ItemTypeID] int NOT NULL,
        [GroupID] int NULL,
        [DisplayName] nvarchar(50) NULL,
        [TypeName] nvarchar(200) NULL,
        [TypeOrder] int NOT NULL DEFAULT 1,
        [CalculateDiskspace] bit NULL,
        [CalculateBandwidth] bit NULL,
        [Suspendable] bit NULL,
        [Disposable] bit NULL,
        [Searchable] bit NULL,
        [Importable] bit NOT NULL DEFAULT CAST(1 AS bit),
        [Backupable] bit NOT NULL DEFAULT CAST(1 AS bit),
        CONSTRAINT [PK_ServiceItemTypes] PRIMARY KEY ([ItemTypeID]),
        CONSTRAINT [FK_ServiceItemTypes_ResourceGroups] FOREIGN KEY ([GroupID]) REFERENCES [ResourceGroups] ([GroupID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [ScheduleTaskParameters] (
        [TaskID] nvarchar(100) NOT NULL,
        [ParameterID] nvarchar(100) NOT NULL,
        [DataTypeID] nvarchar(50) NOT NULL,
        [DefaultValue] nvarchar(max) NULL,
        [ParameterOrder] int NOT NULL,
        CONSTRAINT [PK_ScheduleTaskParameters] PRIMARY KEY ([TaskID], [ParameterID]),
        CONSTRAINT [FK_ScheduleTaskParameters_ScheduleTasks] FOREIGN KEY ([TaskID]) REFERENCES [ScheduleTasks] ([TaskID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [ScheduleTaskViewConfiguration] (
        [TaskID] nvarchar(100) NOT NULL,
        [ConfigurationID] nvarchar(100) NOT NULL,
        [Environment] nvarchar(100) NOT NULL,
        [Description] nvarchar(100) NOT NULL,
        CONSTRAINT [PK_ScheduleTaskViewConfiguration] PRIMARY KEY ([ConfigurationID], [TaskID]),
        CONSTRAINT [FK_ScheduleTaskViewConfiguration_ScheduleTaskViewConfiguration] FOREIGN KEY ([TaskID]) REFERENCES [ScheduleTasks] ([TaskID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [StorageSpaceLevelResourceGroups] (
        [Id] int NOT NULL IDENTITY,
        [LevelId] int NOT NULL,
        [GroupId] int NOT NULL,
        CONSTRAINT [PK__StorageS__3214EC07EBEBED98] PRIMARY KEY ([Id]),
        CONSTRAINT [FK_StorageSpaceLevelResourceGroups_GroupId] FOREIGN KEY ([GroupId]) REFERENCES [ResourceGroups] ([GroupID]) ON DELETE CASCADE,
        CONSTRAINT [FK_StorageSpaceLevelResourceGroups_LevelId] FOREIGN KEY ([LevelId]) REFERENCES [StorageSpaceLevels] ([Id]) ON DELETE CASCADE
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [Comments] (
        [CommentID] int NOT NULL IDENTITY,
        [ItemTypeID] varchar(50) NOT NULL,
        [ItemID] int NOT NULL,
        [UserID] int NOT NULL,
        [CreatedDate] datetime NOT NULL DEFAULT ((getdate())),
        [CommentText] nvarchar(1000) NULL,
        [SeverityID] int NULL,
        CONSTRAINT [PK_Comments] PRIMARY KEY ([CommentID]),
        CONSTRAINT [FK_Comments_Users] FOREIGN KEY ([UserID]) REFERENCES [Users] ([UserID]) ON DELETE CASCADE
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [UserSettings] (
        [UserID] int NOT NULL,
        [SettingsName] nvarchar(50) NOT NULL,
        [PropertyName] nvarchar(50) NOT NULL,
        [PropertyValue] ntext NULL,
        CONSTRAINT [PK_UserSettings] PRIMARY KEY ([UserID], [SettingsName], [PropertyName]),
        CONSTRAINT [FK_UserSettings_Users] FOREIGN KEY ([UserID]) REFERENCES [Users] ([UserID]) ON DELETE CASCADE
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [ServiceDefaultProperties] (
        [ProviderID] int NOT NULL,
        [PropertyName] nvarchar(50) NOT NULL,
        [PropertyValue] nvarchar(1000) NULL,
        CONSTRAINT [PK_ServiceDefaultProperties_1] PRIMARY KEY ([ProviderID], [PropertyName]),
        CONSTRAINT [FK_ServiceDefaultProperties_Providers] FOREIGN KEY ([ProviderID]) REFERENCES [Providers] ([ProviderID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [IPAddresses] (
        [AddressID] int NOT NULL IDENTITY,
        [ExternalIP] varchar(24) NOT NULL,
        [InternalIP] varchar(24) NULL,
        [ServerID] int NULL,
        [Comments] ntext NULL,
        [SubnetMask] varchar(15) NULL,
        [DefaultGateway] varchar(15) NULL,
        [PoolID] int NULL,
        [VLAN] int NULL,
        CONSTRAINT [PK_IPAddresses] PRIMARY KEY ([AddressID]),
        CONSTRAINT [FK_IPAddresses_Servers] FOREIGN KEY ([ServerID]) REFERENCES [Servers] ([ServerID]) ON DELETE CASCADE
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [PrivateNetworkVLANs] (
        [VlanID] int NOT NULL IDENTITY,
        [Vlan] int NOT NULL,
        [ServerID] int NULL,
        [Comments] ntext NULL,
        CONSTRAINT [PK__PrivateN__8348135581B53618] PRIMARY KEY ([VlanID]),
        CONSTRAINT [FK_ServerID] FOREIGN KEY ([ServerID]) REFERENCES [Servers] ([ServerID]) ON DELETE CASCADE
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [Services] (
        [ServiceID] int NOT NULL IDENTITY,
        [ServerID] int NOT NULL,
        [ProviderID] int NOT NULL,
        [ServiceName] nvarchar(50) NOT NULL,
        [Comments] ntext NULL,
        [ServiceQuotaValue] int NULL,
        [ClusterID] int NULL,
        CONSTRAINT [PK_Services] PRIMARY KEY ([ServiceID]),
        CONSTRAINT [FK_Services_Clusters] FOREIGN KEY ([ClusterID]) REFERENCES [Clusters] ([ClusterID]),
        CONSTRAINT [FK_Services_Providers] FOREIGN KEY ([ProviderID]) REFERENCES [Providers] ([ProviderID]),
        CONSTRAINT [FK_Services_Servers] FOREIGN KEY ([ServerID]) REFERENCES [Servers] ([ServerID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [VirtualGroups] (
        [VirtualGroupID] int NOT NULL IDENTITY,
        [ServerID] int NOT NULL,
        [GroupID] int NOT NULL,
        [DistributionType] int NULL,
        [BindDistributionToPrimary] bit NULL,
        CONSTRAINT [PK_VirtualGroups] PRIMARY KEY ([VirtualGroupID]),
        CONSTRAINT [FK_VirtualGroups_ResourceGroups] FOREIGN KEY ([GroupID]) REFERENCES [ResourceGroups] ([GroupID]),
        CONSTRAINT [FK_VirtualGroups_Servers] FOREIGN KEY ([ServerID]) REFERENCES [Servers] ([ServerID]) ON DELETE CASCADE
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [Quotas] (
        [QuotaID] int NOT NULL,
        [GroupID] int NOT NULL,
        [QuotaOrder] int NOT NULL DEFAULT 1,
        [QuotaName] nvarchar(50) NOT NULL,
        [QuotaDescription] nvarchar(200) NULL,
        [QuotaTypeID] int NOT NULL DEFAULT 2,
        [ServiceQuota] bit NULL DEFAULT CAST(0 AS bit),
        [ItemTypeID] int NULL,
        [HideQuota] bit NULL,
        [PerOrganization] int NULL,
        CONSTRAINT [PK_Quotas] PRIMARY KEY ([QuotaID]),
        CONSTRAINT [FK_Quotas_ResourceGroups] FOREIGN KEY ([GroupID]) REFERENCES [ResourceGroups] ([GroupID]) ON DELETE CASCADE,
        CONSTRAINT [FK_Quotas_ServiceItemTypes] FOREIGN KEY ([ItemTypeID]) REFERENCES [ServiceItemTypes] ([ItemTypeID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [ServiceProperties] (
        [ServiceID] int NOT NULL,
        [PropertyName] nvarchar(50) NOT NULL,
        [PropertyValue] nvarchar(max) NULL,
        CONSTRAINT [PK_ServiceProperties_1] PRIMARY KEY ([ServiceID], [PropertyName]),
        CONSTRAINT [FK_ServiceProperties_Services] FOREIGN KEY ([ServiceID]) REFERENCES [Services] ([ServiceID]) ON DELETE CASCADE
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [StorageSpaces] (
        [Id] int NOT NULL IDENTITY,
        [Name] varchar(300) NOT NULL,
        [ServiceId] int NOT NULL,
        [ServerId] int NOT NULL,
        [LevelId] int NOT NULL,
        [Path] varchar(max) NOT NULL,
        [IsShared] bit NOT NULL,
        [UncPath] varchar(max) NULL,
        [FsrmQuotaType] int NOT NULL,
        [FsrmQuotaSizeBytes] bigint NOT NULL,
        [IsDisabled] bit NOT NULL,
        CONSTRAINT [PK__StorageS__3214EC07B8B9A6D1] PRIMARY KEY ([Id]),
        CONSTRAINT [FK_StorageSpaces_ServerId] FOREIGN KEY ([ServerId]) REFERENCES [Servers] ([ServerID]) ON DELETE CASCADE,
        CONSTRAINT [FK_StorageSpaces_ServiceId] FOREIGN KEY ([ServiceId]) REFERENCES [Services] ([ServiceID]) ON DELETE CASCADE
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [VirtualServices] (
        [VirtualServiceID] int NOT NULL IDENTITY,
        [ServerID] int NOT NULL,
        [ServiceID] int NOT NULL,
        CONSTRAINT [PK_VirtualServices] PRIMARY KEY ([VirtualServiceID]),
        CONSTRAINT [FK_VirtualServices_Servers] FOREIGN KEY ([ServerID]) REFERENCES [Servers] ([ServerID]) ON DELETE CASCADE,
        CONSTRAINT [FK_VirtualServices_Services] FOREIGN KEY ([ServiceID]) REFERENCES [Services] ([ServiceID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [StorageSpaceFolders] (
        [Id] int NOT NULL IDENTITY,
        [Name] varchar(300) NOT NULL,
        [StorageSpaceId] int NOT NULL,
        [Path] varchar(max) NOT NULL,
        [UncPath] varchar(max) NULL,
        [IsShared] bit NOT NULL,
        [FsrmQuotaType] int NOT NULL,
        [FsrmQuotaSizeBytes] bigint NOT NULL,
        CONSTRAINT [PK__StorageS__3214EC07AC0C9EB6] PRIMARY KEY ([Id]),
        CONSTRAINT [FK_StorageSpaceFolders_StorageSpaceId] FOREIGN KEY ([StorageSpaceId]) REFERENCES [StorageSpaces] ([Id]) ON DELETE CASCADE
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [EnterpriseFolders] (
        [EnterpriseFolderID] int NOT NULL IDENTITY,
        [ItemID] int NOT NULL,
        [FolderName] nvarchar(255) NOT NULL,
        [FolderQuota] int NOT NULL,
        [LocationDrive] nvarchar(255) NULL,
        [HomeFolder] nvarchar(255) NULL,
        [Domain] nvarchar(255) NULL,
        [StorageSpaceFolderId] int NULL,
        CONSTRAINT [PK_EnterpriseFolders] PRIMARY KEY ([EnterpriseFolderID]),
        CONSTRAINT [FK_EnterpriseFolders_StorageSpaceFolderId] FOREIGN KEY ([StorageSpaceFolderId]) REFERENCES [StorageSpaceFolders] ([Id]) ON DELETE CASCADE
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [AccessTokens] (
        [ID] int NOT NULL IDENTITY,
        [AccessTokenGuid] uniqueidentifier NOT NULL,
        [ExpirationDate] datetime NOT NULL,
        [AccountID] int NOT NULL,
        [ItemId] int NOT NULL,
        [TokenType] int NOT NULL,
        [SmsResponse] varchar(100) NULL,
        CONSTRAINT [PK__AccessTo__3214EC27A32557FE] PRIMARY KEY ([ID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [BlackBerryUsers] (
        [BlackBerryUserId] int NOT NULL IDENTITY,
        [AccountId] int NOT NULL,
        [CreatedDate] datetime NOT NULL DEFAULT ((getdate())),
        [ModifiedDate] datetime NOT NULL,
        CONSTRAINT [PK_BlackBerryUsers] PRIMARY KEY ([BlackBerryUserId])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [CRMUsers] (
        [CRMUserID] int NOT NULL IDENTITY,
        [AccountID] int NOT NULL,
        [CreatedDate] datetime NOT NULL DEFAULT ((getdate())),
        [ChangedDate] datetime NOT NULL DEFAULT ((getdate())),
        [CRMUserGuid] uniqueidentifier NULL,
        [BusinessUnitID] uniqueidentifier NULL,
        [CALType] int NULL,
        CONSTRAINT [PK_CRMUsers] PRIMARY KEY ([CRMUserID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [DomainDnsRecords] (
        [ID] int NOT NULL IDENTITY,
        [DomainId] int NOT NULL,
        [RecordType] int NOT NULL,
        [DnsServer] nvarchar(255) NULL,
        [Value] nvarchar(255) NULL,
        [Date] datetime NULL,
        CONSTRAINT [PK__DomainDn__3214EC2758B0A6F1] PRIMARY KEY ([ID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [Domains] (
        [DomainID] int NOT NULL IDENTITY,
        [PackageID] int NOT NULL,
        [ZoneItemID] int NULL,
        [DomainName] nvarchar(100) NOT NULL,
        [HostingAllowed] bit NOT NULL,
        [WebSiteID] int NULL,
        [MailDomainID] int NULL,
        [IsSubDomain] bit NOT NULL,
        [IsPreviewDomain] bit NOT NULL,
        [IsDomainPointer] bit NOT NULL,
        [DomainItemId] int NULL,
        [CreationDate] datetime NULL,
        [ExpirationDate] datetime NULL,
        [LastUpdateDate] datetime NULL,
        [RegistrarName] nvarchar(max) NULL,
        CONSTRAINT [PK_Domains] PRIMARY KEY ([DomainID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [EnterpriseFoldersOwaPermissions] (
        [ID] int NOT NULL IDENTITY,
        [ItemID] int NOT NULL,
        [FolderID] int NOT NULL,
        [AccountID] int NOT NULL,
        CONSTRAINT [PK__Enterpri__3214EC27D1B48691] PRIMARY KEY ([ID]),
        CONSTRAINT [FK_EnterpriseFoldersOwaPermissions_FolderId] FOREIGN KEY ([FolderID]) REFERENCES [EnterpriseFolders] ([EnterpriseFolderID]) ON DELETE CASCADE
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [ExchangeAccountEmailAddresses] (
        [AddressID] int NOT NULL IDENTITY,
        [AccountID] int NOT NULL,
        [EmailAddress] nvarchar(300) NOT NULL,
        CONSTRAINT [PK_ExchangeAccountEmailAddresses] PRIMARY KEY ([AddressID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [ExchangeAccounts] (
        [AccountID] int NOT NULL IDENTITY,
        [ItemID] int NOT NULL,
        [AccountType] int NOT NULL,
        [AccountName] nvarchar(300) NOT NULL,
        [DisplayName] nvarchar(300) NOT NULL,
        [PrimaryEmailAddress] nvarchar(300) NULL,
        [MailEnabledPublicFolder] bit NULL,
        [MailboxManagerActions] varchar(200) NULL,
        [SamAccountName] nvarchar(100) NULL,
        [CreatedDate] datetime NOT NULL DEFAULT ((getdate())),
        [MailboxPlanId] int NULL,
        [SubscriberNumber] nvarchar(32) NULL,
        [UserPrincipalName] nvarchar(300) NULL,
        [ExchangeDisclaimerId] int NULL,
        [ArchivingMailboxPlanId] int NULL,
        [EnableArchiving] bit NULL,
        [LevelID] int NULL,
        [IsVIP] bit NOT NULL,
        CONSTRAINT [PK_ExchangeAccounts] PRIMARY KEY ([AccountID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [RDSCollectionUsers] (
        [ID] int NOT NULL IDENTITY,
        [RDSCollectionId] int NOT NULL,
        [AccountID] int NOT NULL,
        CONSTRAINT [PK__RDSColle__3214EC2780141EF7] PRIMARY KEY ([ID]),
        CONSTRAINT [FK_RDSCollectionUsers_RDSCollectionId] FOREIGN KEY ([RDSCollectionId]) REFERENCES [RDSCollections] ([ID]) ON DELETE CASCADE,
        CONSTRAINT [FK_RDSCollectionUsers_UserId] FOREIGN KEY ([AccountID]) REFERENCES [ExchangeAccounts] ([AccountID]) ON DELETE CASCADE
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [WebDavAccessTokens] (
        [ID] int NOT NULL IDENTITY,
        [FilePath] nvarchar(max) NOT NULL,
        [AuthData] nvarchar(max) NOT NULL,
        [AccessToken] uniqueidentifier NOT NULL,
        [ExpirationDate] datetime NOT NULL,
        [AccountID] int NOT NULL,
        [ItemId] int NOT NULL,
        CONSTRAINT [PK__WebDavAc__3214EC27B27DC571] PRIMARY KEY ([ID]),
        CONSTRAINT [FK_WebDavAccessTokens_UserId] FOREIGN KEY ([AccountID]) REFERENCES [ExchangeAccounts] ([AccountID]) ON DELETE CASCADE
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [WebDavPortalUsersSettings] (
        [ID] int NOT NULL IDENTITY,
        [AccountId] int NOT NULL,
        [Settings] nvarchar(max) NULL,
        CONSTRAINT [PK__WebDavPo__3214EC278AF5195E] PRIMARY KEY ([ID]),
        CONSTRAINT [FK_WebDavPortalUsersSettings_UserId] FOREIGN KEY ([AccountId]) REFERENCES [ExchangeAccounts] ([AccountID]) ON DELETE CASCADE
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [ExchangeMailboxPlans] (
        [MailboxPlanId] int NOT NULL IDENTITY,
        [ItemID] int NOT NULL,
        [MailboxPlan] nvarchar(300) NOT NULL,
        [MailboxPlanType] int NULL,
        [EnableActiveSync] bit NOT NULL,
        [EnableIMAP] bit NOT NULL,
        [EnableMAPI] bit NOT NULL,
        [EnableOWA] bit NOT NULL,
        [EnablePOP] bit NOT NULL,
        [IsDefault] bit NOT NULL,
        [IssueWarningPct] int NOT NULL,
        [KeepDeletedItemsDays] int NOT NULL,
        [MailboxSizeMB] int NOT NULL,
        [MaxReceiveMessageSizeKB] int NOT NULL,
        [MaxRecipients] int NOT NULL,
        [MaxSendMessageSizeKB] int NOT NULL,
        [ProhibitSendPct] int NOT NULL,
        [ProhibitSendReceivePct] int NOT NULL,
        [HideFromAddressBook] bit NOT NULL,
        [AllowLitigationHold] bit NULL,
        [RecoverableItemsWarningPct] int NULL,
        [RecoverableItemsSpace] int NULL,
        [LitigationHoldUrl] nvarchar(256) NULL,
        [LitigationHoldMsg] nvarchar(512) NULL,
        [Archiving] bit NULL,
        [EnableArchiving] bit NULL,
        [ArchiveSizeMB] int NULL,
        [ArchiveWarningPct] int NULL,
        [EnableAutoReply] bit NULL,
        [IsForJournaling] bit NULL,
        [EnableForceArchiveDeletion] bit NULL,
        CONSTRAINT [PK_ExchangeMailboxPlans] PRIMARY KEY ([MailboxPlanId])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [ExchangeOrganizationDomains] (
        [OrganizationDomainID] int NOT NULL IDENTITY,
        [ItemID] int NOT NULL,
        [DomainID] int NULL,
        [IsHost] bit NULL DEFAULT CAST(0 AS bit),
        [DomainTypeID] int NOT NULL,
        CONSTRAINT [PK_ExchangeOrganizationDomains] PRIMARY KEY ([OrganizationDomainID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [ExchangeOrganizations] (
        [ItemID] int NOT NULL,
        [OrganizationID] nvarchar(128) NOT NULL,
        [ExchangeMailboxPlanID] int NULL,
        [LyncUserPlanID] int NULL,
        [SfBUserPlanID] int NULL,
        CONSTRAINT [PK_ExchangeOrganizations] PRIMARY KEY ([ItemID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [ExchangeOrganizationSettings] (
        [ItemId] int NOT NULL,
        [SettingsName] nvarchar(100) NOT NULL,
        [Xml] nvarchar(max) NOT NULL,
        CONSTRAINT [PK_ExchangeOrganizationSettings] PRIMARY KEY ([ItemId], [SettingsName]),
        CONSTRAINT [FK_ExchangeOrganizationSettings_ExchangeOrganizations_ItemId] FOREIGN KEY ([ItemId]) REFERENCES [ExchangeOrganizations] ([ItemID]) ON DELETE CASCADE
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [ExchangeOrganizationSsFolders] (
        [Id] int NOT NULL IDENTITY,
        [ItemId] int NOT NULL,
        [Type] varchar(100) NOT NULL,
        [StorageSpaceFolderId] int NOT NULL,
        CONSTRAINT [PK__Exchange__3214EC072DDBA072] PRIMARY KEY ([Id]),
        CONSTRAINT [FK_ExchangeOrganizationSsFolders_ItemId] FOREIGN KEY ([ItemId]) REFERENCES [ExchangeOrganizations] ([ItemID]) ON DELETE CASCADE,
        CONSTRAINT [FK_ExchangeOrganizationSsFolders_StorageSpaceFolderId] FOREIGN KEY ([StorageSpaceFolderId]) REFERENCES [StorageSpaceFolders] ([Id]) ON DELETE CASCADE
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [LyncUserPlans] (
        [LyncUserPlanId] int NOT NULL IDENTITY,
        [ItemID] int NOT NULL,
        [LyncUserPlanName] nvarchar(300) NOT NULL,
        [LyncUserPlanType] int NULL,
        [IM] bit NOT NULL,
        [Mobility] bit NOT NULL,
        [MobilityEnableOutsideVoice] bit NOT NULL,
        [Federation] bit NOT NULL,
        [Conferencing] bit NOT NULL,
        [EnterpriseVoice] bit NOT NULL,
        [VoicePolicy] int NOT NULL,
        [IsDefault] bit NOT NULL,
        [RemoteUserAccess] bit NOT NULL,
        [PublicIMConnectivity] bit NOT NULL,
        [AllowOrganizeMeetingsWithExternalAnonymous] bit NOT NULL,
        [Telephony] int NULL,
        [ServerURI] nvarchar(300) NULL,
        [ArchivePolicy] nvarchar(300) NULL,
        [TelephonyDialPlanPolicy] nvarchar(300) NULL,
        [TelephonyVoicePolicy] nvarchar(300) NULL,
        CONSTRAINT [PK_LyncUserPlans] PRIMARY KEY ([LyncUserPlanId]),
        CONSTRAINT [FK_LyncUserPlans_ExchangeOrganizations] FOREIGN KEY ([ItemID]) REFERENCES [ExchangeOrganizations] ([ItemID]) ON DELETE CASCADE
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [LyncUsers] (
        [LyncUserID] int NOT NULL IDENTITY,
        [AccountID] int NOT NULL,
        [LyncUserPlanID] int NOT NULL,
        [CreatedDate] datetime NOT NULL DEFAULT ((getdate())),
        [ModifiedDate] datetime NOT NULL DEFAULT ((getdate())),
        [SipAddress] nvarchar(300) NULL,
        CONSTRAINT [PK_LyncUsers] PRIMARY KEY ([LyncUserID]),
        CONSTRAINT [FK_LyncUsers_LyncUserPlans] FOREIGN KEY ([LyncUserPlanID]) REFERENCES [LyncUserPlans] ([LyncUserPlanId])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [GlobalDnsRecords] (
        [RecordID] int NOT NULL IDENTITY,
        [RecordType] varchar(10) NOT NULL,
        [RecordName] nvarchar(50) NOT NULL,
        [RecordData] nvarchar(500) NOT NULL,
        [MXPriority] int NOT NULL,
        [ServiceID] int NULL,
        [ServerID] int NULL,
        [PackageID] int NULL,
        [IPAddressID] int NULL,
        [SrvPriority] int NULL,
        [SrvWeight] int NULL,
        [SrvPort] int NULL,
        CONSTRAINT [PK_GlobalDnsRecords] PRIMARY KEY ([RecordID]),
        CONSTRAINT [FK_GlobalDnsRecords_IPAddresses] FOREIGN KEY ([IPAddressID]) REFERENCES [IPAddresses] ([AddressID]),
        CONSTRAINT [FK_GlobalDnsRecords_Servers] FOREIGN KEY ([ServerID]) REFERENCES [Servers] ([ServerID]),
        CONSTRAINT [FK_GlobalDnsRecords_Services] FOREIGN KEY ([ServiceID]) REFERENCES [Services] ([ServiceID]) ON DELETE CASCADE
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [HostingPlanQuotas] (
        [PlanID] int NOT NULL,
        [QuotaID] int NOT NULL,
        [QuotaValue] int NOT NULL,
        CONSTRAINT [PK_HostingPlanQuotas_1] PRIMARY KEY ([PlanID], [QuotaID]),
        CONSTRAINT [FK_HostingPlanQuotas_Quotas] FOREIGN KEY ([QuotaID]) REFERENCES [Quotas] ([QuotaID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [HostingPlanResources] (
        [PlanID] int NOT NULL,
        [GroupID] int NOT NULL,
        [CalculateDiskSpace] bit NULL,
        [CalculateBandwidth] bit NULL,
        CONSTRAINT [PK_HostingPlanResources] PRIMARY KEY ([PlanID], [GroupID]),
        CONSTRAINT [FK_HostingPlanResources_ResourceGroups] FOREIGN KEY ([GroupID]) REFERENCES [ResourceGroups] ([GroupID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [HostingPlans] (
        [PlanID] int NOT NULL IDENTITY,
        [UserID] int NULL,
        [PackageID] int NULL,
        [ServerID] int NULL,
        [PlanName] nvarchar(200) NOT NULL,
        [PlanDescription] ntext NULL,
        [Available] bit NOT NULL,
        [SetupPrice] money NULL,
        [RecurringPrice] money NULL,
        [RecurrenceUnit] int NULL,
        [RecurrenceLength] int NULL,
        [IsAddon] bit NULL,
        CONSTRAINT [PK_HostingPlans] PRIMARY KEY ([PlanID]),
        CONSTRAINT [FK_HostingPlans_Servers] FOREIGN KEY ([ServerID]) REFERENCES [Servers] ([ServerID]),
        CONSTRAINT [FK_HostingPlans_Users] FOREIGN KEY ([UserID]) REFERENCES [Users] ([UserID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [Packages] (
        [PackageID] int NOT NULL IDENTITY,
        [ParentPackageID] int NULL,
        [UserID] int NOT NULL,
        [PackageName] nvarchar(300) NULL,
        [PackageComments] ntext NULL,
        [ServerID] int NULL,
        [StatusID] int NOT NULL,
        [PlanID] int NULL,
        [PurchaseDate] datetime NULL,
        [OverrideQuotas] bit NOT NULL,
        [BandwidthUpdated] datetime NULL,
        [DefaultTopPackage] bit NOT NULL,
        [StatusIDchangeDate] datetime NOT NULL DEFAULT ((getdate())),
        CONSTRAINT [PK_Packages] PRIMARY KEY ([PackageID]),
        CONSTRAINT [FK_Packages_HostingPlans] FOREIGN KEY ([PlanID]) REFERENCES [HostingPlans] ([PlanID]),
        CONSTRAINT [FK_Packages_Packages] FOREIGN KEY ([ParentPackageID]) REFERENCES [Packages] ([PackageID]),
        CONSTRAINT [FK_Packages_Servers] FOREIGN KEY ([ServerID]) REFERENCES [Servers] ([ServerID]),
        CONSTRAINT [FK_Packages_Users] FOREIGN KEY ([UserID]) REFERENCES [Users] ([UserID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [PackageAddons] (
        [PackageAddonID] int NOT NULL IDENTITY,
        [PackageID] int NULL,
        [PlanID] int NULL,
        [Quantity] int NULL,
        [PurchaseDate] datetime NULL,
        [Comments] ntext NULL,
        [StatusID] int NULL,
        CONSTRAINT [PK_PackageAddons] PRIMARY KEY ([PackageAddonID]),
        CONSTRAINT [FK_PackageAddons_HostingPlans] FOREIGN KEY ([PlanID]) REFERENCES [HostingPlans] ([PlanID]),
        CONSTRAINT [FK_PackageAddons_Packages] FOREIGN KEY ([PackageID]) REFERENCES [Packages] ([PackageID]) ON DELETE CASCADE
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [PackageQuotas] (
        [PackageID] int NOT NULL,
        [QuotaID] int NOT NULL,
        [QuotaValue] int NOT NULL,
        CONSTRAINT [PK_PackageQuotas] PRIMARY KEY ([PackageID], [QuotaID]),
        CONSTRAINT [FK_PackageQuotas_Packages] FOREIGN KEY ([PackageID]) REFERENCES [Packages] ([PackageID]),
        CONSTRAINT [FK_PackageQuotas_Quotas] FOREIGN KEY ([QuotaID]) REFERENCES [Quotas] ([QuotaID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [PackageResources] (
        [PackageID] int NOT NULL,
        [GroupID] int NOT NULL,
        [CalculateDiskspace] bit NOT NULL,
        [CalculateBandwidth] bit NOT NULL,
        CONSTRAINT [PK_PackageResources_1] PRIMARY KEY ([PackageID], [GroupID]),
        CONSTRAINT [FK_PackageResources_Packages] FOREIGN KEY ([PackageID]) REFERENCES [Packages] ([PackageID]),
        CONSTRAINT [FK_PackageResources_ResourceGroups] FOREIGN KEY ([GroupID]) REFERENCES [ResourceGroups] ([GroupID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [PackagesBandwidth] (
        [PackageID] int NOT NULL,
        [GroupID] int NOT NULL,
        [LogDate] datetime NOT NULL,
        [BytesSent] bigint NOT NULL,
        [BytesReceived] bigint NOT NULL,
        CONSTRAINT [PK_PackagesBandwidth] PRIMARY KEY ([PackageID], [GroupID], [LogDate]),
        CONSTRAINT [FK_PackagesBandwidth_Packages] FOREIGN KEY ([PackageID]) REFERENCES [Packages] ([PackageID]),
        CONSTRAINT [FK_PackagesBandwidth_ResourceGroups] FOREIGN KEY ([GroupID]) REFERENCES [ResourceGroups] ([GroupID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [PackagesDiskspace] (
        [PackageID] int NOT NULL,
        [GroupID] int NOT NULL,
        [DiskSpace] bigint NOT NULL,
        CONSTRAINT [PK_PackagesDiskspace] PRIMARY KEY ([PackageID], [GroupID]),
        CONSTRAINT [FK_PackagesDiskspace_Packages] FOREIGN KEY ([PackageID]) REFERENCES [Packages] ([PackageID]),
        CONSTRAINT [FK_PackagesDiskspace_ResourceGroups] FOREIGN KEY ([GroupID]) REFERENCES [ResourceGroups] ([GroupID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [PackageServices] (
        [PackageID] int NOT NULL,
        [ServiceID] int NOT NULL,
        CONSTRAINT [PK_PackageServices] PRIMARY KEY ([PackageID], [ServiceID]),
        CONSTRAINT [FK_PackageServices_Packages] FOREIGN KEY ([PackageID]) REFERENCES [Packages] ([PackageID]) ON DELETE CASCADE,
        CONSTRAINT [FK_PackageServices_Services] FOREIGN KEY ([ServiceID]) REFERENCES [Services] ([ServiceID]) ON DELETE CASCADE
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [PackagesTreeCache] (
        [ParentPackageID] int NOT NULL,
        [PackageID] int NOT NULL,
        CONSTRAINT [PK_PackagesTreeCache] PRIMARY KEY ([ParentPackageID], [PackageID]),
        CONSTRAINT [FK_PackagesTreeCache_Packages] FOREIGN KEY ([ParentPackageID]) REFERENCES [Packages] ([PackageID]),
        CONSTRAINT [FK_PackagesTreeCache_Packages1] FOREIGN KEY ([PackageID]) REFERENCES [Packages] ([PackageID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [PackageVLANs] (
        [PackageVlanID] int NOT NULL IDENTITY,
        [VlanID] int NOT NULL,
        [PackageID] int NOT NULL,
        CONSTRAINT [PK__PackageV__A9AABBF9C0C25CB3] PRIMARY KEY ([PackageVlanID]),
        CONSTRAINT [FK_PackageID] FOREIGN KEY ([PackageID]) REFERENCES [Packages] ([PackageID]) ON DELETE CASCADE,
        CONSTRAINT [FK_VlanID] FOREIGN KEY ([VlanID]) REFERENCES [PrivateNetworkVLANs] ([VlanID]) ON DELETE CASCADE
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [Schedule] (
        [ScheduleID] int NOT NULL IDENTITY,
        [TaskID] nvarchar(100) NOT NULL,
        [PackageID] int NULL,
        [ScheduleName] nvarchar(100) NULL,
        [ScheduleTypeID] nvarchar(50) NULL,
        [Interval] int NULL,
        [FromTime] datetime NULL,
        [ToTime] datetime NULL,
        [StartTime] datetime NULL,
        [LastRun] datetime NULL,
        [NextRun] datetime NULL,
        [Enabled] bit NOT NULL,
        [PriorityID] nvarchar(50) NULL,
        [HistoriesNumber] int NULL,
        [MaxExecutionTime] int NULL,
        [WeekMonthDay] int NULL,
        CONSTRAINT [PK_Schedule] PRIMARY KEY ([ScheduleID]),
        CONSTRAINT [FK_Schedule_Packages] FOREIGN KEY ([PackageID]) REFERENCES [Packages] ([PackageID]) ON DELETE CASCADE,
        CONSTRAINT [FK_Schedule_ScheduleTasks] FOREIGN KEY ([TaskID]) REFERENCES [ScheduleTasks] ([TaskID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [ServiceItems] (
        [ItemID] int NOT NULL IDENTITY,
        [PackageID] int NULL,
        [ItemTypeID] int NULL,
        [ServiceID] int NULL,
        [ItemName] nvarchar(500) NULL,
        [CreatedDate] datetime NULL,
        CONSTRAINT [PK_ServiceItems] PRIMARY KEY ([ItemID]),
        CONSTRAINT [FK_ServiceItems_Packages] FOREIGN KEY ([PackageID]) REFERENCES [Packages] ([PackageID]),
        CONSTRAINT [FK_ServiceItems_ServiceItemTypes] FOREIGN KEY ([ItemTypeID]) REFERENCES [ServiceItemTypes] ([ItemTypeID]),
        CONSTRAINT [FK_ServiceItems_Services] FOREIGN KEY ([ServiceID]) REFERENCES [Services] ([ServiceID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [ScheduleParameters] (
        [ScheduleID] int NOT NULL,
        [ParameterID] nvarchar(100) NOT NULL,
        [ParameterValue] nvarchar(1000) NULL,
        CONSTRAINT [PK_ScheduleParameters] PRIMARY KEY ([ScheduleID], [ParameterID]),
        CONSTRAINT [FK_ScheduleParameters_Schedule] FOREIGN KEY ([ScheduleID]) REFERENCES [Schedule] ([ScheduleID]) ON DELETE CASCADE
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [PackageIPAddresses] (
        [PackageAddressID] int NOT NULL IDENTITY,
        [PackageID] int NOT NULL,
        [AddressID] int NOT NULL,
        [ItemID] int NULL,
        [IsPrimary] bit NULL,
        [OrgID] int NULL,
        CONSTRAINT [PK_PackageIPAddresses] PRIMARY KEY ([PackageAddressID]),
        CONSTRAINT [FK_PackageIPAddresses_IPAddresses] FOREIGN KEY ([AddressID]) REFERENCES [IPAddresses] ([AddressID]),
        CONSTRAINT [FK_PackageIPAddresses_Packages] FOREIGN KEY ([PackageID]) REFERENCES [Packages] ([PackageID]) ON DELETE CASCADE,
        CONSTRAINT [FK_PackageIPAddresses_ServiceItems] FOREIGN KEY ([ItemID]) REFERENCES [ServiceItems] ([ItemID])
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [PrivateIPAddresses] (
        [PrivateAddressID] int NOT NULL IDENTITY,
        [ItemID] int NOT NULL,
        [IPAddress] varchar(15) NOT NULL,
        [IsPrimary] bit NOT NULL,
        CONSTRAINT [PK_PrivateIPAddresses] PRIMARY KEY ([PrivateAddressID]),
        CONSTRAINT [FK_PrivateIPAddresses_ServiceItems] FOREIGN KEY ([ItemID]) REFERENCES [ServiceItems] ([ItemID]) ON DELETE CASCADE
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE TABLE [ServiceItemProperties] (
        [ItemID] int NOT NULL,
        [PropertyName] nvarchar(50) NOT NULL,
        [PropertyValue] nvarchar(max) NULL,
        CONSTRAINT [PK_ServiceItemProperties] PRIMARY KEY ([ItemID], [PropertyName]),
        CONSTRAINT [FK_ServiceItemProperties_ServiceItems] FOREIGN KEY ([ItemID]) REFERENCES [ServiceItems] ([ItemID]) ON DELETE CASCADE
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'SourceName') AND [object_id] = OBJECT_ID(N'[AuditLogSources]'))
        SET IDENTITY_INSERT [AuditLogSources] ON;
    EXEC(N'INSERT INTO [AuditLogSources] ([SourceName])
    VALUES (''APP_INSTALLER''),
    (''AUTO_DISCOVERY''),
    (''BACKUP''),
    (''DNS_ZONE''),
    (''DOMAIN''),
    (''ENTERPRISE_STORAGE''),
    (''EXCHANGE''),
    (''FILES''),
    (''FTP_ACCOUNT''),
    (''GLOBAL_DNS''),
    (''HOSTING_SPACE''),
    (''HOSTING_SPACE_WR''),
    (''IMPORT''),
    (''IP_ADDRESS''),
    (''MAIL_ACCOUNT''),
    (''MAIL_DOMAIN''),
    (''MAIL_FORWARDING''),
    (''MAIL_GROUP''),
    (''MAIL_LIST''),
    (''OCS''),
    (''ODBC_DSN''),
    (''ORGANIZATION''),
    (''REMOTE_DESKTOP_SERVICES''),
    (''SCHEDULER''),
    (''SERVER''),
    (''SHAREPOINT''),
    (''SPACE''),
    (''SQL_DATABASE''),
    (''SQL_USER''),
    (''STATS_SITE''),
    (''STORAGE_SPACES''),
    (''USER''),
    (''VIRTUAL_SERVER''),
    (''VLAN''),
    (''VPS''),
    (''VPS2012''),
    (''WAG_INSTALLER''),
    (''WEB_SITE'')');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'SourceName') AND [object_id] = OBJECT_ID(N'[AuditLogSources]'))
        SET IDENTITY_INSERT [AuditLogSources] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'SourceName', N'TaskName', N'TaskDescription') AND [object_id] = OBJECT_ID(N'[AuditLogTasks]'))
        SET IDENTITY_INSERT [AuditLogTasks] ON;
    EXEC(N'INSERT INTO [AuditLogTasks] ([SourceName], [TaskName], [TaskDescription])
    VALUES (''APP_INSTALLER'', ''INSTALL_APPLICATION'', N''Install application''),
    (''AUTO_DISCOVERY'', ''IS_INSTALLED'', N''Is installed''),
    (''BACKUP'', ''BACKUP'', N''Backup''),
    (''BACKUP'', ''RESTORE'', N''Restore''),
    (''DNS_ZONE'', ''ADD_RECORD'', N''Add record''),
    (''DNS_ZONE'', ''DELETE_RECORD'', N''Delete record''),
    (''DNS_ZONE'', ''UPDATE_RECORD'', N''Update record''),
    (''DOMAIN'', ''ADD'', N''Add''),
    (''DOMAIN'', ''DELETE'', N''Delete''),
    (''DOMAIN'', ''ENABLE_DNS'', N''Enable DNS''),
    (''DOMAIN'', ''UPDATE'', N''Update''),
    (''ENTERPRISE_STORAGE'', ''CREATE_FOLDER'', N''Create folder''),
    (''ENTERPRISE_STORAGE'', ''CREATE_MAPPED_DRIVE'', N''Create mapped drive''),
    (''ENTERPRISE_STORAGE'', ''DELETE_FOLDER'', N''Delete folder''),
    (''ENTERPRISE_STORAGE'', ''DELETE_MAPPED_DRIVE'', N''Delete mapped drive''),
    (''ENTERPRISE_STORAGE'', ''GET_ORG_STATS'', N''Get organization statistics''),
    (''ENTERPRISE_STORAGE'', ''SET_ENTERPRISE_FOLDER_GENERAL_SETTINGS'', N''Set enterprise folder general settings''),
    (''EXCHANGE'', ''ADD_DISTR_LIST_ADDRESS'', N''Add distribution list e-mail address''),
    (''EXCHANGE'', ''ADD_DOMAIN'', N''Add organization domain''),
    (''EXCHANGE'', ''ADD_EXCHANGE_EXCHANGEDISCLAIMER'', N''Add Exchange disclaimer''),
    (''EXCHANGE'', ''ADD_EXCHANGE_MAILBOXPLAN_RETENTIONPOLICY_ARCHIVING'', N''Add Exchange archiving retention policy''),
    (''EXCHANGE'', ''ADD_EXCHANGE_RETENTIONPOLICYTAG'', N''Add Exchange retention policy tag''),
    (''EXCHANGE'', ''ADD_MAILBOX_ADDRESS'', N''Add mailbox e-mail address''),
    (''EXCHANGE'', ''ADD_PUBLIC_FOLDER_ADDRESS'', N''Add public folder e-mail address''),
    (''EXCHANGE'', ''CALCULATE_DISKSPACE'', N''Calculate organization disk space''),
    (''EXCHANGE'', ''CREATE_CONTACT'', N''Create contact''),
    (''EXCHANGE'', ''CREATE_DISTR_LIST'', N''Create distribution list''),
    (''EXCHANGE'', ''CREATE_MAILBOX'', N''Create mailbox''),
    (''EXCHANGE'', ''CREATE_ORG'', N''Create organization''),
    (''EXCHANGE'', ''CREATE_PUBLIC_FOLDER'', N''Create public folder''),
    (''EXCHANGE'', ''DELETE_CONTACT'', N''Delete contact''),
    (''EXCHANGE'', ''DELETE_DISTR_LIST'', N''Delete distribution list''),
    (''EXCHANGE'', ''DELETE_DISTR_LIST_ADDRESSES'', N''Delete distribution list e-mail addresses''),
    (''EXCHANGE'', ''DELETE_DOMAIN'', N''Delete organization domain''),
    (''EXCHANGE'', ''DELETE_EXCHANGE_MAILBOXPLAN_RETENTIONPOLICY_ARCHIV'', N''Delete Exchange archiving retention policy''),
    (''EXCHANGE'', ''DELETE_EXCHANGE_RETENTIONPOLICYTAG'', N''Delete Exchange retention policy tag''),
    (''EXCHANGE'', ''DELETE_MAILBOX'', N''Delete mailbox''),
    (''EXCHANGE'', ''DELETE_MAILBOX_ADDRESSES'', N''Delete mailbox e-mail addresses''),
    (''EXCHANGE'', ''DELETE_ORG'', N''Delete organization''),
    (''EXCHANGE'', ''DELETE_PUBLIC_FOLDER'', N''Delete public folder''),
    (''EXCHANGE'', ''DELETE_PUBLIC_FOLDER_ADDRESSES'', N''Delete public folder e-mail addresses''),
    (''EXCHANGE'', ''DISABLE_MAIL_PUBLIC_FOLDER'', N''Disable mail public folder'');
    INSERT INTO [AuditLogTasks] ([SourceName], [TaskName], [TaskDescription])
    VALUES (''EXCHANGE'', ''DISABLE_MAILBOX'', N''Disable Mailbox''),
    (''EXCHANGE'', ''ENABLE_MAIL_PUBLIC_FOLDER'', N''Enable mail public folder''),
    (''EXCHANGE'', ''GET_ACTIVESYNC_POLICY'', N''Get Activesync policy''),
    (''EXCHANGE'', ''GET_CONTACT_GENERAL'', N''Get contact general settings''),
    (''EXCHANGE'', ''GET_CONTACT_MAILFLOW'', N''Get contact mail flow settings''),
    (''EXCHANGE'', ''GET_DISTR_LIST_ADDRESSES'', N''Get distribution list e-mail addresses''),
    (''EXCHANGE'', ''GET_DISTR_LIST_BYMEMBER'', N''Get distributions list by member''),
    (''EXCHANGE'', ''GET_DISTR_LIST_GENERAL'', N''Get distribution list general settings''),
    (''EXCHANGE'', ''GET_DISTR_LIST_MAILFLOW'', N''Get distribution list mail flow settings''),
    (''EXCHANGE'', ''GET_DISTRIBUTION_LIST_RESULT'', N''Get distributions list result''),
    (''EXCHANGE'', ''GET_EXCHANGE_ACCOUNTDISCLAIMERID'', N''Get Exchange account disclaimer id''),
    (''EXCHANGE'', ''GET_EXCHANGE_EXCHANGEDISCLAIMER'', N''Get Exchange disclaimer''),
    (''EXCHANGE'', ''GET_EXCHANGE_MAILBOXPLAN'', N''Get Exchange Mailbox plan''),
    (''EXCHANGE'', ''GET_EXCHANGE_MAILBOXPLANS'', N''Get Exchange Mailbox plans''),
    (''EXCHANGE'', ''GET_EXCHANGE_RETENTIONPOLICYTAG'', N''Get Exchange retention policy tag''),
    (''EXCHANGE'', ''GET_EXCHANGE_RETENTIONPOLICYTAGS'', N''Get Exchange retention policy tags''),
    (''EXCHANGE'', ''GET_FOLDERS_STATS'', N''Get organization public folder statistics''),
    (''EXCHANGE'', ''GET_MAILBOX_ADDRESSES'', N''Get mailbox e-mail addresses''),
    (''EXCHANGE'', ''GET_MAILBOX_ADVANCED'', N''Get mailbox advanced settings''),
    (''EXCHANGE'', ''GET_MAILBOX_AUTOREPLY'', N''Get Mailbox autoreply''),
    (''EXCHANGE'', ''GET_MAILBOX_GENERAL'', N''Get mailbox general settings''),
    (''EXCHANGE'', ''GET_MAILBOX_MAILFLOW'', N''Get mailbox mail flow settings''),
    (''EXCHANGE'', ''GET_MAILBOX_PERMISSIONS'', N''Get Mailbox permissions''),
    (''EXCHANGE'', ''GET_MAILBOX_STATS'', N''Get Mailbox statistics''),
    (''EXCHANGE'', ''GET_MAILBOXES_STATS'', N''Get organization mailboxes statistics''),
    (''EXCHANGE'', ''GET_MOBILE_DEVICES'', N''Get mobile devices''),
    (''EXCHANGE'', ''GET_ORG_LIMITS'', N''Get organization storage limits''),
    (''EXCHANGE'', ''GET_ORG_STATS'', N''Get organization statistics''),
    (''EXCHANGE'', ''GET_PICTURE'', N''Get picture''),
    (''EXCHANGE'', ''GET_PUBLIC_FOLDER_ADDRESSES'', N''Get public folder e-mail addresses''),
    (''EXCHANGE'', ''GET_PUBLIC_FOLDER_GENERAL'', N''Get public folder general settings''),
    (''EXCHANGE'', ''GET_PUBLIC_FOLDER_MAILFLOW'', N''Get public folder mail flow settings''),
    (''EXCHANGE'', ''GET_RESOURCE_MAILBOX'', N''Get resource Mailbox settings''),
    (''EXCHANGE'', ''SET_EXCHANGE_ACCOUNTDISCLAIMERID'', N''Set exchange account disclaimer id''),
    (''EXCHANGE'', ''SET_EXCHANGE_MAILBOXPLAN'', N''Set exchange Mailbox plan''),
    (''EXCHANGE'', ''SET_MAILBOXPLAN_RETENTIONPOLICY_ARCHIVING'', N''Set Mailbox plan retention policy archiving''),
    (''EXCHANGE'', ''SET_ORG_LIMITS'', N''Update organization storage limits''),
    (''EXCHANGE'', ''SET_PRIMARY_DISTR_LIST_ADDRESS'', N''Set distribution list primary e-mail address''),
    (''EXCHANGE'', ''SET_PRIMARY_MAILBOX_ADDRESS'', N''Set mailbox primary e-mail address''),
    (''EXCHANGE'', ''SET_PRIMARY_PUBLIC_FOLDER_ADDRESS'', N''Set public folder primary e-mail address''),
    (''EXCHANGE'', ''UPDATE_CONTACT_GENERAL'', N''Update contact general settings''),
    (''EXCHANGE'', ''UPDATE_CONTACT_MAILFLOW'', N''Update contact mail flow settings'');
    INSERT INTO [AuditLogTasks] ([SourceName], [TaskName], [TaskDescription])
    VALUES (''EXCHANGE'', ''UPDATE_DISTR_LIST_GENERAL'', N''Update distribution list general settings''),
    (''EXCHANGE'', ''UPDATE_DISTR_LIST_MAILFLOW'', N''Update distribution list mail flow settings''),
    (''EXCHANGE'', ''UPDATE_EXCHANGE_RETENTIONPOLICYTAG'', N''Update Exchange retention policy tag''),
    (''EXCHANGE'', ''UPDATE_MAILBOX_ADVANCED'', N''Update mailbox advanced settings''),
    (''EXCHANGE'', ''UPDATE_MAILBOX_AUTOREPLY'', N''Update Mailbox autoreply''),
    (''EXCHANGE'', ''UPDATE_MAILBOX_GENERAL'', N''Update mailbox general settings''),
    (''EXCHANGE'', ''UPDATE_MAILBOX_MAILFLOW'', N''Update mailbox mail flow settings''),
    (''EXCHANGE'', ''UPDATE_PUBLIC_FOLDER_GENERAL'', N''Update public folder general settings''),
    (''EXCHANGE'', ''UPDATE_PUBLIC_FOLDER_MAILFLOW'', N''Update public folder mail flow settings''),
    (''EXCHANGE'', ''UPDATE_RESOURCE_MAILBOX'', N''Update resource Mailbox settings''),
    (''FILES'', ''COPY_FILES'', N''Copy files''),
    (''FILES'', ''CREATE_ACCESS_DATABASE'', N''Create MS Access database''),
    (''FILES'', ''CREATE_FILE'', N''Create file''),
    (''FILES'', ''CREATE_FOLDER'', N''Create folder''),
    (''FILES'', ''DELETE_FILES'', N''Delete files''),
    (''FILES'', ''MOVE_FILES'', N''Move files''),
    (''FILES'', ''RENAME_FILE'', N''Rename file''),
    (''FILES'', ''SET_PERMISSIONS'', NULL),
    (''FILES'', ''UNZIP_FILES'', N''Unzip files''),
    (''FILES'', ''UPDATE_BINARY_CONTENT'', N''Update file binary content''),
    (''FILES'', ''ZIP_FILES'', N''Zip files''),
    (''FTP_ACCOUNT'', ''ADD'', N''Add''),
    (''FTP_ACCOUNT'', ''DELETE'', N''Delete''),
    (''FTP_ACCOUNT'', ''UPDATE'', N''Update''),
    (''GLOBAL_DNS'', ''ADD'', N''Add''),
    (''GLOBAL_DNS'', ''DELETE'', N''Delete''),
    (''GLOBAL_DNS'', ''UPDATE'', N''Update''),
    (''HOSTING_SPACE'', ''ADD'', N''Add''),
    (''HOSTING_SPACE_WR'', ''ADD'', N''Add''),
    (''IMPORT'', ''IMPORT'', N''Import''),
    (''IP_ADDRESS'', ''ADD'', N''Add''),
    (''IP_ADDRESS'', ''ADD_RANGE'', N''Add range''),
    (''IP_ADDRESS'', ''ALLOCATE_PACKAGE_IP'', N''Allocate package IP addresses''),
    (''IP_ADDRESS'', ''DEALLOCATE_PACKAGE_IP'', N''Deallocate package IP addresses''),
    (''IP_ADDRESS'', ''DELETE'', N''Delete''),
    (''IP_ADDRESS'', ''DELETE_RANGE'', N''Delete IP Addresses''),
    (''IP_ADDRESS'', ''UPDATE'', N''Update''),
    (''IP_ADDRESS'', ''UPDATE_RANGE'', N''Update IP Addresses''),
    (''MAIL_ACCOUNT'', ''ADD'', N''Add''),
    (''MAIL_ACCOUNT'', ''DELETE'', N''Delete''),
    (''MAIL_ACCOUNT'', ''UPDATE'', N''Update''),
    (''MAIL_DOMAIN'', ''ADD'', N''Add'');
    INSERT INTO [AuditLogTasks] ([SourceName], [TaskName], [TaskDescription])
    VALUES (''MAIL_DOMAIN'', ''ADD_POINTER'', N''Add pointer''),
    (''MAIL_DOMAIN'', ''DELETE'', N''Delete''),
    (''MAIL_DOMAIN'', ''DELETE_POINTER'', N''Update pointer''),
    (''MAIL_DOMAIN'', ''UPDATE'', N''Update''),
    (''MAIL_FORWARDING'', ''ADD'', N''Add''),
    (''MAIL_FORWARDING'', ''DELETE'', N''Delete''),
    (''MAIL_FORWARDING'', ''UPDATE'', N''Update''),
    (''MAIL_GROUP'', ''ADD'', N''Add''),
    (''MAIL_GROUP'', ''DELETE'', N''Delete''),
    (''MAIL_GROUP'', ''UPDATE'', N''Update''),
    (''MAIL_LIST'', ''ADD'', N''Add''),
    (''MAIL_LIST'', ''DELETE'', N''Delete''),
    (''MAIL_LIST'', ''UPDATE'', N''Update''),
    (''OCS'', ''CREATE_OCS_USER'', N''Create OCS user''),
    (''OCS'', ''GET_OCS_USERS'', N''Get OCS users''),
    (''OCS'', ''GET_OCS_USERS_COUNT'', N''Get OCS users count''),
    (''ODBC_DSN'', ''ADD'', N''Add''),
    (''ODBC_DSN'', ''DELETE'', N''Delete''),
    (''ODBC_DSN'', ''UPDATE'', N''Update''),
    (''ORGANIZATION'', ''CREATE_ORG'', N''Create organization''),
    (''ORGANIZATION'', ''CREATE_ORGANIZATION_ENTERPRISE_STORAGE'', N''Create organization enterprise storage''),
    (''ORGANIZATION'', ''CREATE_SECURITY_GROUP'', N''Create security group''),
    (''ORGANIZATION'', ''CREATE_USER'', N''Create user''),
    (''ORGANIZATION'', ''DELETE_ORG'', N''Delete organization''),
    (''ORGANIZATION'', ''DELETE_SECURITY_GROUP'', N''Delete security group''),
    (''ORGANIZATION'', ''GET_ORG_STATS'', N''Get organization statistics''),
    (''ORGANIZATION'', ''GET_SECURITY_GROUP_GENERAL'', N''Get security group general settings''),
    (''ORGANIZATION'', ''GET_SECURITY_GROUPS_BYMEMBER'', N''Get security groups by member''),
    (''ORGANIZATION'', ''GET_SUPPORT_SERVICE_LEVELS'', N''Get support service levels''),
    (''ORGANIZATION'', ''REMOVE_USER'', N''Remove user''),
    (''ORGANIZATION'', ''SEND_USER_PASSWORD_RESET_EMAIL_PINCODE'', N''Send user password reset email pincode''),
    (''ORGANIZATION'', ''SET_USER_PASSWORD'', N''Set user password''),
    (''ORGANIZATION'', ''SET_USER_USERPRINCIPALNAME'', N''Set user principal name''),
    (''ORGANIZATION'', ''UPDATE_PASSWORD_SETTINGS'', N''Update password settings''),
    (''ORGANIZATION'', ''UPDATE_SECURITY_GROUP_GENERAL'', N''Update security group general settings''),
    (''ORGANIZATION'', ''UPDATE_USER_GENERAL'', N''Update user general settings''),
    (''REMOTE_DESKTOP_SERVICES'', ''ADD_RDS_SERVER'', N''Add RDS server''),
    (''REMOTE_DESKTOP_SERVICES'', ''RESTART_RDS_SERVER'', N''Restart RDS server''),
    (''REMOTE_DESKTOP_SERVICES'', ''SET_RDS_SERVER_NEW_CONNECTIONS_ALLOWED'', N''Set RDS new connection allowed''),
    (''SCHEDULER'', ''RUN_SCHEDULE'', NULL),
    (''SERVER'', ''ADD'', N''Add''),
    (''SERVER'', ''ADD_SERVICE'', N''Add service'');
    INSERT INTO [AuditLogTasks] ([SourceName], [TaskName], [TaskDescription])
    VALUES (''SERVER'', ''CHANGE_WINDOWS_SERVICE_STATUS'', N''Change Windows service status''),
    (''SERVER'', ''CHECK_AVAILABILITY'', N''Check availability''),
    (''SERVER'', ''CLEAR_EVENT_LOG'', N''Clear Windows event log''),
    (''SERVER'', ''DELETE'', N''Delete''),
    (''SERVER'', ''DELETE_SERVICE'', N''Delete service''),
    (''SERVER'', ''REBOOT'', N''Reboot''),
    (''SERVER'', ''RESET_TERMINAL_SESSION'', N''Reset terminal session''),
    (''SERVER'', ''TERMINATE_SYSTEM_PROCESS'', N''Terminate system process''),
    (''SERVER'', ''UPDATE'', N''Update''),
    (''SERVER'', ''UPDATE_AD_PASSWORD'', N''Update active directory password''),
    (''SERVER'', ''UPDATE_PASSWORD'', N''Update access password''),
    (''SERVER'', ''UPDATE_SERVICE'', N''Update service''),
    (''SHAREPOINT'', ''ADD_GROUP'', N''Add group''),
    (''SHAREPOINT'', ''ADD_SITE'', N''Add site''),
    (''SHAREPOINT'', ''ADD_USER'', N''Add user''),
    (''SHAREPOINT'', ''BACKUP_SITE'', N''Backup site''),
    (''SHAREPOINT'', ''DELETE_GROUP'', N''Delete group''),
    (''SHAREPOINT'', ''DELETE_SITE'', N''Delete site''),
    (''SHAREPOINT'', ''DELETE_USER'', N''Delete user''),
    (''SHAREPOINT'', ''INSTALL_WEBPARTS'', N''Install Web Parts package''),
    (''SHAREPOINT'', ''RESTORE_SITE'', N''Restore site''),
    (''SHAREPOINT'', ''UNINSTALL_WEBPARTS'', N''Uninstall Web Parts package''),
    (''SHAREPOINT'', ''UPDATE_GROUP'', N''Update group''),
    (''SHAREPOINT'', ''UPDATE_USER'', N''Update user''),
    (''SPACE'', ''CALCULATE_DISKSPACE'', N''Calculate disk space''),
    (''SPACE'', ''CHANGE_ITEMS_STATUS'', N''Change hosting items status''),
    (''SPACE'', ''CHANGE_STATUS'', N''Change hostng space status''),
    (''SPACE'', ''DELETE'', N''Delete hosting space''),
    (''SPACE'', ''DELETE_ITEMS'', N''Delete hosting items''),
    (''SQL_DATABASE'', ''ADD'', N''Add''),
    (''SQL_DATABASE'', ''BACKUP'', N''Backup''),
    (''SQL_DATABASE'', ''DELETE'', N''Delete''),
    (''SQL_DATABASE'', ''RESTORE'', N''Restore''),
    (''SQL_DATABASE'', ''TRUNCATE'', N''Truncate''),
    (''SQL_DATABASE'', ''UPDATE'', N''Update''),
    (''SQL_USER'', ''ADD'', N''Add''),
    (''SQL_USER'', ''DELETE'', N''Delete''),
    (''SQL_USER'', ''UPDATE'', N''Update''),
    (''STATS_SITE'', ''ADD'', N''Add statistics site''),
    (''STATS_SITE'', ''DELETE'', N''Delete statistics site''),
    (''STATS_SITE'', ''UPDATE'', N''Update statistics site''),
    (''STORAGE_SPACES'', ''REMOVE_STORAGE_SPACE'', N''Remove storage space'');
    INSERT INTO [AuditLogTasks] ([SourceName], [TaskName], [TaskDescription])
    VALUES (''STORAGE_SPACES'', ''SAVE_STORAGE_SPACE'', N''Save storage space''),
    (''STORAGE_SPACES'', ''SAVE_STORAGE_SPACE_LEVEL'', N''Save storage space level''),
    (''USER'', ''ADD'', N''Add''),
    (''USER'', ''AUTHENTICATE'', N''Authenticate''),
    (''USER'', ''CHANGE_PASSWORD'', N''Change password''),
    (''USER'', ''CHANGE_PASSWORD_BY_USERNAME_PASSWORD'', N''Change password by username/password''),
    (''USER'', ''CHANGE_STATUS'', N''Change status''),
    (''USER'', ''DELETE'', N''Delete''),
    (''USER'', ''GET_BY_USERNAME_PASSWORD'', N''Get by username/password''),
    (''USER'', ''SEND_REMINDER'', N''Send password reminder''),
    (''USER'', ''UPDATE'', N''Update''),
    (''USER'', ''UPDATE_SETTINGS'', N''Update settings''),
    (''VIRTUAL_SERVER'', ''ADD_SERVICES'', N''Add services''),
    (''VIRTUAL_SERVER'', ''DELETE_SERVICES'', N''Delete services''),
    (''VLAN'', ''ADD'', N''Add''),
    (''VLAN'', ''ADD_RANGE'', N''Add range''),
    (''VLAN'', ''ALLOCATE_PACKAGE_VLAN'', N''Allocate package VLAN''),
    (''VLAN'', ''DEALLOCATE_PACKAGE_VLAN'', N''Deallocate package VLAN''),
    (''VLAN'', ''DELETE_RANGE'', N''Delete range''),
    (''VLAN'', ''UPDATE'', N''Update''),
    (''VPS'', ''ADD_EXTERNAL_IP'', N''Add external IP''),
    (''VPS'', ''ADD_PRIVATE_IP'', N''Add private IP''),
    (''VPS'', ''APPLY_SNAPSHOT'', N''Apply VPS snapshot''),
    (''VPS'', ''CANCEL_JOB'', N''Cancel Job''),
    (''VPS'', ''CHANGE_ADMIN_PASSWORD'', N''Change administrator password''),
    (''VPS'', ''CHANGE_STATE'', N''Change VPS state''),
    (''VPS'', ''CREATE'', N''Create VPS''),
    (''VPS'', ''DELETE'', N''Delete VPS''),
    (''VPS'', ''DELETE_EXTERNAL_IP'', N''Delete external IP''),
    (''VPS'', ''DELETE_PRIVATE_IP'', N''Delete private IP''),
    (''VPS'', ''DELETE_SNAPSHOT'', N''Delete VPS snapshot''),
    (''VPS'', ''DELETE_SNAPSHOT_SUBTREE'', N''Delete VPS snapshot subtree''),
    (''VPS'', ''EJECT_DVD_DISK'', N''Eject DVD disk''),
    (''VPS'', ''INSERT_DVD_DISK'', N''Insert DVD disk''),
    (''VPS'', ''REINSTALL'', N''Re-install VPS''),
    (''VPS'', ''RENAME_SNAPSHOT'', N''Rename VPS snapshot''),
    (''VPS'', ''SEND_SUMMARY_LETTER'', N''Send VPS summary letter''),
    (''VPS'', ''SET_PRIMARY_EXTERNAL_IP'', N''Set primary external IP''),
    (''VPS'', ''SET_PRIMARY_PRIVATE_IP'', N''Set primary private IP''),
    (''VPS'', ''TAKE_SNAPSHOT'', N''Take VPS snapshot''),
    (''VPS'', ''UPDATE_CONFIGURATION'', N''Update VPS configuration''),
    (''VPS'', ''UPDATE_HOSTNAME'', N''Update host name'');
    INSERT INTO [AuditLogTasks] ([SourceName], [TaskName], [TaskDescription])
    VALUES (''VPS'', ''UPDATE_IP'', N''Update IP Address''),
    (''VPS'', ''UPDATE_PERMISSIONS'', N''Update VPS permissions''),
    (''VPS'', ''UPDATE_VDC_PERMISSIONS'', N''Update space permissions''),
    (''VPS2012'', ''ADD_EXTERNAL_IP'', N''Add external IP''),
    (''VPS2012'', ''ADD_PRIVATE_IP'', N''Add private IP''),
    (''VPS2012'', ''APPLY_SNAPSHOT'', N''Apply VM snapshot''),
    (''VPS2012'', ''CHANGE_ADMIN_PASSWORD'', N''Change administrator password''),
    (''VPS2012'', ''CHANGE_STATE'', N''Change VM state''),
    (''VPS2012'', ''CREATE'', N''Create VM''),
    (''VPS2012'', ''DELETE'', N''Delete VM''),
    (''VPS2012'', ''DELETE_EXTERNAL_IP'', N''Delete external IP''),
    (''VPS2012'', ''DELETE_PRIVATE_IP'', N''Delete private IP''),
    (''VPS2012'', ''DELETE_SNAPSHOT'', N''Delete VM snapshot''),
    (''VPS2012'', ''DELETE_SNAPSHOT_SUBTREE'', N''Delete VM snapshot subtree''),
    (''VPS2012'', ''EJECT_DVD_DISK'', N''Eject DVD disk''),
    (''VPS2012'', ''INSERT_DVD_DISK'', N''Insert DVD disk''),
    (''VPS2012'', ''REINSTALL'', N''Reinstall VM''),
    (''VPS2012'', ''RENAME_SNAPSHOT'', N''Rename VM snapshot''),
    (''VPS2012'', ''SET_PRIMARY_EXTERNAL_IP'', N''Set primary external IP''),
    (''VPS2012'', ''SET_PRIMARY_PRIVATE_IP'', N''Set primary private IP''),
    (''VPS2012'', ''TAKE_SNAPSHOT'', N''Take VM snapshot''),
    (''VPS2012'', ''UPDATE_CONFIGURATION'', N''Update VM configuration''),
    (''VPS2012'', ''UPDATE_HOSTNAME'', N''Update host name''),
    (''WAG_INSTALLER'', ''GET_APP_PARAMS_TASK'', N''Get application parameters''),
    (''WAG_INSTALLER'', ''GET_GALLERY_APP_DETAILS_TASK'', N''Get gallery application details''),
    (''WAG_INSTALLER'', ''GET_GALLERY_APPS_TASK'', N''Get gallery applications''),
    (''WAG_INSTALLER'', ''GET_GALLERY_CATEGORIES_TASK'', N''Get gallery categories''),
    (''WAG_INSTALLER'', ''GET_SRV_GALLERY_APPS_TASK'', N''Get server gallery applications''),
    (''WAG_INSTALLER'', ''INSTALL_WEB_APP'', N''Install Web application''),
    (''WEB_SITE'', ''ADD'', N''Add''),
    (''WEB_SITE'', ''ADD_POINTER'', N''Add domain pointer''),
    (''WEB_SITE'', ''ADD_SSL_FOLDER'', N''Add shared SSL folder''),
    (''WEB_SITE'', ''ADD_VDIR'', N''Add virtual directory''),
    (''WEB_SITE'', ''CHANGE_FP_PASSWORD'', N''Change FrontPage account password''),
    (''WEB_SITE'', ''CHANGE_STATE'', N''Change state''),
    (''WEB_SITE'', ''DELETE'', N''Delete''),
    (''WEB_SITE'', ''DELETE_POINTER'', N''Delete domain pointer''),
    (''WEB_SITE'', ''DELETE_SECURED_FOLDER'', N''Delete secured folder''),
    (''WEB_SITE'', ''DELETE_SECURED_GROUP'', N''Delete secured group''),
    (''WEB_SITE'', ''DELETE_SECURED_USER'', N''Delete secured user''),
    (''WEB_SITE'', ''DELETE_SSL_FOLDER'', N''Delete shared SSL folder''),
    (''WEB_SITE'', ''DELETE_VDIR'', N''Delete virtual directory'');
    INSERT INTO [AuditLogTasks] ([SourceName], [TaskName], [TaskDescription])
    VALUES (''WEB_SITE'', ''GET_STATE'', N''Get state''),
    (''WEB_SITE'', ''INSTALL_FP'', N''Install FrontPage Extensions''),
    (''WEB_SITE'', ''INSTALL_SECURED_FOLDERS'', N''Install secured folders''),
    (''WEB_SITE'', ''UNINSTALL_FP'', N''Uninstall FrontPage Extensions''),
    (''WEB_SITE'', ''UNINSTALL_SECURED_FOLDERS'', N''Uninstall secured folders''),
    (''WEB_SITE'', ''UPDATE'', N''Update''),
    (''WEB_SITE'', ''UPDATE_SECURED_FOLDER'', N''Add/update secured folder''),
    (''WEB_SITE'', ''UPDATE_SECURED_GROUP'', N''Add/update secured group''),
    (''WEB_SITE'', ''UPDATE_SECURED_USER'', N''Add/update secured user''),
    (''WEB_SITE'', ''UPDATE_SSL_FOLDER'', N''Update shared SSL folder''),
    (''WEB_SITE'', ''UPDATE_VDIR'', N''Update virtual directory'')');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'SourceName', N'TaskName', N'TaskDescription') AND [object_id] = OBJECT_ID(N'[AuditLogTasks]'))
        SET IDENTITY_INSERT [AuditLogTasks] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'GroupID', N'GroupController', N'GroupName', N'GroupOrder', N'ShowGroup') AND [object_id] = OBJECT_ID(N'[ResourceGroups]'))
        SET IDENTITY_INSERT [ResourceGroups] ON;
    EXEC(N'INSERT INTO [ResourceGroups] ([GroupID], [GroupController], [GroupName], [GroupOrder], [ShowGroup])
    VALUES (1, N''SolidCP.EnterpriseServer.OperatingSystemController'', N''OS'', 1, CAST(1 AS bit)),
    (2, N''SolidCP.EnterpriseServer.WebServerController'', N''Web'', 2, CAST(1 AS bit)),
    (3, N''SolidCP.EnterpriseServer.FtpServerController'', N''FTP'', 3, CAST(1 AS bit)),
    (4, N''SolidCP.EnterpriseServer.MailServerController'', N''Mail'', 4, CAST(1 AS bit)),
    (5, N''SolidCP.EnterpriseServer.DatabaseServerController'', N''MsSQL2000'', 7, CAST(1 AS bit)),
    (6, N''SolidCP.EnterpriseServer.DatabaseServerController'', N''MySQL4'', 11, CAST(1 AS bit)),
    (7, N''SolidCP.EnterpriseServer.DnsServerController'', N''DNS'', 17, CAST(1 AS bit)),
    (8, N''SolidCP.EnterpriseServer.StatisticsServerController'', N''Statistics'', 18, CAST(1 AS bit)),
    (10, N''SolidCP.EnterpriseServer.DatabaseServerController'', N''MsSQL2005'', 8, CAST(1 AS bit)),
    (11, N''SolidCP.EnterpriseServer.DatabaseServerController'', N''MySQL5'', 12, CAST(1 AS bit)),
    (12, NULL, N''Exchange'', 5, CAST(1 AS bit)),
    (13, NULL, N''Hosted Organizations'', 6, CAST(1 AS bit)),
    (20, N''SolidCP.EnterpriseServer.HostedSharePointServerController'', N''Sharepoint Foundation Server'', 14, CAST(1 AS bit)),
    (21, NULL, N''Hosted CRM'', 16, CAST(1 AS bit)),
    (22, N''SolidCP.EnterpriseServer.DatabaseServerController'', N''MsSQL2008'', 9, CAST(1 AS bit)),
    (23, N''SolidCP.EnterpriseServer.DatabaseServerController'', N''MsSQL2012'', 10, CAST(1 AS bit)),
    (24, NULL, N''Hosted CRM2013'', 16, CAST(1 AS bit)),
    (30, NULL, N''VPS'', 19, CAST(1 AS bit)),
    (31, NULL, N''BlackBerry'', 21, CAST(1 AS bit)),
    (32, NULL, N''OCS'', 22, CAST(1 AS bit)),
    (33, NULL, N''VPS2012'', 20, CAST(1 AS bit)),
    (40, NULL, N''VPSForPC'', 20, CAST(1 AS bit)),
    (41, NULL, N''Lync'', 24, CAST(1 AS bit)),
    (42, N''SolidCP.EnterpriseServer.HeliconZooController'', N''HeliconZoo'', 2, CAST(1 AS bit)),
    (44, N''SolidCP.EnterpriseServer.EnterpriseStorageController'', N''EnterpriseStorage'', 26, CAST(1 AS bit)),
    (45, NULL, N''RDS'', 27, CAST(1 AS bit)),
    (46, N''SolidCP.EnterpriseServer.DatabaseServerController'', N''MsSQL2014'', 10, CAST(1 AS bit)),
    (47, NULL, N''Service Levels'', 2, CAST(1 AS bit)),
    (49, N''SolidCP.EnterpriseServer.StorageSpacesController'', N''StorageSpaceServices'', 26, CAST(1 AS bit)),
    (50, N''SolidCP.EnterpriseServer.DatabaseServerController'', N''MariaDB'', 11, CAST(1 AS bit)),
    (52, NULL, N''SfB'', 26, CAST(1 AS bit)),
    (61, NULL, N''MailFilters'', 5, CAST(1 AS bit)),
    (71, N''SolidCP.EnterpriseServer.DatabaseServerController'', N''MsSQL2016'', 10, CAST(1 AS bit)),
    (72, N''SolidCP.EnterpriseServer.DatabaseServerController'', N''MsSQL2017'', 10, CAST(1 AS bit)),
    (73, N''SolidCP.EnterpriseServer.HostedSharePointServerEntController'', N''Sharepoint Enterprise Server'', 15, CAST(1 AS bit)),
    (74, N''SolidCP.EnterpriseServer.DatabaseServerController'', N''MsSQL2019'', 10, CAST(1 AS bit)),
    (75, N''SolidCP.EnterpriseServer.DatabaseServerController'', N''MsSQL2022'', 10, CAST(1 AS bit)),
    (90, N''SolidCP.EnterpriseServer.DatabaseServerController'', N''MySQL8'', 12, CAST(1 AS bit)),
    (167, NULL, N''Proxmox'', 20, CAST(1 AS bit))');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'GroupID', N'GroupController', N'GroupName', N'GroupOrder', N'ShowGroup') AND [object_id] = OBJECT_ID(N'[ResourceGroups]'))
        SET IDENTITY_INSERT [ResourceGroups] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'TaskID', N'RoleID', N'TaskType') AND [object_id] = OBJECT_ID(N'[ScheduleTasks]'))
        SET IDENTITY_INSERT [ScheduleTasks] ON;
    EXEC(N'INSERT INTO [ScheduleTasks] ([TaskID], [RoleID], [TaskType])
    VALUES (N''SCHEDULE_TASK_ACTIVATE_PAID_INVOICES'', 0, N''SolidCP.Ecommerce.EnterpriseServer.ActivatePaidInvoicesTask, SolidCP.EnterpriseServer.Code''),
    (N''SCHEDULE_TASK_AUDIT_LOG_REPORT'', 3, N''SolidCP.EnterpriseServer.AuditLogReportTask, SolidCP.EnterpriseServer.Code''),
    (N''SCHEDULE_TASK_BACKUP'', 1, N''SolidCP.EnterpriseServer.BackupTask, SolidCP.EnterpriseServer.Code''),
    (N''SCHEDULE_TASK_BACKUP_DATABASE'', 3, N''SolidCP.EnterpriseServer.BackupDatabaseTask, SolidCP.EnterpriseServer.Code''),
    (N''SCHEDULE_TASK_CALCULATE_EXCHANGE_DISKSPACE'', 2, N''SolidCP.EnterpriseServer.CalculateExchangeDiskspaceTask, SolidCP.EnterpriseServer.Code''),
    (N''SCHEDULE_TASK_CALCULATE_PACKAGES_BANDWIDTH'', 1, N''SolidCP.EnterpriseServer.CalculatePackagesBandwidthTask, SolidCP.EnterpriseServer.Code''),
    (N''SCHEDULE_TASK_CALCULATE_PACKAGES_DISKSPACE'', 1, N''SolidCP.EnterpriseServer.CalculatePackagesDiskspaceTask, SolidCP.EnterpriseServer.Code''),
    (N''SCHEDULE_TASK_CANCEL_OVERDUE_INVOICES'', 0, N''SolidCP.Ecommerce.EnterpriseServer.CancelOverdueInvoicesTask, SolidCP.EnterpriseServer.Code''),
    (N''SCHEDULE_TASK_CHECK_WEBSITE'', 3, N''SolidCP.EnterpriseServer.CheckWebSiteTask, SolidCP.EnterpriseServer.Code''),
    (N''SCHEDULE_TASK_DELETE_EXCHANGE_ACCOUNTS'', 3, N''SolidCP.EnterpriseServer.DeleteExchangeAccountsTask, SolidCP.EnterpriseServer.Code''),
    (N''SCHEDULE_TASK_DOMAIN_EXPIRATION'', 3, N''SolidCP.EnterpriseServer.DomainExpirationTask, SolidCP.EnterpriseServer.Code''),
    (N''SCHEDULE_TASK_DOMAIN_LOOKUP'', 1, N''SolidCP.EnterpriseServer.DomainLookupViewTask, SolidCP.EnterpriseServer.Code''),
    (N''SCHEDULE_TASK_FTP_FILES'', 3, N''SolidCP.EnterpriseServer.FTPFilesTask, SolidCP.EnterpriseServer.Code''),
    (N''SCHEDULE_TASK_GENERATE_INVOICES'', 0, N''SolidCP.Ecommerce.EnterpriseServer.GenerateInvoicesTask, SolidCP.EnterpriseServer.Code''),
    (N''SCHEDULE_TASK_HOSTED_SOLUTION_REPORT'', 2, N''SolidCP.EnterpriseServer.HostedSolutionReportTask, SolidCP.EnterpriseServer.Code''),
    (N''SCHEDULE_TASK_NOTIFY_OVERUSED_DATABASES'', 2, N''SolidCP.EnterpriseServer.NotifyOverusedDatabasesTask, SolidCP.EnterpriseServer.Code''),
    (N''SCHEDULE_TASK_RUN_PAYMENT_QUEUE'', 0, N''SolidCP.Ecommerce.EnterpriseServer.RunPaymentQueueTask, SolidCP.EnterpriseServer.Code''),
    (N''SCHEDULE_TASK_RUN_SYSTEM_COMMAND'', 1, N''SolidCP.EnterpriseServer.RunSystemCommandTask, SolidCP.EnterpriseServer.Code''),
    (N''SCHEDULE_TASK_SEND_MAIL'', 3, N''SolidCP.EnterpriseServer.SendMailNotificationTask, SolidCP.EnterpriseServer.Code''),
    (N''SCHEDULE_TASK_SUSPEND_OVERDUE_INVOICES'', 0, N''SolidCP.Ecommerce.EnterpriseServer.SuspendOverdueInvoicesTask, SolidCP.EnterpriseServer.Code''),
    (N''SCHEDULE_TASK_SUSPEND_PACKAGES'', 2, N''SolidCP.EnterpriseServer.SuspendOverusedPackagesTask, SolidCP.EnterpriseServer.Code''),
    (N''SCHEDULE_TASK_USER_PASSWORD_EXPIRATION_NOTIFICATION'', 1, N''SolidCP.EnterpriseServer.UserPasswordExpirationNotificationTask, SolidCP.EnterpriseServer.Code''),
    (N''SCHEDULE_TASK_ZIP_FILES'', 3, N''SolidCP.EnterpriseServer.ZipFilesTask, SolidCP.EnterpriseServer.Code'')');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'TaskID', N'RoleID', N'TaskType') AND [object_id] = OBJECT_ID(N'[ScheduleTasks]'))
        SET IDENTITY_INSERT [ScheduleTasks] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'PropertyName', N'SettingsName', N'PropertyValue') AND [object_id] = OBJECT_ID(N'[SystemSettings]'))
        SET IDENTITY_INSERT [SystemSettings] ON;
    EXEC(N'INSERT INTO [SystemSettings] ([PropertyName], [SettingsName], [PropertyValue])
    VALUES (N''AccessIps'', N''AccessIpsSettings'', N''''),
    (N''CanPeerChangeMfa'', N''AuthenticationSettings'', N''True''),
    (N''MfaTokenAppDisplayName'', N''AuthenticationSettings'', N''SolidCP''),
    (N''BackupsPath'', N''BackupSettings'', N''c:\HostingBackups''),
    (N''SmtpEnableSsl'', N''SmtpSettings'', N''False''),
    (N''SmtpPort'', N''SmtpSettings'', N''25''),
    (N''SmtpServer'', N''SmtpSettings'', N''127.0.0.1''),
    (N''SmtpUsername'', N''SmtpSettings'', N''postmaster'')');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'PropertyName', N'SettingsName', N'PropertyValue') AND [object_id] = OBJECT_ID(N'[SystemSettings]'))
        SET IDENTITY_INSERT [SystemSettings] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'PropertyName', N'SettingsName', N'ThemeID', N'PropertyValue') AND [object_id] = OBJECT_ID(N'[ThemeSettings]'))
        SET IDENTITY_INSERT [ThemeSettings] ON;
    EXEC(N'INSERT INTO [ThemeSettings] ([PropertyName], [SettingsName], [ThemeID], [PropertyValue])
    VALUES (N''#0727d7'', N''color-header'', 1, N''headercolor1''),
    (N''#157d4c'', N''color-header'', 1, N''headercolor4''),
    (N''#23282c'', N''color-header'', 1, N''headercolor2''),
    (N''#673ab7'', N''color-header'', 1, N''headercolor5''),
    (N''#795548'', N''color-header'', 1, N''headercolor6''),
    (N''#d3094e'', N''color-header'', 1, N''headercolor7''),
    (N''#e10a1f'', N''color-header'', 1, N''headercolor3''),
    (N''#ff9800'', N''color-header'', 1, N''headercolor8''),
    (N''#1f0e3b'', N''color-Sidebar'', 1, N''sidebarcolor8''),
    (N''#230924'', N''color-Sidebar'', 1, N''sidebarcolor4''),
    (N''#408851'', N''color-Sidebar'', 1, N''sidebarcolor3''),
    (N''#5b737f'', N''color-Sidebar'', 1, N''sidebarcolor2''),
    (N''#6c85ec'', N''color-Sidebar'', 1, N''sidebarcolor1''),
    (N''#903a85'', N''color-Sidebar'', 1, N''sidebarcolor5''),
    (N''#a04846'', N''color-Sidebar'', 1, N''sidebarcolor6''),
    (N''#a65314'', N''color-Sidebar'', 1, N''sidebarcolor7''),
    (N''Dark'', N''Style'', 1, N''dark-theme''),
    (N''Light'', N''Style'', 1, N''light-theme''),
    (N''Minimal'', N''Style'', 1, N''minimal-theme''),
    (N''Semi Dark'', N''Style'', 1, N''semi-dark'')');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'PropertyName', N'SettingsName', N'ThemeID', N'PropertyValue') AND [object_id] = OBJECT_ID(N'[ThemeSettings]'))
        SET IDENTITY_INSERT [ThemeSettings] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ThemeID', N'DisplayName', N'DisplayOrder', N'Enabled', N'LTRName', N'RTLName') AND [object_id] = OBJECT_ID(N'[Themes]'))
        SET IDENTITY_INSERT [Themes] ON;
    EXEC(N'INSERT INTO [Themes] ([ThemeID], [DisplayName], [DisplayOrder], [Enabled], [LTRName], [RTLName])
    VALUES (1, N''SolidCP v1'', 1, 1, N''Default'', N''Default'')');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ThemeID', N'DisplayName', N'DisplayOrder', N'Enabled', N'LTRName', N'RTLName') AND [object_id] = OBJECT_ID(N'[Themes]'))
        SET IDENTITY_INSERT [Themes] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'UserID', N'AdditionalParams', N'Address', N'Changed', N'City', N'Comments', N'CompanyName', N'Country', N'Created', N'EcommerceEnabled', N'Email', N'FailedLogins', N'Fax', N'FirstName', N'HtmlMail', N'InstantMessenger', N'IsDemo', N'IsPeer', N'LastName', N'LoginStatusId', N'MfaMode', N'OneTimePasswordState', N'OwnerID', N'Password', N'PinSecret', N'PrimaryPhone', N'RoleID', N'SecondaryEmail', N'SecondaryPhone', N'State', N'StatusID', N'SubscriberNumber', N'Username', N'Zip') AND [object_id] = OBJECT_ID(N'[Users]'))
        SET IDENTITY_INSERT [Users] ON;
    EXEC(N'INSERT INTO [Users] ([UserID], [AdditionalParams], [Address], [Changed], [City], [Comments], [CompanyName], [Country], [Created], [EcommerceEnabled], [Email], [FailedLogins], [Fax], [FirstName], [HtmlMail], [InstantMessenger], [IsDemo], [IsPeer], [LastName], [LoginStatusId], [MfaMode], [OneTimePasswordState], [OwnerID], [Password], [PinSecret], [PrimaryPhone], [RoleID], [SecondaryEmail], [SecondaryPhone], [State], [StatusID], [SubscriberNumber], [Username], [Zip])
    VALUES (1, NULL, N'''', ''2010-07-16T12:53:02.453'', N'''', N'''', NULL, N'''', ''2010-07-16T12:53:02.453'', CAST(1 AS bit), N''serveradmin@myhosting.com'', NULL, '''', N''Enterprise'', CAST(1 AS bit), '''', CAST(0 AS bit), CAST(0 AS bit), N''Administrator'', NULL, 0, NULL, NULL, N'''', NULL, '''', 1, N'''', '''', N'''', 1, NULL, N''serveradmin'', '''')');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'UserID', N'AdditionalParams', N'Address', N'Changed', N'City', N'Comments', N'CompanyName', N'Country', N'Created', N'EcommerceEnabled', N'Email', N'FailedLogins', N'Fax', N'FirstName', N'HtmlMail', N'InstantMessenger', N'IsDemo', N'IsPeer', N'LastName', N'LoginStatusId', N'MfaMode', N'OneTimePasswordState', N'OwnerID', N'Password', N'PinSecret', N'PrimaryPhone', N'RoleID', N'SecondaryEmail', N'SecondaryPhone', N'State', N'StatusID', N'SubscriberNumber', N'Username', N'Zip') AND [object_id] = OBJECT_ID(N'[Users]'))
        SET IDENTITY_INSERT [Users] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'DatabaseVersion', N'BuildDate') AND [object_id] = OBJECT_ID(N'[Versions]'))
        SET IDENTITY_INSERT [Versions] ON;
    EXEC(N'INSERT INTO [Versions] ([DatabaseVersion], [BuildDate])
    VALUES (''1.0'', ''2010-04-10T00:00:00.000''),
    (''1.0.1.0'', ''2010-07-16T12:53:03.563''),
    (''1.0.2.0'', ''2010-09-03T00:00:00.000''),
    (''1.1.0.9'', ''2010-11-16T00:00:00.000''),
    (''1.1.2.13'', ''2011-04-15T00:00:00.000''),
    (''1.2.0.38'', ''2011-07-13T00:00:00.000''),
    (''1.2.1.6'', ''2012-03-29T00:00:00.000''),
    (''1.4.9'', ''2024-04-20T00:00:00.000''),
    (''2.0.0.228'', ''2012-12-07T00:00:00.000'')');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'DatabaseVersion', N'BuildDate') AND [object_id] = OBJECT_ID(N'[Versions]'))
        SET IDENTITY_INSERT [Versions] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'PackageID', N'BandwidthUpdated', N'DefaultTopPackage', N'OverrideQuotas', N'PackageComments', N'PackageName', N'ParentPackageID', N'PlanID', N'PurchaseDate', N'ServerID', N'StatusID', N'StatusIDchangeDate', N'UserID') AND [object_id] = OBJECT_ID(N'[Packages]'))
        SET IDENTITY_INSERT [Packages] ON;
    EXEC(N'INSERT INTO [Packages] ([PackageID], [BandwidthUpdated], [DefaultTopPackage], [OverrideQuotas], [PackageComments], [PackageName], [ParentPackageID], [PlanID], [PurchaseDate], [ServerID], [StatusID], [StatusIDchangeDate], [UserID])
    VALUES (1, NULL, CAST(0 AS bit), CAST(0 AS bit), N'''', N''System'', NULL, NULL, NULL, NULL, 1, ''2024-04-20T11:02:58.560'', 1)');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'PackageID', N'BandwidthUpdated', N'DefaultTopPackage', N'OverrideQuotas', N'PackageComments', N'PackageName', N'ParentPackageID', N'PlanID', N'PurchaseDate', N'ServerID', N'StatusID', N'StatusIDchangeDate', N'UserID') AND [object_id] = OBJECT_ID(N'[Packages]'))
        SET IDENTITY_INSERT [Packages] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ProviderID', N'DisableAutoDiscovery', N'DisplayName', N'EditorControl', N'GroupID', N'ProviderName', N'ProviderType') AND [object_id] = OBJECT_ID(N'[Providers]'))
        SET IDENTITY_INSERT [Providers] ON;
    EXEC(N'INSERT INTO [Providers] ([ProviderID], [DisableAutoDiscovery], [DisplayName], [EditorControl], [GroupID], [ProviderName], [ProviderType])
    VALUES (1, NULL, N''Windows Server 2003'', N''Windows2003'', 1, N''Windows2003'', N''SolidCP.Providers.OS.Windows2003, SolidCP.Providers.OS.Windows2003''),
    (2, NULL, N''Internet Information Services 6.0'', N''IIS60'', 2, N''IIS60'', N''SolidCP.Providers.Web.IIs60, SolidCP.Providers.Web.IIs60''),
    (3, NULL, N''Microsoft FTP Server 6.0'', N''MSFTP60'', 3, N''MSFTP60'', N''SolidCP.Providers.FTP.MsFTP, SolidCP.Providers.FTP.IIs60''),
    (4, NULL, N''MailEnable Server 1.x - 7.x'', N''MailEnable'', 4, N''MailEnable'', N''SolidCP.Providers.Mail.MailEnable, SolidCP.Providers.Mail.MailEnable''),
    (5, NULL, N''Microsoft SQL Server 2000'', N''MSSQL'', 5, N''MSSQL'', N''SolidCP.Providers.Database.MsSqlServer, SolidCP.Providers.Database.SqlServer''),
    (6, NULL, N''MySQL Server 4.x'', N''MySQL'', 6, N''MySQL'', N''SolidCP.Providers.Database.MySqlServer, SolidCP.Providers.Database.MySQL''),
    (7, NULL, N''Microsoft DNS Server'', N''MSDNS'', 7, N''MSDNS'', N''SolidCP.Providers.DNS.MsDNS, SolidCP.Providers.DNS.MsDNS''),
    (8, NULL, N''AWStats Statistics Service'', N''AWStats'', 8, N''AWStats'', N''SolidCP.Providers.Statistics.AWStats, SolidCP.Providers.Statistics.AWStats''),
    (9, NULL, N''SimpleDNS Plus 4.x'', N''SimpleDNS'', 7, N''SimpleDNS'', N''SolidCP.Providers.DNS.SimpleDNS, SolidCP.Providers.DNS.SimpleDNS''),
    (10, NULL, N''SmarterStats 3.x'', N''SmarterStats'', 8, N''SmarterStats'', N''SolidCP.Providers.Statistics.SmarterStats, SolidCP.Providers.Statistics.SmarterStats''),
    (11, NULL, N''SmarterMail 2.x'', N''SmarterMail'', 4, N''SmarterMail'', N''SolidCP.Providers.Mail.SmarterMail2, SolidCP.Providers.Mail.SmarterMail2''),
    (12, NULL, N''Gene6 FTP Server 3.x'', N''Gene6FTP'', 3, N''Gene6FTP'', N''SolidCP.Providers.FTP.Gene6, SolidCP.Providers.FTP.Gene6''),
    (13, NULL, N''Merak Mail Server 8.0.3 - 9.2.x'', N''Merak'', 4, N''Merak'', N''SolidCP.Providers.Mail.Merak, SolidCP.Providers.Mail.Merak''),
    (14, NULL, N''SmarterMail 3.x - 4.x'', N''SmarterMail'', 4, N''SmarterMail'', N''SolidCP.Providers.Mail.SmarterMail3, SolidCP.Providers.Mail.SmarterMail3''),
    (16, NULL, N''Microsoft SQL Server 2005'', N''MSSQL'', 10, N''MSSQL'', N''SolidCP.Providers.Database.MsSqlServer2005, SolidCP.Providers.Database.SqlServer''),
    (17, NULL, N''MySQL Server 5.0'', N''MySQL'', 11, N''MySQL'', N''SolidCP.Providers.Database.MySqlServer50, SolidCP.Providers.Database.MySQL''),
    (18, NULL, N''MDaemon 9.x - 11.x'', N''MDaemon'', 4, N''MDaemon'', N''SolidCP.Providers.Mail.MDaemon, SolidCP.Providers.Mail.MDaemon''),
    (19, CAST(1 AS bit), N''ArGoSoft Mail Server 1.x'', N''ArgoMail'', 4, N''ArgoMail'', N''SolidCP.Providers.Mail.ArgoMail, SolidCP.Providers.Mail.ArgoMail''),
    (20, NULL, N''hMailServer 4.2'', N''hMailServer'', 4, N''hMailServer'', N''SolidCP.Providers.Mail.hMailServer, SolidCP.Providers.Mail.hMailServer''),
    (21, NULL, N''Ability Mail Server 2.x'', N''AbilityMailServer'', 4, N''AbilityMailServer'', N''SolidCP.Providers.Mail.AbilityMailServer, SolidCP.Providers.Mail.AbilityMailServer''),
    (22, NULL, N''hMailServer 4.3'', N''hMailServer43'', 4, N''hMailServer43'', N''SolidCP.Providers.Mail.hMailServer43, SolidCP.Providers.Mail.hMailServer43''),
    (24, NULL, N''ISC BIND 8.x - 9.x'', N''Bind'', 7, N''Bind'', N''SolidCP.Providers.DNS.IscBind, SolidCP.Providers.DNS.Bind''),
    (25, NULL, N''Serv-U FTP 6.x'', N''ServU'', 3, N''ServU'', N''SolidCP.Providers.FTP.ServU, SolidCP.Providers.FTP.ServU''),
    (26, NULL, N''FileZilla FTP Server 0.9'', N''FileZilla'', 3, N''FileZilla'', N''SolidCP.Providers.FTP.FileZilla, SolidCP.Providers.FTP.FileZilla''),
    (27, NULL, N''Hosted Microsoft Exchange Server 2007'', N''Exchange'', 12, N''Exchange2007'', N''SolidCP.Providers.HostedSolution.Exchange2007, SolidCP.Providers.HostedSolution''),
    (28, NULL, N''SimpleDNS Plus 5.x'', N''SimpleDNS'', 7, N''SimpleDNS'', N''SolidCP.Providers.DNS.SimpleDNS5, SolidCP.Providers.DNS.SimpleDNS50''),
    (29, NULL, N''SmarterMail 5.x'', N''SmarterMail50'', 4, N''SmarterMail'', N''SolidCP.Providers.Mail.SmarterMail5, SolidCP.Providers.Mail.SmarterMail5''),
    (30, NULL, N''MySQL Server 5.1'', N''MySQL'', 11, N''MySQL'', N''SolidCP.Providers.Database.MySqlServer51, SolidCP.Providers.Database.MySQL''),
    (31, NULL, N''SmarterStats 4.x'', N''SmarterStats'', 8, N''SmarterStats'', N''SolidCP.Providers.Statistics.SmarterStats4, SolidCP.Providers.Statistics.SmarterStats''),
    (32, NULL, N''Hosted Microsoft Exchange Server 2010'', N''Exchange'', 12, N''Exchange2010'', N''SolidCP.Providers.HostedSolution.Exchange2010, SolidCP.Providers.HostedSolution''),
    (55, CAST(1 AS bit), N''Nettica DNS'', N''NetticaDNS'', 7, N''NetticaDNS'', N''SolidCP.Providers.DNS.Nettica, SolidCP.Providers.DNS.Nettica''),
    (56, CAST(1 AS bit), N''PowerDNS'', N''PowerDNS'', 7, N''PowerDNS'', N''SolidCP.Providers.DNS.PowerDNS, SolidCP.Providers.DNS.PowerDNS''),
    (60, NULL, N''SmarterMail 6.x'', N''SmarterMail60'', 4, N''SmarterMail'', N''SolidCP.Providers.Mail.SmarterMail6, SolidCP.Providers.Mail.SmarterMail6''),
    (61, NULL, N''Merak Mail Server 10.x'', N''Merak'', 4, N''Merak'', N''SolidCP.Providers.Mail.Merak10, SolidCP.Providers.Mail.Merak10''),
    (62, NULL, N''SmarterStats 5.x +'', N''SmarterStats'', 8, N''SmarterStats'', N''SolidCP.Providers.Statistics.SmarterStats5, SolidCP.Providers.Statistics.SmarterStats''),
    (63, NULL, N''hMailServer 5.x'', N''hMailServer5'', 4, N''hMailServer5'', N''SolidCP.Providers.Mail.hMailServer5, SolidCP.Providers.Mail.hMailServer5''),
    (64, NULL, N''SmarterMail 7.x - 8.x'', N''SmarterMail60'', 4, N''SmarterMail'', N''SolidCP.Providers.Mail.SmarterMail7, SolidCP.Providers.Mail.SmarterMail7''),
    (65, NULL, N''SmarterMail 9.x'', N''SmarterMail60'', 4, N''SmarterMail'', N''SolidCP.Providers.Mail.SmarterMail9, SolidCP.Providers.Mail.SmarterMail9''),
    (66, NULL, N''SmarterMail 10.x +'', N''SmarterMail100'', 4, N''SmarterMail'', N''SolidCP.Providers.Mail.SmarterMail10, SolidCP.Providers.Mail.SmarterMail10''),
    (67, NULL, N''SmarterMail 100.x +'', N''SmarterMail100x'', 4, N''SmarterMail'', N''SolidCP.Providers.Mail.SmarterMail100, SolidCP.Providers.Mail.SmarterMail100''),
    (90, NULL, N''Hosted Microsoft Exchange Server 2010 SP2'', N''Exchange'', 12, N''Exchange2010SP2'', N''SolidCP.Providers.HostedSolution.Exchange2010SP2, SolidCP.Providers.HostedSolution''),
    (91, CAST(1 AS bit), N''Hosted Microsoft Exchange Server 2013'', N''Exchange'', 12, N''Exchange2013'', N''SolidCP.Providers.HostedSolution.Exchange2013, SolidCP.Providers.HostedSolution.Exchange2013'');
    INSERT INTO [Providers] ([ProviderID], [DisableAutoDiscovery], [DisplayName], [EditorControl], [GroupID], [ProviderName], [ProviderType])
    VALUES (92, NULL, N''Hosted Microsoft Exchange Server 2016'', N''Exchange'', 12, N''Exchange2016'', N''SolidCP.Providers.HostedSolution.Exchange2016, SolidCP.Providers.HostedSolution.Exchange2016''),
    (93, NULL, N''Hosted Microsoft Exchange Server 2019'', N''Exchange'', 12, N''Exchange2016'', N''SolidCP.Providers.HostedSolution.Exchange2019, SolidCP.Providers.HostedSolution.Exchange2019''),
    (100, NULL, N''Windows Server 2008'', N''Windows2008'', 1, N''Windows2008'', N''SolidCP.Providers.OS.Windows2008, SolidCP.Providers.OS.Windows2008''),
    (101, NULL, N''Internet Information Services 7.0'', N''IIS70'', 2, N''IIS70'', N''SolidCP.Providers.Web.IIs70, SolidCP.Providers.Web.IIs70''),
    (102, NULL, N''Microsoft FTP Server 7.0'', N''MSFTP70'', 3, N''MSFTP70'', N''SolidCP.Providers.FTP.MsFTP, SolidCP.Providers.FTP.IIs70''),
    (103, NULL, N''Hosted Organizations'', N''Organizations'', 13, N''Organizations'', N''SolidCP.Providers.HostedSolution.OrganizationProvider, SolidCP.Providers.HostedSolution''),
    (104, NULL, N''Windows Server 2012'', N''Windows2012'', 1, N''Windows2012'', N''SolidCP.Providers.OS.Windows2012, SolidCP.Providers.OS.Windows2012''),
    (105, NULL, N''Internet Information Services 8.0'', N''IIS70'', 2, N''IIS80'', N''SolidCP.Providers.Web.IIs80, SolidCP.Providers.Web.IIs80''),
    (106, NULL, N''Microsoft FTP Server 8.0'', N''MSFTP70'', 3, N''MSFTP80'', N''SolidCP.Providers.FTP.MsFTP80, SolidCP.Providers.FTP.IIs80''),
    (110, NULL, N''Cerberus FTP Server 6.x'', N''CerberusFTP6'', 3, N''CerberusFTP6'', N''SolidCP.Providers.FTP.CerberusFTP6, SolidCP.Providers.FTP.CerberusFTP6''),
    (111, NULL, N''Windows Server 2016'', N''Windows2008'', 1, N''Windows2016'', N''SolidCP.Providers.OS.Windows2016, SolidCP.Providers.OS.Windows2016''),
    (112, NULL, N''Internet Information Services 10.0'', N''IIS70'', 2, N''IIS100'', N''SolidCP.Providers.Web.IIs100, SolidCP.Providers.Web.IIs100''),
    (113, NULL, N''Microsoft FTP Server 10.0'', N''MSFTP70'', 3, N''MSFTP100'', N''SolidCP.Providers.FTP.MsFTP100, SolidCP.Providers.FTP.IIs100''),
    (135, CAST(1 AS bit), N''Web Application Engines'', N''HeliconZoo'', 42, N''HeliconZoo'', N''SolidCP.Providers.Web.HeliconZoo.HeliconZoo, SolidCP.Providers.Web.HeliconZoo''),
    (160, NULL, N''IceWarp Mail Server'', N''IceWarp'', 4, N''IceWarp'', N''SolidCP.Providers.Mail.IceWarp, SolidCP.Providers.Mail.IceWarp''),
    (200, NULL, N''Hosted Windows SharePoint Services 3.0'', N''HostedSharePoint30'', 20, N''HostedSharePoint30'', N''SolidCP.Providers.HostedSolution.HostedSharePointServer, SolidCP.Providers.HostedSolution''),
    (201, NULL, N''Hosted MS CRM 4.0'', N''CRM'', 21, N''CRM'', N''SolidCP.Providers.HostedSolution.CRMProvider, SolidCP.Providers.HostedSolution''),
    (202, NULL, N''Microsoft SQL Server 2008'', N''MSSQL'', 22, N''MsSQL'', N''SolidCP.Providers.Database.MsSqlServer2008, SolidCP.Providers.Database.SqlServer''),
    (203, CAST(1 AS bit), N''BlackBerry 4.1'', N''BlackBerry'', 31, N''BlackBerry 4.1'', N''SolidCP.Providers.HostedSolution.BlackBerryProvider, SolidCP.Providers.HostedSolution''),
    (204, CAST(1 AS bit), N''BlackBerry 5.0'', N''BlackBerry5'', 31, N''BlackBerry 5.0'', N''SolidCP.Providers.HostedSolution.BlackBerry5Provider, SolidCP.Providers.HostedSolution''),
    (205, CAST(1 AS bit), N''Office Communications Server 2007 R2'', N''OCS'', 32, N''OCS'', N''SolidCP.Providers.HostedSolution.OCS2007R2, SolidCP.Providers.HostedSolution''),
    (206, CAST(1 AS bit), N''OCS Edge server'', N''OCS_Edge'', 32, N''OCSEdge'', N''SolidCP.Providers.HostedSolution.OCSEdge2007R2, SolidCP.Providers.HostedSolution''),
    (208, NULL, N''Hosted SharePoint Foundation 2010'', N''HostedSharePoint30'', 20, N''HostedSharePoint2010'', N''SolidCP.Providers.HostedSolution.HostedSharePointServer2010, SolidCP.Providers.HostedSolution''),
    (209, NULL, N''Microsoft SQL Server 2012'', N''MSSQL'', 23, N''MsSQL'', N''SolidCP.Providers.Database.MsSqlServer2012, SolidCP.Providers.Database.SqlServer''),
    (250, NULL, N''Microsoft Lync Server 2010 Multitenant Hosting Pack'', N''Lync'', 41, N''Lync2010'', N''SolidCP.Providers.HostedSolution.Lync2010, SolidCP.Providers.HostedSolution''),
    (300, CAST(1 AS bit), N''Microsoft Hyper-V'', N''HyperV'', 30, N''HyperV'', N''SolidCP.Providers.Virtualization.HyperV, SolidCP.Providers.Virtualization.HyperV''),
    (301, NULL, N''MySQL Server 5.5'', N''MySQL'', 11, N''MySQL'', N''SolidCP.Providers.Database.MySqlServer55, SolidCP.Providers.Database.MySQL''),
    (302, NULL, N''MySQL Server 5.6'', N''MySQL'', 11, N''MySQL'', N''SolidCP.Providers.Database.MySqlServer56, SolidCP.Providers.Database.MySQL''),
    (303, NULL, N''MySQL Server 5.7'', N''MySQL'', 11, N''MySQL'', N''SolidCP.Providers.Database.MySqlServer57, SolidCP.Providers.Database.MySQL''),
    (304, NULL, N''MySQL Server 8.0'', N''MySQL'', 90, N''MySQL'', N''SolidCP.Providers.Database.MySqlServer80, SolidCP.Providers.Database.MySQL''),
    (305, NULL, N''MySQL Server 8.1'', N''MySQL'', 90, N''MySQL'', N''SolidCP.Providers.Database.MySqlServer81, SolidCP.Providers.Database.MySQL''),
    (306, NULL, N''MySQL Server 8.2'', N''MySQL'', 90, N''MySQL'', N''SolidCP.Providers.Database.MySqlServer82, SolidCP.Providers.Database.MySQL''),
    (350, CAST(1 AS bit), N''Microsoft Hyper-V 2012 R2'', N''HyperV2012R2'', 33, N''HyperV2012R2'', N''SolidCP.Providers.Virtualization.HyperV2012R2, SolidCP.Providers.Virtualization.HyperV2012R2''),
    (351, CAST(1 AS bit), N''Microsoft Hyper-V Virtual Machine Management'', N''HyperVvmm'', 33, N''HyperVvmm'', N''SolidCP.Providers.Virtualization.HyperVvmm, SolidCP.Providers.Virtualization.HyperVvmm''),
    (352, CAST(1 AS bit), N''Microsoft Hyper-V 2016'', N''HyperV2012R2'', 33, N''HyperV2016'', N''SolidCP.Providers.Virtualization.HyperV2016, SolidCP.Providers.Virtualization.HyperV2016''),
    (370, CAST(1 AS bit), N''Proxmox Virtualization (remote)'', N''Proxmox'', 167, N''Proxmox (remote)'', N''SolidCP.Providers.Virtualization.Proxmoxvps, SolidCP.Providers.Virtualization.Proxmoxvps''),
    (371, CAST(0 AS bit), N''Proxmox Virtualization'', N''Proxmox'', 167, N''Proxmox'', N''SolidCP.Providers.Virtualization.ProxmoxvpsLocal, SolidCP.Providers.Virtualization.Proxmoxvps''),
    (400, CAST(1 AS bit), N''Microsoft Hyper-V For Private Cloud'', N''HyperVForPrivateCloud'', 40, N''HyperVForPC'', N''SolidCP.Providers.VirtualizationForPC.HyperVForPC, SolidCP.Providers.VirtualizationForPC.HyperVForPC''),
    (410, NULL, N''Microsoft DNS Server 2012+'', N''MSDNS'', 7, N''MSDNS.2012'', N''SolidCP.Providers.DNS.MsDNS2012, SolidCP.Providers.DNS.MsDNS2012''),
    (500, NULL, N''Unix System'', N''Unix'', 1, N''UnixSystem'', N''SolidCP.Providers.OS.Unix, SolidCP.Providers.OS.Unix''),
    (600, CAST(1 AS bit), N''Enterprise Storage Windows 2012'', N''EnterpriseStorage'', 44, N''EnterpriseStorage2012'', N''SolidCP.Providers.EnterpriseStorage.Windows2012, SolidCP.Providers.EnterpriseStorage.Windows2012''),
    (700, CAST(1 AS bit), N''Storage Spaces Windows 2012'', N''StorageSpaceServices'', 49, N''StorageSpace2012'', N''SolidCP.Providers.StorageSpaces.Windows2012, SolidCP.Providers.StorageSpaces.Windows2012'');
    INSERT INTO [Providers] ([ProviderID], [DisableAutoDiscovery], [DisplayName], [EditorControl], [GroupID], [ProviderName], [ProviderType])
    VALUES (1201, NULL, N''Hosted MS CRM 2011'', N''CRM2011'', 21, N''CRM'', N''SolidCP.Providers.HostedSolution.CRMProvider2011, SolidCP.Providers.HostedSolution.CRM2011''),
    (1202, NULL, N''Hosted MS CRM 2013'', N''CRM2011'', 24, N''CRM'', N''SolidCP.Providers.HostedSolution.CRMProvider2013, SolidCP.Providers.HostedSolution.Crm2013''),
    (1203, NULL, N''Microsoft SQL Server 2014'', N''MSSQL'', 46, N''MsSQL'', N''SolidCP.Providers.Database.MsSqlServer2014, SolidCP.Providers.Database.SqlServer''),
    (1205, NULL, N''Hosted MS CRM 2015'', N''CRM2011'', 24, N''CRM'', N''SolidCP.Providers.HostedSolution.CRMProvider2015, SolidCP.Providers.HostedSolution.Crm2015''),
    (1206, NULL, N''Hosted MS CRM 2016'', N''CRM2011'', 24, N''CRM'', N''SolidCP.Providers.HostedSolution.CRMProvider2016, SolidCP.Providers.HostedSolution.Crm2016''),
    (1301, NULL, N''Hosted SharePoint Foundation 2013'', N''HostedSharePoint30'', 20, N''HostedSharePoint2013'', N''SolidCP.Providers.HostedSolution.HostedSharePointServer2013, SolidCP.Providers.HostedSolution.SharePoint2013''),
    (1306, NULL, N''Hosted SharePoint Foundation 2016'', N''HostedSharePoint30'', 20, N''HostedSharePoint2016'', N''SolidCP.Providers.HostedSolution.HostedSharePointServer2016, SolidCP.Providers.HostedSolution.SharePoint2016''),
    (1401, NULL, N''Microsoft Lync Server 2013 Enterprise Edition'', N''Lync'', 41, N''Lync2013'', N''SolidCP.Providers.HostedSolution.Lync2013, SolidCP.Providers.HostedSolution.Lync2013''),
    (1402, NULL, N''Microsoft Lync Server 2013 Multitenant Hosting Pack'', N''Lync'', 41, N''Lync2013HP'', N''SolidCP.Providers.HostedSolution.Lync2013HP, SolidCP.Providers.HostedSolution.Lync2013HP''),
    (1403, NULL, N''Microsoft Skype for Business Server 2015'', N''SfB'', 52, N''SfB2015'', N''SolidCP.Providers.HostedSolution.SfB2015, SolidCP.Providers.HostedSolution.SfB2015''),
    (1404, NULL, N''Microsoft Skype for Business Server 2019'', N''SfB'', 52, N''SfB2019'', N''SolidCP.Providers.HostedSolution.SfB2019, SolidCP.Providers.HostedSolution.SfB2019''),
    (1501, CAST(1 AS bit), N''Remote Desktop Services Windows 2012'', N''RDS'', 45, N''RemoteDesktopServices2012'', N''SolidCP.Providers.RemoteDesktopServices.Windows2012,SolidCP.Providers.RemoteDesktopServices.Windows2012''),
    (1502, CAST(1 AS bit), N''Remote Desktop Services Windows 2016'', N''RDS'', 45, N''RemoteDesktopServices2012'', N''SolidCP.Providers.RemoteDesktopServices.Windows2016,SolidCP.Providers.RemoteDesktopServices.Windows2016''),
    (1503, CAST(1 AS bit), N''Remote Desktop Services Windows 2019'', N''RDS'', 45, N''RemoteDesktopServices2019'', N''SolidCP.Providers.RemoteDesktopServices.Windows2019,SolidCP.Providers.RemoteDesktopServices.Windows2019''),
    (1550, NULL, N''MariaDB 10.1'', N''MariaDB'', 50, N''MariaDB'', N''SolidCP.Providers.Database.MariaDB101, SolidCP.Providers.Database.MariaDB''),
    (1552, NULL, N''Hosted SharePoint Enterprise 2013'', N''HostedSharePoint30'', 73, N''HostedSharePoint2013Ent'', N''SolidCP.Providers.HostedSolution.HostedSharePointServer2013Ent, SolidCP.Providers.HostedSolution.SharePoint2013Ent''),
    (1560, NULL, N''MariaDB 10.2'', N''MariaDB'', 50, N''MariaDB'', N''SolidCP.Providers.Database.MariaDB102, SolidCP.Providers.Database.MariaDB''),
    (1570, CAST(1 AS bit), N''MariaDB 10.3'', N''MariaDB'', 50, N''MariaDB'', N''SolidCP.Providers.Database.MariaDB103, SolidCP.Providers.Database.MariaDB''),
    (1571, CAST(1 AS bit), N''MariaDB 10.4'', N''MariaDB'', 50, N''MariaDB'', N''SolidCP.Providers.Database.MariaDB104, SolidCP.Providers.Database.MariaDB''),
    (1572, NULL, N''MariaDB 10.5'', N''MariaDB'', 50, N''MariaDB'', N''SolidCP.Providers.Database.MariaDB105, SolidCP.Providers.Database.MariaDB''),
    (1573, NULL, N''MariaDB 10.6'', N''MariaDB'', 50, N''MariaDB'', N''SolidCP.Providers.Database.MariaDB106, SolidCP.Providers.Database.MariaDB''),
    (1601, CAST(1 AS bit), N''Mail Cleaner'', N''MailCleaner'', 61, N''MailCleaner'', N''SolidCP.Providers.Filters.MailCleaner, SolidCP.Providers.Filters.MailCleaner''),
    (1602, CAST(1 AS bit), N''SpamExperts Mail Filter'', N''SpamExperts'', 61, N''SpamExperts'', N''SolidCP.Providers.Filters.SpamExperts, SolidCP.Providers.Filters.SpamExperts''),
    (1701, NULL, N''Microsoft SQL Server 2016'', N''MSSQL'', 71, N''MsSQL'', N''SolidCP.Providers.Database.MsSqlServer2016, SolidCP.Providers.Database.SqlServer''),
    (1702, NULL, N''Hosted SharePoint Enterprise 2016'', N''HostedSharePoint30'', 73, N''HostedSharePoint2016Ent'', N''SolidCP.Providers.HostedSolution.HostedSharePointServer2016Ent, SolidCP.Providers.HostedSolution.SharePoint2016Ent''),
    (1703, NULL, N''SimpleDNS Plus 6.x'', N''SimpleDNS'', 7, N''SimpleDNS'', N''SolidCP.Providers.DNS.SimpleDNS6, SolidCP.Providers.DNS.SimpleDNS60''),
    (1704, CAST(1 AS bit), N''Microsoft SQL Server 2017'', N''MSSQL'', 72, N''MsSQL'', N''SolidCP.Providers.Database.MsSqlServer2017, SolidCP.Providers.Database.SqlServer''),
    (1705, CAST(1 AS bit), N''Microsoft SQL Server 2019'', N''MSSQL'', 74, N''MsSQL'', N''SolidCP.Providers.Database.MsSqlServer2019, SolidCP.Providers.Database.SqlServer''),
    (1706, NULL, N''Microsoft SQL Server 2022'', N''MSSQL'', 75, N''MsSQL'', N''SolidCP.Providers.Database.MsSqlServer2022, SolidCP.Providers.Database.SqlServer''),
    (1711, NULL, N''Hosted SharePoint 2019'', N''HostedSharePoint30'', 73, N''HostedSharePoint2019'', N''SolidCP.Providers.HostedSolution.HostedSharePointServer2019, SolidCP.Providers.HostedSolution.SharePoint2019''),
    (1800, NULL, N''Windows Server 2019'', N''Windows2012'', 1, N''Windows2019'', N''SolidCP.Providers.OS.Windows2019, SolidCP.Providers.OS.Windows2019''),
    (1801, CAST(1 AS bit), N''Microsoft Hyper-V 2019'', N''HyperV2012R2'', 33, N''HyperV2019'', N''SolidCP.Providers.Virtualization.HyperV2019, SolidCP.Providers.Virtualization.HyperV2019''),
    (1802, NULL, N''Windows Server 2022'', N''Windows2012'', 1, N''Windows2022'', N''SolidCP.Providers.OS.Windows2022, SolidCP.Providers.OS.Windows2022''),
    (1803, CAST(1 AS bit), N''Microsoft Hyper-V 2022'', N''HyperV2012R2'', 33, N''HyperV2022'', N''SolidCP.Providers.Virtualization.HyperV2022, SolidCP.Providers.Virtualization.HyperV2022''),
    (1901, NULL, N''SimpleDNS Plus 8.x'', N''SimpleDNS'', 7, N''SimpleDNS'', N''SolidCP.Providers.DNS.SimpleDNS8, SolidCP.Providers.DNS.SimpleDNS80''),
    (1902, NULL, N''Microsoft DNS Server 2016'', N''MSDNS'', 7, N''MSDNS.2016'', N''SolidCP.Providers.DNS.MsDNS2016, SolidCP.Providers.DNS.MsDNS2016''),
    (1903, NULL, N''SimpleDNS Plus 9.x'', N''SimpleDNS'', 7, N''SimpleDNS'', N''SolidCP.Providers.DNS.SimpleDNS9, SolidCP.Providers.DNS.SimpleDNS90''),
    (1910, NULL, N''vsftpd FTP Server 3 (Experimental)'', N''vsftpd'', 3, N''vsftpd'', N''SolidCP.Providers.FTP.VsFtp3, SolidCP.Providers.FTP.VsFtp''),
    (1911, NULL, N''Apache Web Server 2.4 (Experimental)'', N''Apache'', 2, N''Apache'', N''SolidCP.Providers.Web.Apache24, SolidCP.Providers.Web.Apache'')');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ProviderID', N'DisableAutoDiscovery', N'DisplayName', N'EditorControl', N'GroupID', N'ProviderName', N'ProviderType') AND [object_id] = OBJECT_ID(N'[Providers]'))
        SET IDENTITY_INSERT [Providers] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'QuotaID', N'GroupID', N'HideQuota', N'ItemTypeID', N'PerOrganization', N'QuotaDescription', N'QuotaName', N'QuotaOrder', N'QuotaTypeID', N'ServiceQuota') AND [object_id] = OBJECT_ID(N'[Quotas]'))
        SET IDENTITY_INSERT [Quotas] ON;
    EXEC(N'INSERT INTO [Quotas] ([QuotaID], [GroupID], [HideQuota], [ItemTypeID], [PerOrganization], [QuotaDescription], [QuotaName], [QuotaOrder], [QuotaTypeID], [ServiceQuota])
    VALUES (25, 2, NULL, NULL, NULL, N''ASP.NET 1.1'', N''Web.AspNet11'', 3, 1, CAST(0 AS bit)),
    (26, 2, NULL, NULL, NULL, N''ASP.NET 2.0'', N''Web.AspNet20'', 4, 1, CAST(0 AS bit)),
    (27, 2, NULL, NULL, NULL, N''ASP'', N''Web.Asp'', 2, 1, CAST(0 AS bit)),
    (28, 2, NULL, NULL, NULL, N''PHP 4.x'', N''Web.Php4'', 5, 1, CAST(0 AS bit)),
    (29, 2, NULL, NULL, NULL, N''PHP 5.x'', N''Web.Php5'', 6, 1, CAST(0 AS bit)),
    (30, 2, NULL, NULL, NULL, N''Perl'', N''Web.Perl'', 7, 1, CAST(0 AS bit)),
    (31, 2, NULL, NULL, NULL, N''Python'', N''Web.Python'', 8, 1, CAST(0 AS bit)),
    (32, 2, NULL, NULL, NULL, N''Virtual Directories'', N''Web.VirtualDirs'', 9, 1, CAST(0 AS bit)),
    (33, 2, NULL, NULL, NULL, N''FrontPage'', N''Web.FrontPage'', 10, 1, CAST(0 AS bit)),
    (34, 2, NULL, NULL, NULL, N''Custom Security Settings'', N''Web.Security'', 11, 1, CAST(0 AS bit)),
    (35, 2, NULL, NULL, NULL, N''Custom Default Documents'', N''Web.DefaultDocs'', 12, 1, CAST(0 AS bit)),
    (36, 2, NULL, NULL, NULL, N''Dedicated Application Pools'', N''Web.AppPools'', 13, 1, CAST(0 AS bit)),
    (37, 2, NULL, NULL, NULL, N''Custom Headers'', N''Web.Headers'', 14, 1, CAST(0 AS bit)),
    (38, 2, NULL, NULL, NULL, N''Custom Errors'', N''Web.Errors'', 15, 1, CAST(0 AS bit)),
    (39, 2, NULL, NULL, NULL, N''Custom MIME Types'', N''Web.Mime'', 16, 1, CAST(0 AS bit)),
    (40, 4, NULL, NULL, NULL, N''Max Mailbox Size'', N''Mail.MaxBoxSize'', 2, 3, CAST(0 AS bit)),
    (41, 5, NULL, NULL, NULL, N''Max Database Size'', N''MsSQL2000.MaxDatabaseSize'', 3, 3, CAST(0 AS bit)),
    (42, 5, NULL, NULL, NULL, N''Database Backups'', N''MsSQL2000.Backup'', 5, 1, CAST(0 AS bit)),
    (43, 5, NULL, NULL, NULL, N''Database Restores'', N''MsSQL2000.Restore'', 6, 1, CAST(0 AS bit)),
    (44, 5, NULL, NULL, NULL, N''Database Truncate'', N''MsSQL2000.Truncate'', 7, 1, CAST(0 AS bit)),
    (45, 6, NULL, NULL, NULL, N''Database Backups'', N''MySQL4.Backup'', 4, 1, CAST(0 AS bit)),
    (48, 7, NULL, NULL, NULL, N''DNS Editor'', N''DNS.Editor'', 1, 1, CAST(0 AS bit)),
    (49, 4, NULL, NULL, NULL, N''Max Group Recipients'', N''Mail.MaxGroupMembers'', 5, 3, CAST(0 AS bit)),
    (50, 4, NULL, NULL, NULL, N''Max List Recipients'', N''Mail.MaxListMembers'', 7, 3, CAST(0 AS bit)),
    (51, 1, NULL, NULL, NULL, N''Bandwidth, MB'', N''OS.Bandwidth'', 2, 2, CAST(0 AS bit)),
    (52, 1, NULL, NULL, NULL, N''Disk space, MB'', N''OS.Diskspace'', 1, 2, CAST(0 AS bit)),
    (53, 1, NULL, NULL, NULL, N''Domains'', N''OS.Domains'', 3, 2, CAST(0 AS bit)),
    (54, 1, NULL, NULL, NULL, N''Sub-Domains'', N''OS.SubDomains'', 4, 2, CAST(0 AS bit)),
    (55, 1, NULL, NULL, NULL, N''File Manager'', N''OS.FileManager'', 6, 1, CAST(0 AS bit)),
    (57, 2, NULL, NULL, NULL, N''CGI-BIN Folder'', N''Web.CgiBin'', 8, 1, CAST(0 AS bit)),
    (58, 2, NULL, NULL, NULL, N''Secured Folders'', N''Web.SecuredFolders'', 8, 1, CAST(0 AS bit)),
    (60, 2, NULL, NULL, NULL, N''Web Sites Redirection'', N''Web.Redirections'', 8, 1, CAST(0 AS bit)),
    (61, 2, NULL, NULL, NULL, N''Changing Sites Root Folders'', N''Web.HomeFolders'', 8, 1, CAST(0 AS bit)),
    (64, 10, NULL, NULL, NULL, N''Max Database Size'', N''MsSQL2005.MaxDatabaseSize'', 3, 3, CAST(0 AS bit)),
    (65, 10, NULL, NULL, NULL, N''Database Backups'', N''MsSQL2005.Backup'', 5, 1, CAST(0 AS bit)),
    (66, 10, NULL, NULL, NULL, N''Database Restores'', N''MsSQL2005.Restore'', 6, 1, CAST(0 AS bit)),
    (67, 10, NULL, NULL, NULL, N''Database Truncate'', N''MsSQL2005.Truncate'', 7, 1, CAST(0 AS bit)),
    (70, 11, NULL, NULL, NULL, N''Database Backups'', N''MySQL5.Backup'', 4, 1, CAST(0 AS bit)),
    (71, 1, NULL, NULL, NULL, N''Scheduled Tasks'', N''OS.ScheduledTasks'', 9, 2, CAST(0 AS bit)),
    (72, 1, NULL, NULL, NULL, N''Interval Tasks Allowed'', N''OS.ScheduledIntervalTasks'', 10, 1, CAST(0 AS bit)),
    (73, 1, NULL, NULL, NULL, N''Minimum Tasks Interval, minutes'', N''OS.MinimumTaskInterval'', 11, 3, CAST(0 AS bit)),
    (74, 1, NULL, NULL, NULL, N''Applications Installer'', N''OS.AppInstaller'', 7, 1, CAST(0 AS bit));
    INSERT INTO [Quotas] ([QuotaID], [GroupID], [HideQuota], [ItemTypeID], [PerOrganization], [QuotaDescription], [QuotaName], [QuotaOrder], [QuotaTypeID], [ServiceQuota])
    VALUES (75, 1, NULL, NULL, NULL, N''Extra Application Packs'', N''OS.ExtraApplications'', 8, 1, CAST(0 AS bit)),
    (77, 12, NULL, NULL, 1, N''Organization Disk Space, MB'', N''Exchange2007.DiskSpace'', 2, 2, CAST(0 AS bit)),
    (78, 12, NULL, NULL, 1, N''Mailboxes per Organization'', N''Exchange2007.Mailboxes'', 3, 2, CAST(0 AS bit)),
    (79, 12, NULL, NULL, 1, N''Contacts per Organization'', N''Exchange2007.Contacts'', 4, 3, CAST(0 AS bit)),
    (80, 12, NULL, NULL, 1, N''Distribution Lists per Organization'', N''Exchange2007.DistributionLists'', 5, 3, CAST(0 AS bit)),
    (81, 12, NULL, NULL, 1, N''Public Folders per Organization'', N''Exchange2007.PublicFolders'', 6, 3, CAST(0 AS bit)),
    (83, 12, NULL, NULL, NULL, N''POP3 Access'', N''Exchange2007.POP3Allowed'', 9, 1, CAST(0 AS bit)),
    (84, 12, NULL, NULL, NULL, N''IMAP Access'', N''Exchange2007.IMAPAllowed'', 11, 1, CAST(0 AS bit)),
    (85, 12, NULL, NULL, NULL, N''OWA/HTTP Access'', N''Exchange2007.OWAAllowed'', 13, 1, CAST(0 AS bit)),
    (86, 12, NULL, NULL, NULL, N''MAPI Access'', N''Exchange2007.MAPIAllowed'', 15, 1, CAST(0 AS bit)),
    (87, 12, NULL, NULL, NULL, N''ActiveSync Access'', N''Exchange2007.ActiveSyncAllowed'', 17, 1, CAST(0 AS bit)),
    (88, 12, NULL, NULL, NULL, N''Mail Enabled Public Folders Allowed'', N''Exchange2007.MailEnabledPublicFolders'', 8, 1, CAST(0 AS bit)),
    (94, 2, NULL, NULL, NULL, N''ColdFusion'', N''Web.ColdFusion'', 17, 1, CAST(0 AS bit)),
    (95, 2, NULL, NULL, NULL, N''Web Application Gallery'', N''Web.WebAppGallery'', 1, 1, CAST(0 AS bit)),
    (96, 2, NULL, NULL, NULL, N''ColdFusion Virtual Directories'', N''Web.CFVirtualDirectories'', 18, 1, CAST(0 AS bit)),
    (97, 2, NULL, NULL, NULL, N''Remote web management allowed'', N''Web.RemoteManagement'', 20, 1, CAST(0 AS bit)),
    (100, 2, NULL, NULL, NULL, N''Dedicated IP Addresses'', N''Web.IPAddresses'', 19, 2, CAST(1 AS bit)),
    (102, 4, NULL, NULL, NULL, N''Disable Mailbox Size Edit'', N''Mail.DisableSizeEdit'', 8, 1, CAST(0 AS bit)),
    (103, 6, NULL, NULL, NULL, N''Max Database Size'', N''MySQL4.MaxDatabaseSize'', 3, 3, CAST(0 AS bit)),
    (104, 6, NULL, NULL, NULL, N''Database Restores'', N''MySQL4.Restore'', 5, 1, CAST(0 AS bit)),
    (105, 6, NULL, NULL, NULL, N''Database Truncate'', N''MySQL4.Truncate'', 6, 1, CAST(0 AS bit)),
    (106, 11, NULL, NULL, NULL, N''Max Database Size'', N''MySQL5.MaxDatabaseSize'', 3, 3, CAST(0 AS bit)),
    (107, 11, NULL, NULL, NULL, N''Database Restores'', N''MySQL5.Restore'', 5, 1, CAST(0 AS bit)),
    (108, 11, NULL, NULL, NULL, N''Database Truncate'', N''MySQL5.Truncate'', 6, 1, CAST(0 AS bit)),
    (112, 90, NULL, NULL, NULL, N''Database Backups'', N''MySQL8.Backup'', 4, 1, CAST(0 AS bit)),
    (113, 90, NULL, NULL, NULL, N''Max Database Size'', N''MySQL8.MaxDatabaseSize'', 3, 3, CAST(0 AS bit)),
    (114, 90, NULL, NULL, NULL, N''Database Restores'', N''MySQL8.Restore'', 5, 1, CAST(0 AS bit)),
    (115, 90, NULL, NULL, NULL, N''Database Truncate'', N''MySQL8.Truncate'', 6, 1, CAST(0 AS bit)),
    (203, 10, NULL, NULL, NULL, N''Max Log Size'', N''MsSQL2005.MaxLogSize'', 4, 3, CAST(0 AS bit)),
    (204, 5, NULL, NULL, NULL, N''Max Log Size'', N''MsSQL2000.MaxLogSize'', 4, 3, CAST(0 AS bit)),
    (207, 13, NULL, NULL, 1, N''Domains per Organizations'', N''HostedSolution.Domains'', 3, 3, CAST(0 AS bit)),
    (208, 20, NULL, NULL, NULL, N''Max site storage, MB'', N''HostedSharePoint.MaxStorage'', 2, 3, CAST(0 AS bit)),
    (209, 21, NULL, NULL, 1, N''Full licenses per organization'', N''HostedCRM.Users'', 2, 3, CAST(0 AS bit)),
    (210, 21, NULL, NULL, NULL, N''CRM Organization'', N''HostedCRM.Organization'', 1, 1, CAST(0 AS bit)),
    (213, 22, NULL, NULL, NULL, N''Max Database Size'', N''MsSQL2008.MaxDatabaseSize'', 3, 3, CAST(0 AS bit)),
    (214, 22, NULL, NULL, NULL, N''Database Backups'', N''MsSQL2008.Backup'', 5, 1, CAST(0 AS bit)),
    (215, 22, NULL, NULL, NULL, N''Database Restores'', N''MsSQL2008.Restore'', 6, 1, CAST(0 AS bit)),
    (216, 22, NULL, NULL, NULL, N''Database Truncate'', N''MsSQL2008.Truncate'', 7, 1, CAST(0 AS bit)),
    (217, 22, NULL, NULL, NULL, N''Max Log Size'', N''MsSQL2008.MaxLogSize'', 4, 3, CAST(0 AS bit)),
    (220, 1, CAST(1 AS bit), NULL, NULL, N''Domain Pointers'', N''OS.DomainPointers'', 5, 2, CAST(0 AS bit)),
    (221, 23, NULL, NULL, NULL, N''Max Database Size'', N''MsSQL2012.MaxDatabaseSize'', 3, 3, CAST(0 AS bit)),
    (222, 23, NULL, NULL, NULL, N''Database Backups'', N''MsSQL2012.Backup'', 5, 1, CAST(0 AS bit));
    INSERT INTO [Quotas] ([QuotaID], [GroupID], [HideQuota], [ItemTypeID], [PerOrganization], [QuotaDescription], [QuotaName], [QuotaOrder], [QuotaTypeID], [ServiceQuota])
    VALUES (223, 23, NULL, NULL, NULL, N''Database Restores'', N''MsSQL2012.Restore'', 6, 1, CAST(0 AS bit)),
    (224, 23, NULL, NULL, NULL, N''Database Truncate'', N''MsSQL2012.Truncate'', 7, 1, CAST(0 AS bit)),
    (225, 23, NULL, NULL, NULL, N''Max Log Size'', N''MsSQL2012.MaxLogSize'', 4, 3, CAST(0 AS bit)),
    (230, 13, NULL, NULL, NULL, N''Allow to Change UserPrincipalName'', N''HostedSolution.AllowChangeUPN'', 4, 1, CAST(0 AS bit)),
    (301, 30, NULL, NULL, NULL, N''Allow user to create VPS'', N''VPS.ManagingAllowed'', 2, 1, CAST(0 AS bit)),
    (302, 30, NULL, NULL, NULL, N''Number of CPU cores'', N''VPS.CpuNumber'', 3, 2, CAST(0 AS bit)),
    (303, 30, NULL, NULL, NULL, N''Boot from CD allowed'', N''VPS.BootCdAllowed'', 7, 1, CAST(0 AS bit)),
    (304, 30, NULL, NULL, NULL, N''Boot from CD'', N''VPS.BootCdEnabled'', 8, 1, CAST(0 AS bit)),
    (305, 30, NULL, NULL, NULL, N''RAM size, MB'', N''VPS.Ram'', 4, 2, CAST(0 AS bit)),
    (306, 30, NULL, NULL, NULL, N''Hard Drive size, GB'', N''VPS.Hdd'', 5, 2, CAST(0 AS bit)),
    (307, 30, NULL, NULL, NULL, N''DVD drive'', N''VPS.DvdEnabled'', 6, 1, CAST(0 AS bit)),
    (308, 30, NULL, NULL, NULL, N''External Network'', N''VPS.ExternalNetworkEnabled'', 10, 1, CAST(0 AS bit)),
    (309, 30, NULL, NULL, NULL, N''Number of External IP addresses'', N''VPS.ExternalIPAddressesNumber'', 11, 2, CAST(0 AS bit)),
    (310, 30, NULL, NULL, NULL, N''Private Network'', N''VPS.PrivateNetworkEnabled'', 13, 1, CAST(0 AS bit)),
    (311, 30, NULL, NULL, NULL, N''Number of Private IP addresses per VPS'', N''VPS.PrivateIPAddressesNumber'', 14, 3, CAST(0 AS bit)),
    (312, 30, NULL, NULL, NULL, N''Number of Snaphots'', N''VPS.SnapshotsNumber'', 9, 3, CAST(0 AS bit)),
    (313, 30, NULL, NULL, NULL, N''Allow user to Start, Turn off and Shutdown VPS'', N''VPS.StartShutdownAllowed'', 15, 1, CAST(0 AS bit)),
    (314, 30, NULL, NULL, NULL, N''Allow user to Pause, Resume VPS'', N''VPS.PauseResumeAllowed'', 16, 1, CAST(0 AS bit)),
    (315, 30, NULL, NULL, NULL, N''Allow user to Reboot VPS'', N''VPS.RebootAllowed'', 17, 1, CAST(0 AS bit)),
    (316, 30, NULL, NULL, NULL, N''Allow user to Reset VPS'', N''VPS.ResetAlowed'', 18, 1, CAST(0 AS bit)),
    (317, 30, NULL, NULL, NULL, N''Allow user to Re-install VPS'', N''VPS.ReinstallAllowed'', 19, 1, CAST(0 AS bit)),
    (318, 30, NULL, NULL, NULL, N''Monthly bandwidth, GB'', N''VPS.Bandwidth'', 12, 2, CAST(0 AS bit)),
    (319, 31, NULL, NULL, 1, NULL, N''BlackBerry.Users'', 1, 2, CAST(0 AS bit)),
    (320, 32, NULL, NULL, 1, NULL, N''OCS.Users'', 1, 2, CAST(0 AS bit)),
    (321, 32, NULL, NULL, NULL, NULL, N''OCS.Federation'', 2, 1, CAST(0 AS bit)),
    (322, 32, NULL, NULL, NULL, NULL, N''OCS.FederationByDefault'', 3, 1, CAST(0 AS bit)),
    (323, 32, NULL, NULL, NULL, NULL, N''OCS.PublicIMConnectivity'', 4, 1, CAST(0 AS bit)),
    (324, 32, NULL, NULL, NULL, NULL, N''OCS.PublicIMConnectivityByDefault'', 5, 1, CAST(0 AS bit)),
    (325, 32, NULL, NULL, NULL, NULL, N''OCS.ArchiveIMConversation'', 6, 1, CAST(0 AS bit)),
    (326, 32, NULL, NULL, NULL, NULL, N''OCS.ArchiveIMConvervationByDefault'', 7, 1, CAST(0 AS bit)),
    (327, 32, NULL, NULL, NULL, NULL, N''OCS.ArchiveFederatedIMConversation'', 8, 1, CAST(0 AS bit)),
    (328, 32, NULL, NULL, NULL, NULL, N''OCS.ArchiveFederatedIMConversationByDefault'', 9, 1, CAST(0 AS bit)),
    (329, 32, NULL, NULL, NULL, NULL, N''OCS.PresenceAllowed'', 10, 1, CAST(0 AS bit)),
    (330, 32, NULL, NULL, NULL, NULL, N''OCS.PresenceAllowedByDefault'', 10, 1, CAST(0 AS bit)),
    (331, 2, NULL, NULL, NULL, N''ASP.NET 4.0'', N''Web.AspNet40'', 4, 1, CAST(0 AS bit)),
    (332, 2, NULL, NULL, NULL, N''SSL'', N''Web.SSL'', 21, 1, CAST(0 AS bit)),
    (333, 2, NULL, NULL, NULL, N''Allow IP Address Mode Switch'', N''Web.AllowIPAddressModeSwitch'', 22, 1, CAST(0 AS bit)),
    (334, 2, NULL, NULL, NULL, N''Enable Hostname Support'', N''Web.EnableHostNameSupport'', 23, 1, CAST(0 AS bit)),
    (344, 2, NULL, NULL, NULL, N''htaccess'', N''Web.Htaccess'', 9, 1, CAST(0 AS bit)),
    (346, 40, NULL, NULL, NULL, N''Allow user to create VPS'', N''VPSForPC.ManagingAllowed'', 2, 1, CAST(0 AS bit)),
    (347, 40, NULL, NULL, NULL, N''Number of CPU cores'', N''VPSForPC.CpuNumber'', 3, 2, CAST(0 AS bit)),
    (348, 40, NULL, NULL, NULL, N''Boot from CD allowed'', N''VPSForPC.BootCdAllowed'', 7, 1, CAST(0 AS bit));
    INSERT INTO [Quotas] ([QuotaID], [GroupID], [HideQuota], [ItemTypeID], [PerOrganization], [QuotaDescription], [QuotaName], [QuotaOrder], [QuotaTypeID], [ServiceQuota])
    VALUES (349, 40, NULL, NULL, NULL, N''Boot from CD'', N''VPSForPC.BootCdEnabled'', 7, 1, CAST(0 AS bit)),
    (350, 40, NULL, NULL, NULL, N''RAM size, MB'', N''VPSForPC.Ram'', 4, 2, CAST(0 AS bit)),
    (351, 40, NULL, NULL, NULL, N''Hard Drive size, GB'', N''VPSForPC.Hdd'', 5, 2, CAST(0 AS bit)),
    (352, 40, NULL, NULL, NULL, N''DVD drive'', N''VPSForPC.DvdEnabled'', 6, 1, CAST(0 AS bit)),
    (353, 40, NULL, NULL, NULL, N''External Network'', N''VPSForPC.ExternalNetworkEnabled'', 10, 1, CAST(0 AS bit)),
    (354, 40, NULL, NULL, NULL, N''Number of External IP addresses'', N''VPSForPC.ExternalIPAddressesNumber'', 11, 2, CAST(0 AS bit)),
    (355, 40, NULL, NULL, NULL, N''Private Network'', N''VPSForPC.PrivateNetworkEnabled'', 13, 1, CAST(0 AS bit)),
    (356, 40, NULL, NULL, NULL, N''Number of Private IP addresses per VPS'', N''VPSForPC.PrivateIPAddressesNumber'', 14, 3, CAST(0 AS bit)),
    (357, 40, NULL, NULL, NULL, N''Number of Snaphots'', N''VPSForPC.SnapshotsNumber'', 9, 3, CAST(0 AS bit)),
    (358, 40, NULL, NULL, NULL, N''Allow user to Start, Turn off and Shutdown VPS'', N''VPSForPC.StartShutdownAllowed'', 15, 1, CAST(0 AS bit)),
    (359, 40, NULL, NULL, NULL, N''Allow user to Pause, Resume VPS'', N''VPSForPC.PauseResumeAllowed'', 16, 1, CAST(0 AS bit)),
    (360, 40, NULL, NULL, NULL, N''Allow user to Reboot VPS'', N''VPSForPC.RebootAllowed'', 17, 1, CAST(0 AS bit)),
    (361, 40, NULL, NULL, NULL, N''Allow user to Reset VPS'', N''VPSForPC.ResetAlowed'', 18, 1, CAST(0 AS bit)),
    (362, 40, NULL, NULL, NULL, N''Allow user to Re-install VPS'', N''VPSForPC.ReinstallAllowed'', 19, 1, CAST(0 AS bit)),
    (363, 40, NULL, NULL, NULL, N''Monthly bandwidth, GB'', N''VPSForPC.Bandwidth'', 12, 2, CAST(0 AS bit)),
    (364, 12, NULL, NULL, NULL, N''Keep Deleted Items (days)'', N''Exchange2007.KeepDeletedItemsDays'', 19, 3, CAST(0 AS bit)),
    (365, 12, NULL, NULL, NULL, N''Maximum Recipients'', N''Exchange2007.MaxRecipients'', 20, 3, CAST(0 AS bit)),
    (366, 12, NULL, NULL, NULL, N''Maximum Send Message Size (Kb)'', N''Exchange2007.MaxSendMessageSizeKB'', 21, 3, CAST(0 AS bit)),
    (367, 12, NULL, NULL, NULL, N''Maximum Receive Message Size (Kb)'', N''Exchange2007.MaxReceiveMessageSizeKB'', 22, 3, CAST(0 AS bit)),
    (368, 12, NULL, NULL, NULL, N''Is Consumer Organization'', N''Exchange2007.IsConsumer'', 1, 1, CAST(0 AS bit)),
    (369, 12, NULL, NULL, NULL, N''Enable Plans Editing'', N''Exchange2007.EnablePlansEditing'', 23, 1, CAST(0 AS bit)),
    (370, 41, NULL, NULL, 1, N''Users'', N''Lync.Users'', 1, 2, CAST(0 AS bit)),
    (371, 41, NULL, NULL, NULL, N''Allow Federation'', N''Lync.Federation'', 2, 1, CAST(0 AS bit)),
    (372, 41, NULL, NULL, NULL, N''Allow Conferencing'', N''Lync.Conferencing'', 3, 1, CAST(0 AS bit)),
    (373, 41, NULL, NULL, NULL, N''Maximum Conference Particiapants'', N''Lync.MaxParticipants'', 4, 3, CAST(0 AS bit)),
    (374, 41, NULL, NULL, NULL, N''Allow Video in Conference'', N''Lync.AllowVideo'', 5, 1, CAST(0 AS bit)),
    (375, 41, NULL, NULL, NULL, N''Allow EnterpriseVoice'', N''Lync.EnterpriseVoice'', 6, 1, CAST(0 AS bit)),
    (376, 41, NULL, NULL, NULL, N''Number of Enterprise Voice Users'', N''Lync.EVUsers'', 7, 2, CAST(0 AS bit)),
    (377, 41, NULL, NULL, NULL, N''Allow National Calls'', N''Lync.EVNational'', 8, 1, CAST(0 AS bit)),
    (378, 41, NULL, NULL, NULL, N''Allow Mobile Calls'', N''Lync.EVMobile'', 9, 1, CAST(0 AS bit)),
    (379, 41, NULL, NULL, NULL, N''Allow International Calls'', N''Lync.EVInternational'', 10, 1, CAST(0 AS bit)),
    (380, 41, NULL, NULL, NULL, N''Enable Plans Editing'', N''Lync.EnablePlansEditing'', 11, 1, CAST(0 AS bit)),
    (400, 20, NULL, NULL, NULL, N''Use shared SSL Root'', N''HostedSharePoint.UseSharedSSL'', 3, 1, CAST(0 AS bit)),
    (409, 1, NULL, NULL, NULL, N''Not allow Tenants to Delete Top Level Domains'', N''OS.NotAllowTenantDeleteDomains'', 13, 1, CAST(0 AS bit)),
    (410, 1, NULL, NULL, NULL, N''Not allow Tenants to Create Top Level Domains'', N''OS.NotAllowTenantCreateDomains'', 12, 1, CAST(0 AS bit)),
    (411, 2, NULL, NULL, NULL, N''Application Pools Restart'', N''Web.AppPoolsRestart'', 13, 1, CAST(0 AS bit)),
    (420, 12, NULL, NULL, NULL, N''Allow Litigation Hold'', N''Exchange2007.AllowLitigationHold'', 24, 1, CAST(0 AS bit)),
    (421, 12, NULL, NULL, 1, N''Recoverable Items Space'', N''Exchange2007.RecoverableItemsSpace'', 25, 2, CAST(0 AS bit)),
    (422, 12, NULL, NULL, NULL, N''Disclaimers Allowed'', N''Exchange2007.DisclaimersAllowed'', 26, 1, CAST(0 AS bit)),
    (423, 13, NULL, NULL, 1, N''Security Groups'', N''HostedSolution.SecurityGroups'', 5, 2, CAST(0 AS bit)),
    (424, 12, NULL, NULL, NULL, N''Allow Retention Policy'', N''Exchange2013.AllowRetentionPolicy'', 27, 1, CAST(0 AS bit)),
    (425, 12, NULL, NULL, 1, N''Archiving storage, MB'', N''Exchange2013.ArchivingStorage'', 29, 2, CAST(0 AS bit));
    INSERT INTO [Quotas] ([QuotaID], [GroupID], [HideQuota], [ItemTypeID], [PerOrganization], [QuotaDescription], [QuotaName], [QuotaOrder], [QuotaTypeID], [ServiceQuota])
    VALUES (426, 12, NULL, NULL, 1, N''Archiving Mailboxes per Organization'', N''Exchange2013.ArchivingMailboxes'', 28, 2, CAST(0 AS bit)),
    (428, 12, NULL, NULL, 1, N''Resource Mailboxes per Organization'', N''Exchange2013.ResourceMailboxes'', 31, 2, CAST(0 AS bit)),
    (429, 12, NULL, NULL, 1, N''Shared Mailboxes per Organization'', N''Exchange2013.SharedMailboxes'', 30, 2, CAST(0 AS bit)),
    (430, 44, NULL, NULL, 1, N''Disk Storage Space (Mb)'', N''EnterpriseStorage.DiskStorageSpace'', 1, 2, CAST(0 AS bit)),
    (431, 44, NULL, NULL, 1, N''Number of Root Folders'', N''EnterpriseStorage.Folders'', 1, 2, CAST(0 AS bit)),
    (447, 61, NULL, NULL, NULL, N''Enable Spam Filter'', N''Filters.Enable'', 1, 1, CAST(0 AS bit)),
    (448, 61, NULL, NULL, NULL, N''Enable Per-Mailbox Login'', N''Filters.EnableEmailUsers'', 2, 1, CAST(0 AS bit)),
    (450, 45, NULL, NULL, 1, N''Remote Desktop Users'', N''RDS.Users'', 1, 2, CAST(0 AS bit)),
    (451, 45, NULL, NULL, 1, N''Remote Desktop Servers'', N''RDS.Servers'', 2, 2, CAST(0 AS bit)),
    (452, 45, NULL, NULL, NULL, N''Disable user from adding server'', N''RDS.DisableUserAddServer'', 3, 1, CAST(0 AS bit)),
    (453, 45, NULL, NULL, NULL, N''Disable user from removing server'', N''RDS.DisableUserDeleteServer'', 3, 1, CAST(0 AS bit)),
    (460, 21, NULL, NULL, NULL, N''Max Database Size, MB'', N''HostedCRM.MaxDatabaseSize'', 5, 3, CAST(0 AS bit)),
    (461, 21, NULL, NULL, 1, N''Limited licenses per organization'', N''HostedCRM.LimitedUsers'', 3, 3, CAST(0 AS bit)),
    (462, 21, NULL, NULL, 1, N''ESS licenses per organization'', N''HostedCRM.ESSUsers'', 4, 3, CAST(0 AS bit)),
    (463, 24, NULL, NULL, NULL, N''CRM Organization'', N''HostedCRM2013.Organization'', 1, 1, CAST(0 AS bit)),
    (464, 24, NULL, NULL, NULL, N''Max Database Size, MB'', N''HostedCRM2013.MaxDatabaseSize'', 5, 3, CAST(0 AS bit)),
    (465, 24, NULL, NULL, 1, N''Essential licenses per organization'', N''HostedCRM2013.EssentialUsers'', 2, 3, CAST(0 AS bit)),
    (466, 24, NULL, NULL, 1, N''Basic licenses per organization'', N''HostedCRM2013.BasicUsers'', 3, 3, CAST(0 AS bit)),
    (467, 24, NULL, NULL, 1, N''Professional licenses per organization'', N''HostedCRM2013.ProfessionalUsers'', 4, 3, CAST(0 AS bit)),
    (468, 45, NULL, NULL, NULL, N''Use Drive Maps'', N''EnterpriseStorage.DriveMaps'', 2, 1, CAST(0 AS bit)),
    (472, 46, NULL, NULL, NULL, N''Max Database Size'', N''MsSQL2014.MaxDatabaseSize'', 3, 3, CAST(0 AS bit)),
    (473, 46, NULL, NULL, NULL, N''Database Backups'', N''MsSQL2014.Backup'', 5, 1, CAST(0 AS bit)),
    (474, 46, NULL, NULL, NULL, N''Database Restores'', N''MsSQL2014.Restore'', 6, 1, CAST(0 AS bit)),
    (475, 46, NULL, NULL, NULL, N''Database Truncate'', N''MsSQL2014.Truncate'', 7, 1, CAST(0 AS bit)),
    (476, 46, NULL, NULL, NULL, N''Max Log Size'', N''MsSQL2014.MaxLogSize'', 4, 3, CAST(0 AS bit)),
    (491, 45, NULL, NULL, 1, N''Remote Desktop Servers'', N''RDS.Collections'', 2, 2, CAST(0 AS bit)),
    (495, 13, NULL, NULL, 1, N''Deleted Users'', N''HostedSolution.DeletedUsers'', 6, 2, CAST(0 AS bit)),
    (496, 13, NULL, NULL, 1, N''Deleted Users Backup Storage Space, Mb'', N''HostedSolution.DeletedUsersBackupStorageSpace'', 6, 2, CAST(0 AS bit)),
    (551, 73, NULL, NULL, NULL, N''Max site storage, MB'', N''HostedSharePointEnterprise.MaxStorage'', 2, 3, CAST(0 AS bit)),
    (552, 73, NULL, NULL, NULL, N''Use shared SSL Root'', N''HostedSharePointEnterprise.UseSharedSSL'', 3, 1, CAST(0 AS bit)),
    (554, 33, NULL, NULL, NULL, N''Allow user to create VPS'', N''VPS2012.ManagingAllowed'', 2, 1, CAST(0 AS bit)),
    (555, 33, NULL, NULL, NULL, N''Number of CPU cores'', N''VPS2012.CpuNumber'', 3, 2, CAST(0 AS bit)),
    (556, 33, NULL, NULL, NULL, N''Boot from CD allowed'', N''VPS2012.BootCdAllowed'', 7, 1, CAST(0 AS bit)),
    (557, 33, NULL, NULL, NULL, N''Boot from CD'', N''VPS2012.BootCdEnabled'', 8, 1, CAST(0 AS bit)),
    (558, 33, NULL, NULL, NULL, N''RAM size, MB'', N''VPS2012.Ram'', 4, 2, CAST(0 AS bit)),
    (559, 33, NULL, NULL, NULL, N''Hard Drive size, GB'', N''VPS2012.Hdd'', 5, 2, CAST(0 AS bit)),
    (560, 33, NULL, NULL, NULL, N''DVD drive'', N''VPS2012.DvdEnabled'', 6, 1, CAST(0 AS bit)),
    (561, 33, NULL, NULL, NULL, N''External Network'', N''VPS2012.ExternalNetworkEnabled'', 10, 1, CAST(0 AS bit)),
    (562, 33, NULL, NULL, NULL, N''Number of External IP addresses'', N''VPS2012.ExternalIPAddressesNumber'', 11, 2, CAST(0 AS bit)),
    (563, 33, NULL, NULL, NULL, N''Private Network'', N''VPS2012.PrivateNetworkEnabled'', 13, 1, CAST(0 AS bit)),
    (564, 33, NULL, NULL, NULL, N''Number of Private IP addresses per VPS'', N''VPS2012.PrivateIPAddressesNumber'', 14, 3, CAST(0 AS bit)),
    (565, 33, NULL, NULL, NULL, N''Number of Snaphots'', N''VPS2012.SnapshotsNumber'', 9, 3, CAST(0 AS bit));
    INSERT INTO [Quotas] ([QuotaID], [GroupID], [HideQuota], [ItemTypeID], [PerOrganization], [QuotaDescription], [QuotaName], [QuotaOrder], [QuotaTypeID], [ServiceQuota])
    VALUES (566, 33, NULL, NULL, NULL, N''Allow user to Start, Turn off and Shutdown VPS'', N''VPS2012.StartShutdownAllowed'', 15, 1, CAST(0 AS bit)),
    (567, 33, NULL, NULL, NULL, N''Allow user to Pause, Resume VPS'', N''VPS2012.PauseResumeAllowed'', 16, 1, CAST(0 AS bit)),
    (568, 33, NULL, NULL, NULL, N''Allow user to Reboot VPS'', N''VPS2012.RebootAllowed'', 17, 1, CAST(0 AS bit)),
    (569, 33, NULL, NULL, NULL, N''Allow user to Reset VPS'', N''VPS2012.ResetAlowed'', 18, 1, CAST(0 AS bit)),
    (570, 33, NULL, NULL, NULL, N''Allow user to Re-install VPS'', N''VPS2012.ReinstallAllowed'', 19, 1, CAST(0 AS bit)),
    (571, 33, NULL, NULL, NULL, N''Monthly bandwidth, GB'', N''VPS2012.Bandwidth'', 12, 2, CAST(0 AS bit)),
    (572, 33, NULL, NULL, NULL, N''Allow user to Replication'', N''VPS2012.ReplicationEnabled'', 20, 1, CAST(0 AS bit)),
    (575, 50, NULL, NULL, NULL, N''Max Database Size'', N''MariaDB.MaxDatabaseSize'', 3, 3, CAST(0 AS bit)),
    (576, 50, NULL, NULL, NULL, N''Database Backups'', N''MariaDB.Backup'', 5, 1, CAST(0 AS bit)),
    (577, 50, NULL, NULL, NULL, N''Database Restores'', N''MariaDB.Restore'', 6, 1, CAST(0 AS bit)),
    (578, 50, NULL, NULL, NULL, N''Database Truncate'', N''MariaDB.Truncate'', 7, 1, CAST(0 AS bit)),
    (579, 50, NULL, NULL, NULL, N''Max Log Size'', N''MariaDB.MaxLogSize'', 4, 3, CAST(0 AS bit)),
    (581, 52, NULL, NULL, NULL, N''Phone Numbers'', N''SfB.PhoneNumbers'', 12, 2, CAST(0 AS bit)),
    (582, 52, NULL, NULL, 1, N''Users'', N''SfB.Users'', 1, 2, CAST(0 AS bit)),
    (583, 52, NULL, NULL, NULL, N''Allow Federation'', N''SfB.Federation'', 2, 1, CAST(0 AS bit)),
    (584, 52, NULL, NULL, NULL, N''Allow Conferencing'', N''SfB.Conferencing'', 3, 1, CAST(0 AS bit)),
    (585, 52, NULL, NULL, NULL, N''Maximum Conference Particiapants'', N''SfB.MaxParticipants'', 4, 3, CAST(0 AS bit)),
    (586, 52, NULL, NULL, NULL, N''Allow Video in Conference'', N''SfB.AllowVideo'', 5, 1, CAST(0 AS bit)),
    (587, 52, NULL, NULL, NULL, N''Allow EnterpriseVoice'', N''SfB.EnterpriseVoice'', 6, 1, CAST(0 AS bit)),
    (588, 52, NULL, NULL, NULL, N''Number of Enterprise Voice Users'', N''SfB.EVUsers'', 7, 2, CAST(0 AS bit)),
    (589, 52, NULL, NULL, NULL, N''Allow National Calls'', N''SfB.EVNational'', 8, 1, CAST(0 AS bit)),
    (590, 52, NULL, NULL, NULL, N''Allow Mobile Calls'', N''SfB.EVMobile'', 9, 1, CAST(0 AS bit)),
    (591, 52, NULL, NULL, NULL, N''Allow International Calls'', N''SfB.EVInternational'', 10, 1, CAST(0 AS bit)),
    (592, 52, NULL, NULL, NULL, N''Enable Plans Editing'', N''SfB.EnablePlansEditing'', 11, 1, CAST(0 AS bit)),
    (674, 167, NULL, NULL, NULL, N''Allow user to create VPS'', N''PROXMOX.ManagingAllowed'', 2, 1, CAST(0 AS bit)),
    (675, 167, NULL, NULL, NULL, N''Number of CPU cores'', N''PROXMOX.CpuNumber'', 3, 3, CAST(0 AS bit)),
    (676, 167, NULL, NULL, NULL, N''Boot from CD allowed'', N''PROXMOX.BootCdAllowed'', 7, 1, CAST(0 AS bit)),
    (677, 167, NULL, NULL, NULL, N''Boot from CD'', N''PROXMOX.BootCdEnabled'', 8, 1, CAST(0 AS bit)),
    (678, 167, NULL, NULL, NULL, N''RAM size, MB'', N''PROXMOX.Ram'', 4, 2, CAST(0 AS bit)),
    (679, 167, NULL, NULL, NULL, N''Hard Drive size, GB'', N''PROXMOX.Hdd'', 5, 2, CAST(0 AS bit)),
    (680, 167, NULL, NULL, NULL, N''DVD drive'', N''PROXMOX.DvdEnabled'', 6, 1, CAST(0 AS bit)),
    (681, 167, NULL, NULL, NULL, N''External Network'', N''PROXMOX.ExternalNetworkEnabled'', 10, 1, CAST(0 AS bit)),
    (682, 167, NULL, NULL, NULL, N''Number of External IP addresses'', N''PROXMOX.ExternalIPAddressesNumber'', 11, 2, CAST(0 AS bit)),
    (683, 167, NULL, NULL, NULL, N''Private Network'', N''PROXMOX.PrivateNetworkEnabled'', 13, 1, CAST(0 AS bit)),
    (684, 167, NULL, NULL, NULL, N''Number of Private IP addresses per VPS'', N''PROXMOX.PrivateIPAddressesNumber'', 14, 3, CAST(0 AS bit)),
    (685, 167, NULL, NULL, NULL, N''Number of Snaphots'', N''PROXMOX.SnapshotsNumber'', 9, 3, CAST(0 AS bit)),
    (686, 167, NULL, NULL, NULL, N''Allow user to Start, Turn off and Shutdown VPS'', N''PROXMOX.StartShutdownAllowed'', 15, 1, CAST(0 AS bit)),
    (687, 167, NULL, NULL, NULL, N''Allow user to Pause, Resume VPS'', N''PROXMOX.PauseResumeAllowed'', 16, 1, CAST(0 AS bit)),
    (688, 167, NULL, NULL, NULL, N''Allow user to Reboot VPS'', N''PROXMOX.RebootAllowed'', 17, 1, CAST(0 AS bit)),
    (689, 167, NULL, NULL, NULL, N''Allow user to Reset VPS'', N''PROXMOX.ResetAlowed'', 18, 1, CAST(0 AS bit)),
    (690, 167, NULL, NULL, NULL, N''Allow user to Re-install VPS'', N''PROXMOX.ReinstallAllowed'', 19, 1, CAST(0 AS bit)),
    (691, 167, NULL, NULL, NULL, N''Monthly bandwidth, GB'', N''PROXMOX.Bandwidth'', 12, 2, CAST(0 AS bit));
    INSERT INTO [Quotas] ([QuotaID], [GroupID], [HideQuota], [ItemTypeID], [PerOrganization], [QuotaDescription], [QuotaName], [QuotaOrder], [QuotaTypeID], [ServiceQuota])
    VALUES (692, 167, NULL, NULL, NULL, N''Allow user to Replication'', N''PROXMOX.ReplicationEnabled'', 20, 1, CAST(0 AS bit)),
    (703, 71, NULL, NULL, NULL, N''Max Database Size'', N''MsSQL2016.MaxDatabaseSize'', 3, 3, CAST(0 AS bit)),
    (704, 71, NULL, NULL, NULL, N''Database Backups'', N''MsSQL2016.Backup'', 5, 1, CAST(0 AS bit)),
    (705, 71, NULL, NULL, NULL, N''Database Restores'', N''MsSQL2016.Restore'', 6, 1, CAST(0 AS bit)),
    (706, 71, NULL, NULL, NULL, N''Database Truncate'', N''MsSQL2016.Truncate'', 7, 1, CAST(0 AS bit)),
    (707, 71, NULL, NULL, NULL, N''Max Log Size'', N''MsSQL2016.MaxLogSize'', 4, 3, CAST(0 AS bit)),
    (713, 72, NULL, NULL, NULL, N''Max Database Size'', N''MsSQL2017.MaxDatabaseSize'', 3, 3, CAST(0 AS bit)),
    (714, 72, NULL, NULL, NULL, N''Database Backups'', N''MsSQL2017.Backup'', 5, 1, CAST(0 AS bit)),
    (715, 72, NULL, NULL, NULL, N''Database Restores'', N''MsSQL2017.Restore'', 6, 1, CAST(0 AS bit)),
    (716, 72, NULL, NULL, NULL, N''Database Truncate'', N''MsSQL2017.Truncate'', 7, 1, CAST(0 AS bit)),
    (717, 72, NULL, NULL, NULL, N''Max Log Size'', N''MsSQL2017.MaxLogSize'', 4, 3, CAST(0 AS bit)),
    (723, 74, NULL, NULL, NULL, N''Max Database Size'', N''MsSQL2019.MaxDatabaseSize'', 3, 3, CAST(0 AS bit)),
    (724, 74, NULL, NULL, NULL, N''Database Backups'', N''MsSQL2019.Backup'', 5, 1, CAST(0 AS bit)),
    (725, 74, NULL, NULL, NULL, N''Database Restores'', N''MsSQL2019.Restore'', 6, 1, CAST(0 AS bit)),
    (726, 74, NULL, NULL, NULL, N''Database Truncate'', N''MsSQL2019.Truncate'', 7, 1, CAST(0 AS bit)),
    (727, 74, NULL, NULL, NULL, N''Max Log Size'', N''MsSQL2019.MaxLogSize'', 4, 3, CAST(0 AS bit)),
    (728, 33, NULL, NULL, NULL, N''Number of Private Network VLANs'', N''VPS2012.PrivateVLANsNumber'', 14, 2, CAST(0 AS bit)),
    (729, 12, NULL, NULL, NULL, N''Automatic Replies via SolidCP Allowed'', N''Exchange2013.AutoReply'', 32, 1, CAST(0 AS bit)),
    (730, 33, NULL, NULL, NULL, N''Additional Hard Drives per VPS'', N''VPS2012.AdditionalVhdCount'', 6, 3, CAST(0 AS bit)),
    (731, 12, NULL, NULL, 1, N''Journaling Mailboxes per Organization'', N''Exchange2013.JournalingMailboxes'', 31, 2, CAST(0 AS bit)),
    (734, 75, NULL, NULL, NULL, N''Max Database Size'', N''MsSQL2022.MaxDatabaseSize'', 3, 3, CAST(0 AS bit)),
    (735, 75, NULL, NULL, NULL, N''Database Backups'', N''MsSQL2022.Backup'', 5, 1, CAST(0 AS bit)),
    (736, 75, NULL, NULL, NULL, N''Database Restores'', N''MsSQL2022.Restore'', 6, 1, CAST(0 AS bit)),
    (737, 75, NULL, NULL, NULL, N''Database Truncate'', N''MsSQL2022.Truncate'', 7, 1, CAST(0 AS bit)),
    (738, 75, NULL, NULL, NULL, N''Max Log Size'', N''MsSQL2022.MaxLogSize'', 4, 3, CAST(0 AS bit))');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'QuotaID', N'GroupID', N'HideQuota', N'ItemTypeID', N'PerOrganization', N'QuotaDescription', N'QuotaName', N'QuotaOrder', N'QuotaTypeID', N'ServiceQuota') AND [object_id] = OBJECT_ID(N'[Quotas]'))
        SET IDENTITY_INSERT [Quotas] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'RecordID', N'GroupID', N'MXPriority', N'RecordData', N'RecordName', N'RecordOrder', N'RecordType') AND [object_id] = OBJECT_ID(N'[ResourceGroupDnsRecords]'))
        SET IDENTITY_INSERT [ResourceGroupDnsRecords] ON;
    EXEC(N'INSERT INTO [ResourceGroupDnsRecords] ([RecordID], [GroupID], [MXPriority], [RecordData], [RecordName], [RecordOrder], [RecordType])
    VALUES (1, 2, 0, N''[IP]'', N'''', 1, ''A''),
    (2, 2, 0, N''[IP]'', N''*'', 2, ''A''),
    (3, 2, 0, N''[IP]'', N''www'', 3, ''A''),
    (4, 3, 0, N''[IP]'', N''ftp'', 1, ''A''),
    (5, 4, 0, N''[IP]'', N''mail'', 1, ''A''),
    (6, 4, 0, N''[IP]'', N''mail2'', 2, ''A''),
    (7, 4, 10, N''mail.[DOMAIN_NAME]'', N'''', 3, ''MX''),
    (9, 4, 21, N''mail2.[DOMAIN_NAME]'', N'''', 4, ''MX''),
    (10, 5, 0, N''[IP]'', N''mssql'', 1, ''A''),
    (11, 6, 0, N''[IP]'', N''mysql'', 1, ''A''),
    (12, 8, 0, N''[IP]'', N''stats'', 1, ''A''),
    (13, 4, 0, N''v=spf1 a mx -all'', N'''', 5, ''TXT''),
    (14, 12, 0, N''[IP]'', N''smtp'', 1, ''A''),
    (15, 12, 10, N''smtp.[DOMAIN_NAME]'', N'''', 2, ''MX''),
    (16, 12, 0, N'''', N''autodiscover'', 3, ''CNAME''),
    (17, 12, 0, N'''', N''owa'', 4, ''CNAME'')');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'RecordID', N'GroupID', N'MXPriority', N'RecordData', N'RecordName', N'RecordOrder', N'RecordType') AND [object_id] = OBJECT_ID(N'[ResourceGroupDnsRecords]'))
        SET IDENTITY_INSERT [ResourceGroupDnsRecords] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ParameterID', N'TaskID', N'DataTypeID', N'DefaultValue', N'ParameterOrder') AND [object_id] = OBJECT_ID(N'[ScheduleTaskParameters]'))
        SET IDENTITY_INSERT [ScheduleTaskParameters] ON;
    EXEC(N'INSERT INTO [ScheduleTaskParameters] ([ParameterID], [TaskID], [DataTypeID], [DefaultValue], [ParameterOrder])
    VALUES (N''AUDIT_LOG_DATE'', N''SCHEDULE_TASK_AUDIT_LOG_REPORT'', N''List'', N''today=Today;yesterday=Yesterday;schedule=Schedule'', 5),
    (N''AUDIT_LOG_SEVERITY'', N''SCHEDULE_TASK_AUDIT_LOG_REPORT'', N''List'', N''-1=All;0=Information;1=Warning;2=Error'', 2),
    (N''AUDIT_LOG_SOURCE'', N''SCHEDULE_TASK_AUDIT_LOG_REPORT'', N''List'', N'''', 3),
    (N''AUDIT_LOG_TASK'', N''SCHEDULE_TASK_AUDIT_LOG_REPORT'', N''List'', N'''', 4),
    (N''MAIL_TO'', N''SCHEDULE_TASK_AUDIT_LOG_REPORT'', N''String'', NULL, 1),
    (N''SHOW_EXECUTION_LOG'', N''SCHEDULE_TASK_AUDIT_LOG_REPORT'', N''List'', N''0=No;1=Yes'', 6),
    (N''BACKUP_FILE_NAME'', N''SCHEDULE_TASK_BACKUP'', N''String'', N'''', 1),
    (N''DELETE_TEMP_BACKUP'', N''SCHEDULE_TASK_BACKUP'', N''Boolean'', N''true'', 1),
    (N''STORE_PACKAGE_FOLDER'', N''SCHEDULE_TASK_BACKUP'', N''String'', N''\'', 1),
    (N''STORE_PACKAGE_ID'', N''SCHEDULE_TASK_BACKUP'', N''String'', N'''', 1),
    (N''STORE_SERVER_FOLDER'', N''SCHEDULE_TASK_BACKUP'', N''String'', N'''', 1),
    (N''BACKUP_FOLDER'', N''SCHEDULE_TASK_BACKUP_DATABASE'', N''String'', N''\backups'', 3),
    (N''BACKUP_NAME'', N''SCHEDULE_TASK_BACKUP_DATABASE'', N''String'', N''database_backup.bak'', 4),
    (N''DATABASE_GROUP'', N''SCHEDULE_TASK_BACKUP_DATABASE'', N''List'', N''MsSQL2014=SQL Server 2014;MsSQL2016=SQL Server 2016;MsSQL2017=SQL Server 2017;MsSQL2019=SQL Server 2019;MsSQL2022=SQL Server 2022;MySQL5=MySQL 5.0;MariaDB=MariaDB'', 1),
    (N''DATABASE_NAME'', N''SCHEDULE_TASK_BACKUP_DATABASE'', N''String'', N'''', 2),
    (N''ZIP_BACKUP'', N''SCHEDULE_TASK_BACKUP_DATABASE'', N''List'', N''true=Yes;false=No'', 5),
    (N''MAIL_BODY'', N''SCHEDULE_TASK_CHECK_WEBSITE'', N''MultiString'', N'''', 10),
    (N''MAIL_FROM'', N''SCHEDULE_TASK_CHECK_WEBSITE'', N''String'', N''admin@mysite.com'', 7),
    (N''MAIL_SUBJECT'', N''SCHEDULE_TASK_CHECK_WEBSITE'', N''String'', N''Web Site is unavailable'', 9),
    (N''MAIL_TO'', N''SCHEDULE_TASK_CHECK_WEBSITE'', N''String'', N''admin@mysite.com'', 8),
    (N''PASSWORD'', N''SCHEDULE_TASK_CHECK_WEBSITE'', N''String'', NULL, 3),
    (N''RESPONSE_CONTAIN'', N''SCHEDULE_TASK_CHECK_WEBSITE'', N''String'', NULL, 5),
    (N''RESPONSE_DOESNT_CONTAIN'', N''SCHEDULE_TASK_CHECK_WEBSITE'', N''String'', NULL, 6),
    (N''RESPONSE_STATUS'', N''SCHEDULE_TASK_CHECK_WEBSITE'', N''String'', N''500'', 4),
    (N''URL'', N''SCHEDULE_TASK_CHECK_WEBSITE'', N''String'', N''http://'', 1),
    (N''USE_RESPONSE_CONTAIN'', N''SCHEDULE_TASK_CHECK_WEBSITE'', N''Boolean'', N''false'', 1),
    (N''USE_RESPONSE_DOESNT_CONTAIN'', N''SCHEDULE_TASK_CHECK_WEBSITE'', N''Boolean'', N''false'', 1),
    (N''USE_RESPONSE_STATUS'', N''SCHEDULE_TASK_CHECK_WEBSITE'', N''Boolean'', N''false'', 1),
    (N''USERNAME'', N''SCHEDULE_TASK_CHECK_WEBSITE'', N''String'', NULL, 2),
    (N''DAYS_BEFORE'', N''SCHEDULE_TASK_DOMAIN_EXPIRATION'', N''String'', NULL, 1),
    (N''ENABLE_NOTIFICATION'', N''SCHEDULE_TASK_DOMAIN_EXPIRATION'', N''Boolean'', N''false'', 3),
    (N''INCLUDE_NONEXISTEN_DOMAINS'', N''SCHEDULE_TASK_DOMAIN_EXPIRATION'', N''Boolean'', N''false'', 4),
    (N''MAIL_TO'', N''SCHEDULE_TASK_DOMAIN_EXPIRATION'', N''String'', NULL, 2),
    (N''DNS_SERVERS'', N''SCHEDULE_TASK_DOMAIN_LOOKUP'', N''String'', NULL, 1),
    (N''MAIL_TO'', N''SCHEDULE_TASK_DOMAIN_LOOKUP'', N''String'', NULL, 2),
    (N''PAUSE_BETWEEN_QUERIES'', N''SCHEDULE_TASK_DOMAIN_LOOKUP'', N''String'', N''100'', 4),
    (N''SERVER_NAME'', N''SCHEDULE_TASK_DOMAIN_LOOKUP'', N''String'', N'''', 3),
    (N''FILE_PATH'', N''SCHEDULE_TASK_FTP_FILES'', N''String'', N''\'', 1),
    (N''FTP_FOLDER'', N''SCHEDULE_TASK_FTP_FILES'', N''String'', NULL, 5),
    (N''FTP_PASSWORD'', N''SCHEDULE_TASK_FTP_FILES'', N''String'', NULL, 4),
    (N''FTP_SERVER'', N''SCHEDULE_TASK_FTP_FILES'', N''String'', N''ftp.myserver.com'', 2),
    (N''FTP_USERNAME'', N''SCHEDULE_TASK_FTP_FILES'', N''String'', NULL, 3);
    INSERT INTO [ScheduleTaskParameters] ([ParameterID], [TaskID], [DataTypeID], [DefaultValue], [ParameterOrder])
    VALUES (N''CRM_REPORT'', N''SCHEDULE_TASK_HOSTED_SOLUTION_REPORT'', N''Boolean'', N''true'', 6),
    (N''EMAIL'', N''SCHEDULE_TASK_HOSTED_SOLUTION_REPORT'', N''String'', NULL, 1),
    (N''EXCHANGE_REPORT'', N''SCHEDULE_TASK_HOSTED_SOLUTION_REPORT'', N''Boolean'', N''true'', 2),
    (N''LYNC_REPORT'', N''SCHEDULE_TASK_HOSTED_SOLUTION_REPORT'', N''Boolean'', N''true'', 4),
    (N''ORGANIZATION_REPORT'', N''SCHEDULE_TASK_HOSTED_SOLUTION_REPORT'', N''Boolean'', N''true'', 7),
    (N''SFB_REPORT'', N''SCHEDULE_TASK_HOSTED_SOLUTION_REPORT'', N''Boolean'', N''true'', 5),
    (N''SHAREPOINT_REPORT'', N''SCHEDULE_TASK_HOSTED_SOLUTION_REPORT'', N''Boolean'', N''true'', 3),
    (N''MARIADB_OVERUSED'', N''SCHEDULE_TASK_NOTIFY_OVERUSED_DATABASES'', N''Boolean'', N''true'', 1),
    (N''MSSQL_OVERUSED'', N''SCHEDULE_TASK_NOTIFY_OVERUSED_DATABASES'', N''Boolean'', N''true'', 1),
    (N''MYSQL_OVERUSED'', N''SCHEDULE_TASK_NOTIFY_OVERUSED_DATABASES'', N''Boolean'', N''true'', 1),
    (N''OVERUSED_MAIL_BCC'', N''SCHEDULE_TASK_NOTIFY_OVERUSED_DATABASES'', N''String'', N'''', 1),
    (N''OVERUSED_MAIL_BODY'', N''SCHEDULE_TASK_NOTIFY_OVERUSED_DATABASES'', N''String'', N'''', 1),
    (N''OVERUSED_MAIL_FROM'', N''SCHEDULE_TASK_NOTIFY_OVERUSED_DATABASES'', N''String'', N'''', 1),
    (N''OVERUSED_MAIL_SUBJECT'', N''SCHEDULE_TASK_NOTIFY_OVERUSED_DATABASES'', N''String'', N'''', 1),
    (N''OVERUSED_USAGE_THRESHOLD'', N''SCHEDULE_TASK_NOTIFY_OVERUSED_DATABASES'', N''String'', N''100'', 1),
    (N''SEND_OVERUSED_EMAIL'', N''SCHEDULE_TASK_NOTIFY_OVERUSED_DATABASES'', N''Boolean'', N''true'', 1),
    (N''SEND_WARNING_EMAIL'', N''SCHEDULE_TASK_NOTIFY_OVERUSED_DATABASES'', N''Boolean'', N''true'', 1),
    (N''WARNING_MAIL_BCC'', N''SCHEDULE_TASK_NOTIFY_OVERUSED_DATABASES'', N''String'', N'''', 1),
    (N''WARNING_MAIL_BODY'', N''SCHEDULE_TASK_NOTIFY_OVERUSED_DATABASES'', N''String'', N'''', 1),
    (N''WARNING_MAIL_FROM'', N''SCHEDULE_TASK_NOTIFY_OVERUSED_DATABASES'', N''String'', N'''', 1),
    (N''WARNING_MAIL_SUBJECT'', N''SCHEDULE_TASK_NOTIFY_OVERUSED_DATABASES'', N''String'', N'''', 1),
    (N''WARNING_USAGE_THRESHOLD'', N''SCHEDULE_TASK_NOTIFY_OVERUSED_DATABASES'', N''String'', N''80'', 1),
    (N''EXECUTABLE_PARAMS'', N''SCHEDULE_TASK_RUN_SYSTEM_COMMAND'', N''String'', N'''', 3),
    (N''EXECUTABLE_PATH'', N''SCHEDULE_TASK_RUN_SYSTEM_COMMAND'', N''String'', N''Executable.exe'', 2),
    (N''SERVER_NAME'', N''SCHEDULE_TASK_RUN_SYSTEM_COMMAND'', N''String'', NULL, 1),
    (N''MAIL_BODY'', N''SCHEDULE_TASK_SEND_MAIL'', N''MultiString'', NULL, 4),
    (N''MAIL_FROM'', N''SCHEDULE_TASK_SEND_MAIL'', N''String'', NULL, 1),
    (N''MAIL_SUBJECT'', N''SCHEDULE_TASK_SEND_MAIL'', N''String'', NULL, 3),
    (N''MAIL_TO'', N''SCHEDULE_TASK_SEND_MAIL'', N''String'', NULL, 2),
    (N''BANDWIDTH_OVERUSED'', N''SCHEDULE_TASK_SUSPEND_PACKAGES'', N''Boolean'', N''true'', 1),
    (N''DISKSPACE_OVERUSED'', N''SCHEDULE_TASK_SUSPEND_PACKAGES'', N''Boolean'', N''true'', 1),
    (N''SEND_SUSPENSION_EMAIL'', N''SCHEDULE_TASK_SUSPEND_PACKAGES'', N''Boolean'', N''true'', 1),
    (N''SEND_WARNING_EMAIL'', N''SCHEDULE_TASK_SUSPEND_PACKAGES'', N''Boolean'', N''true'', 1),
    (N''SUSPEND_OVERUSED'', N''SCHEDULE_TASK_SUSPEND_PACKAGES'', N''Boolean'', N''true'', 1),
    (N''SUSPENSION_MAIL_BCC'', N''SCHEDULE_TASK_SUSPEND_PACKAGES'', N''String'', NULL, 1),
    (N''SUSPENSION_MAIL_BODY'', N''SCHEDULE_TASK_SUSPEND_PACKAGES'', N''String'', NULL, 1),
    (N''SUSPENSION_MAIL_FROM'', N''SCHEDULE_TASK_SUSPEND_PACKAGES'', N''String'', NULL, 1),
    (N''SUSPENSION_MAIL_SUBJECT'', N''SCHEDULE_TASK_SUSPEND_PACKAGES'', N''String'', NULL, 1),
    (N''SUSPENSION_USAGE_THRESHOLD'', N''SCHEDULE_TASK_SUSPEND_PACKAGES'', N''String'', N''100'', 1),
    (N''WARNING_MAIL_BCC'', N''SCHEDULE_TASK_SUSPEND_PACKAGES'', N''String'', NULL, 1),
    (N''WARNING_MAIL_BODY'', N''SCHEDULE_TASK_SUSPEND_PACKAGES'', N''String'', NULL, 1),
    (N''WARNING_MAIL_FROM'', N''SCHEDULE_TASK_SUSPEND_PACKAGES'', N''String'', NULL, 1);
    INSERT INTO [ScheduleTaskParameters] ([ParameterID], [TaskID], [DataTypeID], [DefaultValue], [ParameterOrder])
    VALUES (N''WARNING_MAIL_SUBJECT'', N''SCHEDULE_TASK_SUSPEND_PACKAGES'', N''String'', NULL, 1),
    (N''WARNING_USAGE_THRESHOLD'', N''SCHEDULE_TASK_SUSPEND_PACKAGES'', N''String'', N''80'', 1),
    (N''DAYS_BEFORE_EXPIRATION'', N''SCHEDULE_TASK_USER_PASSWORD_EXPIRATION_NOTIFICATION'', N''String'', NULL, 1),
    (N''FOLDER'', N''SCHEDULE_TASK_ZIP_FILES'', N''String'', NULL, 1),
    (N''ZIP_FILE'', N''SCHEDULE_TASK_ZIP_FILES'', N''String'', N''\archive.zip'', 2)');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ParameterID', N'TaskID', N'DataTypeID', N'DefaultValue', N'ParameterOrder') AND [object_id] = OBJECT_ID(N'[ScheduleTaskParameters]'))
        SET IDENTITY_INSERT [ScheduleTaskParameters] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ConfigurationID', N'TaskID', N'Description', N'Environment') AND [object_id] = OBJECT_ID(N'[ScheduleTaskViewConfiguration]'))
        SET IDENTITY_INSERT [ScheduleTaskViewConfiguration] ON;
    EXEC(N'INSERT INTO [ScheduleTaskViewConfiguration] ([ConfigurationID], [TaskID], [Description], [Environment])
    VALUES (N''ASP_NET'', N''SCHEDULE_TASK_ACTIVATE_PAID_INVOICES'', N''~/DesktopModules/SolidCP/ScheduleTaskControls/EmptyView.ascx'', N''ASP.NET''),
    (N''ASP_NET'', N''SCHEDULE_TASK_AUDIT_LOG_REPORT'', N''~/DesktopModules/SolidCP/ScheduleTaskControls/AuditLogReportView.ascx'', N''ASP.NET''),
    (N''ASP_NET'', N''SCHEDULE_TASK_BACKUP'', N''~/DesktopModules/SolidCP/ScheduleTaskControls/Backup.ascx'', N''ASP.NET''),
    (N''ASP_NET'', N''SCHEDULE_TASK_BACKUP_DATABASE'', N''~/DesktopModules/SolidCP/ScheduleTaskControls/BackupDatabase.ascx'', N''ASP.NET''),
    (N''ASP_NET'', N''SCHEDULE_TASK_CALCULATE_EXCHANGE_DISKSPACE'', N''~/DesktopModules/SolidCP/ScheduleTaskControls/EmptyView.ascx'', N''ASP.NET''),
    (N''ASP_NET'', N''SCHEDULE_TASK_CALCULATE_PACKAGES_BANDWIDTH'', N''~/DesktopModules/SolidCP/ScheduleTaskControls/EmptyView.ascx'', N''ASP.NET''),
    (N''ASP_NET'', N''SCHEDULE_TASK_CALCULATE_PACKAGES_DISKSPACE'', N''~/DesktopModules/SolidCP/ScheduleTaskControls/EmptyView.ascx'', N''ASP.NET''),
    (N''ASP_NET'', N''SCHEDULE_TASK_CANCEL_OVERDUE_INVOICES'', N''~/DesktopModules/SolidCP/ScheduleTaskControls/EmptyView.ascx'', N''ASP.NET''),
    (N''ASP_NET'', N''SCHEDULE_TASK_CHECK_WEBSITE'', N''~/DesktopModules/SolidCP/ScheduleTaskControls/CheckWebsite.ascx'', N''ASP.NET''),
    (N''ASP_NET'', N''SCHEDULE_TASK_DOMAIN_EXPIRATION'', N''~/DesktopModules/SolidCP/ScheduleTaskControls/DomainExpirationView.ascx'', N''ASP.NET''),
    (N''ASP_NET'', N''SCHEDULE_TASK_DOMAIN_LOOKUP'', N''~/DesktopModules/SolidCP/ScheduleTaskControls/DomainLookupView.ascx'', N''ASP.NET''),
    (N''ASP_NET'', N''SCHEDULE_TASK_FTP_FILES'', N''~/DesktopModules/SolidCP/ScheduleTaskControls/SendFilesViaFtp.ascx'', N''ASP.NET''),
    (N''ASP_NET'', N''SCHEDULE_TASK_GENERATE_INVOICES'', N''~/DesktopModules/SolidCP/ScheduleTaskControls/EmptyView.ascx'', N''ASP.NET''),
    (N''ASP_NET'', N''SCHEDULE_TASK_HOSTED_SOLUTION_REPORT'', N''~/DesktopModules/SolidCP/ScheduleTaskControls/HostedSolutionReport.ascx'', N''ASP.NET''),
    (N''ASP_NET'', N''SCHEDULE_TASK_NOTIFY_OVERUSED_DATABASES'', N''~/DesktopModules/SolidCP/ScheduleTaskControls/NotifyOverusedDatabases.ascx'', N''ASP.NET''),
    (N''ASP_NET'', N''SCHEDULE_TASK_RUN_PAYMENT_QUEUE'', N''~/DesktopModules/SolidCP/ScheduleTaskControls/EmptyView.ascx'', N''ASP.NET''),
    (N''ASP_NET'', N''SCHEDULE_TASK_RUN_SYSTEM_COMMAND'', N''~/DesktopModules/SolidCP/ScheduleTaskControls/ExecuteSystemCommand.ascx'', N''ASP.NET''),
    (N''ASP_NET'', N''SCHEDULE_TASK_SEND_MAIL'', N''~/DesktopModules/SolidCP/ScheduleTaskControls/SendEmailNotification.ascx'', N''ASP.NET''),
    (N''ASP_NET'', N''SCHEDULE_TASK_SUSPEND_OVERDUE_INVOICES'', N''~/DesktopModules/SolidCP/ScheduleTaskControls/EmptyView.ascx'', N''ASP.NET''),
    (N''ASP_NET'', N''SCHEDULE_TASK_SUSPEND_PACKAGES'', N''~/DesktopModules/SolidCP/ScheduleTaskControls/SuspendOverusedSpaces.ascx'', N''ASP.NET''),
    (N''ASP_NET'', N''SCHEDULE_TASK_USER_PASSWORD_EXPIRATION_NOTIFICATION'', N''~/DesktopModules/SolidCP/ScheduleTaskControls/UserPasswordExpirationNotificationView.ascx'', N''ASP.NET''),
    (N''ASP_NET'', N''SCHEDULE_TASK_ZIP_FILES'', N''~/DesktopModules/SolidCP/ScheduleTaskControls/ZipFiles.ascx'', N''ASP.NET'')');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ConfigurationID', N'TaskID', N'Description', N'Environment') AND [object_id] = OBJECT_ID(N'[ScheduleTaskViewConfiguration]'))
        SET IDENTITY_INSERT [ScheduleTaskViewConfiguration] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'Backupable', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Searchable', N'Suspendable', N'TypeName', N'TypeOrder') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] ON;
    EXEC(N'INSERT INTO [ServiceItemTypes] ([ItemTypeID], [Backupable], [CalculateBandwidth], [CalculateDiskspace], [DisplayName], [Disposable], [GroupID], [Searchable], [Suspendable], [TypeName], [TypeOrder])
    VALUES (2, CAST(1 AS bit), CAST(0 AS bit), CAST(1 AS bit), N''HomeFolder'', CAST(1 AS bit), 1, CAST(0 AS bit), CAST(0 AS bit), N''SolidCP.Providers.OS.HomeFolder, SolidCP.Providers.Base'', 15)');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'Backupable', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Searchable', N'Suspendable', N'TypeName', N'TypeOrder') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'Backupable', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Importable', N'Searchable', N'Suspendable', N'TypeName', N'TypeOrder') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] ON;
    EXEC(N'INSERT INTO [ServiceItemTypes] ([ItemTypeID], [Backupable], [CalculateBandwidth], [CalculateDiskspace], [DisplayName], [Disposable], [GroupID], [Importable], [Searchable], [Suspendable], [TypeName], [TypeOrder])
    VALUES (5, CAST(1 AS bit), CAST(0 AS bit), CAST(1 AS bit), N''MsSQL2000Database'', CAST(1 AS bit), 5, CAST(1 AS bit), CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.Database.SqlDatabase, SolidCP.Providers.Base'', 9),
    (6, CAST(1 AS bit), CAST(0 AS bit), CAST(0 AS bit), N''MsSQL2000User'', CAST(1 AS bit), 5, CAST(1 AS bit), CAST(1 AS bit), CAST(1 AS bit), N''SolidCP.Providers.Database.SqlUser, SolidCP.Providers.Base'', 10),
    (7, CAST(1 AS bit), CAST(0 AS bit), CAST(1 AS bit), N''MySQL4Database'', CAST(1 AS bit), 6, CAST(1 AS bit), CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.Database.SqlDatabase, SolidCP.Providers.Base'', 13),
    (8, CAST(1 AS bit), CAST(0 AS bit), CAST(0 AS bit), N''MySQL4User'', CAST(1 AS bit), 6, CAST(1 AS bit), CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.Database.SqlUser, SolidCP.Providers.Base'', 14),
    (9, CAST(1 AS bit), CAST(1 AS bit), CAST(0 AS bit), N''FTPAccount'', CAST(1 AS bit), 3, CAST(1 AS bit), CAST(1 AS bit), CAST(1 AS bit), N''SolidCP.Providers.FTP.FtpAccount, SolidCP.Providers.Base'', 3),
    (10, CAST(1 AS bit), CAST(1 AS bit), CAST(1 AS bit), N''WebSite'', CAST(1 AS bit), 2, CAST(1 AS bit), CAST(1 AS bit), CAST(1 AS bit), N''SolidCP.Providers.Web.WebSite, SolidCP.Providers.Base'', 2),
    (11, CAST(1 AS bit), CAST(1 AS bit), CAST(0 AS bit), N''MailDomain'', CAST(1 AS bit), 4, CAST(1 AS bit), CAST(1 AS bit), CAST(1 AS bit), N''SolidCP.Providers.Mail.MailDomain, SolidCP.Providers.Base'', 8)');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'Backupable', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Importable', N'Searchable', N'Suspendable', N'TypeName', N'TypeOrder') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'Backupable', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Importable', N'Searchable', N'Suspendable', N'TypeName') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] ON;
    EXEC(N'INSERT INTO [ServiceItemTypes] ([ItemTypeID], [Backupable], [CalculateBandwidth], [CalculateDiskspace], [DisplayName], [Disposable], [GroupID], [Importable], [Searchable], [Suspendable], [TypeName])
    VALUES (12, CAST(1 AS bit), CAST(0 AS bit), CAST(0 AS bit), N''DNSZone'', CAST(1 AS bit), 7, CAST(1 AS bit), CAST(0 AS bit), CAST(1 AS bit), N''SolidCP.Providers.DNS.DnsZone, SolidCP.Providers.Base'')');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'Backupable', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Importable', N'Searchable', N'Suspendable', N'TypeName') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Searchable', N'Suspendable', N'TypeName', N'TypeOrder') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] ON;
    EXEC(N'INSERT INTO [ServiceItemTypes] ([ItemTypeID], [CalculateBandwidth], [CalculateDiskspace], [DisplayName], [Disposable], [GroupID], [Searchable], [Suspendable], [TypeName], [TypeOrder])
    VALUES (13, CAST(0 AS bit), CAST(0 AS bit), N''Domain'', CAST(0 AS bit), 1, CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.OS.Domain, SolidCP.Providers.Base'', 1)');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Searchable', N'Suspendable', N'TypeName', N'TypeOrder') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'Backupable', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Importable', N'Searchable', N'Suspendable', N'TypeName', N'TypeOrder') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] ON;
    EXEC(N'INSERT INTO [ServiceItemTypes] ([ItemTypeID], [Backupable], [CalculateBandwidth], [CalculateDiskspace], [DisplayName], [Disposable], [GroupID], [Importable], [Searchable], [Suspendable], [TypeName], [TypeOrder])
    VALUES (14, CAST(1 AS bit), CAST(0 AS bit), CAST(0 AS bit), N''StatisticsSite'', CAST(1 AS bit), 8, CAST(1 AS bit), CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.Statistics.StatsSite, SolidCP.Providers.Base'', 17)');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'Backupable', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Importable', N'Searchable', N'Suspendable', N'TypeName', N'TypeOrder') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Searchable', N'Suspendable', N'TypeName', N'TypeOrder') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] ON;
    EXEC(N'INSERT INTO [ServiceItemTypes] ([ItemTypeID], [CalculateBandwidth], [CalculateDiskspace], [DisplayName], [Disposable], [GroupID], [Searchable], [Suspendable], [TypeName], [TypeOrder])
    VALUES (15, CAST(0 AS bit), CAST(1 AS bit), N''MailAccount'', CAST(0 AS bit), 4, CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.Mail.MailAccount, SolidCP.Providers.Base'', 4),
    (16, CAST(0 AS bit), CAST(0 AS bit), N''MailAlias'', CAST(0 AS bit), 4, CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.Mail.MailAlias, SolidCP.Providers.Base'', 5),
    (17, CAST(0 AS bit), CAST(0 AS bit), N''MailList'', CAST(0 AS bit), 4, CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.Mail.MailList, SolidCP.Providers.Base'', 7),
    (18, CAST(0 AS bit), CAST(0 AS bit), N''MailGroup'', CAST(0 AS bit), 4, CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.Mail.MailGroup, SolidCP.Providers.Base'', 6)');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Searchable', N'Suspendable', N'TypeName', N'TypeOrder') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'Backupable', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Importable', N'Searchable', N'Suspendable', N'TypeName', N'TypeOrder') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] ON;
    EXEC(N'INSERT INTO [ServiceItemTypes] ([ItemTypeID], [Backupable], [CalculateBandwidth], [CalculateDiskspace], [DisplayName], [Disposable], [GroupID], [Importable], [Searchable], [Suspendable], [TypeName], [TypeOrder])
    VALUES (20, CAST(1 AS bit), CAST(0 AS bit), CAST(0 AS bit), N''ODBCDSN'', CAST(1 AS bit), 1, CAST(1 AS bit), CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.OS.SystemDSN, SolidCP.Providers.Base'', 22),
    (21, CAST(1 AS bit), CAST(0 AS bit), CAST(1 AS bit), N''MsSQL2005Database'', CAST(1 AS bit), 10, CAST(1 AS bit), CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.Database.SqlDatabase, SolidCP.Providers.Base'', 11),
    (22, CAST(1 AS bit), CAST(0 AS bit), CAST(0 AS bit), N''MsSQL2005User'', CAST(1 AS bit), 10, CAST(1 AS bit), CAST(1 AS bit), CAST(1 AS bit), N''SolidCP.Providers.Database.SqlUser, SolidCP.Providers.Base'', 12),
    (23, CAST(1 AS bit), CAST(0 AS bit), CAST(1 AS bit), N''MySQL5Database'', CAST(1 AS bit), 11, CAST(1 AS bit), CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.Database.SqlDatabase, SolidCP.Providers.Base'', 15),
    (24, CAST(1 AS bit), CAST(0 AS bit), CAST(0 AS bit), N''MySQL5User'', CAST(1 AS bit), 11, CAST(1 AS bit), CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.Database.SqlUser, SolidCP.Providers.Base'', 16)');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'Backupable', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Importable', N'Searchable', N'Suspendable', N'TypeName', N'TypeOrder') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'Backupable', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Searchable', N'Suspendable', N'TypeName', N'TypeOrder') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] ON;
    EXEC(N'INSERT INTO [ServiceItemTypes] ([ItemTypeID], [Backupable], [CalculateBandwidth], [CalculateDiskspace], [DisplayName], [Disposable], [GroupID], [Searchable], [Suspendable], [TypeName], [TypeOrder])
    VALUES (25, CAST(1 AS bit), CAST(0 AS bit), CAST(0 AS bit), N''SharedSSLFolder'', CAST(1 AS bit), 2, CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.Web.SharedSSLFolder, SolidCP.Providers.Base'', 21)');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'Backupable', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Searchable', N'Suspendable', N'TypeName', N'TypeOrder') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'Backupable', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Searchable', N'Suspendable', N'TypeName') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] ON;
    EXEC(N'INSERT INTO [ServiceItemTypes] ([ItemTypeID], [Backupable], [CalculateBandwidth], [CalculateDiskspace], [DisplayName], [Disposable], [GroupID], [Searchable], [Suspendable], [TypeName])
    VALUES (28, CAST(1 AS bit), CAST(0 AS bit), CAST(0 AS bit), N''SecondaryDNSZone'', CAST(1 AS bit), 7, CAST(0 AS bit), CAST(1 AS bit), N''SolidCP.Providers.DNS.SecondaryDnsZone, SolidCP.Providers.Base'')');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'Backupable', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Searchable', N'Suspendable', N'TypeName') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'Backupable', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Searchable', N'Suspendable', N'TypeName', N'TypeOrder') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] ON;
    EXEC(N'INSERT INTO [ServiceItemTypes] ([ItemTypeID], [Backupable], [CalculateBandwidth], [CalculateDiskspace], [DisplayName], [Disposable], [GroupID], [Searchable], [Suspendable], [TypeName], [TypeOrder])
    VALUES (29, CAST(1 AS bit), CAST(0 AS bit), CAST(1 AS bit), N''Organization'', CAST(1 AS bit), 13, CAST(1 AS bit), CAST(1 AS bit), N''SolidCP.Providers.HostedSolution.Organization, SolidCP.Providers.Base'', 1),
    (30, CAST(1 AS bit), NULL, NULL, N''OrganizationDomain'', NULL, 13, NULL, NULL, N''SolidCP.Providers.HostedSolution.OrganizationDomain, SolidCP.Providers.Base'', 1)');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'Backupable', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Searchable', N'Suspendable', N'TypeName', N'TypeOrder') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'Backupable', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Importable', N'Searchable', N'Suspendable', N'TypeName', N'TypeOrder') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] ON;
    EXEC(N'INSERT INTO [ServiceItemTypes] ([ItemTypeID], [Backupable], [CalculateBandwidth], [CalculateDiskspace], [DisplayName], [Disposable], [GroupID], [Importable], [Searchable], [Suspendable], [TypeName], [TypeOrder])
    VALUES (31, CAST(1 AS bit), CAST(0 AS bit), CAST(1 AS bit), N''MsSQL2008Database'', CAST(1 AS bit), 22, CAST(1 AS bit), CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.Database.SqlDatabase, SolidCP.Providers.Base'', 1),
    (32, CAST(1 AS bit), CAST(0 AS bit), CAST(0 AS bit), N''MsSQL2008User'', CAST(1 AS bit), 22, CAST(1 AS bit), CAST(1 AS bit), CAST(1 AS bit), N''SolidCP.Providers.Database.SqlUser, SolidCP.Providers.Base'', 1)');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'Backupable', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Importable', N'Searchable', N'Suspendable', N'TypeName', N'TypeOrder') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Searchable', N'Suspendable', N'TypeName', N'TypeOrder') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] ON;
    EXEC(N'INSERT INTO [ServiceItemTypes] ([ItemTypeID], [CalculateBandwidth], [CalculateDiskspace], [DisplayName], [Disposable], [GroupID], [Searchable], [Suspendable], [TypeName], [TypeOrder])
    VALUES (33, CAST(0 AS bit), CAST(0 AS bit), N''VirtualMachine'', CAST(1 AS bit), 30, CAST(1 AS bit), CAST(1 AS bit), N''SolidCP.Providers.Virtualization.VirtualMachine, SolidCP.Providers.Base'', 1),
    (34, CAST(0 AS bit), CAST(0 AS bit), N''VirtualSwitch'', CAST(1 AS bit), 30, CAST(1 AS bit), CAST(1 AS bit), N''SolidCP.Providers.Virtualization.VirtualSwitch, SolidCP.Providers.Base'', 2),
    (35, CAST(0 AS bit), CAST(0 AS bit), N''VMInfo'', CAST(1 AS bit), 40, CAST(1 AS bit), CAST(1 AS bit), N''SolidCP.Providers.Virtualization.VMInfo, SolidCP.Providers.Base'', 1),
    (36, CAST(0 AS bit), CAST(0 AS bit), N''VirtualSwitch'', CAST(1 AS bit), 40, CAST(1 AS bit), CAST(1 AS bit), N''SolidCP.Providers.Virtualization.VirtualSwitch, SolidCP.Providers.Base'', 2)');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Searchable', N'Suspendable', N'TypeName', N'TypeOrder') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'Backupable', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Importable', N'Searchable', N'Suspendable', N'TypeName', N'TypeOrder') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] ON;
    EXEC(N'INSERT INTO [ServiceItemTypes] ([ItemTypeID], [Backupable], [CalculateBandwidth], [CalculateDiskspace], [DisplayName], [Disposable], [GroupID], [Importable], [Searchable], [Suspendable], [TypeName], [TypeOrder])
    VALUES (37, CAST(1 AS bit), CAST(0 AS bit), CAST(1 AS bit), N''MsSQL2012Database'', CAST(1 AS bit), 23, CAST(1 AS bit), CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.Database.SqlDatabase, SolidCP.Providers.Base'', 1),
    (38, CAST(1 AS bit), CAST(0 AS bit), CAST(0 AS bit), N''MsSQL2012User'', CAST(1 AS bit), 23, CAST(1 AS bit), CAST(1 AS bit), CAST(1 AS bit), N''SolidCP.Providers.Database.SqlUser, SolidCP.Providers.Base'', 1),
    (39, CAST(1 AS bit), CAST(0 AS bit), CAST(1 AS bit), N''MsSQL2014Database'', CAST(1 AS bit), 46, CAST(1 AS bit), CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.Database.SqlDatabase, SolidCP.Providers.Base'', 1),
    (40, CAST(1 AS bit), CAST(0 AS bit), CAST(0 AS bit), N''MsSQL2014User'', CAST(1 AS bit), 46, CAST(1 AS bit), CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.Database.SqlUser, SolidCP.Providers.Base'', 1)');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'Backupable', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Importable', N'Searchable', N'Suspendable', N'TypeName', N'TypeOrder') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Searchable', N'Suspendable', N'TypeName', N'TypeOrder') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] ON;
    EXEC(N'INSERT INTO [ServiceItemTypes] ([ItemTypeID], [CalculateBandwidth], [CalculateDiskspace], [DisplayName], [Disposable], [GroupID], [Searchable], [Suspendable], [TypeName], [TypeOrder])
    VALUES (41, CAST(0 AS bit), CAST(0 AS bit), N''VirtualMachine'', CAST(1 AS bit), 33, CAST(1 AS bit), CAST(1 AS bit), N''SolidCP.Providers.Virtualization.VirtualMachine, SolidCP.Providers.Base'', 1),
    (42, CAST(0 AS bit), CAST(0 AS bit), N''VirtualSwitch'', CAST(1 AS bit), 33, CAST(1 AS bit), CAST(1 AS bit), N''SolidCP.Providers.Virtualization.VirtualSwitch, SolidCP.Providers.Base'', 2)');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Searchable', N'Suspendable', N'TypeName', N'TypeOrder') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'Backupable', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Importable', N'Searchable', N'Suspendable', N'TypeName', N'TypeOrder') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] ON;
    EXEC(N'INSERT INTO [ServiceItemTypes] ([ItemTypeID], [Backupable], [CalculateBandwidth], [CalculateDiskspace], [DisplayName], [Disposable], [GroupID], [Importable], [Searchable], [Suspendable], [TypeName], [TypeOrder])
    VALUES (71, CAST(1 AS bit), CAST(0 AS bit), CAST(1 AS bit), N''MsSQL2016Database'', CAST(1 AS bit), 71, CAST(1 AS bit), CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.Database.SqlDatabase, SolidCP.Providers.Base'', 1),
    (72, CAST(1 AS bit), CAST(0 AS bit), CAST(0 AS bit), N''MsSQL2016User'', CAST(1 AS bit), 71, CAST(1 AS bit), CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.Database.SqlUser, SolidCP.Providers.Base'', 1),
    (73, CAST(1 AS bit), CAST(0 AS bit), CAST(1 AS bit), N''MsSQL2017Database'', CAST(1 AS bit), 72, CAST(1 AS bit), CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.Database.SqlDatabase, SolidCP.Providers.Base'', 1),
    (74, CAST(1 AS bit), CAST(0 AS bit), CAST(0 AS bit), N''MsSQL2017User'', CAST(1 AS bit), 72, CAST(1 AS bit), CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.Database.SqlUser, SolidCP.Providers.Base'', 1),
    (75, CAST(1 AS bit), CAST(0 AS bit), CAST(1 AS bit), N''MySQL8Database'', CAST(1 AS bit), 90, CAST(1 AS bit), CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.Database.SqlDatabase, SolidCP.Providers.Base'', 18),
    (76, CAST(1 AS bit), CAST(0 AS bit), CAST(0 AS bit), N''MySQL8User'', CAST(1 AS bit), 90, CAST(1 AS bit), CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.Database.SqlUser, SolidCP.Providers.Base'', 19),
    (77, CAST(1 AS bit), CAST(0 AS bit), CAST(1 AS bit), N''MsSQL2019Database'', CAST(1 AS bit), 74, CAST(1 AS bit), CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.Database.SqlDatabase, SolidCP.Providers.Base'', 1),
    (78, CAST(1 AS bit), CAST(0 AS bit), CAST(0 AS bit), N''MsSQL2019User'', CAST(1 AS bit), 74, CAST(1 AS bit), CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.Database.SqlUser, SolidCP.Providers.Base'', 1),
    (79, CAST(1 AS bit), CAST(0 AS bit), CAST(1 AS bit), N''MsSQL2022Database'', CAST(1 AS bit), 75, CAST(1 AS bit), CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.Database.SqlDatabase, SolidCP.Providers.Base'', 1),
    (80, CAST(1 AS bit), CAST(0 AS bit), CAST(0 AS bit), N''MsSQL2022User'', CAST(1 AS bit), 75, CAST(1 AS bit), CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.Database.SqlUser, SolidCP.Providers.Base'', 1)');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'Backupable', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Importable', N'Searchable', N'Suspendable', N'TypeName', N'TypeOrder') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Searchable', N'Suspendable', N'TypeName', N'TypeOrder') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] ON;
    EXEC(N'INSERT INTO [ServiceItemTypes] ([ItemTypeID], [CalculateBandwidth], [CalculateDiskspace], [DisplayName], [Disposable], [GroupID], [Searchable], [Suspendable], [TypeName], [TypeOrder])
    VALUES (143, CAST(0 AS bit), CAST(0 AS bit), N''VirtualMachine'', CAST(1 AS bit), 167, CAST(1 AS bit), CAST(1 AS bit), N''SolidCP.Providers.Virtualization.VirtualMachine, SolidCP.Providers.Base'', 1),
    (144, CAST(0 AS bit), CAST(0 AS bit), N''VirtualSwitch'', CAST(1 AS bit), 167, CAST(1 AS bit), CAST(1 AS bit), N''SolidCP.Providers.Virtualization.VirtualSwitch, SolidCP.Providers.Base'', 2)');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Searchable', N'Suspendable', N'TypeName', N'TypeOrder') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'Backupable', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Importable', N'Searchable', N'Suspendable', N'TypeName', N'TypeOrder') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] ON;
    EXEC(N'INSERT INTO [ServiceItemTypes] ([ItemTypeID], [Backupable], [CalculateBandwidth], [CalculateDiskspace], [DisplayName], [Disposable], [GroupID], [Importable], [Searchable], [Suspendable], [TypeName], [TypeOrder])
    VALUES (200, CAST(1 AS bit), CAST(0 AS bit), CAST(1 AS bit), N''SharePointFoundationSiteCollection'', CAST(1 AS bit), 20, CAST(1 AS bit), CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.SharePoint.SharePointSiteCollection, SolidCP.Providers.Base'', 25),
    (202, CAST(1 AS bit), CAST(0 AS bit), CAST(1 AS bit), N''MariaDBDatabase'', CAST(1 AS bit), 50, CAST(1 AS bit), CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.Database.SqlDatabase, SolidCP.Providers.Base'', 1),
    (203, CAST(1 AS bit), CAST(0 AS bit), CAST(0 AS bit), N''MariaDBUser'', CAST(1 AS bit), 50, CAST(1 AS bit), CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.Database.SqlUser, SolidCP.Providers.Base'', 1),
    (204, CAST(1 AS bit), CAST(0 AS bit), CAST(1 AS bit), N''SharePointEnterpriseSiteCollection'', CAST(1 AS bit), 73, CAST(1 AS bit), CAST(1 AS bit), CAST(0 AS bit), N''SolidCP.Providers.SharePoint.SharePointEnterpriseSiteCollection, SolidCP.Providers.Base'', 100)');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ItemTypeID', N'Backupable', N'CalculateBandwidth', N'CalculateDiskspace', N'DisplayName', N'Disposable', N'GroupID', N'Importable', N'Searchable', N'Suspendable', N'TypeName', N'TypeOrder') AND [object_id] = OBJECT_ID(N'[ServiceItemTypes]'))
        SET IDENTITY_INSERT [ServiceItemTypes] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'PropertyName', N'SettingsName', N'UserID', N'PropertyValue') AND [object_id] = OBJECT_ID(N'[UserSettings]'))
        SET IDENTITY_INSERT [UserSettings] ON;
    EXEC(N'INSERT INTO [UserSettings] ([PropertyName], [SettingsName], [UserID], [PropertyValue])
    VALUES (N''CC'', N''AccountSummaryLetter'', 1, N''support@HostingCompany.com''),
    (N''EnableLetter'', N''AccountSummaryLetter'', 1, N''False''),
    (N''From'', N''AccountSummaryLetter'', 1, N''support@HostingCompany.com''),
    (N''HtmlBody'', N''AccountSummaryLetter'', 1, CONCAT(CAST(N''<html xmlns="http://www.w3.org/1999/xhtml">'' AS nvarchar(max)), nchar(13), nchar(10), N''<head>'', nchar(13), nchar(10), N''    <title>Account Summary Information</title>'', nchar(13), nchar(10), N''    <style type="text/css">'', nchar(13), nchar(10), N''		.Summary { background-color: ##ffffff; padding: 5px; }'', nchar(13), nchar(10), N''		.Summary .Header { padding: 10px 0px 10px 10px; font-size: 16pt; background-color: ##E5F2FF; color: ##1F4978; border-bottom: solid 2px ##86B9F7; }'', nchar(13), nchar(10), N''        .Summary A { color: ##0153A4; }'', nchar(13), nchar(10), N''        .Summary { font-family: Tahoma; font-size: 9pt; }'', nchar(13), nchar(10), N''        .Summary H1 { font-size: 1.7em; color: ##1F4978; border-bottom: dotted 3px ##efefef; }'', nchar(13), nchar(10), N''        .Summary H2 { font-size: 1.3em; color: ##1F4978; }'', nchar(13), nchar(10), N''        .Summary TABLE { border: solid 1px ##e5e5e5; }'', nchar(13), nchar(10), N''        .Summary TH,'', nchar(13), nchar(10), N''        .Summary TD.Label { padding: 5px; font-size: 8pt; font-weight: bold; background-color: ##f5f5f5; }'', nchar(13), nchar(10), N''        .Summary TD { padding: 8px; font-size: 9pt; }'', nchar(13), nchar(10), N''        .Summary UL LI { font-size: 1.1em; font-weight: bold; }'', nchar(13), nchar(10), N''        .Summary UL UL LI { font-size: 0.9em; font-weight: normal; }'', nchar(13), nchar(10), N''    </style>'', nchar(13), nchar(10), N''</head>'', nchar(13), nchar(10), N''<body>'', nchar(13), nchar(10), N''<div class="Summary">'', nchar(13), nchar(10), nchar(13), nchar(10), N''<a name="top"></a>'', nchar(13), nchar(10), N''<div class="Header">'', nchar(13), nchar(10), N''	Hosting Account Information'', nchar(13), nchar(10), N''</div>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:if test="#Signup#">'', nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''Hello #user.FirstName#,'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''New user account has been created and below you can find its summary information.'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<h1>Control Panel URL</h1>'', nchar(13), nchar(10), N''<table>'', nchar(13), nchar(10), N''    <thead>'', nchar(13), nchar(10), N''        <tr>'', nchar(13), nchar(10), N''            <th>Control Panel URL</th>'', nchar(13), nchar(10), N''            <th>Username</th>'', nchar(13), nchar(10), N''            <th>Password</th>'', nchar(13), nchar(10), N''        </tr>'', nchar(13), nchar(10), N''    </thead>'', nchar(13), nchar(10), N''    <tbody>'', nchar(13), nchar(10), N''        <tr>'', nchar(13), nchar(10), N''            <td><a href="http://panel.HostingCompany.com">http://panel.HostingCompany.com</a></td>'', nchar(13), nchar(10), N''            <td>#user.Username#</td>'', nchar(13), nchar(10), N''            <td>#user.Password#</td>'', nchar(13), nchar(10), N''        </tr>'', nchar(13), nchar(10), N''    </tbody>'', nchar(13), nchar(10), N''</table>'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<h1>Hosting Spaces</h1>'', nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''    The following hosting spaces have been created under your account:'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), N''<ad:foreach collection="#Spaces#" var="Space" index="i">'', nchar(13), nchar(10), N''<h2>#Space.PackageName#</h2>'', nchar(13), nchar(10), N''<table>'', nchar(13), nchar(10), N''	<tbody>'', nchar(13), nchar(10), N''		<tr>'', nchar(13), nchar(10), N''			<td class="Label">Hosting Plan:</td>'', nchar(13), nchar(10), N''			<td>'', nchar(13), nchar(10), N''				<ad:if test="#not(isnull(Plans[Space.PlanId]))#">#Plans[Space.PlanId].PlanName#<ad:else>System</ad:if>'', nchar(13), nchar(10), N''			</td>'', nchar(13), nchar(10), N''		</tr>'', nchar(13), nchar(10), N''		<ad:if test="#not(isnull(Plans[Space.PlanId]))#">'', nchar(13), nchar(10), N''		<tr>'', nchar(13), nchar(10), N''			<td class="Label">Purchase Date:</td>'', nchar(13), nchar(10), N''			<td>'', nchar(13), nchar(10), N''				#Space.PurchaseDate#'', nchar(13), nchar(10), N''			</td>'', nchar(13), nchar(10), N''		</tr>'', nchar(13), nchar(10), N''		<tr>'', nchar(13), nchar(10), N''			<td class="Label">Disk Space, MB:</td>'', nchar(13), nchar(10), N''			<td><ad:NumericQuota space="#SpaceContexts[Space.PackageId]#" quota="OS.Diskspace" /></td>'', nchar(13), nchar(10), N''		</tr>'', nchar(13), nchar(10), N''		<tr>'', nchar(13), nchar(10), N''			<td class="Label">Bandwidth, MB/Month:</td>'', nchar(13), nchar(10), N''			<td><ad:NumericQuota space="#SpaceContexts[Space.PackageId]#" quota="OS.Bandwidth" /></td>'', nchar(13), nchar(10), N''		</tr>'', nchar(13), nchar(10), N''		<tr>'', nchar(13), nchar(10), N''			<td class="Label">Maximum Number of Domains:</td>'', nchar(13), nchar(10), N''			<td><ad:NumericQuota space="#SpaceContexts[Space.PackageId]#" quota="OS.Domains" /></td>'', nchar(13), nchar(10), CONCAT(CAST(N''		</tr>'' AS nvarchar(max)), nchar(13), nchar(10), N''		<tr>'', nchar(13), nchar(10), N''			<td class="Label">Maximum Number of Sub-Domains:</td>'', nchar(13), nchar(10), N''			<td><ad:NumericQuota space="#SpaceContexts[Space.PackageId]#" quota="OS.SubDomains" /></td>'', nchar(13), nchar(10), N''		</tr>'', nchar(13), nchar(10), N''		</ad:if>'', nchar(13), nchar(10), N''	</tbody>'', nchar(13), nchar(10), N''</table>'', nchar(13), nchar(10), N''</ad:foreach>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:if test="#Signup#">'', nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''If you have any questions regarding your hosting account, feel free to contact our support department at any time.'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''Best regards,<br />'', nchar(13), nchar(10), N''SolidCP.<br />'', nchar(13), nchar(10), N''Web Site: <a href="https://solidcp.com">https://solidcp.com</a><br />'', nchar(13), nchar(10), N''E-Mail: <a href="mailto:support@solidcp.com">support@solidcp.com</a>'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:template name="NumericQuota">'', nchar(13), nchar(10), N''	<ad:if test="#space.Quotas.ContainsKey(quota)#">'', nchar(13), nchar(10), N''		<ad:if test="#space.Quotas[quota].QuotaAllocatedValue isnot -1#">#space.Quotas[quota].QuotaAllocatedValue#<ad:else>Unlimited</ad:if>'', nchar(13), nchar(10), N''	<ad:else>'', nchar(13), nchar(10), N''		0'', nchar(13), nchar(10), N''	</ad:if>'', nchar(13), nchar(10), N''</ad:template>'', nchar(13), nchar(10), nchar(13), nchar(10), N''</div>'', nchar(13), nchar(10), N''</body>'', nchar(13), nchar(10), N''</html>''))),
    (N''Priority'', N''AccountSummaryLetter'', 1, N''Normal''),
    (N''Subject'', N''AccountSummaryLetter'', 1, N''<ad:if test="#Signup#">SolidCP  account has been created for<ad:else>SolidCP  account summary for</ad:if> #user.FirstName# #user.LastName#''),
    (N''TextBody'', N''AccountSummaryLetter'', 1, CONCAT(CAST(N''================================='' AS nvarchar(max)), nchar(13), nchar(10), N''   Hosting Account Information'', nchar(13), nchar(10), N''================================='', nchar(13), nchar(10), N''<ad:if test="#Signup#">Hello #user.FirstName#,'', nchar(13), nchar(10), nchar(13), nchar(10), N''New user account has been created and below you can find its summary information.'', nchar(13), nchar(10), nchar(13), nchar(10), N''Control Panel URL: https://panel.solidcp.com'', nchar(13), nchar(10), N''Username: #user.Username#'', nchar(13), nchar(10), N''Password: #user.Password#'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), N''Hosting Spaces'', nchar(13), nchar(10), N''=============='', nchar(13), nchar(10), N''The following hosting spaces have been created under your account:'', nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:foreach collection="#Spaces#" var="Space" index="i">'', nchar(13), nchar(10), N''=== #Space.PackageName# ==='', nchar(13), nchar(10), N''Hosting Plan: <ad:if test="#not(isnull(Plans[Space.PlanId]))#">#Plans[Space.PlanId].PlanName#<ad:else>System</ad:if>'', nchar(13), nchar(10), N''<ad:if test="#not(isnull(Plans[Space.PlanId]))#">Purchase Date: #Space.PurchaseDate#'', nchar(13), nchar(10), N''Disk Space, MB: <ad:NumericQuota space="#SpaceContexts[Space.PackageId]#" quota="OS.Diskspace" />'', nchar(13), nchar(10), N''Bandwidth, MB/Month: <ad:NumericQuota space="#SpaceContexts[Space.PackageId]#" quota="OS.Bandwidth" />'', nchar(13), nchar(10), N''Maximum Number of Domains: <ad:NumericQuota space="#SpaceContexts[Space.PackageId]#" quota="OS.Domains" />'', nchar(13), nchar(10), N''Maximum Number of Sub-Domains: <ad:NumericQuota space="#SpaceContexts[Space.PackageId]#" quota="OS.SubDomains" />'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), N''</ad:foreach>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:if test="#Signup#">If you have any questions regarding your hosting account, feel free to contact our support department at any time.'', nchar(13), nchar(10), nchar(13), nchar(10), N''Best regards,'', nchar(13), nchar(10), N''SolidCP.'', nchar(13), nchar(10), N''Web Site: https://solidcp.com">'', nchar(13), nchar(10), N''E-Mail: support@solidcp.com'', nchar(13), nchar(10), N''</ad:if><ad:template name="NumericQuota"><ad:if test="#space.Quotas.ContainsKey(quota)#"><ad:if test="#space.Quotas[quota].QuotaAllocatedValue isnot -1#">#space.Quotas[quota].QuotaAllocatedValue#<ad:else>Unlimited</ad:if><ad:else>0</ad:if></ad:template>'')),
    (N''Transform'', N''BandwidthXLST'', 1, CONCAT(CAST(N''<?xml version="1.0" encoding="UTF-8"?>'' AS nvarchar(max)), nchar(13), nchar(10), N''<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">'', nchar(13), nchar(10), N''<xsl:template match="/">'', nchar(13), nchar(10), N''  <html>'', nchar(13), nchar(10), N''  <body>'', nchar(13), nchar(10), N''  <img alt="Embedded Image" width="299" height="60" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASsAAAA8CAYAAAA+AJwjAAAACXBIWXMAAAsTAAALEwEAmpwYAAA4G2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS41LWMwMTQgNzkuMTUxNDgxLCAyMDEzLzAzLzEzLTEyOjA5OjE1ICAgICAgICAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgICAgICAgICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgICAgICAgICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPHhtcDpDcmVhdG9yVG9vbD5BZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpPC94bXA6Q3JlYXRvclRvb2w+CiAgICAgICAgIDx4bXA6Q3JlYXRlRGF0ZT4yMDE2LTAzLTAxVDE0OjUwOjQzKzAxOjAwPC94bXA6Q3JlYXRlRGF0ZT4KICAgICAgICAgPHhtcDpNb2RpZnlEYXRlPjIwMTYtMDMtMDFUMTQ6NTE6NTgrMDE6MDA8L3htcDpNb2RpZnlEYXRlPgogICAgICAgICA8eG1wOk1ldGFkYXRhRGF0ZT4yMDE2LTAzLTAxVDE0OjUxOjU4KzAxOjAwPC94bXA6TWV0YWRhdGFEYXRlPgogICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3BuZzwvZGM6Zm9ybWF0PgogICAgICAgICA8cGhvdG9zaG9wOkNvbG9yTW9kZT4zPC9waG90b3Nob3A6Q29sb3JNb2RlPgogICAgICAgICA8eG1wTU06SW5zdGFuY2VJRD54bXAuaWlkOjZhNTdmMWYyLTgyZjYtMjk0MS1hYjFmLTNkOWQ0YjdmMTY2YjwveG1wTU06SW5zdGFuY2VJRD4KICAgICAgICAgPHhtcE1NOkRvY3VtZW50SUQ+eG1wLmRpZDo2YTU3ZjFmMi04MmY2LTI5NDEtYWIxZi0zZDlkNGI3ZjE2NmI8L3htcE1NOkRvY3VtZW50SUQ+CiAgICAgICAgIDx4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+eG1wLmRpZDo2YTU3ZjFmMi04MmY2LTI5NDEtYWIxZi0zZDlkNGI3ZjE2NmI8L3htcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD4KICAgICAgICAgPHhtcE1NOkhpc3Rvcnk+CiAgICAgICAgICAgIDxyZGY6U2VxPgogICAgICAgICAgICAgICA8cmRmOmxpIHJkZjpwYXJzZVR5cGU9IlJlc291cmNlIj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmFjdGlvbj5jcmVhdGVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6NmE1N2YxZjItODJmNi0yOTQxLWFiMWYtM2Q5ZDRiN2YxNjZiPC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDE2LTAzLTAxVDE0OjUwOjQzKzAxOjAwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpPC9zdEV2dDpzb2Z0d2FyZUFnZW50PgogICAgICAgICAgICAgICA8L3JkZjpsaT4KICAgICAgICAgICAgPC9yZGY6U2VxPgogICAgICAgICA8L3htcE1NOkhpc3Rvcnk+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgICAgIDx0aWZmOlhSZXNvbHV0aW9uPjcyMDAwMC8xMDAwMDwvdGlmZjpYUmVzb2x1dGlvbj4KICAgICAgICAgPHRpZmY6WVJlc29sdXRpb24+NzIwMDAwLzEwMDAwPC90aWZmOllSZXNvbHV0aW9uPgogICAgICAgICA8dGlmZjpSZXNvbHV0aW9uVW5pdD4yPC90aWZmOlJlc29sdXRpb25Vbml0PgogICAgICAgICA8ZXhpZjpDb2xvclNwYWNlPjY1NTM1PC9leGlmOkNvbG9yU3BhY2U+CiAgICAgICAgIDxleGlmOlBpeGVsWERpbWVuc2lvbj4yOTk8L2V4aWY6UGl4ZWxYRGltZW5zaW9uPgogICAgICAgICA8ZXhpZjpQaXhlbFlEaW1lbnNpb24+NjA8L2V4aWY6UGl4ZWxZRGltZW5zaW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/Pq+oh5kAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAALU1JREFUeNrsnXmcnFWV97/neZ6q6jXd2XcI+76DoqACKgq4gPsAggvIoDjovOq4oDMqCu7buOAuKg4iyCCCG4uyCI4CYQlJCIGErJ1O70tVPc+95/3j3uqurtTWSTpErZPP80lVddXz3PV3zzn3d86Vh+YtoSABIP7/QGTsNf5z/OfF74VxUbYVG4TM6e1i9dw9Oeb7D2A0gO5eCIPir4VAB3AAsAQ4ApgDzAfaAQP0ARuAx/21GlgH5KglxoKWKV0UQv8gbNoMYehqYP1lDFjrXieJu0eSQBxD03Quu+cqPv7IDaxpnVXz8WkgLG1PEaZK1NdVAev/N4Ap1wa+D7cYg0XH+5kdL1+iyoJUilYRDLuXKLA+jjElYxggVmVuFNEZhiQV2myyMqu/i2+e+CbeeeHXYLDLjbcoKuoEgVCmvuKJnwvqx3U2B81N0NrsxvtUi9XyQAHjz1c//2B8zgHRszxmWoAjgVOBFwInAqk6f7sK+A1wC3Av0E9DGtKQf1h5NsHqROBtwBs9aE1W9gUuAf4VuBn4NvA7r0Q0pCEN+QeTYOofIagEpJM4UBEQmQ9cAdwBvHU7gaoUcM8Efg18Gdij0a0NaUhDsyqVVmAezr8027tIImBPoElFrBXpmDbUG62fPueKKI73ygfpryM8f0pQ0WlazwfeA9zV6N6GNOSfG6yagROA4/z/ewILLEz3JlgIiKhigpDFXWsYaGm76rK3Xf4SNXyFwcGFBFOq0B0N/C9wDnBro4sb0pB/PrBKAa9T1XOAk9RpVaWO/bH7mSBk4ZZ1jASpK8993w9vufWs11zNmuGFxPmJuyBTI9OBa4CzG4DVkIb8Y0i9Ks4rcDtvP7VwhoVW622+4mt8q1wJk5iujtnXveW937nh1jNe823WDC0hl4VUalfVrRP4qTcLG9KQhvyDa1bNwGeA86zjQW0j5SgT2SjNgeufXPG+8z/xlV+d9cZP0TVyIHEOUmF5vtOEG+oAIvcDDwNP+U/TwN6oHggcj0jbJDSsn4CeDKyhmNukCkHAFJukDWlIQ3YBWO2j8B0LJxd/WI42JkUkxCQImdW3Jf/AXod87OYTX30GvfFLGRp2oBBXZRX0IfwAkRsQWQ5sLcHCEJiO6gFY+1KUC4CFNWso7AX6IRJzKarjBNIggP5R6Ol3ZulOIv81pCEN2bVg9RxVvVodo7ymJlUQE4TMHOwhH4a/uOiSq3qfWnDg29iypfDXauX4I4F8hDD8CyJxpdsD3e7SezH2Oqz9KI6nVQ2sAN6O1Ru9KTuuWcUx5PIQBQ2wasjUiiqB2kY77EywEjhU4XvlgKoWWIlamnLD9qcnvO6Gx/Y49HwdGJhLHEP10JJrCIN/h2jzZLoeeAz0AhLzFPABqvvfIuDVWHsHkEPE0fj7B+szTXeuhL48nd5M7QQSoAmY4etRb4HEK7s9QN4D+hZ/5dkNCLJ1VqSD8d1kW1K/EBjymnZBZuPCsLJMjJYpfH8A6K3VaPWUWyrXQXx/tQPlFtiUL0ePqBJHKUbSLZXGWlg0LjqANmBmUf/NwG1oTaY/A//8QV/dLX6xz/nxVq2Tip+vO2kYpHFRJsMT1IiJRputVsdSsJqr8CUcYJXtqDIlj4EhK5JvHx1JNnfM/d53XvaOocSYkxnqr7Xa/JIouhQJurerCUSGgI+TJAL8R41vvwTHCVszBlbW7kqfVRPwXOA04CBVnQ/M8oOiwE/b3t2HvL9HgoufXAU8ATwI/L5kou+6lVCETUnMwjAiI1ININ4FXOgHsymZcM3Abf47BfmQ16g3lgz6woS/AfgYVVT0LmPKxgUCpETYmrj53FG53K3AfwJn4OJWS4EsA/xaRT4wZ7CbWw48kQ+/4WPQt7GwGx4Ac3FulqOAuRid48dDh/+bLbqXbCdIFBat9YzH1v4Z+C3QRxjA6CgEAplMIT7vdcB7/T2SnQRWTX5R3eDrXhp23OPBdC1wJy7ud7AiWCl8SN2kHnuCVl53RoDlwM+shH8SbO8+fZtzZ/zH9WsfPfRFV7H+yQWg1Zr4UZAPYG03xtTSviqMOgPWZrH2Sqw9FOGMaj44rC4G1mCsC+DcdUA1A7hC4UIDUxGtmil6PRM4rOj9Qzhm/4/rUCimRLPKqhJVB6sDcQHslaS7BAiWAAv8VU6WVypLBGwyCXl1yFZRLRGh2xhsENAeBOXKnvHl3rvKbVYH1shApk0fmb8/2XDMN9oJ+k7i+K24sLGpXiTxmuuhuDjcS4F7gI/7xQziZNw94riThz+LCvlW4C/Af+NC6BKAqEjdfami7y50qhT/vy1iLQM+C1wjQmyCkD16NrFq+jy6Oue2MTj4Imf+VQSDmICPI6wiZyCbhc5Ot+LUE/kdhG6k9Y+CWhD6UK7A6otBmipq/8ICVJ2fSmSXmH8C7QrfS+DMZ8MrJi5Q/LtAi8A3y03ggKlB0IKq020NFshUXhyGatymv6TItVb7gUp20ajqmLpST9l7rMUCLUFQungn3gytAtQyNHeoj3v3PIwP/svl0Lse0tEMrLkaa87g2XWTnoBwDcjrCcI7SYybS05GvcWUepbKNhM4DeE04JOI/BdgI+sKOE2Qj+CUwQmdUka7ulHgvQJPmyBkWn6YhV1reHrmQl777qtZvvDgU9j09DyCsNpCfguB3Oye5tFwNOuAasH8ykueAH2j0NfjUrYYO/4M5W8Yez2OuV7pBrM9GBZ8DZuoJ8VMGbDsyA0SxKMYCQirOE4VLk7gTH12HfiRwOXAbQorS5t0VHVKnVsB0GsNsyprz1Ibc3cYtMmr0med+RfVecsQ6LcWAzRX1w63/a1NZGNrJ78/8AQYHQAJMlj7FRJ7xs6p1Q6rvbMQvolyAlZ7HIo/24UqWZaEjwKPY+zPIq89vdjCi4rbT4sgqmia/UKQN4tfUdpzwzw+Z29uO+hkvvT8N7Fy0eGwcfUhhFGHA5KyYgmC69EgS1J05/wgkclz8oO/JVKLlmm09uF+rnvZW8GmoGsdpNPFf84C12NMNbDqw5hWovBHwGKvIa4Alno/z6N1NWJumD8uOoYXb3qM2dkBRsJ0pQkyLxA5dzfZZ5yh8Bbgw6VAstUmqAqpKR6no9bSNMkJXwF36uEHbuPtHrSWRCefNioAhqwbk5lJlL85n+Vviw/hitddBlvWggSnkui57EZ4ABxIkpxJYr9PKirNM7e7ANZl5JM/ROr68awCJJkKo0PhfnFO0Cw4msI+PZu5/pBT+PD7roEnV8CGJyGKFpJUXafXEOp9YwnAxpahiCTTzpVfuYhpSb5sOaYDx6y8jw/+yxeheRrkhiauBMpjWLMRZX6FZz8FHEliXuHfH1H0t6e9/f5b4Eaq7byM9HLzIa/ikK4VfHjp9fS3zao0yA+J4LDdiBRxlFcWTLFtHLJrkuP1W4sJAppEdtQCqpWpo7XU/h9SS6K63WlGAmDYm5CpOrWPJAiIkjxsXgdJHpCTnJ90N6PJqBxDGHzf+YB3ywxLB6McGVllD3FOtwlaVEkG0GGE9wn0CaASsGCwm0fm7sGvjz0LnlwO2SHnS7I6o2pnKA+QJKvGHGKFJ0ybx7m//296O2fRp1pWs3o6jHjN7deS9A5w2blfAo0gN1J8oz5EViJlwSqPtQlB8G9liycswYHxhbj8WN/zoFXeZ5YfYr/+9TSbfFlT0AP8vnFdg0XB5VDsBYakvjCogoXeAXTWqb7P8/6ArkIZR9SQqBJO8XJfuPugNaTCaLu0K3GXAt8BHmGi472AKSng/ybYwMCoWvKqpAPZoTqMqiWQsC64SYDEWkhiiJNmJFiCbAcYTMqFIEULeN2/O9y7RnrYbUWOjBQ9BEdZmDCoSgbTNSh3F77Tkh/m4VlL+PfXfoJlS46G7jUQRsVmfjVZgYhOaMsow1tv/QLvuf0qels7SYLyWn5kElbPWcSZj/4G87OI/3z9p12JTVwoeS+wscLEXY3qxVj7+jpa5hXAS4GfAJ8E1mxr0/TyzSNex4KRHg7sW89gqqnc2N6/roEmcrW4Z/UDo0H93gz1cZovFWs/gOPH1JpvqfGOEkbVYph6sCogiQEGjZm0dlXgRnm6wfW4q87fqQPkHfTHFMowai2pOqAg8b4ugmbAdpLk5tbdzFYB/oRINyLGA0muzPwqLFrTgA5UFdV24EBEFtX5vCavrfZMEkQHUUaRSWdvSYBOlDQidY52OSBSOF5Lal6CycZP2rG/hEmWZTMXs2yPY2DjKqdpmHhc564+MfMTTTcLzTM445HfkU01EQcpqg3j0FrWdy7gVY/8FlHl8pf/P/JhCtSA28FYWeGn04E31wGmBckAbwc5Fpcn6+6Jetowf9vreax96DqO27yCnlQzwcRyZ3DkxVpyWwgXCWSlaFJPzqTnPuNyil1S4+tRAdWdlmAwqmN59UtkD6+JzfL/p/wgU8b5YeIXiE2Mc5wMjitT+HxtaXnzqqS3w3fliGRaP5L7toxVsW5mlPbPQcAiHKdJfNnn+PoO+LILjqu03Ps0R3ybCSBadUYqBoEgA2SnkcvNdxtPNUv+CEHwPpClBAz5xX2kjr51K6a1GZS5oG9DeTeOkFlN0mzPzp/wQUTuRrV5kr+MvTVwJKrvQMsT0EvaZI9IXYdVhAdFHxBk+QSzUAKa4xwM9ri+LKYbqCY10DiY8P1MK5fedDkzR/sYzrRQz3orqvS2dnLi6r+QJ3SDIT9cKPCyCrWZu50L6hGIXANcjMtG6gsRQu8zfO6485ib7eOA3nUMpzLl5lcteSJvNbu9fgz1GlIo3GNcmuiA8ozqdopIl4Uv2Yno/ULgtcAxis7ymlqzX3UL27vKOHenIAUmecEhM+g/G1anlf7Om9bLC5rOqFpS2+G78mX9T+B0xtnQxcqb4PLyf8ahj6JM8FUdBbxT0aP9YtJW5AMrrVuuaMHuBTYL/FLh83m1uVDEVg0/A6xaJclDkk+TJE1IzSExCPwXmfTvJqnsJhQoIIEMgWwln/8PjHkOyAvqcA/MYjxxQH06fTr9F4Lg4R2gAN2OSR7C6PW4SI5q0hxZdEYNM3mZogMyQUNVbLkCioAxXTW4UhO1DYk4fP1jTMsO0dPcSb3DNwlCrIT8+KfvZOWsvfnkKz4CSQ6S5C6S5G+IHLPzzGVZDPLdIn+WH40xT87ej82ZaRxkE4xmKrlqqsnJBj1e0fu2t8sTlFDllgg5qWieFLl5EL+R0gd0C5Dz2oZ34eyj8FGrnOEH7WRBpBS8Zha93l8cS/s9wA+BTyrkjI6j33b4vp7jr0rSTZGqVMQbvMwq7wLm1Vm/TIlTf6HAkeo2Tf7NKj3VOtj4g5KIE4gTS5wkNYnIyuOEwS/J5twJOM1Nk7S1AxjJQT4HiEHpqq7/jYG8TopLoYDJttHc7AhPOrmfjw0wq/eSJH/GRXZUExNZrT4u1anCE8hvRgRrrSNzZnOlKLea8Yyh5eQwb5K52K0kYTjdgglCJuvFCNWwV8869u9aTWgsl7/8QyTWbMCYj6J8B5E5Xj0uuDtM0QIdTdLimofIlxDZBPx1DJyHt/ChEy/m27//FHv1byQbpYtV3aE67nuAwLXi0jAP+t9t8Gp/xq+Yz+CIeoUwhRDY7M2sCEglqhsT9G+UUOOs/0HGE3SdRqXE4+bUYkV/lqDHTaG7KsJlyPiQIDME3qtoLr/9u2K1TKLBUpcz8JkE+152PJV3ALxBHAt9pLoZaEnUQj4P+VhJYq1ClC4sjKsIUoq1447yyRKYVSExDuysfhXltirrTxoX2vK4c6Xo5NaOOIa2NgdYVicHVqOjYK2i+nQ9v4gmnuJV9mGbyj5JLeTjsTO9Jqh2biJVCoU4GLVHoHonCAR5muJcsb9nujfZch5cYj9hR/zruFBQRRhOtyBRhtOX/wHUcuVpl5GNMrcyMvBC4vxJSLCfdxw+g4slK8Rk7Ys7YefISZiI+yLyaUReOWYiqNLbMh2xFqzFjC8wZhJq9R5MJLOWKATE477lMXNryE/KwJ84N2SdWWR9nz2D45DdZ9DHh60ZjERokgmhI6LKfxiXonpXSAB6vsKfE9UfB+riB7cDsrSev6s3OQPkFQLvZuee5nSqHwO20qJnFdSq06ySJCQxYQ0tR4HNY6Ev1rqQsukd3gCfREuN+yH/5K/a3zf+eZPdiOjth6Fhigd/7ZEg0NLsDyiVdD0/iSwalKrZJU3SWcaPRT6IIMp4x/aEEj6K5eEqYDUD9GWo3ulWgJinpi3k2M3LiNSQSDjD+xVcwj2XU31Pdf6CJ3B8qM1e+1gJ9FgJBntbOnnF8t8TBxE/P/481ki4Ot8+dzWj/WCS8h3guF4HA+9EeTWqi+roqJeCvhfkyrHBE+dZNW0+84e2ABY73h5PbudECMtoJuVMr1l13CsRuFnhi3m1dw3bhIigABL7inA6u1ZagAv87qeaKeYcCYSKvkG3NVV3hmSqbgiId5c4M3AOSTKrhmaVTFAOVKGn1wHIrJnufTUXi6o/PDV05M4gcA4AraOVrD/Et16wKt6JGxn15ZqMGSkwPApRFJIO96ynK6M6siosUQcc+cIHeYmYMdrHnl0rWdM8fXwncEwvsF9G9YWIVCLvnY2x12D1EeI+rnjexSTGcvbq2+hLtz1pJHjSP3Nf5zPj+QqnAC8u2ug0XnN4FLhHkT90tc1++uTV946c/eBNfPM5b+Te/U/hgc5FMG0uDG8Fm5Rr0GUol2DtVah+HtVT6+isd5HYW7D6sLtdlg8e/y7+8L/vojnJkQvTBdBfZpUu3A7TsyURcKb3G50XIDdZlNjtaJ2CyoI679MD9Hue05CfWIWsCGnvgppH7Z0ngL0E9ldYMZVRSL4P9gHq9V/mvE8vV6TNF9L3NAOBjqf1qSlGwdgxsGolNk11+I+2rcWWHmfWLZwHUboyYIUhDI24hJLGeNOsDj1UPP0nMUV7xXW1bi+5PBNM1slr2q8mNs+tZwGPVFlfrjZFn+ynbsdkjIPRl27m+PVLufie7/HB138buldBbtDtkLl6/BZrbgZ5QxWz5/2g52EUhnv53KHnEcQxb157O0kQ0ZXuyAu6zIPVtaiGCudalyrkOK99HOyvNwBbRfWWOIi+tWrW4nvPevx3XHL/tVx54vmsWHAYf150FLTOhMEtlXrvEVRPw9jvA+fXaLhFKOeAPop1kdRic9w253BO3vAAGFMgta7AkUs/xLMvHcC31GVhWOsmkx4LmqnDP/RTgV+KyJO+8Xr94iVeU2q3bvv6uep2TY+scc92328rprrSis4RZFEdX70duCaApYj0+3oPFgF+B5C2qgco/AvwppoqrSpGLeTHHOzU9FlVAoaePlK5hHQqRbk4UwUknSLu6ibe2FUailZdrIXWFmhrqd9nJQJJ/CKgnWC7bPkm0FNJzAV+PNSS/kjRZVrdKfAcHBelp4CngSq9mTZacgO8+s9Xcf+sfdm01/Oh7xnIDTvQslyGSY4E2b9C+78Zq/eRJN8gicEGfOaQ8xiJWlgw0sXrNtxLLAHDUTNd6WlEmhjgR6jeYF2uon8VaCsiws/E8ajOjWzy3dEo86UVMxc8/va//g8t2R/xuRe8nXUz9uTugz1Zf7Cr3ApigYuIk2nAWVVXGOH1WP06qmudVhtxxTFv5VXP3MNo1Iz1/Zeofk0dJeCE3QCw5qvqhcBHHU2opmmUFfiEeBpApUHkfYEAS9UFS1+t1Q/qaKI+DtoOAhWgzBSZGH5TBgp+E7qsGLkamiXACoVfWbfjeEktm86gBbCS7QIrVUhHpPKGBcuW0TQ4ignDMlaVEFjL1plt9MzppEbI27Zeh2zOmY6pSaX4/nKltCx11WtSZH59KlJ4sNyjLGO51VvUHcH18Pg2kzIcNrNP10pOXf1XfrPHETy0YSk37Hk8A4uOgp6nIY6fwJjzUa4F2aPCKPk8IoME4Y+dM3GUrx18Pox2syk9g6FMB0f0Luc1G++nPwzZmu5gIGwaFLXvV/iTwjcEFpVkhhBRe6EoJwdq/l9vc8dNW5qFd9/zPfJByPe2rmbN9D2469g3OdNwsNuBq4iz8VVyaPw2jD0A5OBqpgzoiS7NBqAJKWv5wiFv5PzHbiCRgLQITVG0Ma/6JmPtx63q6d5Uol5le3JGT13yXCBE1TCRYlBOVonwtUikEnG0RKcXgCcT9P3G6m+pzKhv2oWm8SJUqyHEgKJfRCQXBcHYeQI16qhW7eWJcpZUOQfAWMUaH26TmNCZWTUntpkwoVMR0XCWeWu6SSVKrqO1rPKjIgSq2HRq+8AjFLdhtvvKisioPuad1QuK1cuS1K+XKNyicJ/x/BxVQz5qYumMFg7qfoKXrV3Kfvs8yLpZ+3LVYWdipy+B7qfuI47fgOoPgIPKzKdmkG/jeI0/xCqMbAIJ+cpB50OQYV7vcp5omc/Glnm8Zt3tnLB1JStbZzEaRr8S1S1WuVZgDx2br2N12Be4DrgoUP3hpvbZBGp5z90/ZFPrNA7bsor75x3M3w49A3rWuNUv78N2jO3D2stQvb4qI99yMsK1boBZFMtQEjOYxCQEpIKAWJVEdV0o8vaUyHOt6tF+06DdoNOAWZ6Ok4hz2C7wjttR6mfBTwasFvp7bqJMdoISeUKVESPO5msKIxzBRMs+eVSN4zapbrTKGuCQ3WCQ17KH+gUeyqtiVEkFbpExZSZ8IMKITRw3xDJqHFVkYWUz0GKsdTvmcbyVOBlCgrYanThe3iggGskyb3MfKWOJ09U3EwUwgThflZnw8Uy/QCQVfJohIt0YM+zoxLtRWoixOS0PRQrrVPV3wFt0W+dkQaYLfAF4ucBgcZhkZA1D6VYezkzjuese4PQn/8zcnqfoap/HN444B9Kd9zOw6dUol6F6XhlHXBNwFcqewJdB+gNriEa3EFjDpsx0vrbvORCmWdE0h70Xbuata25men6Qvqj5PtC3qAs4nlYmrVQauAq3e3irlYCnO+eQMjHvuO8aXtHSzmcF7jz4FFi/jjEintPPfkli7sHRGyrZGftgbSeqW5GQllw/lzx0DUPp1rHMmIM+PW4kQhIE96vq/UVmSgDMSQcSWDCBc1TPAtICWXVgtciDViEZ2gIm7g5ahU7UHo3wsjpGWrpI46mliK9FPbkRJVZLZypDWsIxwPLgxEASE6uOBxvXjqbZVVlLayXq0wCJUYjVkrOWaakUTUGILUmTNBDnyXnntvdDV62DEYtRK+QTJZ90ESdbaoBVhOPzQSikRmLmbh0ilVjiVEhYIzGlCYRpI3nyqYhcJkKMReEIgc+pW6BMeRuQAOUTwC9cEr7dS6US1Ts0Ch+JVDVRuMHnOioy9Lax/5+PyzT5DsqQ8iJr6G+aRm9zwAvW/oXIxCzofYZ1bfP51pFvfoKRgQsweh1qLhR4lW47gf4Ll8/6CuBXQKIS0GxyRLHLCPrItL15ZOYRrGydz+ce+QbNJsdokL7DKh9zQLdtyf2u4pdwjuWNokoSRDzROZd9+zZz6LI/cef8k2BwyFNHbTEMXI/q86lMHt0X1XmgWwu7v93N02ky+YJiPT8U6QASC+Ssxe/PFLhieYGNeYV04AwMq/qM+lXcr+5/qXPXa7q1ernCO+sAiXq9BbZ01m/MjjjukBQ/X0gFIUVZ0GQSIXzP+lxI0FSx37grN4qxus26mgrCidXW6rwtYxVjrZJYgsQGUWykDjNwXiYxNMWGKDGkjCWJgjqidMCKkIoNc3qH6WlvIpsKCa0epPCSOjrjcOAXuxVQCYglZwL5lGL6C9SFu1T1ToWTKjvaFeAcx9zl/bjE89uqymrpbXLnoT5/w4MID4JN+NZRF8SMDt1MfuRuQY4OrX2lwLEKx447euU4kJ8g+hDCDSh3A/c7mzygLRlB4mEeb9+HDxx6MR99/AdMS4bJE37XomegvLQc0AocoOh7repHKMTNqeXp9g5OWv9/LL//x/xhz1MI4/7SHy4XW5n0502AxcBjVlyO6IL/TJ1v6ipvCtkKyrVR+Fps7FdHkwRFaQ4jAhH68jnaUmkyQVA+tKnYNDEJidXelIQ3KnouLgK/mt9Z67QdW4ufk00ShpPY7UYVzWQBWqIUmSAqwFUo8HdzeqxFpVDHxCQMxTFGFSmpY1NoaQ5Txb6lfFWwUr/25QwSm6A5MYGtBVbC4enEzGjLxj1WIJlkMjwTBgRWmTGYJZeOyEXhbBOQiNYkxM7z43y3OS9MlH4C/n00jG7DKJFxtlOfwqcoA1aUOPvVaT+HAz8CvoU7NaP89klTB5E1vOyZezm2exn3zDyUHxx6Xp9m+24XuCtSOlH2R+3egWVvXFD1vghHgOyr6FsE1qg7nfkeYKmKrG+Lh3R52x4MBilajMEEMqzwac8lKssdU3iHOhrB2HZ5NkixZKibJYPrwEY0bXsI62ZVtlKZ4R54Ew0jkEoMRi1WrYu2d2BWi/B2mLGWBAsKI+qOLjOqDCcxo/VMNp8UjoA26k8vDj6vVTXntCAYtcRqsdZ6wvG2j8hZQ6KWACGUYGEozNf6yjDVUmu2pwOYY1S7RtWOgVS5BHuxKtbELt5JwrZAKiZ5HPNZWbUQG5piI81xIrb2buABolxpguBSRUe3C3wDIbCQSswMRc8SrSuLc8RkDcCp08KWC9xgkV/kMuGDhdWieGL/QZWvAJeWpzJM+HQxLj3u2QK/VvgDjlnex/ixUh1AKglCq8jmBUOb15/d5zJuXH3wOcT5kTgw8ZZAzRbgHnGDNwPajNIOmhLnK5utjoT4DG6bXBVoNVlEbbGasNS6NC4nVWjEDtzJPSvGtUAlG0IiacjnSW8LVj2489bm1tq9MaKkY4N6R611nw/U0TEnK5waIH9D6FdQfO4lVa3rHCRxSkGrUX2N1M5pFRb5vIZrfPdoxZ5krL3T1lDFCr4rl5xRTzbK9Cr3jZl4CMRUSi1AnmHgDKP20YIGW18d7clW5bjqmpWiqiJqNTRmuClv+o3o4jqs+gvURXH8Bpd6O/Jza32FbjBM9G9aG7BvYPXMprw5us52embS8CPchrKW7Y8OKNRjk59n62woKxMJnhLYikwc/qVHcX1W0aOAF9ZR6gDYG+Xd6vxYee/IHvW7THMLq6egK4ZSLZ8Mg/Qvz151M4mE/GavlxObPNkgg7isMsb7wkao45y7XJh2avZ4BoheHLHvpEqgr/BCq3pVsdM1DwTGEsaWTLKNBjwNqk66In8BpBMXuBqoxUes1hOLtg/wS3Ha4//5+qeoz04rBGfPRjnRYPerQ7MaLQKpWoHW8wSuQuSDonqHuubSIp9bYRxEOJZOM+jZRu3FNe6b9YNzilUqQYTuRDUnlUNjUri4wTXiOGIjTPQrFtcxEOcDPcuqfkzRqPrzXTjZ/N4tpG1+QFQ3R2IOrdNbcyxu1zgpMnBM5R8okdGwqP8j0MnYkD2ieIO4LhMNE8lnbBjcuRP8k7boqqi0RclEf8gGhQ+gXCfo4jpCcQqfZzyitxd/WFSDo0T5ZiJhb09Tx52vXHsH71hxAx8++lLuWvQiWkY2MZntUhVh8fAmQpNgVIqDvZf6YkqFZBJHej9M/0Q/m9OKUnFpamKdpyK1qANhAaxSxpJYS+AOFxim/sNFW4Dj/TXVshHo8q29SpmYYLqM7I/Iz0AfwOWmGvUrYSERXxMwX9E2hUMt7FdH9H1WfJD3VPtzBfrV9Xc1XtdC4McIS72FMODrWPBJNfs6NgN7JXBMPRkGAmtILKiJSCUjgyjrAtXJ1DmgvvClHXNiA4qsHecraT0/I50jn2uK4lqUip0l5VaG+60LJfgfb+7VhVjluqBET5kLvBPkThUhG0YcMLCau8zzyIbNtNrRugBaVBlp6uTSB77AnOxWhqMJIQKbFM1SmT80U50P6eFijShIDJlsTLqEFKciC2xQ1bdiCif9WAkIkwTr/RSK9AOP4VIk707yGJAXEVCWKzpYwyEPSgZ4nr92hv9ik0jwV2fxTvkoX+2vOTXngnIM1eIIJ1nURCGdDLPXwBNsTc3JB9i/iNYM5dq14ur0jI1kmQ0CQmNrEmOLwbRlMMdoW5pcU4rATm1fBhUqcK8qr7Kq91hnd49fqKc/ll4TdsLUus0QSq59FJoV2Nw0nTev+hUXPv4jbNjEaNhUVz6rOExxcPcjpEyOXBBiscXlMBbiMZ3Sm4hFl6hqW6EuBiFtoT0/RDpvycTJhCs05iVRYsIocdvIpVcqNmsDY58OjKVwlcSB/p6dc/z2zpRbnE2hKHofldNAT2kZVG2yi85S7MadWDS1070cWAVpZue7eOWGaxkNW8Blmn2G3U9uDYyuiPJmMkDlKh8IzcN50tkYDWTXg5V7pD6k8EoLVxvImyIHiS25tGBQu2u9Ue636gLOrbXF10xr7f7WWsQkrG2ZxTmrbuWCZT8iiZrIBZmqgBWoJdu2gLc88XMWDq1lWCIStWOXURtYa1OF5+m2ZfVZp9z7tMnyZNM8lrUcSJMZHTsdzF/7RIk9NRUbKl1RYldGxm4MjFK4SuROxvhfu4V8A7cZQpHP6pNsz0GvO6bpfL26El5LSa/LB1Is3wbu28n1ML4tu6tMZasCA6kORsJ2QmvXAB9kN6IHIKxH/BiVSeuQWnDLtHjAslMIWLUccL0o56vqm63qbcVaVgkIoV7Hsdj3WOxDFpt27yeARbuF2WOeNGtY0zqTNz71Gy5Y/mPyqeaKJ9sAZFMtPGft7bTFwwyHrQToeN5e95U5xSagqo6bZa7cgVV3CnWiMCM/zMrmfbiz8yQ68v2I1eLrg2J0jhioeFkeCmM7kMobUnkHYCXdbICPA1/dDYblT/xEKZWbcBskG3dBGVYAF5XRLmrtYHaUrKW1DjcojeLfgMuksTMB62PAR6gestQWS4rZuS6O7b2bbNgMcA1wNu4osWdbbgdew7acyWbqO0AiU+xHbhnOk8klUwZY9WZO/DkuNvDVqno28GIt3V1xntrfAb8A3l5BU+4AFk+Y0GpY3zyds1bfSqLCDw853wUWl1NHW+dw+oNfZkn/Bja2TifY9juHleYaG88RZgHiQGSDFaEz6WNDpoO/TjuW+bmNGJngmjoVeEsNF1oM+sex6SMQiGVa0s9oOGH8DgGX+oFxmneiHzTljlMnA7gUzD/H5T+vpEFdjTu95R04Ht28KdCm/tdrOMvL/D2c5DhNbce4XgmcCbzXT9D9trMua3F8vU/7vqwaPhNLmvnZbp7T+yfumfES9hxdhZXwWtzO75uAFwCH4pz8u4L1v8E/+zYcV3JgO5SYiUbY2BwTmodyLjSjKUVgdq4CKdd3zt4GVtRCQStSR/wZ9zuptuFY58co+jxgCS4/1WyQV6pyM8JjuHxFvkYTQOXbqlw0scaCoLTHQ9wy93jiMDVmOxfHKCZhmkO2Psb87FbibY9sbxPhRlFerCX3dnaBArJCRY5sSYazubCZby9+F081LWFOvqsYrPbH8Vv2qtF293hQGyl0VIByRP/9vHDLb6lC/luCc/LP8Ndi3A6l4ngy7ZPwc4mf6H24PNqFMxjWA6twu2DLmdx5cEf7chzkJ9BCxpMvBl57LU181OfNoSb/+Ub/zDW4Xb91OL5QJTkOl4poqMREKgT2PgncUfT5ybhc/r1lJlnon1VNizoQl4X2cN8fc3y5W/3rwr7YFsbpNKtwIVurGd+gWQC8mJLklEXa3wrg7kgTskErt805naUdz6HFDJdqgXu7+cMMXGzoXoynsV6AixqZjO8zxOXiKvCyuvzrbl+n5ZScq1AiBzN+IEc5ukTKP+MmHF1pvOIOMBhty5DPRJP2gdlQSPzcsSLkMiGjqcjN3u0Aq6LvaiswQx3PZzZwh6KdKPfgsh6Uk6cVTlX0iUKvJtY9QVDassMVl5cA6IsiSDcTbtsGpwC3VtJY1Pm8bggxb8oFmfgHiy7imaY9mZ70YscXkhMYD5GpJW8Hvj9B1ZIMGR3lklWXY7cryRoZP+HNJMAqwNEJ8lO0Erf5gVlIs9ru27i4B0Y90BQ0nkF2u3DYqm1YWCwyvr6FNXLIt2t+R9pXEWbmh1naeQg/2PNSZuS7J/PztDfLJpP9KfBadO5ZaVCjJOmQoY6mSe8QVgOrHU2gP+yvZ8Dtvila64SlJcBZqvrZwgeJFvYToS/TUkdjmLE85+Lo222CjB3mWI5GIUDaZm8bjtrinyy8gE2ZhXQmfQWgynjz4NI6TaA7gJ9u+wxLazK4I+35rA2wKjJU4z0loPX3JlpUp2Gm4Ah1QYkDGAnbCHTSptEOAeWzBf9TsTMY7cTyFXp+s1c1t8kQWqSVXYTbvn7Ujq09MqnRVRyLq3Cmoq+a+KwSvdXmzU1zX3vXyraDGQqn0WYGWy1BQY2/EDiC+uLVutj1O2gNacg/veyUyHgXM+XoA6pqVXWZqqX0GjMzYW+FzyjM2Qm2wgtU+awqwUQ+2Dj7yqJE1vyiOz27c3Nm/qczNvtdS3Az7qy+L3s/Tb2BtV8t8Z+MI78m9KZmceOCc8nYbGN0NaQhu5tmpWNG3Nj7Pymc55nPJd8ce306jvfzTmoHm1aSF6nq9xWtGP1uEKbHw/pwx5E/39i0+Nz2ZOCCHQDpq4Arq7WEkZDBaBryd+OyaUhD/gk0K5cszpI1CUbtGLtd4deq+rSy7T8mvOK1uC31Ayf56DTwOpyDe+/K0CE0WYMJghsf7jg2P5jqPCOl8fbW+X9webxMLf9EqKYxshrSkN0JrBTGclWXhNX0KnxRKRvyMjF8R/U0XBjC+3A7iNVOImnBHXjwWRy5ripQqcCcONv/VOt+X1o27fA3tiRDC2XyIR7WA+rFlBxL3pCGNOTvwAwUgdhYskniTz7ZBgS+j+MhvbaO2+0NfA53tNHdwJ9xAbcDHizacA7w43GBwZ21EUbojIfYkGl//52zTt0rUnNWpPFks1l0+XJ9vjFUGtKQv1OwKjYFK0gCvAdHMDuoztvt6a9zPEgNebNrGnU6wBXBiDA9zjIctn/9R3te+NdVrYffNDu3sTXA1gtWimP4fgoX39eQhjTk79kMrEPWAW/F5QbanrIVkt/VDVQKdMZDzDfJL/4644SvLWs/6oud8dZFIUk9QKW4kKGzgZc3gKohDfkH0qzqkPv95P8pVM9ZvSPimFqWlMkzkur4441zjvvdvTNedN3M3JbD0jaLrYx3hfCDPwP3eo1qqDE0GtKQfz6wAsdLeg2OqnDUVD0kY/OkrfnBDbNP+8Btc886bUZu8zOtycBtiBQnMhRvWvYyHrO2ml2QZrchDWnI7g9W4AJLz8Sl1XjHFNy/N0A/CXxjS3pOLq9cNy3u/ZkJouTv5wi7hjSkIZVkV5/tthaXnP+1wJ920j0HcDuPL1d3mGkuY3OkNMlaCZJGFzekIQ3NanslD9zgweoFwBuB09k2YVotWYpLV3szLmfTaKM7G9KQBlhNhXQDv8Ttvu2HO3nmRBzNYT7juZEKNtxmnG/pIVzysKX+HnGjGxvSkH98+f8DACeR8Z8W+T8oAAAAAElFTkSuQmCC" />'', nchar(13), nchar(10), N''  <h2>Bandwidth Report</h2>'', nchar(13), nchar(10), N''  <table border="1">'', nchar(13), nchar(10), N''    <tr bgcolor="#66ccff">'', nchar(13), nchar(10), N''		<th>PackageID</th>'', nchar(13), nchar(10), N''        <th>QuotaValue</th>'', nchar(13), nchar(10), N''        <th>Diskspace</th>'', nchar(13), nchar(10), N''        <th>UsagePercentage</th>'', nchar(13), nchar(10), N''        <th>PackageName</th>'', nchar(13), nchar(10), N''        <th>PackagesNumber</th>'', nchar(13), nchar(10), N''        <th>StatusID</th>'', nchar(13), nchar(10), N''        <th>UserID</th>'', nchar(13), nchar(10), N''      <th>Username</th>'', nchar(13), nchar(10), N''        <th>FirstName</th>'', nchar(13), nchar(10), N''        <th>LastName</th>'', nchar(13), nchar(10), N''        <th>FullName</th>'', nchar(13), nchar(10), N''        <th>RoleID</th>'', nchar(13), nchar(10), N''        <th>Email</th>'', nchar(13), nchar(10), N''        <th>UserComments</th> '', nchar(13), nchar(10), N''    </tr>'', nchar(13), nchar(10), N''    <xsl:for-each select="//Table1">'', nchar(13), nchar(10), N''    <tr>'', nchar(13), nchar(10), N''	<td><xsl:value-of select="PackageID"/></td>'', nchar(13), nchar(10), N''        <td><xsl:value-of select="QuotaValue"/></td>'', nchar(13), nchar(10), N''        <td><xsl:value-of select="Diskspace"/></td>'', nchar(13), nchar(10), N''        <td><xsl:value-of select="UsagePercentage"/>%</td>'', nchar(13), nchar(10), N''        <td><xsl:value-of select="PackageName"/></td>'', nchar(13), nchar(10), N''        <td><xsl:value-of select="PackagesNumber"/></td>'', nchar(13), nchar(10), N''        <td><xsl:value-of select="StatusID"/></td>'', nchar(13), nchar(10), N''        <td><xsl:value-of select="UserID"/></td>'', nchar(13), nchar(10), N''      <td><xsl:value-of select="Username"/></td>'', nchar(13), nchar(10), N''        <td><xsl:value-of select="FirstName"/></td>'', nchar(13), nchar(10), N''        <td><xsl:value-of select="LastName"/></td>'', nchar(13), nchar(10), N''        <td><xsl:value-of select="FullName"/></td>'', nchar(13), nchar(10), N''        <td><xsl:value-of select="RoleID"/></td>'', nchar(13), nchar(10), N''        <td><xsl:value-of select="Email"/></td>'', nchar(13), nchar(10), N''        <td><xsl:value-of select="UserComments"/></td>'', nchar(13), nchar(10), N''    </tr>'', nchar(13), nchar(10), N''    </xsl:for-each>'', nchar(13), nchar(10), N''  </table>'', nchar(13), nchar(10), N''  </body>'', nchar(13), nchar(10), N''  </html>'', nchar(13), nchar(10), N''</xsl:template>'', nchar(13), nchar(10), N''</xsl:stylesheet>'')),
    (N''TransformContentType'', N''BandwidthXLST'', 1, N''test/html''),
    (N''TransformSuffix'', N''BandwidthXLST'', 1, N''.htm''),
    (N''Transform'', N''DiskspaceXLST'', 1, CONCAT(CAST(N''<?xml version="1.0" encoding="UTF-8"?>'' AS nvarchar(max)), nchar(13), nchar(10), N''<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">'', nchar(13), nchar(10), N''<xsl:template match="/">'', nchar(13), nchar(10), N''  <html>'', nchar(13), nchar(10), N''  <body>'', nchar(13), nchar(10), N''  <img alt="Embedded Image" width="299" height="60" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASsAAAA8CAYAAAA+AJwjAAAACXBIWXMAAAsTAAALEwEAmpwYAAA4G2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS41LWMwMTQgNzkuMTUxNDgxLCAyMDEzLzAzLzEzLTEyOjA5OjE1ICAgICAgICAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgICAgICAgICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgICAgICAgICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPHhtcDpDcmVhdG9yVG9vbD5BZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpPC94bXA6Q3JlYXRvclRvb2w+CiAgICAgICAgIDx4bXA6Q3JlYXRlRGF0ZT4yMDE2LTAzLTAxVDE0OjUwOjQzKzAxOjAwPC94bXA6Q3JlYXRlRGF0ZT4KICAgICAgICAgPHhtcDpNb2RpZnlEYXRlPjIwMTYtMDMtMDFUMTQ6NTE6NTgrMDE6MDA8L3htcDpNb2RpZnlEYXRlPgogICAgICAgICA8eG1wOk1ldGFkYXRhRGF0ZT4yMDE2LTAzLTAxVDE0OjUxOjU4KzAxOjAwPC94bXA6TWV0YWRhdGFEYXRlPgogICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3BuZzwvZGM6Zm9ybWF0PgogICAgICAgICA8cGhvdG9zaG9wOkNvbG9yTW9kZT4zPC9waG90b3Nob3A6Q29sb3JNb2RlPgogICAgICAgICA8eG1wTU06SW5zdGFuY2VJRD54bXAuaWlkOjZhNTdmMWYyLTgyZjYtMjk0MS1hYjFmLTNkOWQ0YjdmMTY2YjwveG1wTU06SW5zdGFuY2VJRD4KICAgICAgICAgPHhtcE1NOkRvY3VtZW50SUQ+eG1wLmRpZDo2YTU3ZjFmMi04MmY2LTI5NDEtYWIxZi0zZDlkNGI3ZjE2NmI8L3htcE1NOkRvY3VtZW50SUQ+CiAgICAgICAgIDx4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+eG1wLmRpZDo2YTU3ZjFmMi04MmY2LTI5NDEtYWIxZi0zZDlkNGI3ZjE2NmI8L3htcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD4KICAgICAgICAgPHhtcE1NOkhpc3Rvcnk+CiAgICAgICAgICAgIDxyZGY6U2VxPgogICAgICAgICAgICAgICA8cmRmOmxpIHJkZjpwYXJzZVR5cGU9IlJlc291cmNlIj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmFjdGlvbj5jcmVhdGVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6NmE1N2YxZjItODJmNi0yOTQxLWFiMWYtM2Q5ZDRiN2YxNjZiPC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDE2LTAzLTAxVDE0OjUwOjQzKzAxOjAwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpPC9zdEV2dDpzb2Z0d2FyZUFnZW50PgogICAgICAgICAgICAgICA8L3JkZjpsaT4KICAgICAgICAgICAgPC9yZGY6U2VxPgogICAgICAgICA8L3htcE1NOkhpc3Rvcnk+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgICAgIDx0aWZmOlhSZXNvbHV0aW9uPjcyMDAwMC8xMDAwMDwvdGlmZjpYUmVzb2x1dGlvbj4KICAgICAgICAgPHRpZmY6WVJlc29sdXRpb24+NzIwMDAwLzEwMDAwPC90aWZmOllSZXNvbHV0aW9uPgogICAgICAgICA8dGlmZjpSZXNvbHV0aW9uVW5pdD4yPC90aWZmOlJlc29sdXRpb25Vbml0PgogICAgICAgICA8ZXhpZjpDb2xvclNwYWNlPjY1NTM1PC9leGlmOkNvbG9yU3BhY2U+CiAgICAgICAgIDxleGlmOlBpeGVsWERpbWVuc2lvbj4yOTk8L2V4aWY6UGl4ZWxYRGltZW5zaW9uPgogICAgICAgICA8ZXhpZjpQaXhlbFlEaW1lbnNpb24+NjA8L2V4aWY6UGl4ZWxZRGltZW5zaW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/Pq+oh5kAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAALU1JREFUeNrsnXmcnFWV97/neZ6q6jXd2XcI+76DoqACKgq4gPsAggvIoDjovOq4oDMqCu7buOAuKg4iyCCCG4uyCI4CYQlJCIGErJ1O70tVPc+95/3j3uqurtTWSTpErZPP80lVddXz3PV3zzn3d86Vh+YtoSABIP7/QGTsNf5z/OfF74VxUbYVG4TM6e1i9dw9Oeb7D2A0gO5eCIPir4VAB3AAsAQ4ApgDzAfaAQP0ARuAx/21GlgH5KglxoKWKV0UQv8gbNoMYehqYP1lDFjrXieJu0eSQBxD03Quu+cqPv7IDaxpnVXz8WkgLG1PEaZK1NdVAev/N4Ap1wa+D7cYg0XH+5kdL1+iyoJUilYRDLuXKLA+jjElYxggVmVuFNEZhiQV2myyMqu/i2+e+CbeeeHXYLDLjbcoKuoEgVCmvuKJnwvqx3U2B81N0NrsxvtUi9XyQAHjz1c//2B8zgHRszxmWoAjgVOBFwInAqk6f7sK+A1wC3Av0E9DGtKQf1h5NsHqROBtwBs9aE1W9gUuAf4VuBn4NvA7r0Q0pCEN+QeTYOofIagEpJM4UBEQmQ9cAdwBvHU7gaoUcM8Efg18Gdij0a0NaUhDsyqVVmAezr8027tIImBPoElFrBXpmDbUG62fPueKKI73ygfpryM8f0pQ0WlazwfeA9zV6N6GNOSfG6yagROA4/z/ewILLEz3JlgIiKhigpDFXWsYaGm76rK3Xf4SNXyFwcGFBFOq0B0N/C9wDnBro4sb0pB/PrBKAa9T1XOAk9RpVaWO/bH7mSBk4ZZ1jASpK8993w9vufWs11zNmuGFxPmJuyBTI9OBa4CzG4DVkIb8Y0i9Ks4rcDtvP7VwhoVW622+4mt8q1wJk5iujtnXveW937nh1jNe823WDC0hl4VUalfVrRP4qTcLG9KQhvyDa1bNwGeA86zjQW0j5SgT2SjNgeufXPG+8z/xlV+d9cZP0TVyIHEOUmF5vtOEG+oAIvcDDwNP+U/TwN6oHggcj0jbJDSsn4CeDKyhmNukCkHAFJukDWlIQ3YBWO2j8B0LJxd/WI42JkUkxCQImdW3Jf/AXod87OYTX30GvfFLGRp2oBBXZRX0IfwAkRsQWQ5sLcHCEJiO6gFY+1KUC4CFNWso7AX6IRJzKarjBNIggP5R6Ol3ZulOIv81pCEN2bVg9RxVvVodo7ymJlUQE4TMHOwhH4a/uOiSq3qfWnDg29iypfDXauX4I4F8hDD8CyJxpdsD3e7SezH2Oqz9KI6nVQ2sAN6O1Ru9KTuuWcUx5PIQBQ2wasjUiiqB2kY77EywEjhU4XvlgKoWWIlamnLD9qcnvO6Gx/Y49HwdGJhLHEP10JJrCIN/h2jzZLoeeAz0AhLzFPABqvvfIuDVWHsHkEPE0fj7B+szTXeuhL48nd5M7QQSoAmY4etRb4HEK7s9QN4D+hZ/5dkNCLJ1VqSD8d1kW1K/EBjymnZBZuPCsLJMjJYpfH8A6K3VaPWUWyrXQXx/tQPlFtiUL0ePqBJHKUbSLZXGWlg0LjqANmBmUf/NwG1oTaY/A//8QV/dLX6xz/nxVq2Tip+vO2kYpHFRJsMT1IiJRputVsdSsJqr8CUcYJXtqDIlj4EhK5JvHx1JNnfM/d53XvaOocSYkxnqr7Xa/JIouhQJurerCUSGgI+TJAL8R41vvwTHCVszBlbW7kqfVRPwXOA04CBVnQ/M8oOiwE/b3t2HvL9HgoufXAU8ATwI/L5kou+6lVCETUnMwjAiI1ININ4FXOgHsymZcM3Abf47BfmQ16g3lgz6woS/AfgYVVT0LmPKxgUCpETYmrj53FG53K3AfwJn4OJWS4EsA/xaRT4wZ7CbWw48kQ+/4WPQt7GwGx4Ac3FulqOAuRid48dDh/+bLbqXbCdIFBat9YzH1v4Z+C3QRxjA6CgEAplMIT7vdcB7/T2SnQRWTX5R3eDrXhp23OPBdC1wJy7ud7AiWCl8SN2kHnuCVl53RoDlwM+shH8SbO8+fZtzZ/zH9WsfPfRFV7H+yQWg1Zr4UZAPYG03xtTSviqMOgPWZrH2Sqw9FOGMaj44rC4G1mCsC+DcdUA1A7hC4UIDUxGtmil6PRM4rOj9Qzhm/4/rUCimRLPKqhJVB6sDcQHslaS7BAiWAAv8VU6WVypLBGwyCXl1yFZRLRGh2xhsENAeBOXKnvHl3rvKbVYH1shApk0fmb8/2XDMN9oJ+k7i+K24sLGpXiTxmuuhuDjcS4F7gI/7xQziZNw94riThz+LCvlW4C/Af+NC6BKAqEjdfami7y50qhT/vy1iLQM+C1wjQmyCkD16NrFq+jy6Oue2MTj4Imf+VQSDmICPI6wiZyCbhc5Ot+LUE/kdhG6k9Y+CWhD6UK7A6otBmipq/8ICVJ2fSmSXmH8C7QrfS+DMZ8MrJi5Q/LtAi8A3y03ggKlB0IKq020NFshUXhyGatymv6TItVb7gUp20ajqmLpST9l7rMUCLUFQungn3gytAtQyNHeoj3v3PIwP/svl0Lse0tEMrLkaa87g2XWTnoBwDcjrCcI7SYybS05GvcWUepbKNhM4DeE04JOI/BdgI+sKOE2Qj+CUwQmdUka7ulHgvQJPmyBkWn6YhV1reHrmQl777qtZvvDgU9j09DyCsNpCfguB3Oye5tFwNOuAasH8ykueAH2j0NfjUrYYO/4M5W8Yez2OuV7pBrM9GBZ8DZuoJ8VMGbDsyA0SxKMYCQirOE4VLk7gTH12HfiRwOXAbQorS5t0VHVKnVsB0GsNsyprz1Ibc3cYtMmr0med+RfVecsQ6LcWAzRX1w63/a1NZGNrJ78/8AQYHQAJMlj7FRJ7xs6p1Q6rvbMQvolyAlZ7HIo/24UqWZaEjwKPY+zPIq89vdjCi4rbT4sgqmia/UKQN4tfUdpzwzw+Z29uO+hkvvT8N7Fy0eGwcfUhhFGHA5KyYgmC69EgS1J05/wgkclz8oO/JVKLlmm09uF+rnvZW8GmoGsdpNPFf84C12NMNbDqw5hWovBHwGKvIa4Alno/z6N1NWJumD8uOoYXb3qM2dkBRsJ0pQkyLxA5dzfZZ5yh8Bbgw6VAstUmqAqpKR6no9bSNMkJXwF36uEHbuPtHrSWRCefNioAhqwbk5lJlL85n+Vviw/hitddBlvWggSnkui57EZ4ABxIkpxJYr9PKirNM7e7ANZl5JM/ROr68awCJJkKo0PhfnFO0Cw4msI+PZu5/pBT+PD7roEnV8CGJyGKFpJUXafXEOp9YwnAxpahiCTTzpVfuYhpSb5sOaYDx6y8jw/+yxeheRrkhiauBMpjWLMRZX6FZz8FHEliXuHfH1H0t6e9/f5b4Eaq7byM9HLzIa/ikK4VfHjp9fS3zao0yA+J4LDdiBRxlFcWTLFtHLJrkuP1W4sJAppEdtQCqpWpo7XU/h9SS6K63WlGAmDYm5CpOrWPJAiIkjxsXgdJHpCTnJ90N6PJqBxDGHzf+YB3ywxLB6McGVllD3FOtwlaVEkG0GGE9wn0CaASsGCwm0fm7sGvjz0LnlwO2SHnS7I6o2pnKA+QJKvGHGKFJ0ybx7m//296O2fRp1pWs3o6jHjN7deS9A5w2blfAo0gN1J8oz5EViJlwSqPtQlB8G9liycswYHxhbj8WN/zoFXeZ5YfYr/+9TSbfFlT0AP8vnFdg0XB5VDsBYakvjCogoXeAXTWqb7P8/6ArkIZR9SQqBJO8XJfuPugNaTCaLu0K3GXAt8BHmGi472AKSng/ybYwMCoWvKqpAPZoTqMqiWQsC64SYDEWkhiiJNmJFiCbAcYTMqFIEULeN2/O9y7RnrYbUWOjBQ9BEdZmDCoSgbTNSh3F77Tkh/m4VlL+PfXfoJlS46G7jUQRsVmfjVZgYhOaMsow1tv/QLvuf0qels7SYLyWn5kElbPWcSZj/4G87OI/3z9p12JTVwoeS+wscLEXY3qxVj7+jpa5hXAS4GfAJ8E1mxr0/TyzSNex4KRHg7sW89gqqnc2N6/roEmcrW4Z/UDo0H93gz1cZovFWs/gOPH1JpvqfGOEkbVYph6sCogiQEGjZm0dlXgRnm6wfW4q87fqQPkHfTHFMowai2pOqAg8b4ugmbAdpLk5tbdzFYB/oRINyLGA0muzPwqLFrTgA5UFdV24EBEFtX5vCavrfZMEkQHUUaRSWdvSYBOlDQidY52OSBSOF5Lal6CycZP2rG/hEmWZTMXs2yPY2DjKqdpmHhc564+MfMTTTcLzTM445HfkU01EQcpqg3j0FrWdy7gVY/8FlHl8pf/P/JhCtSA28FYWeGn04E31wGmBckAbwc5Fpcn6+6Jetowf9vreax96DqO27yCnlQzwcRyZ3DkxVpyWwgXCWSlaFJPzqTnPuNyil1S4+tRAdWdlmAwqmN59UtkD6+JzfL/p/wgU8b5YeIXiE2Mc5wMjitT+HxtaXnzqqS3w3fliGRaP5L7toxVsW5mlPbPQcAiHKdJfNnn+PoO+LILjqu03Ps0R3ybCSBadUYqBoEgA2SnkcvNdxtPNUv+CEHwPpClBAz5xX2kjr51K6a1GZS5oG9DeTeOkFlN0mzPzp/wQUTuRrV5kr+MvTVwJKrvQMsT0EvaZI9IXYdVhAdFHxBk+QSzUAKa4xwM9ri+LKYbqCY10DiY8P1MK5fedDkzR/sYzrRQz3orqvS2dnLi6r+QJ3SDIT9cKPCyCrWZu50L6hGIXANcjMtG6gsRQu8zfO6485ib7eOA3nUMpzLl5lcteSJvNbu9fgz1GlIo3GNcmuiA8ozqdopIl4Uv2Yno/ULgtcAxis7ymlqzX3UL27vKOHenIAUmecEhM+g/G1anlf7Om9bLC5rOqFpS2+G78mX9T+B0xtnQxcqb4PLyf8ahj6JM8FUdBbxT0aP9YtJW5AMrrVuuaMHuBTYL/FLh83m1uVDEVg0/A6xaJclDkk+TJE1IzSExCPwXmfTvJqnsJhQoIIEMgWwln/8PjHkOyAvqcA/MYjxxQH06fTr9F4Lg4R2gAN2OSR7C6PW4SI5q0hxZdEYNM3mZogMyQUNVbLkCioAxXTW4UhO1DYk4fP1jTMsO0dPcSb3DNwlCrIT8+KfvZOWsvfnkKz4CSQ6S5C6S5G+IHLPzzGVZDPLdIn+WH40xT87ej82ZaRxkE4xmKrlqqsnJBj1e0fu2t8sTlFDllgg5qWieFLl5EL+R0gd0C5Dz2oZ34eyj8FGrnOEH7WRBpBS8Zha93l8cS/s9wA+BTyrkjI6j33b4vp7jr0rSTZGqVMQbvMwq7wLm1Vm/TIlTf6HAkeo2Tf7NKj3VOtj4g5KIE4gTS5wkNYnIyuOEwS/J5twJOM1Nk7S1AxjJQT4HiEHpqq7/jYG8TopLoYDJttHc7AhPOrmfjw0wq/eSJH/GRXZUExNZrT4u1anCE8hvRgRrrSNzZnOlKLea8Yyh5eQwb5K52K0kYTjdgglCJuvFCNWwV8869u9aTWgsl7/8QyTWbMCYj6J8B5E5Xj0uuDtM0QIdTdLimofIlxDZBPx1DJyHt/ChEy/m27//FHv1byQbpYtV3aE67nuAwLXi0jAP+t9t8Gp/xq+Yz+CIeoUwhRDY7M2sCEglqhsT9G+UUOOs/0HGE3SdRqXE4+bUYkV/lqDHTaG7KsJlyPiQIDME3qtoLr/9u2K1TKLBUpcz8JkE+152PJV3ALxBHAt9pLoZaEnUQj4P+VhJYq1ClC4sjKsIUoq1447yyRKYVSExDuysfhXltirrTxoX2vK4c6Xo5NaOOIa2NgdYVicHVqOjYK2i+nQ9v4gmnuJV9mGbyj5JLeTjsTO9Jqh2biJVCoU4GLVHoHonCAR5muJcsb9nujfZch5cYj9hR/zruFBQRRhOtyBRhtOX/wHUcuVpl5GNMrcyMvBC4vxJSLCfdxw+g4slK8Rk7Ys7YefISZiI+yLyaUReOWYiqNLbMh2xFqzFjC8wZhJq9R5MJLOWKATE477lMXNryE/KwJ84N2SdWWR9nz2D45DdZ9DHh60ZjERokgmhI6LKfxiXonpXSAB6vsKfE9UfB+riB7cDsrSev6s3OQPkFQLvZuee5nSqHwO20qJnFdSq06ySJCQxYQ0tR4HNY6Ev1rqQsukd3gCfREuN+yH/5K/a3zf+eZPdiOjth6Fhigd/7ZEg0NLsDyiVdD0/iSwalKrZJU3SWcaPRT6IIMp4x/aEEj6K5eEqYDUD9GWo3ulWgJinpi3k2M3LiNSQSDjD+xVcwj2XU31Pdf6CJ3B8qM1e+1gJ9FgJBntbOnnF8t8TBxE/P/481ki4Ot8+dzWj/WCS8h3guF4HA+9EeTWqi+roqJeCvhfkyrHBE+dZNW0+84e2ABY73h5PbudECMtoJuVMr1l13CsRuFnhi3m1dw3bhIigABL7inA6u1ZagAv87qeaKeYcCYSKvkG3NVV3hmSqbgiId5c4M3AOSTKrhmaVTFAOVKGn1wHIrJnufTUXi6o/PDV05M4gcA4AraOVrD/Et16wKt6JGxn15ZqMGSkwPApRFJIO96ynK6M6siosUQcc+cIHeYmYMdrHnl0rWdM8fXwncEwvsF9G9YWIVCLvnY2x12D1EeI+rnjexSTGcvbq2+hLtz1pJHjSP3Nf5zPj+QqnAC8u2ug0XnN4FLhHkT90tc1++uTV946c/eBNfPM5b+Te/U/hgc5FMG0uDG8Fm5Rr0GUol2DtVah+HtVT6+isd5HYW7D6sLtdlg8e/y7+8L/vojnJkQvTBdBfZpUu3A7TsyURcKb3G50XIDdZlNjtaJ2CyoI679MD9Hue05CfWIWsCGnvgppH7Z0ngL0E9ldYMZVRSL4P9gHq9V/mvE8vV6TNF9L3NAOBjqf1qSlGwdgxsGolNk11+I+2rcWWHmfWLZwHUboyYIUhDI24hJLGeNOsDj1UPP0nMUV7xXW1bi+5PBNM1slr2q8mNs+tZwGPVFlfrjZFn+ynbsdkjIPRl27m+PVLufie7/HB138buldBbtDtkLl6/BZrbgZ5QxWz5/2g52EUhnv53KHnEcQxb157O0kQ0ZXuyAu6zIPVtaiGCudalyrkOK99HOyvNwBbRfWWOIi+tWrW4nvPevx3XHL/tVx54vmsWHAYf150FLTOhMEtlXrvEVRPw9jvA+fXaLhFKOeAPop1kdRic9w253BO3vAAGFMgta7AkUs/xLMvHcC31GVhWOsmkx4LmqnDP/RTgV+KyJO+8Xr94iVeU2q3bvv6uep2TY+scc92328rprrSis4RZFEdX70duCaApYj0+3oPFgF+B5C2qgco/AvwppoqrSpGLeTHHOzU9FlVAoaePlK5hHQqRbk4UwUknSLu6ibe2FUailZdrIXWFmhrqd9nJQJJ/CKgnWC7bPkm0FNJzAV+PNSS/kjRZVrdKfAcHBelp4CngSq9mTZacgO8+s9Xcf+sfdm01/Oh7xnIDTvQslyGSY4E2b9C+78Zq/eRJN8gicEGfOaQ8xiJWlgw0sXrNtxLLAHDUTNd6WlEmhjgR6jeYF2uon8VaCsiws/E8ajOjWzy3dEo86UVMxc8/va//g8t2R/xuRe8nXUz9uTugz1Zf7Cr3ApigYuIk2nAWVVXGOH1WP06qmudVhtxxTFv5VXP3MNo1Iz1/Zeofk0dJeCE3QCw5qvqhcBHHU2opmmUFfiEeBpApUHkfYEAS9UFS1+t1Q/qaKI+DtoOAhWgzBSZGH5TBgp+E7qsGLkamiXACoVfWbfjeEktm86gBbCS7QIrVUhHpPKGBcuW0TQ4ignDMlaVEFjL1plt9MzppEbI27Zeh2zOmY6pSaX4/nKltCx11WtSZH59KlJ4sNyjLGO51VvUHcH18Pg2kzIcNrNP10pOXf1XfrPHETy0YSk37Hk8A4uOgp6nIY6fwJjzUa4F2aPCKPk8IoME4Y+dM3GUrx18Pox2syk9g6FMB0f0Luc1G++nPwzZmu5gIGwaFLXvV/iTwjcEFpVkhhBRe6EoJwdq/l9vc8dNW5qFd9/zPfJByPe2rmbN9D2469g3OdNwsNuBq4iz8VVyaPw2jD0A5OBqpgzoiS7NBqAJKWv5wiFv5PzHbiCRgLQITVG0Ma/6JmPtx63q6d5Uol5le3JGT13yXCBE1TCRYlBOVonwtUikEnG0RKcXgCcT9P3G6m+pzKhv2oWm8SJUqyHEgKJfRCQXBcHYeQI16qhW7eWJcpZUOQfAWMUaH26TmNCZWTUntpkwoVMR0XCWeWu6SSVKrqO1rPKjIgSq2HRq+8AjFLdhtvvKisioPuad1QuK1cuS1K+XKNyicJ/x/BxVQz5qYumMFg7qfoKXrV3Kfvs8yLpZ+3LVYWdipy+B7qfuI47fgOoPgIPKzKdmkG/jeI0/xCqMbAIJ+cpB50OQYV7vcp5omc/Glnm8Zt3tnLB1JStbZzEaRr8S1S1WuVZgDx2br2N12Be4DrgoUP3hpvbZBGp5z90/ZFPrNA7bsor75x3M3w49A3rWuNUv78N2jO3D2stQvb4qI99yMsK1boBZFMtQEjOYxCQEpIKAWJVEdV0o8vaUyHOt6tF+06DdoNOAWZ6Ok4hz2C7wjttR6mfBTwasFvp7bqJMdoISeUKVESPO5msKIxzBRMs+eVSN4zapbrTKGuCQ3WCQ17KH+gUeyqtiVEkFbpExZSZ8IMKITRw3xDJqHFVkYWUz0GKsdTvmcbyVOBlCgrYanThe3iggGskyb3MfKWOJ09U3EwUwgThflZnw8Uy/QCQVfJohIt0YM+zoxLtRWoixOS0PRQrrVPV3wFt0W+dkQaYLfAF4ucBgcZhkZA1D6VYezkzjuese4PQn/8zcnqfoap/HN444B9Kd9zOw6dUol6F6XhlHXBNwFcqewJdB+gNriEa3EFjDpsx0vrbvORCmWdE0h70Xbuata25men6Qvqj5PtC3qAs4nlYmrVQauAq3e3irlYCnO+eQMjHvuO8aXtHSzmcF7jz4FFi/jjEintPPfkli7sHRGyrZGftgbSeqW5GQllw/lzx0DUPp1rHMmIM+PW4kQhIE96vq/UVmSgDMSQcSWDCBc1TPAtICWXVgtciDViEZ2gIm7g5ahU7UHo3wsjpGWrpI46mliK9FPbkRJVZLZypDWsIxwPLgxEASE6uOBxvXjqbZVVlLayXq0wCJUYjVkrOWaakUTUGILUmTNBDnyXnntvdDV62DEYtRK+QTJZ90ESdbaoBVhOPzQSikRmLmbh0ilVjiVEhYIzGlCYRpI3nyqYhcJkKMReEIgc+pW6BMeRuQAOUTwC9cEr7dS6US1Ts0Ch+JVDVRuMHnOioy9Lax/5+PyzT5DsqQ8iJr6G+aRm9zwAvW/oXIxCzofYZ1bfP51pFvfoKRgQsweh1qLhR4lW47gf4Ll8/6CuBXQKIS0GxyRLHLCPrItL15ZOYRrGydz+ce+QbNJsdokL7DKh9zQLdtyf2u4pdwjuWNokoSRDzROZd9+zZz6LI/cef8k2BwyFNHbTEMXI/q86lMHt0X1XmgWwu7v93N02ky+YJiPT8U6QASC+Ssxe/PFLhieYGNeYV04AwMq/qM+lXcr+5/qXPXa7q1ernCO+sAiXq9BbZ01m/MjjjukBQ/X0gFIUVZ0GQSIXzP+lxI0FSx37grN4qxus26mgrCidXW6rwtYxVjrZJYgsQGUWykDjNwXiYxNMWGKDGkjCWJgjqidMCKkIoNc3qH6WlvIpsKCa0epPCSOjrjcOAXuxVQCYglZwL5lGL6C9SFu1T1ToWTKjvaFeAcx9zl/bjE89uqymrpbXLnoT5/w4MID4JN+NZRF8SMDt1MfuRuQY4OrX2lwLEKx447euU4kJ8g+hDCDSh3A/c7mzygLRlB4mEeb9+HDxx6MR99/AdMS4bJE37XomegvLQc0AocoOh7repHKMTNqeXp9g5OWv9/LL//x/xhz1MI4/7SHy4XW5n0502AxcBjVlyO6IL/TJ1v6ipvCtkKyrVR+Fps7FdHkwRFaQ4jAhH68jnaUmkyQVA+tKnYNDEJidXelIQ3KnouLgK/mt9Z67QdW4ufk00ShpPY7UYVzWQBWqIUmSAqwFUo8HdzeqxFpVDHxCQMxTFGFSmpY1NoaQ5Txb6lfFWwUr/25QwSm6A5MYGtBVbC4enEzGjLxj1WIJlkMjwTBgRWmTGYJZeOyEXhbBOQiNYkxM7z43y3OS9MlH4C/n00jG7DKJFxtlOfwqcoA1aUOPvVaT+HAz8CvoU7NaP89klTB5E1vOyZezm2exn3zDyUHxx6Xp9m+24XuCtSOlH2R+3egWVvXFD1vghHgOyr6FsE1qg7nfkeYKmKrG+Lh3R52x4MBilajMEEMqzwac8lKssdU3iHOhrB2HZ5NkixZKibJYPrwEY0bXsI62ZVtlKZ4R54Ew0jkEoMRi1WrYu2d2BWi/B2mLGWBAsKI+qOLjOqDCcxo/VMNp8UjoA26k8vDj6vVTXntCAYtcRqsdZ6wvG2j8hZQ6KWACGUYGEozNf6yjDVUmu2pwOYY1S7RtWOgVS5BHuxKtbELt5JwrZAKiZ5HPNZWbUQG5piI81xIrb2buABolxpguBSRUe3C3wDIbCQSswMRc8SrSuLc8RkDcCp08KWC9xgkV/kMuGDhdWieGL/QZWvAJeWpzJM+HQxLj3u2QK/VvgDjlnex/ixUh1AKglCq8jmBUOb15/d5zJuXH3wOcT5kTgw8ZZAzRbgHnGDNwPajNIOmhLnK5utjoT4DG6bXBVoNVlEbbGasNS6NC4nVWjEDtzJPSvGtUAlG0IiacjnSW8LVj2489bm1tq9MaKkY4N6R611nw/U0TEnK5waIH9D6FdQfO4lVa3rHCRxSkGrUX2N1M5pFRb5vIZrfPdoxZ5krL3T1lDFCr4rl5xRTzbK9Cr3jZl4CMRUSi1AnmHgDKP20YIGW18d7clW5bjqmpWiqiJqNTRmuClv+o3o4jqs+gvURXH8Bpd6O/Jza32FbjBM9G9aG7BvYPXMprw5us52embS8CPchrKW7Y8OKNRjk59n62woKxMJnhLYikwc/qVHcX1W0aOAF9ZR6gDYG+Xd6vxYee/IHvW7THMLq6egK4ZSLZ8Mg/Qvz151M4mE/GavlxObPNkgg7isMsb7wkao45y7XJh2avZ4BoheHLHvpEqgr/BCq3pVsdM1DwTGEsaWTLKNBjwNqk66In8BpBMXuBqoxUes1hOLtg/wS3Ha4//5+qeoz04rBGfPRjnRYPerQ7MaLQKpWoHW8wSuQuSDonqHuubSIp9bYRxEOJZOM+jZRu3FNe6b9YNzilUqQYTuRDUnlUNjUri4wTXiOGIjTPQrFtcxEOcDPcuqfkzRqPrzXTjZ/N4tpG1+QFQ3R2IOrdNbcyxu1zgpMnBM5R8okdGwqP8j0MnYkD2ieIO4LhMNE8lnbBjcuRP8k7boqqi0RclEf8gGhQ+gXCfo4jpCcQqfZzyitxd/WFSDo0T5ZiJhb09Tx52vXHsH71hxAx8++lLuWvQiWkY2MZntUhVh8fAmQpNgVIqDvZf6YkqFZBJHej9M/0Q/m9OKUnFpamKdpyK1qANhAaxSxpJYS+AOFxim/sNFW4Dj/TXVshHo8q29SpmYYLqM7I/Iz0AfwOWmGvUrYSERXxMwX9E2hUMt7FdH9H1WfJD3VPtzBfrV9Xc1XtdC4McIS72FMODrWPBJNfs6NgN7JXBMPRkGAmtILKiJSCUjgyjrAtXJ1DmgvvClHXNiA4qsHecraT0/I50jn2uK4lqUip0l5VaG+60LJfgfb+7VhVjluqBET5kLvBPkThUhG0YcMLCau8zzyIbNtNrRugBaVBlp6uTSB77AnOxWhqMJIQKbFM1SmT80U50P6eFijShIDJlsTLqEFKciC2xQ1bdiCif9WAkIkwTr/RSK9AOP4VIk707yGJAXEVCWKzpYwyEPSgZ4nr92hv9ik0jwV2fxTvkoX+2vOTXngnIM1eIIJ1nURCGdDLPXwBNsTc3JB9i/iNYM5dq14ur0jI1kmQ0CQmNrEmOLwbRlMMdoW5pcU4rATm1fBhUqcK8qr7Kq91hnd49fqKc/ll4TdsLUus0QSq59FJoV2Nw0nTev+hUXPv4jbNjEaNhUVz6rOExxcPcjpEyOXBBiscXlMBbiMZ3Sm4hFl6hqW6EuBiFtoT0/RDpvycTJhCs05iVRYsIocdvIpVcqNmsDY58OjKVwlcSB/p6dc/z2zpRbnE2hKHofldNAT2kZVG2yi85S7MadWDS1070cWAVpZue7eOWGaxkNW8Blmn2G3U9uDYyuiPJmMkDlKh8IzcN50tkYDWTXg5V7pD6k8EoLVxvImyIHiS25tGBQu2u9Ue636gLOrbXF10xr7f7WWsQkrG2ZxTmrbuWCZT8iiZrIBZmqgBWoJdu2gLc88XMWDq1lWCIStWOXURtYa1OF5+m2ZfVZp9z7tMnyZNM8lrUcSJMZHTsdzF/7RIk9NRUbKl1RYldGxm4MjFK4SuROxvhfu4V8A7cZQpHP6pNsz0GvO6bpfL26El5LSa/LB1Is3wbu28n1ML4tu6tMZasCA6kORsJ2QmvXAB9kN6IHIKxH/BiVSeuQWnDLtHjAslMIWLUccL0o56vqm63qbcVaVgkIoV7Hsdj3WOxDFpt27yeARbuF2WOeNGtY0zqTNz71Gy5Y/mPyqeaKJ9sAZFMtPGft7bTFwwyHrQToeN5e95U5xSagqo6bZa7cgVV3CnWiMCM/zMrmfbiz8yQ68v2I1eLrg2J0jhioeFkeCmM7kMobUnkHYCXdbICPA1/dDYblT/xEKZWbcBskG3dBGVYAF5XRLmrtYHaUrKW1DjcojeLfgMuksTMB62PAR6gestQWS4rZuS6O7b2bbNgMcA1wNu4osWdbbgdew7acyWbqO0AiU+xHbhnOk8klUwZY9WZO/DkuNvDVqno28GIt3V1xntrfAb8A3l5BU+4AFk+Y0GpY3zyds1bfSqLCDw853wUWl1NHW+dw+oNfZkn/Bja2TifY9juHleYaG88RZgHiQGSDFaEz6WNDpoO/TjuW+bmNGJngmjoVeEsNF1oM+sex6SMQiGVa0s9oOGH8DgGX+oFxmneiHzTljlMnA7gUzD/H5T+vpEFdjTu95R04Ht28KdCm/tdrOMvL/D2c5DhNbce4XgmcCbzXT9D9trMua3F8vU/7vqwaPhNLmvnZbp7T+yfumfES9hxdhZXwWtzO75uAFwCH4pz8u4L1v8E/+zYcV3JgO5SYiUbY2BwTmodyLjSjKUVgdq4CKdd3zt4GVtRCQStSR/wZ9zuptuFY58co+jxgCS4/1WyQV6pyM8JjuHxFvkYTQOXbqlw0scaCoLTHQ9wy93jiMDVmOxfHKCZhmkO2Psb87FbibY9sbxPhRlFerCX3dnaBArJCRY5sSYazubCZby9+F081LWFOvqsYrPbH8Vv2qtF293hQGyl0VIByRP/9vHDLb6lC/luCc/LP8Ndi3A6l4ngy7ZPwc4mf6H24PNqFMxjWA6twu2DLmdx5cEf7chzkJ9BCxpMvBl57LU181OfNoSb/+Ub/zDW4Xb91OL5QJTkOl4poqMREKgT2PgncUfT5ybhc/r1lJlnon1VNizoQl4X2cN8fc3y5W/3rwr7YFsbpNKtwIVurGd+gWQC8mJLklEXa3wrg7kgTskErt805naUdz6HFDJdqgXu7+cMMXGzoXoynsV6AixqZjO8zxOXiKvCyuvzrbl+n5ZScq1AiBzN+IEc5ukTKP+MmHF1pvOIOMBhty5DPRJP2gdlQSPzcsSLkMiGjqcjN3u0Aq6LvaiswQx3PZzZwh6KdKPfgsh6Uk6cVTlX0iUKvJtY9QVDassMVl5cA6IsiSDcTbtsGpwC3VtJY1Pm8bggxb8oFmfgHiy7imaY9mZ70YscXkhMYD5GpJW8Hvj9B1ZIMGR3lklWXY7cryRoZP+HNJMAqwNEJ8lO0Erf5gVlIs9ru27i4B0Y90BQ0nkF2u3DYqm1YWCwyvr6FNXLIt2t+R9pXEWbmh1naeQg/2PNSZuS7J/PztDfLJpP9KfBadO5ZaVCjJOmQoY6mSe8QVgOrHU2gP+yvZ8Dtvila64SlJcBZqvrZwgeJFvYToS/TUkdjmLE85+Lo222CjB3mWI5GIUDaZm8bjtrinyy8gE2ZhXQmfQWgynjz4NI6TaA7gJ9u+wxLazK4I+35rA2wKjJU4z0loPX3JlpUp2Gm4Ah1QYkDGAnbCHTSptEOAeWzBf9TsTMY7cTyFXp+s1c1t8kQWqSVXYTbvn7Ujq09MqnRVRyLq3Cmoq+a+KwSvdXmzU1zX3vXyraDGQqn0WYGWy1BQY2/EDiC+uLVutj1O2gNacg/veyUyHgXM+XoA6pqVXWZqqX0GjMzYW+FzyjM2Qm2wgtU+awqwUQ+2Dj7yqJE1vyiOz27c3Nm/qczNvtdS3Az7qy+L3s/Tb2BtV8t8Z+MI78m9KZmceOCc8nYbGN0NaQhu5tmpWNG3Nj7Pymc55nPJd8ce306jvfzTmoHm1aSF6nq9xWtGP1uEKbHw/pwx5E/39i0+Nz2ZOCCHQDpq4Arq7WEkZDBaBryd+OyaUhD/gk0K5cszpI1CUbtGLtd4deq+rSy7T8mvOK1uC31Ayf56DTwOpyDe+/K0CE0WYMJghsf7jg2P5jqPCOl8fbW+X9webxMLf9EqKYxshrSkN0JrBTGclWXhNX0KnxRKRvyMjF8R/U0XBjC+3A7iNVOImnBHXjwWRy5ripQqcCcONv/VOt+X1o27fA3tiRDC2XyIR7WA+rFlBxL3pCGNOTvwAwUgdhYskniTz7ZBgS+j+MhvbaO2+0NfA53tNHdwJ9xAbcDHizacA7w43GBwZ21EUbojIfYkGl//52zTt0rUnNWpPFks1l0+XJ9vjFUGtKQv1OwKjYFK0gCvAdHMDuoztvt6a9zPEgNebNrGnU6wBXBiDA9zjIctn/9R3te+NdVrYffNDu3sTXA1gtWimP4fgoX39eQhjTk79kMrEPWAW/F5QbanrIVkt/VDVQKdMZDzDfJL/4644SvLWs/6oud8dZFIUk9QKW4kKGzgZc3gKohDfkH0qzqkPv95P8pVM9ZvSPimFqWlMkzkur4441zjvvdvTNedN3M3JbD0jaLrYx3hfCDPwP3eo1qqDE0GtKQfz6wAsdLeg2OqnDUVD0kY/OkrfnBDbNP+8Btc886bUZu8zOtycBtiBQnMhRvWvYyHrO2ml2QZrchDWnI7g9W4AJLz8Sl1XjHFNy/N0A/CXxjS3pOLq9cNy3u/ZkJouTv5wi7hjSkIZVkV5/tthaXnP+1wJ920j0HcDuPL1d3mGkuY3OkNMlaCZJGFzekIQ3NanslD9zgweoFwBuB09k2YVotWYpLV3szLmfTaKM7G9KQBlhNhXQDv8Ttvu2HO3nmRBzNYT7juZEKNtxmnG/pIVzysKX+HnGjGxvSkH98+f8DACeR8Z8W+T8oAAAAAElFTkSuQmCC" />'', nchar(13), nchar(10), N''  <h2>DiskSpace Report</h2>'', nchar(13), nchar(10), N''  <table border="1">'', nchar(13), nchar(10), N''    <tr bgcolor="#66ccff">'', nchar(13), nchar(10), N''		<th>PackageID</th>'', nchar(13), nchar(10), N''        <th>QuotaValue</th>'', nchar(13), nchar(10), N''        <th>Bandwidth</th>'', nchar(13), nchar(10), N''        <th>UsagePercentage</th>'', nchar(13), nchar(10), N''        <th>PackageName</th>'', nchar(13), nchar(10), N''        <th>PackagesNumber</th>'', nchar(13), nchar(10), N''        <th>StatusID</th>'', nchar(13), nchar(10), N''        <th>UserID</th>'', nchar(13), nchar(10), N''      <th>Username</th>'', nchar(13), nchar(10), N''        <th>FirstName</th>'', nchar(13), nchar(10), N''        <th>LastName</th>'', nchar(13), nchar(10), N''        <th>FullName</th>'', nchar(13), nchar(10), N''        <th>RoleID</th>'', nchar(13), nchar(10), N''        <th>Email</th>'', nchar(13), nchar(10), N''    </tr>'', nchar(13), nchar(10), N''    <xsl:for-each select="//Table1">'', nchar(13), nchar(10), N''    <tr>'', nchar(13), nchar(10), N''	<td><xsl:value-of select="PackageID"/></td>'', nchar(13), nchar(10), N''        <td><xsl:value-of select="QuotaValue"/></td>'', nchar(13), nchar(10), N''        <td><xsl:value-of select="Bandwidth"/></td>'', nchar(13), nchar(10), N''        <td><xsl:value-of select="UsagePercentage"/>%</td>'', nchar(13), nchar(10), N''        <td><xsl:value-of select="PackageName"/></td>'', nchar(13), nchar(10), N''        <td><xsl:value-of select="PackagesNumber"/></td>'', nchar(13), nchar(10), N''        <td><xsl:value-of select="StatusID"/></td>'', nchar(13), nchar(10), N''        <td><xsl:value-of select="UserID"/></td>'', nchar(13), nchar(10), N''      <td><xsl:value-of select="Username"/></td>'', nchar(13), nchar(10), N''        <td><xsl:value-of select="FirstName"/></td>'', nchar(13), nchar(10), N''        <td><xsl:value-of select="LastName"/></td>'', nchar(13), nchar(10), N''        <td><xsl:value-of select="FullName"/></td>'', nchar(13), nchar(10), N''        <td><xsl:value-of select="RoleID"/></td>'', nchar(13), nchar(10), N''        <td><xsl:value-of select="Email"/></td>'', nchar(13), nchar(10), N''        <td><xsl:value-of select="UserComments"/></td>'', nchar(13), nchar(10), N''    </tr>'', nchar(13), nchar(10), N''    </xsl:for-each>'', nchar(13), nchar(10), N''  </table>'', nchar(13), nchar(10), N''  </body>'', nchar(13), nchar(10), N''  </html>'', nchar(13), nchar(10), N''</xsl:template>'', nchar(13), nchar(10), N''</xsl:stylesheet>'')),
    (N''TransformContentType'', N''DiskspaceXLST'', 1, N''text/html''),
    (N''TransformSuffix'', N''DiskspaceXLST'', 1, N''.htm''),
    (N''GridItems'', N''DisplayPreferences'', 1, N''10''),
    (N''CC'', N''DomainExpirationLetter'', 1, N''support@HostingCompany.com''),
    (N''From'', N''DomainExpirationLetter'', 1, N''support@HostingCompany.com''),
    (N''HtmlBody'', N''DomainExpirationLetter'', 1, CONCAT(CAST(N''<html xmlns="http://www.w3.org/1999/xhtml">'' AS nvarchar(max)), nchar(13), nchar(10), N''<head>'', nchar(13), nchar(10), N''    <title>Domain Expiration Information</title>'', nchar(13), nchar(10), N''    <style type="text/css">'', nchar(13), nchar(10), N''		.Summary { background-color: ##ffffff; padding: 5px; }'', nchar(13), nchar(10), N''		.Summary .Header { padding: 10px 0px 10px 10px; font-size: 16pt; background-color: ##E5F2FF; color: ##1F4978; border-bottom: solid 2px ##86B9F7; }'', nchar(13), nchar(10), N''        .Summary A { color: ##0153A4; }'', nchar(13), nchar(10), N''        .Summary { font-family: Tahoma; font-size: 9pt; }'', nchar(13), nchar(10), N''        .Summary H1 { font-size: 1.7em; color: ##1F4978; border-bottom: dotted 3px ##efefef; }'', nchar(13), nchar(10), N''        .Summary H2 { font-size: 1.3em; color: ##1F4978; } '', nchar(13), nchar(10), N''        .Summary TABLE { border: solid 1px ##e5e5e5; }'', nchar(13), nchar(10), N''        .Summary TH,'', nchar(13), nchar(10), N''        .Summary TD.Label { padding: 5px; font-size: 8pt; font-weight: bold; background-color: ##f5f5f5; }'', nchar(13), nchar(10), N''        .Summary TD { padding: 8px; font-size: 9pt; }'', nchar(13), nchar(10), N''        .Summary UL LI { font-size: 1.1em; font-weight: bold; }'', nchar(13), nchar(10), N''        .Summary UL UL LI { font-size: 0.9em; font-weight: normal; }'', nchar(13), nchar(10), N''    </style>'', nchar(13), nchar(10), N''</head>'', nchar(13), nchar(10), N''<body>'', nchar(13), nchar(10), N''<div class="Summary">'', nchar(13), nchar(10), nchar(13), nchar(10), N''<a name="top"></a>'', nchar(13), nchar(10), N''<div class="Header">'', nchar(13), nchar(10), N''	Domain Expiration Information'', nchar(13), nchar(10), N''</div>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:if test="#user#">'', nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''Hello #user.FirstName#,'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''Please, find below details of your domain expiration information.'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<table>'', nchar(13), nchar(10), N''    <thead>'', nchar(13), nchar(10), N''        <tr>'', nchar(13), nchar(10), N''            <th>Domain</th>'', nchar(13), nchar(10), N''			<th>Registrar</th>'', nchar(13), nchar(10), N''			<th>Customer</th>'', nchar(13), nchar(10), N''            <th>Expiration Date</th>'', nchar(13), nchar(10), N''        </tr>'', nchar(13), nchar(10), N''    </thead>'', nchar(13), nchar(10), N''    <tbody>'', nchar(13), nchar(10), N''            <ad:foreach collection="#Domains#" var="Domain" index="i">'', nchar(13), nchar(10), N''        <tr>'', nchar(13), nchar(10), N''            <td>#Domain.DomainName#</td>'', nchar(13), nchar(10), N''			<td>#iif(isnull(Domain.Registrar), "", Domain.Registrar)#</td>'', nchar(13), nchar(10), N''			<td>#Domain.Customer#</td>'', nchar(13), nchar(10), N''            <td>#iif(isnull(Domain.ExpirationDate), "", Domain.ExpirationDate)#</td>'', nchar(13), nchar(10), N''        </tr>'', nchar(13), nchar(10), N''    </ad:foreach>'', nchar(13), nchar(10), N''    </tbody>'', nchar(13), nchar(10), N''</table>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:if test="#IncludeNonExistenDomains#">'', nchar(13), nchar(10), N''	<p>'', nchar(13), nchar(10), N''	Please, find below details of your non-existen domains.'', nchar(13), nchar(10), N''	</p>'', nchar(13), nchar(10), nchar(13), nchar(10), N''	<table>'', nchar(13), nchar(10), N''		<thead>'', nchar(13), nchar(10), N''			<tr>'', nchar(13), nchar(10), N''				<th>Domain</th>'', nchar(13), nchar(10), N''				<th>Customer</th>'', nchar(13), nchar(10), N''			</tr>'', nchar(13), nchar(10), N''		</thead>'', nchar(13), nchar(10), N''		<tbody>'', nchar(13), nchar(10), N''				<ad:foreach collection="#NonExistenDomains#" var="Domain" index="i">'', nchar(13), nchar(10), N''			<tr>'', nchar(13), nchar(10), N''				<td>#Domain.DomainName#</td>'', nchar(13), nchar(10), N''				<td>#Domain.Customer#</td>'', nchar(13), nchar(10), N''			</tr>'', nchar(13), nchar(10), N''		</ad:foreach>'', nchar(13), nchar(10), N''		</tbody>'', nchar(13), nchar(10), N''	</table>'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''If you have any questions regarding your hosting account, feel free to contact our support department at any time.'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''Best regards'', nchar(13), nchar(10), N''</p>'')),
    (N''Priority'', N''DomainExpirationLetter'', 1, N''Normal''),
    (N''Subject'', N''DomainExpirationLetter'', 1, N''Domain expiration notification''),
    (N''TextBody'', N''DomainExpirationLetter'', 1, CONCAT(CAST(N''================================='' AS nvarchar(max)), nchar(13), nchar(10), N''   Domain Expiration Information'', nchar(13), nchar(10), N''================================='', nchar(13), nchar(10), N''<ad:if test="#user#">'', nchar(13), nchar(10), N''Hello #user.FirstName#,'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), N''Please, find below details of your domain expiration information.'', nchar(13), nchar(10), nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:foreach collection="#Domains#" var="Domain" index="i">'', nchar(13), nchar(10), N''	Domain: #Domain.DomainName#'', nchar(13), nchar(10), N''	Registrar: #iif(isnull(Domain.Registrar), "", Domain.Registrar)#'', nchar(13), nchar(10), N''	Customer: #Domain.Customer#'', nchar(13), nchar(10), N''	Expiration Date: #iif(isnull(Domain.ExpirationDate), "", Domain.ExpirationDate)#'', nchar(13), nchar(10), nchar(13), nchar(10), N''</ad:foreach>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:if test="#IncludeNonExistenDomains#">'', nchar(13), nchar(10), N''Please, find below details of your non-existen domains.'', nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:foreach collection="#NonExistenDomains#" var="Domain" index="i">'', nchar(13), nchar(10), N''	Domain: #Domain.DomainName#'', nchar(13), nchar(10), N''	Customer: #Domain.Customer#'', nchar(13), nchar(10), nchar(13), nchar(10), N''</ad:foreach>'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), N''If you have any questions regarding your hosting account, feel free to contact our support department at any time.'', nchar(13), nchar(10), nchar(13), nchar(10), N''Best regards'')),
    (N''CC'', N''DomainLookupLetter'', 1, N''support@HostingCompany.com''),
    (N''From'', N''DomainLookupLetter'', 1, N''support@HostingCompany.com''),
    (N''HtmlBody'', N''DomainLookupLetter'', 1, CONCAT(CAST(N''<html xmlns="http://www.w3.org/1999/xhtml">'' AS nvarchar(max)), nchar(13), nchar(10), N''<head>'', nchar(13), nchar(10), N''    <title>MX and NS Changes Information</title>'', nchar(13), nchar(10), N''    <style type="text/css">'', nchar(13), nchar(10), N''		.Summary { background-color: ##ffffff; padding: 5px; }'', nchar(13), nchar(10), N''		.Summary .Header { padding: 10px 0px 10px 10px; font-size: 16pt; background-color: ##E5F2FF; color: ##1F4978; border-bottom: solid 2px ##86B9F7; }'', nchar(13), nchar(10), N''        .Summary A { color: ##0153A4; }'', nchar(13), nchar(10), N''        .Summary { font-family: Tahoma; font-size: 9pt; }'', nchar(13), nchar(10), N''        .Summary H1 { font-size: 1.7em; color: ##1F4978; border-bottom: dotted 3px ##efefef; }'', nchar(13), nchar(10), N''        .Summary H2 { font-size: 1.3em; color: ##1F4978; } '', nchar(13), nchar(10), N''		.Summary H3 { font-size: 1em; color: ##1F4978; } '', nchar(13), nchar(10), N''        .Summary TABLE { border: solid 1px ##e5e5e5; }'', nchar(13), nchar(10), N''        .Summary TH,'', nchar(13), nchar(10), N''        .Summary TD.Label { padding: 5px; font-size: 8pt; font-weight: bold; background-color: ##f5f5f5; }'', nchar(13), nchar(10), N''        .Summary TD { padding: 8px; font-size: 9pt; }'', nchar(13), nchar(10), N''        .Summary UL LI { font-size: 1.1em; font-weight: bold; }'', nchar(13), nchar(10), N''        .Summary UL UL LI { font-size: 0.9em; font-weight: normal; }'', nchar(13), nchar(10), N''    </style>'', nchar(13), nchar(10), N''</head>'', nchar(13), nchar(10), N''<body>'', nchar(13), nchar(10), N''<div class="Summary">'', nchar(13), nchar(10), nchar(13), nchar(10), N''<a name="top"></a>'', nchar(13), nchar(10), N''<div class="Header">'', nchar(13), nchar(10), N''	MX and NS Changes Information'', nchar(13), nchar(10), N''</div>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:if test="#user#">'', nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''Hello #user.FirstName#,'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''Please, find below details of MX and NS changes.'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), nchar(13), nchar(10), N''    <ad:foreach collection="#Domains#" var="Domain" index="i">'', nchar(13), nchar(10), N''	<h2>#Domain.DomainName# - #DomainUsers[Domain.PackageId].FirstName# #DomainUsers[Domain.PackageId].LastName#</h2>'', nchar(13), nchar(10), N''	<h3>#iif(isnull(Domain.Registrar), "", Domain.Registrar)# #iif(isnull(Domain.ExpirationDate), "", Domain.ExpirationDate)#</h3>'', nchar(13), nchar(10), nchar(13), nchar(10), N''	<table>'', nchar(13), nchar(10), N''	    <thead>'', nchar(13), nchar(10), N''	        <tr>'', nchar(13), nchar(10), N''	            <th>DNS</th>'', nchar(13), nchar(10), N''				<th>Type</th>'', nchar(13), nchar(10), N''				<th>Status</th>'', nchar(13), nchar(10), N''	            <th>Old Value</th>'', nchar(13), nchar(10), N''                <th>New Value</th>'', nchar(13), nchar(10), N''	        </tr>'', nchar(13), nchar(10), N''	    </thead>'', nchar(13), nchar(10), N''	    <tbody>'', nchar(13), nchar(10), N''	        <ad:foreach collection="#Domain.DnsChanges#" var="DnsChange" index="j">'', nchar(13), nchar(10), N''	        <tr>'', nchar(13), nchar(10), N''	            <td>#DnsChange.DnsServer#</td>'', nchar(13), nchar(10), N''	            <td>#DnsChange.Type#</td>'', nchar(13), nchar(10), N''				<td>#DnsChange.Status#</td>'', nchar(13), nchar(10), N''                <td>#DnsChange.OldRecord.Value#</td>'', nchar(13), nchar(10), N''	            <td>#DnsChange.NewRecord.Value#</td>'', nchar(13), nchar(10), N''	        </tr>'', nchar(13), nchar(10), N''	    	</ad:foreach>'', nchar(13), nchar(10), N''	    </tbody>'', nchar(13), nchar(10), N''	</table>'', nchar(13), nchar(10), N''	'', nchar(13), nchar(10), N''    </ad:foreach>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''If you have any questions regarding your hosting account, feel free to contact our support department at any time.'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''Best regards'', nchar(13), nchar(10), N''</p>'')),
    (N''NoChangesHtmlBody'', N''DomainLookupLetter'', 1, CONCAT(CAST(N''<html xmlns="http://www.w3.org/1999/xhtml">'' AS nvarchar(max)), nchar(13), nchar(10), N''<head>'', nchar(13), nchar(10), N''    <title>MX and NS Changes Information</title>'', nchar(13), nchar(10), N''    <style type="text/css">'', nchar(13), nchar(10), N''		.Summary { background-color: ##ffffff; padding: 5px; }'', nchar(13), nchar(10), N''		.Summary .Header { padding: 10px 0px 10px 10px; font-size: 16pt; background-color: ##E5F2FF; color: ##1F4978; border-bottom: solid 2px ##86B9F7; }'', nchar(13), nchar(10), N''        .Summary A { color: ##0153A4; }'', nchar(13), nchar(10), N''        .Summary { font-family: Tahoma; font-size: 9pt; }'', nchar(13), nchar(10), N''        .Summary H1 { font-size: 1.7em; color: ##1F4978; border-bottom: dotted 3px ##efefef; }'', nchar(13), nchar(10), N''        .Summary H2 { font-size: 1.3em; color: ##1F4978; } '', nchar(13), nchar(10), N''        .Summary TABLE { border: solid 1px ##e5e5e5; }'', nchar(13), nchar(10), N''        .Summary TH,'', nchar(13), nchar(10), N''        .Summary TD.Label { padding: 5px; font-size: 8pt; font-weight: bold; background-color: ##f5f5f5; }'', nchar(13), nchar(10), N''        .Summary TD { padding: 8px; font-size: 9pt; }'', nchar(13), nchar(10), N''        .Summary UL LI { font-size: 1.1em; font-weight: bold; }'', nchar(13), nchar(10), N''        .Summary UL UL LI { font-size: 0.9em; font-weight: normal; }'', nchar(13), nchar(10), N''    </style>'', nchar(13), nchar(10), N''</head>'', nchar(13), nchar(10), N''<body>'', nchar(13), nchar(10), N''<div class="Summary">'', nchar(13), nchar(10), nchar(13), nchar(10), N''<a name="top"></a>'', nchar(13), nchar(10), N''<div class="Header">'', nchar(13), nchar(10), N''	MX and NS Changes Information'', nchar(13), nchar(10), N''</div>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:if test="#user#">'', nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''Hello #user.FirstName#,'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''No MX and NS changes have been found.'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''If you have any questions regarding your hosting account, feel free to contact our support department at any time.'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''Best regards'', nchar(13), nchar(10), N''</p>'')),
    (N''NoChangesTextBody'', N''DomainLookupLetter'', 1, CONCAT(CAST(N''================================='' AS nvarchar(max)), nchar(13), nchar(10), N''   MX and NS Changes Information'', nchar(13), nchar(10), N''================================='', nchar(13), nchar(10), N''<ad:if test="#user#">'', nchar(13), nchar(10), N''Hello #user.FirstName#,'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), N''No MX and NS changes have been founded.'', nchar(13), nchar(10), nchar(13), nchar(10), N''If you have any questions regarding your hosting account, feel free to contact our support department at any time.'', nchar(13), nchar(10), nchar(13), nchar(10), N''Best regards'', nchar(13), nchar(10))),
    (N''Priority'', N''DomainLookupLetter'', 1, N''Normal''),
    (N''Subject'', N''DomainLookupLetter'', 1, N''MX and NS changes notification''),
    (N''TextBody'', N''DomainLookupLetter'', 1, CONCAT(CAST(N''================================='' AS nvarchar(max)), nchar(13), nchar(10), N''   MX and NS Changes Information'', nchar(13), nchar(10), N''================================='', nchar(13), nchar(10), N''<ad:if test="#user#">'', nchar(13), nchar(10), N''Hello #user.FirstName#,'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), N''Please, find below details of MX and NS changes.'', nchar(13), nchar(10), nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:foreach collection="#Domains#" var="Domain" index="i">'', nchar(13), nchar(10), nchar(13), nchar(10), N'' #Domain.DomainName# - #DomainUsers[Domain.PackageId].FirstName# #DomainUsers[Domain.PackageId].LastName#'', nchar(13), nchar(10), N'' Registrar:      #iif(isnull(Domain.Registrar), "", Domain.Registrar)#'', nchar(13), nchar(10), N'' ExpirationDate: #iif(isnull(Domain.ExpirationDate), "", Domain.ExpirationDate)#'', nchar(13), nchar(10), nchar(13), nchar(10), N''        <ad:foreach collection="#Domain.DnsChanges#" var="DnsChange" index="j">'', nchar(13), nchar(10), N''            DNS:       #DnsChange.DnsServer#'', nchar(13), nchar(10), N''            Type:      #DnsChange.Type#'', nchar(13), nchar(10), N''	    Status:    #DnsChange.Status#'', nchar(13), nchar(10), N''            Old Value: #DnsChange.OldRecord.Value#'', nchar(13), nchar(10), N''            New Value: #DnsChange.NewRecord.Value#'', nchar(13), nchar(10), nchar(13), nchar(10), N''    	</ad:foreach>'', nchar(13), nchar(10), N''</ad:foreach>'', nchar(13), nchar(10), nchar(13), nchar(10), nchar(13), nchar(10), nchar(13), nchar(10), N''If you have any questions regarding your hosting account, feel free to contact our support department at any time.'', nchar(13), nchar(10), nchar(13), nchar(10), N''Best regards'', nchar(13), nchar(10))),
    (N''From'', N''ExchangeMailboxSetupLetter'', 1, N''support@HostingCompany.com''),
    (N''HtmlBody'', N''ExchangeMailboxSetupLetter'', 1, CONCAT(CAST(N''<html xmlns="http://www.w3.org/1999/xhtml">'' AS nvarchar(max)), nchar(13), nchar(10), N''<head>'', nchar(13), nchar(10), N''    <title>Account Summary Information</title>'', nchar(13), nchar(10), N''    <style type="text/css">'', nchar(13), nchar(10), N''        body {font-family: ''''Segoe UI Light'''',''''Open Sans'''',Arial!important;color:black;}'', nchar(13), nchar(10), N''        p {color:black;}'', nchar(13), nchar(10), N''		.Summary { background-color: ##ffffff; padding: 5px; }'', nchar(13), nchar(10), N''		.SummaryHeader { padding: 10px 0px 10px 10px; font-size: 16pt; background-color: ##E5F2FF; color: ##1F4978; border-bottom: solid 2px ##86B9F7; }'', nchar(13), nchar(10), N''        .Summary A { color: ##0153A4; }'', nchar(13), nchar(10), N''        .Summary { font-family: Tahoma; font-size: 9pt; }'', nchar(13), nchar(10), N''        .Summary H1 { font-size: 1.5em; color: ##1F4978; border-bottom: dotted 3px ##efefef; font-weight:normal; }'', nchar(13), nchar(10), N''        .Summary H2 { font-size: 1.2em; color: ##1F4978; } '', nchar(13), nchar(10), N''        .Summary TABLE { border: solid 1px ##e5e5e5; }'', nchar(13), nchar(10), N''        .Summary TH,'', nchar(13), nchar(10), N''        .Summary TD.Label { padding: 5px; font-size: 8pt; font-weight: bold; background-color: ##f5f5f5; }'', nchar(13), nchar(10), N''        .Summary TD { padding: 8px; font-size: 9pt; color:black;}'', nchar(13), nchar(10), N''        .Summary UL LI { font-size: 1.1em; font-weight: bold; }'', nchar(13), nchar(10), N''        .Summary UL UL LI { font-size: 0.9em; font-weight: normal; }'', nchar(13), nchar(10), N''        .Label { color:##1F4978; }'', nchar(13), nchar(10), N''        .menu-bar a {padding: 15px 0;display: inline-block;}'', nchar(13), nchar(10), N''    </style>'', nchar(13), nchar(10), N''</head>'', nchar(13), nchar(10), N''<body>'', nchar(13), nchar(10), N''<table border="0" cellspacing="0" cellpadding="0" width="100%"><!-- was 800 -->'', nchar(13), nchar(10), N''<tbody>'', nchar(13), nchar(10), N''<tr>'', nchar(13), nchar(10), N''<td style="padding: 10px 20px 10px 20px; background-color: ##e1e1e1;">'', nchar(13), nchar(10), N''<table border="0" cellspacing="0" cellpadding="0" width="100%">'', nchar(13), nchar(10), N''<tbody>'', nchar(13), nchar(10), N''<tr>'', nchar(13), nchar(10), N''<td style="text-align: left; padding: 0px 0px 2px 0px;"><a href=""><img src="" border="0" alt="" /></a></td>'', nchar(13), nchar(10), N''</tr>'', nchar(13), nchar(10), N''</tbody>'', nchar(13), nchar(10), N''</table>'', nchar(13), nchar(10), N''<table border="0" cellspacing="0" cellpadding="0" width="100%">'', nchar(13), nchar(10), N''<tbody>'', nchar(13), nchar(10), N''<tr>'', nchar(13), nchar(10), N''<td style="padding-bottom: 10px;">'', nchar(13), nchar(10), N''<table border="0" cellspacing="0" cellpadding="0" width="100%">'', nchar(13), nchar(10), N''<tbody>'', nchar(13), nchar(10), N''<tr>'', nchar(13), nchar(10), N''<td style="background-color: ##2e8bcc; padding: 3px;">'', nchar(13), nchar(10), N''<table class="menu-bar" border="0" cellspacing="0" cellpadding="0" width="100%">'', nchar(13), nchar(10), N''<tbody>'', nchar(13), nchar(10), N''<tr>'', nchar(13), nchar(10), N''<td style="text-align: center;" width="20%"><a style="color: ##ffffff; text-transform: uppercase; font-size: 9px; font-weight: bold; font-family: Arial, Helvetica, sans-serif; text-decoration: none;" href=""</a></td>'', nchar(13), nchar(10), N''<td style="text-align: center;" width="20%"><a style="color: ##ffffff; text-transform: uppercase; font-size: 9px; font-weight: bold; font-family: Arial, Helvetica, sans-serif; text-decoration: none;" href=""></a></td>'', nchar(13), nchar(10), N''<td style="text-align: center;" width="20%"><a style="color: ##ffffff; text-transform: uppercase; font-size: 9px; font-weight: bold; font-family: Arial, Helvetica, sans-serif; text-decoration: none;" href=""></a></td>'', nchar(13), nchar(10), N''<td style="text-align: center;" width="20%"><a style="color: ##ffffff; text-transform: uppercase; font-size: 9px; font-weight: bold; font-family: Arial, Helvetica, sans-serif; text-decoration: none;" href=""></a></td>'', nchar(13), nchar(10), N''<td style="text-align: center;" width="20%"><a style="color: ##ffffff; text-transform: uppercase; font-size: 9px; font-weight: bold; font-family: Arial, Helvetica, sans-serif; text-decoration: none;" href=""></a></td>'', nchar(13), nchar(10), N''</tr>'', nchar(13), nchar(10), N''</tbody>'', nchar(13), nchar(10), N''</table>'', nchar(13), nchar(10), N''</td>'', nchar(13), nchar(10), N''</tr>'', nchar(13), nchar(10), N''</tbody>'', nchar(13), nchar(10), N''</table>'', nchar(13), nchar(10), N''</td>'', nchar(13), nchar(10), N''</tr>'', nchar(13), nchar(10), N''</tbody>'', nchar(13), nchar(10), N''</table>'', nchar(13), nchar(10), N''<table border="0" cellspacing="0" cellpadding="0" width="100%">'', nchar(13), nchar(10), N''<tbody>'', nchar(13), nchar(10), N''<tr>'', nchar(13), nchar(10), N''<td style="background-color: ##ffffff;">'', nchar(13), nchar(10), N''<table border="0" cellspacing="0" cellpadding="0" width="100%"><!-- was 759 -->'', nchar(13), nchar(10), N''<tbody>'', nchar(13), nchar(10), N''<tr>'', nchar(13), nchar(10), N''<td style="vertical-align: top; padding: 10px 10px 0px 10px;" width="100%">'', nchar(13), nchar(10), N''<table border="0" cellspacing="0" cellpadding="0" width="100%">'', nchar(13), nchar(10), N''<tbody>'', nchar(13), nchar(10), N''<tr>'', nchar(13), nchar(10), N''<td style="font-family: ''''Segoe UI Light'''',''''Open Sans'''',Arial; padding: 0px 10px 0px 0px;">'', nchar(13), nchar(10), N''<!-- Begin Content -->'', nchar(13), nchar(10), N''<div class="Summary">'', nchar(13), nchar(10), N''    <ad:if test="#Email#">'', nchar(13), nchar(10), N''    <p>'', nchar(13), nchar(10), N''    Hello #Account.DisplayName#,'', nchar(13), nchar(10), N''    </p>'', nchar(13), nchar(10), N''    <p>'', nchar(13), nchar(10), N''    Thanks for choosing as your Exchange hosting provider.'', nchar(13), nchar(10), N''    </p>'', nchar(13), nchar(10), N''    </ad:if>'', nchar(13), nchar(10), N''    <ad:if test="#not(PMM)#">'', nchar(13), nchar(10), N''    <h1>User Accounts</h1>'', CONCAT(CAST(nchar(13) AS nvarchar(max)), nchar(10), N''    <p>'', nchar(13), nchar(10), N''    The following user accounts have been created for you.'', nchar(13), nchar(10), N''    </p>'', nchar(13), nchar(10), N''    <table>'', nchar(13), nchar(10), N''        <tr>'', nchar(13), nchar(10), N''            <td class="Label">Username:</td>'', nchar(13), nchar(10), N''            <td>#Account.UserPrincipalName#</td>'', nchar(13), nchar(10), N''        </tr>'', nchar(13), nchar(10), N''        <tr>'', nchar(13), nchar(10), N''            <td class="Label">E-mail:</td>'', nchar(13), nchar(10), N''            <td>#Account.PrimaryEmailAddress#</td>'', nchar(13), nchar(10), N''        </tr>'', nchar(13), nchar(10), N''		<ad:if test="#PswResetUrl#">'', nchar(13), nchar(10), N''        <tr>'', nchar(13), nchar(10), N''            <td class="Label">Password Reset Url:</td>'', nchar(13), nchar(10), N''            <td><a href="#PswResetUrl#" target="_blank">Click here</a></td>'', nchar(13), nchar(10), N''        </tr>'', nchar(13), nchar(10), N''		</ad:if>'', nchar(13), nchar(10), N''    </table>'', nchar(13), nchar(10), N''    </ad:if>'', nchar(13), nchar(10), N''    <h1>DNS</h1>'', nchar(13), nchar(10), N''    <p>'', nchar(13), nchar(10), N''    In order for us to accept mail for your domain, you will need to point your MX records to:'', nchar(13), nchar(10), N''    </p>'', nchar(13), nchar(10), N''    <table>'', nchar(13), nchar(10), N''        <ad:foreach collection="#SmtpServers#" var="SmtpServer" index="i">'', nchar(13), nchar(10), N''            <tr>'', nchar(13), nchar(10), N''                <td class="Label">#SmtpServer#</td>'', nchar(13), nchar(10), N''            </tr>'', nchar(13), nchar(10), N''        </ad:foreach>'', nchar(13), nchar(10), N''    </table>'', nchar(13), nchar(10), N''   <h1>'', nchar(13), nchar(10), N''    Webmail (OWA, Outlook Web Access)</h1>'', nchar(13), nchar(10), N''    <p>'', nchar(13), nchar(10), N''    <a href="" target="_blank"></a>'', nchar(13), nchar(10), N''    </p>'', nchar(13), nchar(10), N''    <h1>'', nchar(13), nchar(10), N''    Outlook (Windows Clients)</h1>'', nchar(13), nchar(10), N''    <p>'', nchar(13), nchar(10), N''    To configure MS Outlook to work with the servers, please reference:'', nchar(13), nchar(10), N''    </p>'', nchar(13), nchar(10), N''    <p>'', nchar(13), nchar(10), N''    <a href="" target="_blank"></a>'', nchar(13), nchar(10), N''    </p>'', nchar(13), nchar(10), N''    <p>'', nchar(13), nchar(10), N''    If you need to download and install the Outlook client:</p>'', nchar(13), nchar(10), N''        '', nchar(13), nchar(10), N''        <table>'', nchar(13), nchar(10), N''            <tr><td colspan="2" class="Label"><font size="3">MS Outlook Client</font></td></tr>'', nchar(13), nchar(10), N''            <tr>'', nchar(13), nchar(10), N''                <td class="Label">'', nchar(13), nchar(10), N''                    Download URL:</td>'', nchar(13), nchar(10), N''                <td><a href=""></a></td>'', nchar(13), nchar(10), N''            </tr>'', nchar(13), nchar(10), N''<tr>'', nchar(13), nchar(10), N''                <td class="Label"></td>'', nchar(13), nchar(10), N''                <td><a href=""></a></td>'', nchar(13), nchar(10), N''            </tr>'', nchar(13), nchar(10), N''            <tr>'', nchar(13), nchar(10), N''                <td class="Label">'', nchar(13), nchar(10), N''                    KEY:</td>'', nchar(13), nchar(10), N''                <td></td>'', nchar(13), nchar(10), N''            </tr>'', nchar(13), nchar(10), N''        </table>'', nchar(13), nchar(10), N'' '', nchar(13), nchar(10), N''       <h1>'', nchar(13), nchar(10), N''    ActiveSync, iPhone, iPad</h1>'', nchar(13), nchar(10), N''    <table>'', nchar(13), nchar(10), N''        <tr>'', nchar(13), nchar(10), N''            <td class="Label">Server:</td>'', nchar(13), nchar(10), N''            <td>#ActiveSyncServer#</td>'', nchar(13), nchar(10), N''        </tr>'', nchar(13), nchar(10), N''        <tr>'', nchar(13), nchar(10), N''            <td class="Label">Domain:</td>'', nchar(13), nchar(10), N''            <td>#SamDomain#</td>'', nchar(13), nchar(10), N''        </tr>'', nchar(13), nchar(10), N''        <tr>'', nchar(13), nchar(10), N''            <td class="Label">SSL:</td>'', nchar(13), nchar(10), N''            <td>must be checked</td>'', nchar(13), nchar(10), N''        </tr>'', nchar(13), nchar(10), N''        <tr>'', nchar(13), nchar(10), N''            <td class="Label">Your username:</td>'', nchar(13), nchar(10), N''            <td>#SamUsername#</td>'', nchar(13), nchar(10), N''        </tr>'', nchar(13), CONCAT(CAST(nchar(10) AS nvarchar(max)), N''    </table>'', nchar(13), nchar(10), N'' '', nchar(13), nchar(10), N''    <h1>Password Changes</h1>'', nchar(13), nchar(10), N''    <p>'', nchar(13), nchar(10), N''    Passwords can be changed at any time using Webmail or the <a href="" target="_blank">Control Panel</a>.</p>'', nchar(13), nchar(10), N''    <h1>Control Panel</h1>'', nchar(13), nchar(10), N''    <p>'', nchar(13), nchar(10), N''    If you need to change the details of your account, you can easily do this using <a href="" target="_blank">Control Panel</a>.</p>'', nchar(13), nchar(10), N''    <h1>Support</h1>'', nchar(13), nchar(10), N''    <p>'', nchar(13), nchar(10), N''    You have 2 options, email <a href="mailto:"></a> or use the web interface at <a href=""></a></p>'', nchar(13), nchar(10), N''    '', nchar(13), nchar(10), N''</div>'', nchar(13), nchar(10), N''<!-- End Content -->'', nchar(13), nchar(10), N''<br></td>'', nchar(13), nchar(10), N''</tr>'', nchar(13), nchar(10), N''</tbody>'', nchar(13), nchar(10), N''</table>'', nchar(13), nchar(10), N''</td>'', nchar(13), nchar(10), N''</tr>'', nchar(13), nchar(10), N''</tbody>'', nchar(13), nchar(10), N''</table>'', nchar(13), nchar(10), N''</td>'', nchar(13), nchar(10), N''</tr>'', nchar(13), nchar(10), N''<tr>'', nchar(13), nchar(10), N''<td style="background-color: ##ffffff; border-top: 1px solid ##999999;">'', nchar(13), nchar(10), N''<table border="0" cellspacing="0" cellpadding="0" width="100%">'', nchar(13), nchar(10), N''<tbody>'', nchar(13), nchar(10), N''<tr>'', nchar(13), nchar(10), N''<td style="vertical-align: top; padding: 0px 20px 15px 20px;">'', nchar(13), nchar(10), N''<table border="0" cellspacing="0" cellpadding="0" width="100%">'', nchar(13), nchar(10), N''<tbody>'', nchar(13), nchar(10), N''<tr>'', nchar(13), nchar(10), N''<td style="font-family: Arial, Helvetica, sans-serif; text-align: left; font-size: 9px; color: ##717073; padding: 20px 0px 0px 0px;">'', nchar(13), nchar(10), N''<table border="0" cellspacing="0" cellpadding="0" width="100%">'', nchar(13), nchar(10), N''<tbody>'', nchar(13), nchar(10), N''<tr>'', nchar(13), nchar(10), N''<td style="font-family: Arial, Helvetica, sans-serif; font-size: 9px; text-align: left; color: ##1666af; vertical-align: top;" width="33%"><a style="font-weight: bold; text-transform: uppercase; text-decoration: underline; color: ##1666af;" href=""></a><br />Learn more about the services can provide to improve your business.</td>'', nchar(13), nchar(10), N''<td style="font-family: Arial, Helvetica, sans-serif; font-size: 9px; text-align: left; color: ##1666af; padding: 0px 10px 0px 10px; vertical-align: top;" width="34%"><a style="font-weight: bold; text-transform: uppercase; text-decoration: underline; color: ##1666af;" href="">Privacy Policy</a><br /> follows strict guidelines in protecting your privacy. Learn about our <a style="font-weight: bold; text-decoration: underline; color: ##1666af;" href="">Privacy Policy</a>.</td>'', nchar(13), nchar(10), N''<td style="font-family: Arial, Helvetica, sans-serif; font-size: 9px; text-align: left; color: ##1666af; vertical-align: top;" width="33%"><a style="font-weight: bold; text-transform: uppercase; text-decoration: underline; color: ##1666af;" href="">Contact Us</a><br />Questions? For more information, <a style="font-weight: bold; text-decoration: underline; color: ##1666af;" href="">contact us</a>.</td>'', nchar(13), nchar(10), N''</tr>'', nchar(13), nchar(10), N''</tbody>'', nchar(13), nchar(10), N''</table>'', nchar(13), nchar(10), N''</td>'', nchar(13), nchar(10), N''</tr>'', nchar(13), nchar(10), N''</tbody>'', nchar(13), nchar(10), N''</table>'', nchar(13), nchar(10), N''</td>'', nchar(13), nchar(10), N''</tr>'', nchar(13), nchar(10), N''</tbody>'', nchar(13), nchar(10), N''</table>'', nchar(13), nchar(10), N''</td>'', nchar(13), nchar(10), N''</tr>'', nchar(13), nchar(10), N''</tbody>'', nchar(13), nchar(10), N''</table>'', nchar(13), nchar(10), N''</td>'', nchar(13), nchar(10), N''</tr>'', nchar(13), nchar(10), N''</tbody>'', nchar(13), nchar(10), N''</table>'', nchar(13), nchar(10), N''</body>'', nchar(13), nchar(10), N''</html>'')))),
    (N''Priority'', N''ExchangeMailboxSetupLetter'', 1, N''Normal''),
    (N''Subject'', N''ExchangeMailboxSetupLetter'', 1, N'' Hosted Exchange Mailbox Setup''),
    (N''TextBody'', N''ExchangeMailboxSetupLetter'', 1, CONCAT(CAST(N''<ad:if test="#Email#">'' AS nvarchar(max)), nchar(13), nchar(10), N''Hello #Account.DisplayName#,'', nchar(13), nchar(10), nchar(13), nchar(10), N''Thanks for choosing as your Exchange hosting provider.'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), N''<ad:if test="#not(PMM)#">'', nchar(13), nchar(10), N''User Accounts'', nchar(13), nchar(10), nchar(13), nchar(10), N''The following user accounts have been created for you.'', nchar(13), nchar(10), nchar(13), nchar(10), N''Username: #Account.UserPrincipalName#'', nchar(13), nchar(10), N''E-mail: #Account.PrimaryEmailAddress#'', nchar(13), nchar(10), N''<ad:if test="#PswResetUrl#">'', nchar(13), nchar(10), N''Password Reset Url: #PswResetUrl#'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), N''================================='', nchar(13), nchar(10), N''DNS'', nchar(13), nchar(10), N''================================='', nchar(13), nchar(10), nchar(13), nchar(10), N''In order for us to accept mail for your domain, you will need to point your MX records to:'', nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:foreach collection="#SmtpServers#" var="SmtpServer" index="i">#SmtpServer#</ad:foreach>'', nchar(13), nchar(10), nchar(13), nchar(10), N''================================='', nchar(13), nchar(10), N''Webmail (OWA, Outlook Web Access)'', nchar(13), nchar(10), N''================================='', nchar(13), nchar(10), nchar(13), nchar(10), nchar(13), nchar(10), nchar(13), nchar(10), N''================================='', nchar(13), nchar(10), N''Outlook (Windows Clients)'', nchar(13), nchar(10), N''================================='', nchar(13), nchar(10), nchar(13), nchar(10), N''To configure MS Outlook to work with servers, please reference:'', nchar(13), nchar(10), nchar(13), nchar(10), nchar(13), nchar(10), nchar(13), nchar(10), N''If you need to download and install the MS Outlook client:'', nchar(13), nchar(10), nchar(13), nchar(10), N''MS Outlook Download URL:'', nchar(13), nchar(10), nchar(13), nchar(10), N''KEY: '', nchar(13), nchar(10), nchar(13), nchar(10), N''================================='', nchar(13), nchar(10), N''ActiveSync, iPhone, iPad'', nchar(13), nchar(10), N''================================='', nchar(13), nchar(10), nchar(13), nchar(10), N''Server: #ActiveSyncServer#'', nchar(13), nchar(10), N''Domain: #SamDomain#'', nchar(13), nchar(10), N''SSL: must be checked'', nchar(13), nchar(10), N''Your username: #SamUsername#'', nchar(13), nchar(10), nchar(13), nchar(10), N''================================='', nchar(13), nchar(10), N''Password Changes'', nchar(13), nchar(10), N''================================='', nchar(13), nchar(10), nchar(13), nchar(10), N''Passwords can be changed at any time using Webmail or the Control Panel'', nchar(13), nchar(10), nchar(13), nchar(10), nchar(13), nchar(10), N''================================='', nchar(13), nchar(10), N''Control Panel'', nchar(13), nchar(10), N''================================='', nchar(13), nchar(10), nchar(13), nchar(10), N''If you need to change the details of your account, you can easily do this using the Control Panel '', nchar(13), nchar(10), nchar(13), nchar(10), nchar(13), nchar(10), N''================================='', nchar(13), nchar(10), N''Support'', nchar(13), nchar(10), N''================================='', nchar(13), nchar(10), nchar(13), nchar(10), N''You have 2 options, email or use the web interface at '')),
    (N''MailboxPasswordPolicy'', N''ExchangePolicy'', 1, N''True;8;20;0;2;0;True''),
    (N''UserNamePolicy'', N''FtpPolicy'', 1, N''True;-;1;20;;;''),
    (N''UserPasswordPolicy'', N''FtpPolicy'', 1, N''True;5;20;0;1;0;True''),
    (N''AccountNamePolicy'', N''MailPolicy'', 1, N''True;;1;50;;;''),
    (N''AccountPasswordPolicy'', N''MailPolicy'', 1, N''True;5;20;0;1;0;False;;0;;;False;False;0;''),
    (N''CatchAllName'', N''MailPolicy'', 1, N''mail''),
    (N''DatabaseNamePolicy'', N''MariaDBPolicy'', 1, N''True;;1;40;;;''),
    (N''UserNamePolicy'', N''MariaDBPolicy'', 1, N''True;;1;16;;;''),
    (N''UserPasswordPolicy'', N''MariaDBPolicy'', 1, N''True;5;20;0;1;0;False;;0;;;False;False;0;'');
    INSERT INTO [UserSettings] ([PropertyName], [SettingsName], [UserID], [PropertyValue])
    VALUES (N''DatabaseNamePolicy'', N''MsSqlPolicy'', 1, N''True;-;1;120;;;''),
    (N''UserNamePolicy'', N''MsSqlPolicy'', 1, N''True;-;1;120;;;''),
    (N''UserPasswordPolicy'', N''MsSqlPolicy'', 1, N''True;5;20;0;1;0;True;;0;0;0;False;False;0;''),
    (N''DatabaseNamePolicy'', N''MySqlPolicy'', 1, N''True;;1;40;;;''),
    (N''UserNamePolicy'', N''MySqlPolicy'', 1, N''True;;1;16;;;''),
    (N''UserPasswordPolicy'', N''MySqlPolicy'', 1, N''True;5;20;0;1;0;False;;0;0;0;False;False;0;''),
    (N''From'', N''OrganizationUserPasswordRequestLetter'', 1, N''support@HostingCompany.com''),
    (N''HtmlBody'', N''OrganizationUserPasswordRequestLetter'', 1, CONCAT(CAST(N''<html xmlns="http://www.w3.org/1999/xhtml">'' AS nvarchar(max)), nchar(13), nchar(10), N''<head>'', nchar(13), nchar(10), N''    <title>Password request notification</title>'', nchar(13), nchar(10), N''    <style type="text/css">'', nchar(13), nchar(10), N''		.Summary { background-color: ##ffffff; padding: 5px; }'', nchar(13), nchar(10), N''		.Summary .Header { padding: 10px 0px 10px 10px; font-size: 16pt; background-color: ##E5F2FF; color: ##1F4978; border-bottom: solid 2px ##86B9F7; }'', nchar(13), nchar(10), N''        .Summary A { color: ##0153A4; }'', nchar(13), nchar(10), N''        .Summary { font-family: Tahoma; font-size: 9pt; }'', nchar(13), nchar(10), N''        .Summary H1 { font-size: 1.7em; color: ##1F4978; border-bottom: dotted 3px ##efefef; }'', nchar(13), nchar(10), N''        .Summary H2 { font-size: 1.3em; color: ##1F4978; } '', nchar(13), nchar(10), N''        .Summary TABLE { border: solid 1px ##e5e5e5; }'', nchar(13), nchar(10), N''        .Summary TH,'', nchar(13), nchar(10), N''        .Summary TD.Label { padding: 5px; font-size: 8pt; font-weight: bold; background-color: ##f5f5f5; }'', nchar(13), nchar(10), N''        .Summary TD { padding: 8px; font-size: 9pt; }'', nchar(13), nchar(10), N''        .Summary UL LI { font-size: 1.1em; font-weight: bold; }'', nchar(13), nchar(10), N''        .Summary UL UL LI { font-size: 0.9em; font-weight: normal; }'', nchar(13), nchar(10), N''    </style>'', nchar(13), nchar(10), N''</head>'', nchar(13), nchar(10), N''<body>'', nchar(13), nchar(10), N''<div class="Summary">'', nchar(13), nchar(10), N''<div class="Header">'', nchar(13), nchar(10), N''<img src="#logoUrl#">'', nchar(13), nchar(10), N''</div>'', nchar(13), nchar(10), N''<h1>Password request notification</h1>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:if test="#user#">'', nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''Hello #user.FirstName#,'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''Your account have been created. In order to create a password for your account, please follow next link:'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<a href="#passwordResetLink#" target="_blank">#passwordResetLink#</a>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''If you have any questions regarding your hosting account, feel free to contact our support department at any time.'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''Best regards'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), N''</div>'', nchar(13), nchar(10), N''</body>'')),
    (N''LogoUrl'', N''OrganizationUserPasswordRequestLetter'', 1, N''''),
    (N''Priority'', N''OrganizationUserPasswordRequestLetter'', 1, N''Normal''),
    (N''SMSBody'', N''OrganizationUserPasswordRequestLetter'', 1, CONCAT(CAST(nchar(13) AS nvarchar(max)), nchar(10), N''User have been created. Password request url:'', nchar(13), nchar(10), N''#passwordResetLink#'')),
    (N''Subject'', N''OrganizationUserPasswordRequestLetter'', 1, N''Password request notification''),
    (N''TextBody'', N''OrganizationUserPasswordRequestLetter'', 1, CONCAT(CAST(N''========================================='' AS nvarchar(max)), nchar(13), nchar(10), N''   Password request notification'', nchar(13), nchar(10), N''========================================='', nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:if test="#user#">'', nchar(13), nchar(10), N''Hello #user.FirstName#,'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), N''Your account have been created. In order to create a password for your account, please follow next link:'', nchar(13), nchar(10), nchar(13), nchar(10), N''#passwordResetLink#'', nchar(13), nchar(10), nchar(13), nchar(10), N''If you have any questions regarding your hosting account, feel free to contact our support department at any time.'', nchar(13), nchar(10), nchar(13), nchar(10), N''Best regards'')),
    (N''DsnNamePolicy'', N''OsPolicy'', 1, N''True;-;2;40;;;''),
    (N''CC'', N''PackageSummaryLetter'', 1, N''support@HostingCompany.com''),
    (N''EnableLetter'', N''PackageSummaryLetter'', 1, N''True''),
    (N''From'', N''PackageSummaryLetter'', 1, N''support@HostingCompany.com''),
    (N''Priority'', N''PackageSummaryLetter'', 1, N''Normal''),
    (N''Subject'', N''PackageSummaryLetter'', 1, N''"#space.Package.PackageName#" <ad:if test="#Signup#">hosting space has been created for<ad:else>hosting space summary for</ad:if> #user.FirstName# #user.LastName#''),
    (N''CC'', N''PasswordReminderLetter'', 1, N''''),
    (N''From'', N''PasswordReminderLetter'', 1, N''support@HostingCompany.com''),
    (N''HtmlBody'', N''PasswordReminderLetter'', 1, CONCAT(CAST(N''<html xmlns="http://www.w3.org/1999/xhtml">'' AS nvarchar(max)), nchar(13), nchar(10), N''<head>'', nchar(13), nchar(10), N''    <title>Account Summary Information</title>'', nchar(13), nchar(10), N''    <style type="text/css">'', nchar(13), nchar(10), N''		.Summary { background-color: ##ffffff; padding: 5px; }'', nchar(13), nchar(10), N''		.Summary .Header { padding: 10px 0px 10px 10px; font-size: 16pt; background-color: ##E5F2FF; color: ##1F4978; border-bottom: solid 2px ##86B9F7; }'', nchar(13), nchar(10), N''        .Summary A { color: ##0153A4; }'', nchar(13), nchar(10), N''        .Summary { font-family: Tahoma; font-size: 9pt; }'', nchar(13), nchar(10), N''        .Summary H1 { font-size: 1.7em; color: ##1F4978; border-bottom: dotted 3px ##efefef; }'', nchar(13), nchar(10), N''        .Summary H2 { font-size: 1.3em; color: ##1F4978; }'', nchar(13), nchar(10), N''        .Summary TABLE { border: solid 1px ##e5e5e5; }'', nchar(13), nchar(10), N''        .Summary TH,'', nchar(13), nchar(10), N''        .Summary TD.Label { padding: 5px; font-size: 8pt; font-weight: bold; background-color: ##f5f5f5; }'', nchar(13), nchar(10), N''        .Summary TD { padding: 8px; font-size: 9pt; }'', nchar(13), nchar(10), N''        .Summary UL LI { font-size: 1.1em; font-weight: bold; }'', nchar(13), nchar(10), N''        .Summary UL UL LI { font-size: 0.9em; font-weight: normal; }'', nchar(13), nchar(10), N''    </style>'', nchar(13), nchar(10), N''</head>'', nchar(13), nchar(10), N''<body>'', nchar(13), nchar(10), N''<div class="Summary">'', nchar(13), nchar(10), nchar(13), nchar(10), N''<a name="top"></a>'', nchar(13), nchar(10), N''<div class="Header">'', nchar(13), nchar(10), N''	Hosting Account Information'', nchar(13), nchar(10), N''</div>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''Hello #user.FirstName#,'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''Please, find below details of your control panel account. The one time password was generated for you. You should change the password after login. '', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<h1>Control Panel URL</h1>'', nchar(13), nchar(10), N''<table>'', nchar(13), nchar(10), N''    <thead>'', nchar(13), nchar(10), N''        <tr>'', nchar(13), nchar(10), N''            <th>Control Panel URL</th>'', nchar(13), nchar(10), N''            <th>Username</th>'', nchar(13), nchar(10), N''            <th>One Time Password</th>'', nchar(13), nchar(10), N''        </tr>'', nchar(13), nchar(10), N''    </thead>'', nchar(13), nchar(10), N''    <tbody>'', nchar(13), nchar(10), N''        <tr>'', nchar(13), nchar(10), N''            <td><a href="http://panel.HostingCompany.com">http://panel.HostingCompany.com</a></td>'', nchar(13), nchar(10), N''            <td>#user.Username#</td>'', nchar(13), nchar(10), N''            <td>#user.Password#</td>'', nchar(13), nchar(10), N''        </tr>'', nchar(13), nchar(10), N''    </tbody>'', nchar(13), nchar(10), N''</table>'', nchar(13), nchar(10), nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''If you have any questions regarding your hosting account, feel free to contact our support department at any time.'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''Best regards,<br />'', nchar(13), nchar(10), N''SolidCP.<br />'', nchar(13), nchar(10), N''Web Site: <a href="https://solidcp.com">https://solidcp.com</a><br />'', nchar(13), nchar(10), N''E-Mail: <a href="mailto:support@solidcp.com">support@solidcp.com</a>'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), nchar(13), nchar(10), N''</div>'', nchar(13), nchar(10), N''</body>'', nchar(13), nchar(10), N''</html>'')),
    (N''Priority'', N''PasswordReminderLetter'', 1, N''Normal''),
    (N''Subject'', N''PasswordReminderLetter'', 1, N''Password reminder for #user.FirstName# #user.LastName#''),
    (N''TextBody'', N''PasswordReminderLetter'', 1, CONCAT(CAST(N''================================='' AS nvarchar(max)), nchar(13), nchar(10), N''   Hosting Account Information'', nchar(13), nchar(10), N''================================='', nchar(13), nchar(10), nchar(13), nchar(10), N''Hello #user.FirstName#,'', nchar(13), nchar(10), nchar(13), nchar(10), N''Please, find below details of your control panel account. The one time password was generated for you. You should change the password after login.'', nchar(13), nchar(10), nchar(13), nchar(10), N''Control Panel URL: https://panel.solidcp.com'', nchar(13), nchar(10), N''Username: #user.Username#'', nchar(13), nchar(10), N''One Time Password: #user.Password#'', nchar(13), nchar(10), nchar(13), nchar(10), N''If you have any questions regarding your hosting account, feel free to contact our support department at any time.'', nchar(13), nchar(10), nchar(13), nchar(10), N''Best regards,'', nchar(13), nchar(10), N''SolidCP.'', nchar(13), nchar(10), N''Web Site: https://solidcp.com"'', nchar(13), nchar(10), N''E-Mail: support@solidcp.com'')),
    (N''CC'', N''RDSSetupLetter'', 1, N''support@HostingCompany.com''),
    (N''From'', N''RDSSetupLetter'', 1, N''support@HostingCompany.com''),
    (N''HtmlBody'', N''RDSSetupLetter'', 1, CONCAT(CAST(N''<html xmlns="http://www.w3.org/1999/xhtml">'' AS nvarchar(max)), nchar(13), nchar(10), N''<head>'', nchar(13), nchar(10), N''    <title>RDS Setup Information</title>'', nchar(13), nchar(10), N''    <style type="text/css">'', nchar(13), nchar(10), N''		.Summary { background-color: ##ffffff; padding: 5px; }'', nchar(13), nchar(10), N''		.Summary .Header { padding: 10px 0px 10px 10px; font-size: 16pt; background-color: ##E5F2FF; color: ##1F4978; border-bottom: solid 2px ##86B9F7; }'', nchar(13), nchar(10), N''        .Summary A { color: ##0153A4; }'', nchar(13), nchar(10), N''        .Summary { font-family: Tahoma; font-size: 9pt; }'', nchar(13), nchar(10), N''        .Summary H1 { font-size: 1.7em; color: ##1F4978; border-bottom: dotted 3px ##efefef; }'', nchar(13), nchar(10), N''        .Summary H2 { font-size: 1.3em; color: ##1F4978; } '', nchar(13), nchar(10), N''        .Summary TABLE { border: solid 1px ##e5e5e5; }'', nchar(13), nchar(10), N''        .Summary TH,'', nchar(13), nchar(10), N''        .Summary TD.Label { padding: 5px; font-size: 8pt; font-weight: bold; background-color: ##f5f5f5; }'', nchar(13), nchar(10), N''        .Summary TD { padding: 8px; font-size: 9pt; }'', nchar(13), nchar(10), N''        .Summary UL LI { font-size: 1.1em; font-weight: bold; }'', nchar(13), nchar(10), N''        .Summary UL UL LI { font-size: 0.9em; font-weight: normal; }'', nchar(13), nchar(10), N''    </style>'', nchar(13), nchar(10), N''</head>'', nchar(13), nchar(10), N''<body>'', nchar(13), nchar(10), N''<div class="Summary">'', nchar(13), nchar(10), nchar(13), nchar(10), N''<a name="top"></a>'', nchar(13), nchar(10), N''<div class="Header">'', nchar(13), nchar(10), N''	RDS Setup Information'', nchar(13), nchar(10), N''</div>'', nchar(13), nchar(10), N''</div>'', nchar(13), nchar(10), N''</body>'')),
    (N''Priority'', N''RDSSetupLetter'', 1, N''Normal''),
    (N''Subject'', N''RDSSetupLetter'', 1, N''RDS setup''),
    (N''TextBody'', N''RDSSetupLetter'', 1, CONCAT(CAST(N''================================='' AS nvarchar(max)), nchar(13), nchar(10), N''   RDS Setup Information'', nchar(13), nchar(10), N''================================='', nchar(13), nchar(10), N''<ad:if test="#user#">'', nchar(13), nchar(10), N''Hello #user.FirstName#,'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), N''Please, find below RDS setup instructions.'', nchar(13), nchar(10), nchar(13), nchar(10), N''If you have any questions, feel free to contact our support department at any time.'', nchar(13), nchar(10), nchar(13), nchar(10), N''Best regards'')),
    (N''GroupNamePolicy'', N''SharePointPolicy'', 1, N''True;-;1;20;;;''),
    (N''UserNamePolicy'', N''SharePointPolicy'', 1, N''True;-;1;20;;;''),
    (N''UserPasswordPolicy'', N''SharePointPolicy'', 1, N''True;5;20;0;1;0;True;;0;;;False;False;0;''),
    (N''DemoMessage'', N''SolidCPPolicy'', 1, CONCAT(CAST(N''When user account is in demo mode the majority of operations are'' AS nvarchar(max)), nchar(13), nchar(10), N''disabled, especially those ones that modify or delete records.'', nchar(13), nchar(10), N''You are welcome to ask your questions or place comments about'', nchar(13), nchar(10), N''this demo on  <a href="http://forum.SolidCP.net"'', nchar(13), nchar(10), N''target="_blank">SolidCP  Support Forum</a>'')),
    (N''ForbiddenIP'', N''SolidCPPolicy'', 1, N''''),
    (N''PasswordPolicy'', N''SolidCPPolicy'', 1, N''True;6;20;0;1;0;True;;0;;;False;False;0;''),
    (N''From'', N''UserPasswordExpirationLetter'', 1, N''support@HostingCompany.com''),
    (N''HtmlBody'', N''UserPasswordExpirationLetter'', 1, CONCAT(CAST(N''<html xmlns="http://www.w3.org/1999/xhtml">'' AS nvarchar(max)), nchar(13), nchar(10), N''<head>'', nchar(13), nchar(10), N''    <title>Password expiration notification</title>'', nchar(13), nchar(10), N''    <style type="text/css">'', nchar(13), nchar(10), N''		.Summary { background-color: ##ffffff; padding: 5px; }'', nchar(13), nchar(10), N''		.Summary .Header { padding: 10px 0px 10px 10px; font-size: 16pt; background-color: ##E5F2FF; color: ##1F4978; border-bottom: solid 2px ##86B9F7; }'', nchar(13), nchar(10), N''        .Summary A { color: ##0153A4; }'', nchar(13), nchar(10), N''        .Summary { font-family: Tahoma; font-size: 9pt; }'', nchar(13), nchar(10), N''        .Summary H1 { font-size: 1.7em; color: ##1F4978; border-bottom: dotted 3px ##efefef; }'', nchar(13), nchar(10), N''        .Summary H2 { font-size: 1.3em; color: ##1F4978; } '', nchar(13), nchar(10), N''        .Summary TABLE { border: solid 1px ##e5e5e5; }'', nchar(13), nchar(10), N''        .Summary TH,'', nchar(13), nchar(10), N''        .Summary TD.Label { padding: 5px; font-size: 8pt; font-weight: bold; background-color: ##f5f5f5; }'', nchar(13), nchar(10), N''        .Summary TD { padding: 8px; font-size: 9pt; }'', nchar(13), nchar(10), N''        .Summary UL LI { font-size: 1.1em; font-weight: bold; }'', nchar(13), nchar(10), N''        .Summary UL UL LI { font-size: 0.9em; font-weight: normal; }'', nchar(13), nchar(10), N''    </style>'', nchar(13), nchar(10), N''</head>'', nchar(13), nchar(10), N''<body>'', nchar(13), nchar(10), N''<div class="Summary">'', nchar(13), nchar(10), N''<div class="Header">'', nchar(13), nchar(10), N''<img src="#logoUrl#">'', nchar(13), nchar(10), N''</div>'', nchar(13), nchar(10), N''<h1>Password expiration notification</h1>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:if test="#user#">'', nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''Hello #user.FirstName#,'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''Your password expiration date is #user.PasswordExpirationDateTime#. You can reset your own password by visiting the following page:'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<a href="#passwordResetLink#" target="_blank">#passwordResetLink#</a>'', nchar(13), nchar(10), nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''If you have any questions regarding your hosting account, feel free to contact our support department at any time.'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''Best regards'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), N''</div>'', nchar(13), nchar(10), N''</body>'')),
    (N''LogoUrl'', N''UserPasswordExpirationLetter'', 1, N''''),
    (N''Priority'', N''UserPasswordExpirationLetter'', 1, N''Normal''),
    (N''Subject'', N''UserPasswordExpirationLetter'', 1, N''Password expiration notification'');
    INSERT INTO [UserSettings] ([PropertyName], [SettingsName], [UserID], [PropertyValue])
    VALUES (N''TextBody'', N''UserPasswordExpirationLetter'', 1, CONCAT(CAST(N''========================================='' AS nvarchar(max)), nchar(13), nchar(10), N''   Password expiration notification'', nchar(13), nchar(10), N''========================================='', nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:if test="#user#">'', nchar(13), nchar(10), N''Hello #user.FirstName#,'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), N''Your password expiration date is #user.PasswordExpirationDateTime#. You can reset your own password by visiting the following page:'', nchar(13), nchar(10), nchar(13), nchar(10), N''#passwordResetLink#'', nchar(13), nchar(10), nchar(13), nchar(10), N''If you have any questions regarding your hosting account, feel free to contact our support department at any time.'', nchar(13), nchar(10), nchar(13), nchar(10), N''Best regards'')),
    (N''From'', N''UserPasswordResetLetter'', 1, N''support@HostingCompany.com''),
    (N''HtmlBody'', N''UserPasswordResetLetter'', 1, CONCAT(CAST(N''<html xmlns="http://www.w3.org/1999/xhtml">'' AS nvarchar(max)), nchar(13), nchar(10), N''<head>'', nchar(13), nchar(10), N''    <title>Password reset notification</title>'', nchar(13), nchar(10), N''    <style type="text/css">'', nchar(13), nchar(10), N''		.Summary { background-color: ##ffffff; padding: 5px; }'', nchar(13), nchar(10), N''		.Summary .Header { padding: 10px 0px 10px 10px; font-size: 16pt; background-color: ##E5F2FF; color: ##1F4978; border-bottom: solid 2px ##86B9F7; }'', nchar(13), nchar(10), N''        .Summary A { color: ##0153A4; }'', nchar(13), nchar(10), N''        .Summary { font-family: Tahoma; font-size: 9pt; }'', nchar(13), nchar(10), N''        .Summary H1 { font-size: 1.7em; color: ##1F4978; border-bottom: dotted 3px ##efefef; }'', nchar(13), nchar(10), N''        .Summary H2 { font-size: 1.3em; color: ##1F4978; } '', nchar(13), nchar(10), N''        .Summary TABLE { border: solid 1px ##e5e5e5; }'', nchar(13), nchar(10), N''        .Summary TH,'', nchar(13), nchar(10), N''        .Summary TD.Label { padding: 5px; font-size: 8pt; font-weight: bold; background-color: ##f5f5f5; }'', nchar(13), nchar(10), N''        .Summary TD { padding: 8px; font-size: 9pt; }'', nchar(13), nchar(10), N''        .Summary UL LI { font-size: 1.1em; font-weight: bold; }'', nchar(13), nchar(10), N''        .Summary UL UL LI { font-size: 0.9em; font-weight: normal; }'', nchar(13), nchar(10), N''    </style>'', nchar(13), nchar(10), N''</head>'', nchar(13), nchar(10), N''<body>'', nchar(13), nchar(10), N''<div class="Summary">'', nchar(13), nchar(10), N''<div class="Header">'', nchar(13), nchar(10), N''<img src="#logoUrl#">'', nchar(13), nchar(10), N''</div>'', nchar(13), nchar(10), N''<h1>Password reset notification</h1>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:if test="#user#">'', nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''Hello #user.FirstName#,'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''We received a request to reset the password for your account. If you made this request, click the link below. If you did not make this request, you can ignore this email.'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<a href="#passwordResetLink#" target="_blank">#passwordResetLink#</a>'', nchar(13), nchar(10), nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''If you have any questions regarding your hosting account, feel free to contact our support department at any time.'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''Best regards'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), N''</div>'', nchar(13), nchar(10), N''</body>'')),
    (N''LogoUrl'', N''UserPasswordResetLetter'', 1, N''''),
    (N''PasswordResetLinkSmsBody'', N''UserPasswordResetLetter'', 1, CONCAT(CAST(N''Password reset link:'' AS nvarchar(max)), nchar(13), nchar(10), N''#passwordResetLink#'', nchar(13), nchar(10))),
    (N''Priority'', N''UserPasswordResetLetter'', 1, N''Normal''),
    (N''Subject'', N''UserPasswordResetLetter'', 1, N''Password reset notification''),
    (N''TextBody'', N''UserPasswordResetLetter'', 1, CONCAT(CAST(N''========================================='' AS nvarchar(max)), nchar(13), nchar(10), N''   Password reset notification'', nchar(13), nchar(10), N''========================================='', nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:if test="#user#">'', nchar(13), nchar(10), N''Hello #user.FirstName#,'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), N''We received a request to reset the password for your account. If you made this request, click the link below. If you did not make this request, you can ignore this email.'', nchar(13), nchar(10), nchar(13), nchar(10), N''#passwordResetLink#'', nchar(13), nchar(10), nchar(13), nchar(10), N''If you have any questions regarding your hosting account, feel free to contact our support department at any time.'', nchar(13), nchar(10), nchar(13), nchar(10), N''Best regards'')),
    (N''From'', N''UserPasswordResetPincodeLetter'', 1, N''support@HostingCompany.com''),
    (N''HtmlBody'', N''UserPasswordResetPincodeLetter'', 1, CONCAT(CAST(N''<html xmlns="http://www.w3.org/1999/xhtml">'' AS nvarchar(max)), nchar(13), nchar(10), N''<head>'', nchar(13), nchar(10), N''    <title>Password reset notification</title>'', nchar(13), nchar(10), N''    <style type="text/css">'', nchar(13), nchar(10), N''		.Summary { background-color: ##ffffff; padding: 5px; }'', nchar(13), nchar(10), N''		.Summary .Header { padding: 10px 0px 10px 10px; font-size: 16pt; background-color: ##E5F2FF; color: ##1F4978; border-bottom: solid 2px ##86B9F7; }'', nchar(13), nchar(10), N''        .Summary A { color: ##0153A4; }'', nchar(13), nchar(10), N''        .Summary { font-family: Tahoma; font-size: 9pt; }'', nchar(13), nchar(10), N''        .Summary H1 { font-size: 1.7em; color: ##1F4978; border-bottom: dotted 3px ##efefef; }'', nchar(13), nchar(10), N''        .Summary H2 { font-size: 1.3em; color: ##1F4978; } '', nchar(13), nchar(10), N''        .Summary TABLE { border: solid 1px ##e5e5e5; }'', nchar(13), nchar(10), N''        .Summary TH,'', nchar(13), nchar(10), N''        .Summary TD.Label { padding: 5px; font-size: 8pt; font-weight: bold; background-color: ##f5f5f5; }'', nchar(13), nchar(10), N''        .Summary TD { padding: 8px; font-size: 9pt; }'', nchar(13), nchar(10), N''        .Summary UL LI { font-size: 1.1em; font-weight: bold; }'', nchar(13), nchar(10), N''        .Summary UL UL LI { font-size: 0.9em; font-weight: normal; }'', nchar(13), nchar(10), N''    </style>'', nchar(13), nchar(10), N''</head>'', nchar(13), nchar(10), N''<body>'', nchar(13), nchar(10), N''<div class="Summary">'', nchar(13), nchar(10), N''<div class="Header">'', nchar(13), nchar(10), N''<img src="#logoUrl#">'', nchar(13), nchar(10), N''</div>'', nchar(13), nchar(10), N''<h1>Password reset notification</h1>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:if test="#user#">'', nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''Hello #user.FirstName#,'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''We received a request to reset the password for your account. Your password reset pincode:'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), nchar(13), nchar(10), N''#passwordResetPincode#'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''If you have any questions regarding your hosting account, feel free to contact our support department at any time.'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''Best regards'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), N''</div>'', nchar(13), nchar(10), N''</body>'')),
    (N''LogoUrl'', N''UserPasswordResetPincodeLetter'', 1, N''''),
    (N''PasswordResetPincodeSmsBody'', N''UserPasswordResetPincodeLetter'', 1, CONCAT(CAST(nchar(13) AS nvarchar(max)), nchar(10), N''Your password reset pincode:'', nchar(13), nchar(10), N''#passwordResetPincode#'')),
    (N''Priority'', N''UserPasswordResetPincodeLetter'', 1, N''Normal''),
    (N''Subject'', N''UserPasswordResetPincodeLetter'', 1, N''Password reset notification''),
    (N''TextBody'', N''UserPasswordResetPincodeLetter'', 1, CONCAT(CAST(N''========================================='' AS nvarchar(max)), nchar(13), nchar(10), N''   Password reset notification'', nchar(13), nchar(10), N''========================================='', nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:if test="#user#">'', nchar(13), nchar(10), N''Hello #user.FirstName#,'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), N''We received a request to reset the password for your account. Your password reset pincode:'', nchar(13), nchar(10), nchar(13), nchar(10), N''#passwordResetPincode#'', nchar(13), nchar(10), nchar(13), nchar(10), N''If you have any questions regarding your hosting account, feel free to contact our support department at any time.'', nchar(13), nchar(10), nchar(13), nchar(10), N''Best regards'')),
    (N''CC'', N''VerificationCodeLetter'', 1, N''support@HostingCompany.com''),
    (N''From'', N''VerificationCodeLetter'', 1, N''support@HostingCompany.com''),
    (N''HtmlBody'', N''VerificationCodeLetter'', 1, CONCAT(CAST(N''<html xmlns="http://www.w3.org/1999/xhtml">'' AS nvarchar(max)), nchar(13), nchar(10), N''<head>'', nchar(13), nchar(10), N''    <title>Verification code</title>'', nchar(13), nchar(10), N''    <style type="text/css">'', nchar(13), nchar(10), N''		.Summary { background-color: ##ffffff; padding: 5px; }'', nchar(13), nchar(10), N''		.Summary .Header { padding: 10px 0px 10px 10px; font-size: 16pt; background-color: ##E5F2FF; color: ##1F4978; border-bottom: solid 2px ##86B9F7; }'', nchar(13), nchar(10), N''        .Summary A { color: ##0153A4; }'', nchar(13), nchar(10), N''        .Summary { font-family: Tahoma; font-size: 9pt; }'', nchar(13), nchar(10), N''        .Summary H1 { font-size: 1.7em; color: ##1F4978; border-bottom: dotted 3px ##efefef; }'', nchar(13), nchar(10), N''        .Summary H2 { font-size: 1.3em; color: ##1F4978; }'', nchar(13), nchar(10), N''        .Summary TABLE { border: solid 1px ##e5e5e5; }'', nchar(13), nchar(10), N''        .Summary TH,'', nchar(13), nchar(10), N''        .Summary TD.Label { padding: 5px; font-size: 8pt; font-weight: bold; background-color: ##f5f5f5; }'', nchar(13), nchar(10), N''        .Summary TD { padding: 8px; font-size: 9pt; }'', nchar(13), nchar(10), N''        .Summary UL LI { font-size: 1.1em; font-weight: bold; }'', nchar(13), nchar(10), N''        .Summary UL UL LI { font-size: 0.9em; font-weight: normal; }'', nchar(13), nchar(10), N''    </style>'', nchar(13), nchar(10), N''</head>'', nchar(13), nchar(10), N''<body>'', nchar(13), nchar(10), N''<div class="Summary">'', nchar(13), nchar(10), nchar(13), nchar(10), N''<a name="top"></a>'', nchar(13), nchar(10), N''<div class="Header">'', nchar(13), nchar(10), N''	Verification code'', nchar(13), nchar(10), N''</div>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''Hello #user.FirstName#,'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''to complete the sign in, enter the verification code on the device. '', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<table>'', nchar(13), nchar(10), N''    <thead>'', nchar(13), nchar(10), N''        <tr>'', nchar(13), nchar(10), N''            <th>Verification code</th>'', nchar(13), nchar(10), N''        </tr>'', nchar(13), nchar(10), N''    </thead>'', nchar(13), nchar(10), N''    <tbody>'', nchar(13), nchar(10), N''        <tr>'', nchar(13), nchar(10), N''            <td>#verificationCode#</td>'', nchar(13), nchar(10), N''        </tr>'', nchar(13), nchar(10), N''    </tbody>'', nchar(13), nchar(10), N''</table>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''Best regards,<br />'', nchar(13), nchar(10), nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), nchar(13), nchar(10), N''</div>'', nchar(13), nchar(10), N''</body>'', nchar(13), nchar(10), N''</html>'')),
    (N''Priority'', N''VerificationCodeLetter'', 1, N''Normal''),
    (N''Subject'', N''VerificationCodeLetter'', 1, N''Verification code''),
    (N''TextBody'', N''VerificationCodeLetter'', 1, CONCAT(CAST(N''================================='' AS nvarchar(max)), nchar(13), nchar(10), N''   Verification code'', nchar(13), nchar(10), N''================================='', nchar(13), nchar(10), N''<ad:if test="#user#">'', nchar(13), nchar(10), N''Hello #user.FirstName#,'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), N''to complete the sign in, enter the verification code on the device.'', nchar(13), nchar(10), nchar(13), nchar(10), N''Verification code'', nchar(13), nchar(10), N''#verificationCode#'', nchar(13), nchar(10), nchar(13), nchar(10), N''Best regards,'', nchar(13), nchar(10))),
    (N''AddParkingPage'', N''WebPolicy'', 1, N''True''),
    (N''AddRandomDomainString'', N''WebPolicy'', 1, N''False''),
    (N''AnonymousAccountPolicy'', N''WebPolicy'', 1, N''True;;5;20;;_web;''),
    (N''AspInstalled'', N''WebPolicy'', 1, N''True''),
    (N''AspNetInstalled'', N''WebPolicy'', 1, N''2''),
    (N''CgiBinInstalled'', N''WebPolicy'', 1, N''False''),
    (N''DefaultDocuments'', N''WebPolicy'', 1, N''Default.htm,Default.asp,index.htm,Default.aspx''),
    (N''EnableAnonymousAccess'', N''WebPolicy'', 1, N''True''),
    (N''EnableBasicAuthentication'', N''WebPolicy'', 1, N''False''),
    (N''EnableDedicatedPool'', N''WebPolicy'', 1, N''False''),
    (N''EnableDirectoryBrowsing'', N''WebPolicy'', 1, N''False''),
    (N''EnableParentPaths'', N''WebPolicy'', 1, N''False''),
    (N''EnableParkingPageTokens'', N''WebPolicy'', 1, N''False''),
    (N''EnableWindowsAuthentication'', N''WebPolicy'', 1, N''True''),
    (N''EnableWritePermissions'', N''WebPolicy'', 1, N''False''),
    (N''FrontPageAccountPolicy'', N''WebPolicy'', 1, N''True;;1;20;;;''),
    (N''FrontPagePasswordPolicy'', N''WebPolicy'', 1, N''True;5;20;0;1;0;False;;0;0;0;False;False;0;''),
    (N''ParkingPageContent'', N''WebPolicy'', 1, CONCAT(CAST(N''<html xmlns="http://www.w3.org/1999/xhtml">'' AS nvarchar(max)), nchar(13), nchar(10), N''<head>'', nchar(13), nchar(10), N''    <title>The web site is under construction</title>'', nchar(13), nchar(10), N''<style type="text/css">'', nchar(13), nchar(10), N''	H1 { font-size: 16pt; margin-bottom: 4px; }'', nchar(13), nchar(10), N''	H2 { font-size: 14pt; margin-bottom: 4px; font-weight: normal; }'', nchar(13), nchar(10), N''</style>'', nchar(13), nchar(10), N''</head>'', nchar(13), nchar(10), N''<body>'', nchar(13), nchar(10), N''<div id="PageOutline">'', nchar(13), nchar(10), N''	<h1>This web site has just been created from <a href="https://www.SolidCP.com">SolidCP </a> and it is still under construction.</h1>'', nchar(13), nchar(10), N''	<h2>The web site is hosted by <a href="https://solidcp.com">SolidCP</a>.</h2>'', nchar(13), nchar(10), N''</div>'', nchar(13), nchar(10), N''</body>'', nchar(13), nchar(10), N''</html>'')),
    (N''ParkingPageName'', N''WebPolicy'', 1, N''default.aspx''),
    (N''PerlInstalled'', N''WebPolicy'', 1, N''False''),
    (N''PhpInstalled'', N''WebPolicy'', 1, N'''');
    INSERT INTO [UserSettings] ([PropertyName], [SettingsName], [UserID], [PropertyValue])
    VALUES (N''PublishingProfile'', N''WebPolicy'', 1, CONCAT(CAST(N''<?xml version="1.0" encoding="utf-8"?>'' AS nvarchar(max)), nchar(13), nchar(10), N''<publishData>'', nchar(13), nchar(10), N''<ad:if test="#WebSite.WebDeploySitePublishingEnabled#">'', nchar(13), nchar(10), N''	<publishProfile'', nchar(13), nchar(10), N''		profileName="#WebSite.Name# - Web Deploy"'', nchar(13), nchar(10), N''		publishMethod="MSDeploy"'', nchar(13), nchar(10), N''		publishUrl="#WebSite["WmSvcServiceUrl"]#:#WebSite["WmSvcServicePort"]#"'', nchar(13), nchar(10), N''		msdeploySite="#WebSite.Name#"'', nchar(13), nchar(10), N''		userName="#WebSite.WebDeployPublishingAccount#"'', nchar(13), nchar(10), N''		userPWD="#WebSite.WebDeployPublishingPassword#"'', nchar(13), nchar(10), N''		destinationAppUrl="http://#WebSite.Name#/"'', nchar(13), nchar(10), N''		<ad:if test="#Not(IsNull(MsSqlDatabase)) and Not(IsNull(MsSqlUser))#">SQLServerDBConnectionString="server=#MsSqlServerExternalAddress#;database=#MsSqlDatabase.Name#;uid=#MsSqlUser.Name#;pwd=#MsSqlUser.Password#"</ad:if>'', nchar(13), nchar(10), N''		<ad:if test="#Not(IsNull(MySqlDatabase)) and Not(IsNull(MySqlUser))#">mySQLDBConnectionString="server=#MySqlAddress#;database=#MySqlDatabase.Name#;uid=#MySqlUser.Name#;pwd=#MySqlUser.Password#"</ad:if>'', nchar(13), nchar(10), N''		<ad:if test="#Not(IsNull(MariaDBDatabase)) and Not(IsNull(MariaDBUser))#">MariaDBDBConnectionString="server=#MariaDBAddress#;database=#MariaDBDatabase.Name#;uid=#MariaDBUser.Name#;pwd=#MariaDBUser.Password#"</ad:if>'', nchar(13), nchar(10), N''		hostingProviderForumLink="https://solidcp.com/support"'', nchar(13), nchar(10), N''		controlPanelLink="https://panel.solidcp.com/"'', nchar(13), nchar(10), N''	/>'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), N''<ad:if test="#IsDefined("FtpAccount")#">'', nchar(13), nchar(10), N''	<publishProfile'', nchar(13), nchar(10), N''		profileName="#WebSite.Name# - FTP"'', nchar(13), nchar(10), N''		publishMethod="FTP"'', nchar(13), nchar(10), N''		publishUrl="ftp://#FtpServiceAddress#"'', nchar(13), nchar(10), N''		ftpPassiveMode="True"'', nchar(13), nchar(10), N''		userName="#FtpAccount.Name#"'', nchar(13), nchar(10), N''		userPWD="#FtpAccount.Password#"'', nchar(13), nchar(10), N''		destinationAppUrl="http://#WebSite.Name#/"'', nchar(13), nchar(10), N''		<ad:if test="#Not(IsNull(MsSqlDatabase)) and Not(IsNull(MsSqlUser))#">SQLServerDBConnectionString="server=#MsSqlServerExternalAddress#;database=#MsSqlDatabase.Name#;uid=#MsSqlUser.Name#;pwd=#MsSqlUser.Password#"</ad:if>'', nchar(13), nchar(10), N''		<ad:if test="#Not(IsNull(MySqlDatabase)) and Not(IsNull(MySqlUser))#">mySQLDBConnectionString="server=#MySqlAddress#;database=#MySqlDatabase.Name#;uid=#MySqlUser.Name#;pwd=#MySqlUser.Password#"</ad:if>'', nchar(13), nchar(10), N''		<ad:if test="#Not(IsNull(MariaDBDatabase)) and Not(IsNull(MariaDBUser))#">MariaDBDBConnectionString="server=#MariaDBAddress#;database=#MariaDBDatabase.Name#;uid=#MariaDBUser.Name#;pwd=#MariaDBUser.Password#"</ad:if>'', nchar(13), nchar(10), N''		hostingProviderForumLink="https://solidcp.com/support"'', nchar(13), nchar(10), N''		controlPanelLink="https://panel.solidcp.com/"'', nchar(13), nchar(10), N''    />'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), N''</publishData>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<!--'', nchar(13), nchar(10), N''Control Panel:'', nchar(13), nchar(10), N''Username: #User.Username#'', nchar(13), nchar(10), N''Password: #User.Password#'', nchar(13), nchar(10), nchar(13), nchar(10), N''Technical Contact:'', nchar(13), nchar(10), N''support@solidcp.com'', nchar(13), nchar(10), N''-->'')),
    (N''PythonInstalled'', N''WebPolicy'', 1, N''False''),
    (N''SecuredGroupNamePolicy'', N''WebPolicy'', 1, N''True;;1;20;;;''),
    (N''SecuredUserNamePolicy'', N''WebPolicy'', 1, N''True;;1;20;;;''),
    (N''SecuredUserPasswordPolicy'', N''WebPolicy'', 1, N''True;5;20;0;1;0;False;;0;0;0;False;False;0;''),
    (N''VirtDirNamePolicy'', N''WebPolicy'', 1, N''True;-;3;50;;;''),
    (N''WebDataFolder'', N''WebPolicy'', 1, N''\[DOMAIN_NAME]\data''),
    (N''WebLogsFolder'', N''WebPolicy'', 1, N''\[DOMAIN_NAME]\logs''),
    (N''WebRootFolder'', N''WebPolicy'', 1, N''\[DOMAIN_NAME]\wwwroot'')');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'PropertyName', N'SettingsName', N'UserID', N'PropertyValue') AND [object_id] = OBJECT_ID(N'[UserSettings]'))
        SET IDENTITY_INSERT [UserSettings] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'PackageID', N'ParentPackageID') AND [object_id] = OBJECT_ID(N'[PackagesTreeCache]'))
        SET IDENTITY_INSERT [PackagesTreeCache] ON;
    EXEC(N'INSERT INTO [PackagesTreeCache] ([PackageID], [ParentPackageID])
    VALUES (1, 1)');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'PackageID', N'ParentPackageID') AND [object_id] = OBJECT_ID(N'[PackagesTreeCache]'))
        SET IDENTITY_INSERT [PackagesTreeCache] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'QuotaID', N'GroupID', N'HideQuota', N'ItemTypeID', N'PerOrganization', N'QuotaDescription', N'QuotaName', N'QuotaOrder', N'QuotaTypeID', N'ServiceQuota') AND [object_id] = OBJECT_ID(N'[Quotas]'))
        SET IDENTITY_INSERT [Quotas] ON;
    EXEC(N'INSERT INTO [Quotas] ([QuotaID], [GroupID], [HideQuota], [ItemTypeID], [PerOrganization], [QuotaDescription], [QuotaName], [QuotaOrder], [QuotaTypeID], [ServiceQuota])
    VALUES (2, 6, NULL, 7, NULL, N''Databases'', N''MySQL4.Databases'', 1, 2, CAST(1 AS bit)),
    (3, 5, NULL, 5, NULL, N''Databases'', N''MsSQL2000.Databases'', 1, 2, CAST(1 AS bit)),
    (4, 3, NULL, 9, NULL, N''FTP Accounts'', N''FTP.Accounts'', 1, 2, CAST(1 AS bit)),
    (12, 8, NULL, 14, NULL, N''Statistics Sites'', N''Stats.Sites'', 1, 2, CAST(1 AS bit)),
    (13, 2, NULL, 10, NULL, N''Web Sites'', N''Web.Sites'', 1, 2, CAST(1 AS bit)),
    (14, 4, NULL, 15, NULL, N''Mail Accounts'', N''Mail.Accounts'', 1, 2, CAST(1 AS bit)),
    (15, 5, NULL, 6, NULL, N''Users'', N''MsSQL2000.Users'', 2, 2, CAST(0 AS bit)),
    (18, 4, NULL, 16, NULL, N''Mail Forwardings'', N''Mail.Forwardings'', 3, 2, CAST(0 AS bit)),
    (19, 6, NULL, 8, NULL, N''Users'', N''MySQL4.Users'', 2, 2, CAST(0 AS bit)),
    (20, 4, NULL, 17, NULL, N''Mail Lists'', N''Mail.Lists'', 6, 2, CAST(0 AS bit)),
    (24, 4, NULL, 18, NULL, N''Mail Groups'', N''Mail.Groups'', 4, 2, CAST(0 AS bit)),
    (47, 1, NULL, 20, NULL, N''ODBC DSNs'', N''OS.ODBC'', 6, 2, CAST(0 AS bit)),
    (59, 2, NULL, 25, NULL, N''Shared SSL Folders'', N''Web.SharedSSL'', 8, 2, CAST(0 AS bit)),
    (62, 10, NULL, 21, NULL, N''Databases'', N''MsSQL2005.Databases'', 1, 2, CAST(0 AS bit)),
    (63, 10, NULL, 22, NULL, N''Users'', N''MsSQL2005.Users'', 2, 2, CAST(0 AS bit)),
    (68, 11, NULL, 23, NULL, N''Databases'', N''MySQL5.Databases'', 1, 2, CAST(0 AS bit)),
    (69, 11, NULL, 24, NULL, N''Users'', N''MySQL5.Users'', 2, 2, CAST(0 AS bit)),
    (110, 90, NULL, 75, NULL, N''Databases'', N''MySQL8.Databases'', 1, 2, CAST(0 AS bit)),
    (111, 90, NULL, 76, NULL, N''Users'', N''MySQL8.Users'', 2, 2, CAST(0 AS bit)),
    (200, 20, NULL, 200, 1, N''SharePoint Site Collections'', N''HostedSharePoint.Sites'', 1, 2, CAST(0 AS bit)),
    (205, 13, NULL, 29, NULL, N''Organizations'', N''HostedSolution.Organizations'', 1, 2, CAST(0 AS bit)),
    (206, 13, NULL, 30, 1, N''Users'', N''HostedSolution.Users'', 2, 2, CAST(0 AS bit)),
    (211, 22, NULL, 31, NULL, N''Databases'', N''MsSQL2008.Databases'', 1, 2, CAST(0 AS bit)),
    (212, 22, NULL, 32, NULL, N''Users'', N''MsSQL2008.Users'', 2, 2, CAST(0 AS bit)),
    (218, 23, NULL, 37, NULL, N''Databases'', N''MsSQL2012.Databases'', 1, 2, CAST(0 AS bit)),
    (219, 23, NULL, 38, NULL, N''Users'', N''MsSQL2012.Users'', 2, 2, CAST(0 AS bit)),
    (300, 30, NULL, 33, NULL, N''Number of VPS'', N''VPS.ServersNumber'', 1, 2, CAST(0 AS bit)),
    (345, 40, NULL, 35, NULL, N''Number of VPS'', N''VPSForPC.ServersNumber'', 1, 2, CAST(0 AS bit)),
    (470, 46, NULL, 39, NULL, N''Databases'', N''MsSQL2014.Databases'', 1, 2, CAST(0 AS bit)),
    (471, 46, NULL, 40, NULL, N''Users'', N''MsSQL2014.Users'', 2, 2, CAST(0 AS bit)),
    (550, 73, NULL, 204, 1, N''SharePoint Site Collections'', N''HostedSharePointEnterprise.Sites'', 1, 2, CAST(0 AS bit)),
    (553, 33, NULL, 41, NULL, N''Number of VPS'', N''VPS2012.ServersNumber'', 1, 2, CAST(0 AS bit)),
    (573, 50, NULL, 202, NULL, N''Databases'', N''MariaDB.Databases'', 1, 2, CAST(0 AS bit)),
    (574, 50, NULL, 203, NULL, N''Users'', N''MariaDB.Users'', 2, 2, CAST(0 AS bit)),
    (673, 167, NULL, 41, NULL, N''Number of VPS'', N''PROXMOX.ServersNumber'', 1, 2, CAST(0 AS bit)),
    (701, 71, NULL, 39, NULL, N''Databases'', N''MsSQL2016.Databases'', 1, 2, CAST(0 AS bit)),
    (702, 71, NULL, 40, NULL, N''Users'', N''MsSQL2016.Users'', 2, 2, CAST(0 AS bit)),
    (711, 72, NULL, 73, NULL, N''Databases'', N''MsSQL2017.Databases'', 1, 2, CAST(0 AS bit)),
    (712, 72, NULL, 74, NULL, N''Users'', N''MsSQL2017.Users'', 2, 2, CAST(0 AS bit)),
    (721, 74, NULL, 77, NULL, N''Databases'', N''MsSQL2019.Databases'', 1, 2, CAST(0 AS bit)),
    (722, 74, NULL, 78, NULL, N''Users'', N''MsSQL2019.Users'', 2, 2, CAST(0 AS bit)),
    (732, 75, NULL, 79, NULL, N''Databases'', N''MsSQL2022.Databases'', 1, 2, CAST(0 AS bit));
    INSERT INTO [Quotas] ([QuotaID], [GroupID], [HideQuota], [ItemTypeID], [PerOrganization], [QuotaDescription], [QuotaName], [QuotaOrder], [QuotaTypeID], [ServiceQuota])
    VALUES (733, 75, NULL, 80, NULL, N''Users'', N''MsSQL2022.Users'', 2, 2, CAST(0 AS bit))');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'QuotaID', N'GroupID', N'HideQuota', N'ItemTypeID', N'PerOrganization', N'QuotaDescription', N'QuotaName', N'QuotaOrder', N'QuotaTypeID', N'ServiceQuota') AND [object_id] = OBJECT_ID(N'[Quotas]'))
        SET IDENTITY_INSERT [Quotas] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ScheduleID', N'Enabled', N'FromTime', N'HistoriesNumber', N'Interval', N'LastRun', N'MaxExecutionTime', N'NextRun', N'PackageID', N'PriorityID', N'ScheduleName', N'ScheduleTypeID', N'StartTime', N'TaskID', N'ToTime', N'WeekMonthDay') AND [object_id] = OBJECT_ID(N'[Schedule]'))
        SET IDENTITY_INSERT [Schedule] ON;
    EXEC(N'INSERT INTO [Schedule] ([ScheduleID], [Enabled], [FromTime], [HistoriesNumber], [Interval], [LastRun], [MaxExecutionTime], [NextRun], [PackageID], [PriorityID], [ScheduleName], [ScheduleTypeID], [StartTime], [TaskID], [ToTime], [WeekMonthDay])
    VALUES (1, CAST(1 AS bit), ''2000-01-01T12:00:00.000'', 7, 0, NULL, 3600, ''2010-07-16T14:53:02.470'', 1, N''Normal'', N''Calculate Disk Space'', N''Daily'', ''2000-01-01T12:30:00.000'', N''SCHEDULE_TASK_CALCULATE_PACKAGES_DISKSPACE'', ''2000-01-01T12:00:00.000'', 1),
    (2, CAST(1 AS bit), ''2000-01-01T12:00:00.000'', 7, 0, NULL, 3600, ''2010-07-16T14:53:02.477'', 1, N''Normal'', N''Calculate Bandwidth'', N''Daily'', ''2000-01-01T12:00:00.000'', N''SCHEDULE_TASK_CALCULATE_PACKAGES_BANDWIDTH'', ''2000-01-01T12:00:00.000'', 1)');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ScheduleID', N'Enabled', N'FromTime', N'HistoriesNumber', N'Interval', N'LastRun', N'MaxExecutionTime', N'NextRun', N'PackageID', N'PriorityID', N'ScheduleName', N'ScheduleTypeID', N'StartTime', N'TaskID', N'ToTime', N'WeekMonthDay') AND [object_id] = OBJECT_ID(N'[Schedule]'))
        SET IDENTITY_INSERT [Schedule] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'PropertyName', N'ProviderID', N'PropertyValue') AND [object_id] = OBJECT_ID(N'[ServiceDefaultProperties]'))
        SET IDENTITY_INSERT [ServiceDefaultProperties] ON;
    EXEC(N'INSERT INTO [ServiceDefaultProperties] ([PropertyName], [ProviderID], [PropertyValue])
    VALUES (N''UsersHome'', 1, N''%SYSTEMDRIVE%\HostingSpaces''),
    (N''AspNet11Path'', 2, N''%SYSTEMROOT%\Microsoft.NET\Framework\v1.1.4322\aspnet_isapi.dll''),
    (N''AspNet11Pool'', 2, N''ASP.NET V1.1''),
    (N''AspNet20Path'', 2, N''%SYSTEMROOT%\Microsoft.NET\Framework\v2.0.50727\aspnet_isapi.dll''),
    (N''AspNet20Pool'', 2, N''ASP.NET V2.0''),
    (N''AspNet40Path'', 2, N''%SYSTEMROOT%\Microsoft.NET\Framework\v4.0.30319\aspnet_isapi.dll''),
    (N''AspNet40Pool'', 2, N''ASP.NET V4.0''),
    (N''AspPath'', 2, N''%SYSTEMROOT%\System32\InetSrv\asp.dll''),
    (N''CFFlashRemotingDirectory'', 2, N''C:\ColdFusion9\runtime\lib\wsconfig\1''),
    (N''CFScriptsDirectory'', 2, N''C:\Inetpub\wwwroot\CFIDE''),
    (N''ColdFusionPath'', 2, N''C:\ColdFusion9\runtime\lib\wsconfig\jrun_iis6.dll''),
    (N''GalleryXmlFeedUrl'', 2, N''''),
    (N''PerlPath'', 2, N''%SYSTEMDRIVE%\Perl\bin\Perl.exe''),
    (N''Php4Path'', 2, N''%PROGRAMFILES%\PHP\php.exe''),
    (N''Php5Path'', 2, N''%PROGRAMFILES%\PHP\php-cgi.exe''),
    (N''ProtectedAccessFile'', 2, N''.htaccess''),
    (N''ProtectedFoldersFile'', 2, N''.htfolders''),
    (N''ProtectedGroupsFile'', 2, N''.htgroup''),
    (N''ProtectedUsersFile'', 2, N''.htpasswd''),
    (N''PythonPath'', 2, N''%SYSTEMDRIVE%\Python\python.exe''),
    (N''SecuredFoldersFilterPath'', 2, N''%SYSTEMROOT%\System32\InetSrv\IISPasswordFilter.dll''),
    (N''WebGroupName'', 2, N''SCPWebUsers''),
    (N''FtpGroupName'', 3, N''SCPFtpUsers''),
    (N''SiteId'', 3, N''MSFTPSVC/1''),
    (N''DatabaseLocation'', 5, N''%SYSTEMDRIVE%\SQL2000Databases\[USER_NAME]''),
    (N''ExternalAddress'', 5, N''(local)''),
    (N''InternalAddress'', 5, N''(local)''),
    (N''SaLogin'', 5, N''sa''),
    (N''SaPassword'', 5, N''''),
    (N''UseDefaultDatabaseLocation'', 5, N''True''),
    (N''UseTrustedConnection'', 5, N''True''),
    (N''ExternalAddress'', 6, N''localhost''),
    (N''InstallFolder'', 6, N''%PROGRAMFILES%\MySQL\MySQL Server 4.1''),
    (N''InternalAddress'', 6, N''localhost,3306''),
    (N''RootLogin'', 6, N''root''),
    (N''RootPassword'', 6, N''''),
    (N''ExpireLimit'', 7, N''1209600''),
    (N''MinimumTTL'', 7, N''86400''),
    (N''NameServers'', 7, N''ns1.yourdomain.com;ns2.yourdomain.com''),
    (N''RefreshInterval'', 7, N''3600''),
    (N''ResponsiblePerson'', 7, N''hostmaster.[DOMAIN_NAME]''),
    (N''RetryDelay'', 7, N''600'');
    INSERT INTO [ServiceDefaultProperties] ([PropertyName], [ProviderID], [PropertyValue])
    VALUES (N''AwStatsFolder'', 8, N''%SYSTEMDRIVE%\AWStats\wwwroot\cgi-bin''),
    (N''BatchFileName'', 8, N''UpdateStats.bat''),
    (N''BatchLineTemplate'', 8, N''%SYSTEMDRIVE%\perl\bin\perl.exe awstats.pl config=[DOMAIN_NAME] -update''),
    (N''ConfigFileName'', 8, N''awstats.[DOMAIN_NAME].conf''),
    (N''ConfigFileTemplate'', 8, CONCAT(CAST(N''LogFormat = "%time2 %other %other %other %method %url %other %other %logname %host %other %ua %other %referer %other %code %other %other %bytesd %other %other"'' AS nvarchar(max)), nchar(13), nchar(10), N''LogSeparator = " "'', nchar(13), nchar(10), N''DNSLookup = 2'', nchar(13), nchar(10), N''DirCgi = "/cgi-bin"'', nchar(13), nchar(10), N''DirIcons = "/icon"'', nchar(13), nchar(10), N''AllowFullYearView=3'', nchar(13), nchar(10), N''AllowToUpdateStatsFromBrowser = 0'', nchar(13), nchar(10), N''UseFramesWhenCGI = 1'', nchar(13), nchar(10), N''ShowFlagLinks = "en fr de it nl es"'', nchar(13), nchar(10), N''LogFile = "[LOGS_FOLDER]\ex%YY-3%MM-3%DD-3.log"'', nchar(13), nchar(10), N''DirData = "%SYSTEMDRIVE%\AWStats\data"'', nchar(13), nchar(10), N''SiteDomain = "[DOMAIN_NAME]"'', nchar(13), nchar(10), N''HostAliases = [DOMAIN_ALIASES]'')),
    (N''StatisticsURL'', 8, N''http://127.0.0.1/AWStats/cgi-bin/awstats.pl?config=[domain_name]''),
    (N''AdminLogin'', 9, N''Admin''),
    (N''ExpireLimit'', 9, N''1209600''),
    (N''MinimumTTL'', 9, N''86400''),
    (N''NameServers'', 9, N''ns1.yourdomain.com;ns2.yourdomain.com''),
    (N''RefreshInterval'', 9, N''3600''),
    (N''ResponsiblePerson'', 9, N''hostmaster.[DOMAIN_NAME]''),
    (N''RetryDelay'', 9, N''600''),
    (N''SimpleDnsUrl'', 9, N''http://127.0.0.1:8053''),
    (N''LogDeleteDays'', 10, N''0''),
    (N''LogFormat'', 10, N''W3Cex''),
    (N''LogWildcard'', 10, N''*.log''),
    (N''Password'', 10, N''''),
    (N''ServerID'', 10, N''1''),
    (N''SmarterLogDeleteMonths'', 10, N''0''),
    (N''SmarterLogsPath'', 10, N''%SYSTEMDRIVE%\SmarterLogs''),
    (N''SmarterUrl'', 10, N''http://127.0.0.1:9999/services''),
    (N''StatisticsURL'', 10, N''http://127.0.0.1:9999/Login.aspx?txtSiteID=[site_id]&txtUser=[username]&txtPass=[password]&shortcutLink=autologin''),
    (N''TimeZoneId'', 10, N''27''),
    (N''Username'', 10, N''Admin''),
    (N''AdminPassword'', 11, N''''),
    (N''AdminUsername'', 11, N''admin''),
    (N''DomainsPath'', 11, N''%SYSTEMDRIVE%\SmarterMail''),
    (N''ServerIPAddress'', 11, N''127.0.0.1;127.0.0.1''),
    (N''ServiceUrl'', 11, N''http://127.0.0.1:9998/services''),
    (N''InstallFolder'', 12, N''%PROGRAMFILES%\Gene6 FTP Server''),
    (N''LogsFolder'', 12, N''%PROGRAMFILES%\Gene6 FTP Server\Log''),
    (N''AdminPassword'', 14, N''''),
    (N''AdminUsername'', 14, N''admin''),
    (N''DomainsPath'', 14, N''%SYSTEMDRIVE%\SmarterMail''),
    (N''ServerIPAddress'', 14, N''127.0.0.1;127.0.0.1''),
    (N''ServiceUrl'', 14, N''http://127.0.0.1:9998/services''),
    (N''BrowseMethod'', 16, N''POST''),
    (N''BrowseParameters'', 16, CONCAT(CAST(N''ServerName=[SERVER]'' AS nvarchar(max)), nchar(13), nchar(10), N''Login=[USER]'', nchar(13), nchar(10), N''Password=[PASSWORD]'', nchar(13), nchar(10), N''Protocol=dbmssocn'')),
    (N''BrowseURL'', 16, N''http://localhost/MLA/silentlogon.aspx''),
    (N''DatabaseLocation'', 16, N''%SYSTEMDRIVE%\SQL2005Databases\[USER_NAME]''),
    (N''ExternalAddress'', 16, N''(local)'');
    INSERT INTO [ServiceDefaultProperties] ([PropertyName], [ProviderID], [PropertyValue])
    VALUES (N''InternalAddress'', 16, N''(local)''),
    (N''SaLogin'', 16, N''sa''),
    (N''SaPassword'', 16, N''''),
    (N''UseDefaultDatabaseLocation'', 16, N''True''),
    (N''UseTrustedConnection'', 16, N''True''),
    (N''ExternalAddress'', 17, N''localhost''),
    (N''InstallFolder'', 17, N''%PROGRAMFILES%\MySQL\MySQL Server 5.0''),
    (N''InternalAddress'', 17, N''localhost,3306''),
    (N''RootLogin'', 17, N''root''),
    (N''RootPassword'', 17, N''''),
    (N''AdminPassword'', 22, N''''),
    (N''AdminUsername'', 22, N''Administrator''),
    (N''BindConfigPath'', 24, N''c:\BIND\dns\etc\named.conf''),
    (N''BindReloadBatch'', 24, N''c:\BIND\dns\reload.bat''),
    (N''ExpireLimit'', 24, N''1209600''),
    (N''MinimumTTL'', 24, N''86400''),
    (N''NameServers'', 24, N''ns1.yourdomain.com;ns2.yourdomain.com''),
    (N''RefreshInterval'', 24, N''3600''),
    (N''ResponsiblePerson'', 24, N''hostmaster.[DOMAIN_NAME]''),
    (N''RetryDelay'', 24, N''600''),
    (N''ZoneFileNameTemplate'', 24, N''db.[domain_name].txt''),
    (N''ZonesFolderPath'', 24, N''c:\BIND\dns\zones''),
    (N''DomainId'', 25, N''1''),
    (N''KeepDeletedItemsDays'', 27, N''14''),
    (N''KeepDeletedMailboxesDays'', 27, N''30''),
    (N''MailboxDatabase'', 27, N''Hosted Exchange Database''),
    (N''RootOU'', 27, N''SCP Hosting''),
    (N''StorageGroup'', 27, N''Hosted Exchange Storage Group''),
    (N''TempDomain'', 27, N''my-temp-domain.com''),
    (N''AdminLogin'', 28, N''Admin''),
    (N''ExpireLimit'', 28, N''1209600''),
    (N''MinimumTTL'', 28, N''86400''),
    (N''NameServers'', 28, N''ns1.yourdomain.com;ns2.yourdomain.com''),
    (N''RefreshInterval'', 28, N''3600''),
    (N''ResponsiblePerson'', 28, N''hostmaster.[DOMAIN_NAME]''),
    (N''RetryDelay'', 28, N''600''),
    (N''SimpleDnsUrl'', 28, N''http://127.0.0.1:8053''),
    (N''AdminPassword'', 29, N'' ''),
    (N''AdminUsername'', 29, N''admin''),
    (N''DomainsPath'', 29, N''%SYSTEMDRIVE%\SmarterMail''),
    (N''ServerIPAddress'', 29, N''127.0.0.1;127.0.0.1''),
    (N''ServiceUrl'', 29, N''http://localhost:9998/services/'');
    INSERT INTO [ServiceDefaultProperties] ([PropertyName], [ProviderID], [PropertyValue])
    VALUES (N''ExternalAddress'', 30, N''localhost''),
    (N''InstallFolder'', 30, N''%PROGRAMFILES%\MySQL\MySQL Server 5.1''),
    (N''InternalAddress'', 30, N''localhost,3306''),
    (N''RootLogin'', 30, N''root''),
    (N''RootPassword'', 30, N''''),
    (N''LogDeleteDays'', 31, N''0''),
    (N''LogFormat'', 31, N''W3Cex''),
    (N''LogWildcard'', 31, N''*.log''),
    (N''Password'', 31, N''''),
    (N''ServerID'', 31, N''1''),
    (N''SmarterLogDeleteMonths'', 31, N''0''),
    (N''SmarterLogsPath'', 31, N''%SYSTEMDRIVE%\SmarterLogs''),
    (N''SmarterUrl'', 31, N''http://127.0.0.1:9999/services''),
    (N''StatisticsURL'', 31, N''http://127.0.0.1:9999/Login.aspx?txtSiteID=[site_id]&txtUser=[username]&txtPass=[password]&shortcutLink=autologin''),
    (N''TimeZoneId'', 31, N''27''),
    (N''Username'', 31, N''Admin''),
    (N''KeepDeletedItemsDays'', 32, N''14''),
    (N''KeepDeletedMailboxesDays'', 32, N''30''),
    (N''MailboxDatabase'', 32, N''Hosted Exchange Database''),
    (N''RootOU'', 32, N''SCP Hosting''),
    (N''TempDomain'', 32, N''my-temp-domain.com''),
    (N''ExpireLimit'', 56, N''1209600''),
    (N''MinimumTTL'', 56, N''86400''),
    (N''NameServers'', 56, N''ns1.yourdomain.com;ns2.yourdomain.com''),
    (N''PDNSDbName'', 56, N''pdnsdb''),
    (N''PDNSDbPort'', 56, N''3306''),
    (N''PDNSDbServer'', 56, N''localhost''),
    (N''PDNSDbUser'', 56, N''root''),
    (N''RefreshInterval'', 56, N''3600''),
    (N''ResponsiblePerson'', 56, N''hostmaster.[DOMAIN_NAME]''),
    (N''RetryDelay'', 56, N''600''),
    (N''AdminPassword'', 60, N'' ''),
    (N''AdminUsername'', 60, N''admin''),
    (N''DomainsPath'', 60, N''%SYSTEMDRIVE%\SmarterMail''),
    (N''ServerIPAddress'', 60, N''127.0.0.1;127.0.0.1''),
    (N''ServiceUrl'', 60, N''http://localhost:9998/services/''),
    (N''LogDeleteDays'', 62, N''0''),
    (N''LogFormat'', 62, N''W3Cex''),
    (N''LogWildcard'', 62, N''*.log''),
    (N''Password'', 62, N''''),
    (N''ServerID'', 62, N''1''),
    (N''SmarterLogDeleteMonths'', 62, N''0'');
    INSERT INTO [ServiceDefaultProperties] ([PropertyName], [ProviderID], [PropertyValue])
    VALUES (N''SmarterLogsPath'', 62, N''%SYSTEMDRIVE%\SmarterLogs''),
    (N''SmarterUrl'', 62, N''http://127.0.0.1:9999/services''),
    (N''StatisticsURL'', 62, N''http://127.0.0.1:9999/Login.aspx?txtSiteID=[site_id]&txtUser=[username]&txtPass=[password]&shortcutLink=autologin''),
    (N''TimeZoneId'', 62, N''27''),
    (N''Username'', 62, N''Admin''),
    (N''AdminPassword'', 63, N''''),
    (N''AdminUsername'', 63, N''Administrator''),
    (N''AdminPassword'', 64, N''''),
    (N''AdminUsername'', 64, N''admin''),
    (N''DomainsPath'', 64, N''%SYSTEMDRIVE%\SmarterMail''),
    (N''ServerIPAddress'', 64, N''127.0.0.1;127.0.0.1''),
    (N''ServiceUrl'', 64, N''http://localhost:9998/services/''),
    (N''AdminPassword'', 65, N''''),
    (N''AdminUsername'', 65, N''admin''),
    (N''DomainsPath'', 65, N''%SYSTEMDRIVE%\SmarterMail''),
    (N''ServerIPAddress'', 65, N''127.0.0.1;127.0.0.1''),
    (N''ServiceUrl'', 65, N''http://localhost:9998/services/''),
    (N''AdminPassword'', 66, N''''),
    (N''AdminUsername'', 66, N''admin''),
    (N''DomainsPath'', 66, N''%SYSTEMDRIVE%\SmarterMail''),
    (N''ServerIPAddress'', 66, N''127.0.0.1;127.0.0.1''),
    (N''ServiceUrl'', 66, N''http://localhost:9998/services/''),
    (N''AdminPassword'', 67, N''''),
    (N''AdminUsername'', 67, N''admin''),
    (N''DomainsPath'', 67, N''%SYSTEMDRIVE%\SmarterMail\Domains''),
    (N''ServerIPAddress'', 67, N''127.0.0.1;127.0.0.1''),
    (N''ServiceUrl'', 67, N''http://localhost:9998''),
    (N''UsersHome'', 100, N''%SYSTEMDRIVE%\HostingSpaces''),
    (N''AspNet11Pool'', 101, N''ASP.NET 1.1''),
    (N''AspNet40Path'', 101, N''%WINDIR%\Microsoft.NET\Framework\v4.0.30319\aspnet_isapi.dll''),
    (N''AspNet40x64Path'', 101, N''%WINDIR%\Microsoft.NET\Framework64\v4.0.30319\aspnet_isapi.dll''),
    (N''AspNetBitnessMode'', 101, N''32''),
    (N''CFFlashRemotingDirectory'', 101, N''C:\ColdFusion9\runtime\lib\wsconfig\1''),
    (N''CFScriptsDirectory'', 101, N''C:\Inetpub\wwwroot\CFIDE''),
    (N''ClassicAspNet20Pool'', 101, N''ASP.NET 2.0 (Classic)''),
    (N''ClassicAspNet40Pool'', 101, N''ASP.NET 4.0 (Classic)''),
    (N''ColdFusionPath'', 101, N''C:\ColdFusion9\runtime\lib\wsconfig\jrun_iis6.dll''),
    (N''GalleryXmlFeedUrl'', 101, N''''),
    (N''IntegratedAspNet20Pool'', 101, N''ASP.NET 2.0 (Integrated)''),
    (N''IntegratedAspNet40Pool'', 101, N''ASP.NET 4.0 (Integrated)''),
    (N''PerlPath'', 101, N''%SYSTEMDRIVE%\Perl\bin\PerlEx30.dll''),
    (N''Php4Path'', 101, N''%PROGRAMFILES(x86)%\PHP\php.exe'');
    INSERT INTO [ServiceDefaultProperties] ([PropertyName], [ProviderID], [PropertyValue])
    VALUES (N''PhpMode'', 101, N''FastCGI''),
    (N''PhpPath'', 101, N''%PROGRAMFILES(x86)%\PHP\php-cgi.exe''),
    (N''ProtectedGroupsFile'', 101, N''.htgroup''),
    (N''ProtectedUsersFile'', 101, N''.htpasswd''),
    (N''SecureFoldersModuleAssembly'', 101, N''SolidCP.IIsModules.SecureFolders, SolidCP.IIsModules, Version=1.0.0.0, Culture=Neutral, PublicKeyToken=37f9c58a0aa32ff0''),
    (N''WebGroupName'', 101, N''SCP_IUSRS''),
    (N''WmSvc.CredentialsMode'', 101, N''WINDOWS''),
    (N''WmSvc.Port'', 101, N''8172''),
    (N''FtpGroupName'', 102, N''SCPFtpUsers''),
    (N''SiteId'', 102, N''Default FTP Site''),
    (N''UsersHome'', 104, N''%SYSTEMDRIVE%\HostingSpaces''),
    (N''AspNet11Pool'', 105, N''ASP.NET 1.1''),
    (N''AspNet40Path'', 105, N''%WINDIR%\Microsoft.NET\Framework\v4.0.30319\aspnet_isapi.dll''),
    (N''AspNet40x64Path'', 105, N''%WINDIR%\Microsoft.NET\Framework64\v4.0.30319\aspnet_isapi.dll''),
    (N''AspNetBitnessMode'', 105, N''32''),
    (N''CFFlashRemotingDirectory'', 105, N''C:\ColdFusion9\runtime\lib\wsconfig\1''),
    (N''CFScriptsDirectory'', 105, N''C:\Inetpub\wwwroot\CFIDE''),
    (N''ClassicAspNet20Pool'', 105, N''ASP.NET 2.0 (Classic)''),
    (N''ClassicAspNet40Pool'', 105, N''ASP.NET 4.0 (Classic)''),
    (N''ColdFusionPath'', 105, N''C:\ColdFusion9\runtime\lib\wsconfig\jrun_iis6.dll''),
    (N''GalleryXmlFeedUrl'', 105, N''''),
    (N''IntegratedAspNet20Pool'', 105, N''ASP.NET 2.0 (Integrated)''),
    (N''IntegratedAspNet40Pool'', 105, N''ASP.NET 4.0 (Integrated)''),
    (N''PerlPath'', 105, N''%SYSTEMDRIVE%\Perl\bin\PerlEx30.dll''),
    (N''Php4Path'', 105, N''%PROGRAMFILES(x86)%\PHP\php.exe''),
    (N''PhpMode'', 105, N''FastCGI''),
    (N''PhpPath'', 105, N''%PROGRAMFILES(x86)%\PHP\php-cgi.exe''),
    (N''ProtectedGroupsFile'', 105, N''.htgroup''),
    (N''ProtectedUsersFile'', 105, N''.htpasswd''),
    (N''SecureFoldersModuleAssembly'', 105, N''SolidCP.IIsModules.SecureFolders, SolidCP.IIsModules, Version=1.0.0.0, Culture=Neutral, PublicKeyToken=37f9c58a0aa32ff0''),
    (N''sslusesni'', 105, N''True''),
    (N''WebGroupName'', 105, N''SCP_IUSRS''),
    (N''WmSvc.CredentialsMode'', 105, N''WINDOWS''),
    (N''WmSvc.Port'', 105, N''8172''),
    (N''FtpGroupName'', 106, N''SCPFtpUsers''),
    (N''SiteId'', 106, N''Default FTP Site''),
    (N''sslusesni'', 106, N''False''),
    (N''UsersHome'', 111, N''%SYSTEMDRIVE%\HostingSpaces''),
    (N''AspNet11Pool'', 112, N''ASP.NET 1.1''),
    (N''AspNet40Path'', 112, N''%WINDIR%\Microsoft.NET\Framework\v4.0.30319\aspnet_isapi.dll''),
    (N''AspNet40x64Path'', 112, N''%WINDIR%\Microsoft.NET\Framework64\v4.0.30319\aspnet_isapi.dll''),
    (N''AspNetBitnessMode'', 112, N''32'');
    INSERT INTO [ServiceDefaultProperties] ([PropertyName], [ProviderID], [PropertyValue])
    VALUES (N''CFFlashRemotingDirectory'', 112, N''C:\ColdFusion9\runtime\lib\wsconfig\1''),
    (N''CFScriptsDirectory'', 112, N''C:\Inetpub\wwwroot\CFIDE''),
    (N''ClassicAspNet20Pool'', 112, N''ASP.NET 2.0 (Classic)''),
    (N''ClassicAspNet40Pool'', 112, N''ASP.NET 4.0 (Classic)''),
    (N''ColdFusionPath'', 112, N''C:\ColdFusion9\runtime\lib\wsconfig\jrun_iis6.dll''),
    (N''GalleryXmlFeedUrl'', 112, N''''),
    (N''IntegratedAspNet20Pool'', 112, N''ASP.NET 2.0 (Integrated)''),
    (N''IntegratedAspNet40Pool'', 112, N''ASP.NET 4.0 (Integrated)''),
    (N''PerlPath'', 112, N''%SYSTEMDRIVE%\Perl\bin\PerlEx30.dll''),
    (N''Php4Path'', 112, N''%PROGRAMFILES(x86)%\PHP\php.exe''),
    (N''PhpMode'', 112, N''FastCGI''),
    (N''PhpPath'', 112, N''%PROGRAMFILES(x86)%\PHP\php-cgi.exe''),
    (N''ProtectedGroupsFile'', 112, N''.htgroup''),
    (N''ProtectedUsersFile'', 112, N''.htpasswd''),
    (N''SecureFoldersModuleAssembly'', 112, N''SolidCP.IIsModules.SecureFolders, SolidCP.IIsModules, Version=1.0.0.0, Culture=Neutral, PublicKeyToken=37f9c58a0aa32ff0''),
    (N''sslusesni'', 112, N''True''),
    (N''WebGroupName'', 112, N''SCP_IUSRS''),
    (N''WmSvc.CredentialsMode'', 112, N''WINDOWS''),
    (N''WmSvc.Port'', 112, N''8172''),
    (N''FtpGroupName'', 113, N''SCPFtpUsers''),
    (N''SiteId'', 113, N''Default FTP Site''),
    (N''sslusesni'', 113, N''False''),
    (N''RootWebApplicationIpAddress'', 200, N''''),
    (N''UserName'', 204, N''admin''),
    (N''UtilityPath'', 204, N''C:\Program Files\Research In Motion\BlackBerry Enterprise Server Resource Kit\BlackBerry Enterprise Server User Administration Tool''),
    (N''CpuLimit'', 300, N''100''),
    (N''CpuReserve'', 300, N''0''),
    (N''CpuWeight'', 300, N''100''),
    (N''DvdLibraryPath'', 300, N''C:\Hyper-V\Library''),
    (N''ExportedVpsPath'', 300, N''C:\Hyper-V\Exported''),
    (N''HostnamePattern'', 300, N''vps[user_id].hosterdomain.com''),
    (N''OsTemplatesPath'', 300, N''C:\Hyper-V\Templates''),
    (N''PrivateNetworkFormat'', 300, N''192.168.0.1/16''),
    (N''RootFolder'', 300, N''C:\Hyper-V\VirtualMachines\[VPS_HOSTNAME]''),
    (N''StartAction'', 300, N''start''),
    (N''StartupDelay'', 300, N''0''),
    (N''StopAction'', 300, N''shutDown''),
    (N''VirtualDiskType'', 300, N''dynamic''),
    (N''ExternalAddress'', 301, N''localhost''),
    (N''InstallFolder'', 301, N''%PROGRAMFILES%\MySQL\MySQL Server 5.5''),
    (N''InternalAddress'', 301, N''localhost,3306''),
    (N''RootLogin'', 301, N''root'');
    INSERT INTO [ServiceDefaultProperties] ([PropertyName], [ProviderID], [PropertyValue])
    VALUES (N''RootPassword'', 301, N''''),
    (N''ExternalAddress'', 304, N''localhost''),
    (N''InstallFolder'', 304, N''%PROGRAMFILES%\MySQL\MySQL Server 8.0''),
    (N''InternalAddress'', 304, N''localhost,3306''),
    (N''RootLogin'', 304, N''root''),
    (N''RootPassword'', 304, N''''),
    (N''sslmode'', 304, N''True''),
    (N''ExternalAddress'', 305, N''localhost''),
    (N''InstallFolder'', 305, N''%PROGRAMFILES%\MySQL\MySQL Server 8.0''),
    (N''InternalAddress'', 305, N''localhost,3306''),
    (N''RootLogin'', 305, N''root''),
    (N''RootPassword'', 305, N''''),
    (N''sslmode'', 305, N''True''),
    (N''ExternalAddress'', 306, N''localhost''),
    (N''InstallFolder'', 306, N''%PROGRAMFILES%\MySQL\MySQL Server 8.0''),
    (N''InternalAddress'', 306, N''localhost,3306''),
    (N''RootLogin'', 306, N''root''),
    (N''RootPassword'', 306, N''''),
    (N''sslmode'', 306, N''True''),
    (N''admode'', 410, N''False''),
    (N''expirelimit'', 410, N''1209600''),
    (N''minimumttl'', 410, N''86400''),
    (N''nameservers'', 410, N''ns1.yourdomain.com;ns2.yourdomain.com''),
    (N''refreshinterval'', 410, N''3600''),
    (N''responsibleperson'', 410, N''hostmaster.[DOMAIN_NAME]''),
    (N''retrydelay'', 410, N''600''),
    (N''LogDir'', 500, N''/var/log''),
    (N''UsersHome'', 500, N''%HOME%''),
    (N''ExternalAddress'', 1550, N''localhost''),
    (N''InstallFolder'', 1550, N''%PROGRAMFILES%\MariaDB 10.1''),
    (N''InternalAddress'', 1550, N''localhost''),
    (N''RootLogin'', 1550, N''root''),
    (N''RootPassword'', 1550, N''''),
    (N''ExternalAddress'', 1570, N''localhost''),
    (N''InstallFolder'', 1570, N''%PROGRAMFILES%\MariaDB 10.3''),
    (N''InternalAddress'', 1570, N''localhost''),
    (N''RootLogin'', 1570, N''root''),
    (N''RootPassword'', 1570, N''''),
    (N''ExternalAddress'', 1571, N''localhost''),
    (N''InstallFolder'', 1571, N''%PROGRAMFILES%\MariaDB 10.4''),
    (N''InternalAddress'', 1571, N''localhost''),
    (N''RootLogin'', 1571, N''root'');
    INSERT INTO [ServiceDefaultProperties] ([PropertyName], [ProviderID], [PropertyValue])
    VALUES (N''RootPassword'', 1571, N''''),
    (N''ExternalAddress'', 1572, N''localhost''),
    (N''InstallFolder'', 1572, N''%PROGRAMFILES%\MariaDB 10.5''),
    (N''InternalAddress'', 1572, N''localhost''),
    (N''RootLogin'', 1572, N''root''),
    (N''RootPassword'', 1572, N''''),
    (N''ExternalAddress'', 1573, N''localhost''),
    (N''InstallFolder'', 1573, N''%PROGRAMFILES%\MariaDB 10.5''),
    (N''InternalAddress'', 1573, N''localhost''),
    (N''RootLogin'', 1573, N''root''),
    (N''RootPassword'', 1573, N''''),
    (N''UsersHome'', 1800, N''%SYSTEMDRIVE%\HostingSpaces''),
    (N''UsersHome'', 1802, N''%SYSTEMDRIVE%\HostingSpaces''),
    (N''AdminLogin'', 1901, N''Admin''),
    (N''ExpireLimit'', 1901, N''1209600''),
    (N''MinimumTTL'', 1901, N''86400''),
    (N''NameServers'', 1901, N''ns1.yourdomain.com;ns2.yourdomain.com''),
    (N''RefreshInterval'', 1901, N''3600''),
    (N''ResponsiblePerson'', 1901, N''hostmaster.[DOMAIN_NAME]''),
    (N''RetryDelay'', 1901, N''600''),
    (N''SimpleDnsUrl'', 1901, N''http://127.0.0.1:8053''),
    (N''admode'', 1902, N''False''),
    (N''expirelimit'', 1902, N''1209600''),
    (N''minimumttl'', 1902, N''86400''),
    (N''nameservers'', 1902, N''ns1.yourdomain.com;ns2.yourdomain.com''),
    (N''refreshinterval'', 1902, N''3600''),
    (N''responsibleperson'', 1902, N''hostmaster.[DOMAIN_NAME]''),
    (N''retrydelay'', 1902, N''600''),
    (N''ConfigFile'', 1910, N''/etc/vsftpd.conf''),
    (N''BinPath'', 1911, N''''),
    (N''ConfigFile'', 1911, N''/etc/apache2/apache2.conf''),
    (N''ConfigPath'', 1911, N''/etc/apache2'')');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'PropertyName', N'ProviderID', N'PropertyValue') AND [object_id] = OBJECT_ID(N'[ServiceDefaultProperties]'))
        SET IDENTITY_INSERT [ServiceDefaultProperties] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ParameterID', N'ScheduleID', N'ParameterValue') AND [object_id] = OBJECT_ID(N'[ScheduleParameters]'))
        SET IDENTITY_INSERT [ScheduleParameters] ON;
    EXEC(N'INSERT INTO [ScheduleParameters] ([ParameterID], [ScheduleID], [ParameterValue])
    VALUES (N''SUSPEND_OVERUSED'', 1, N''false''),
    (N''SUSPEND_OVERUSED'', 2, N''false'')');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'ParameterID', N'ScheduleID', N'ParameterValue') AND [object_id] = OBJECT_ID(N'[ScheduleParameters]'))
        SET IDENTITY_INSERT [ScheduleParameters] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [AccessTokensIdx_AccountID] ON [AccessTokens] ([AccountID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [BackgroundTaskLogsIdx_TaskID] ON [BackgroundTaskLogs] ([TaskID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [BackgroundTaskParametersIdx_TaskID] ON [BackgroundTaskParameters] ([TaskID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [BackgroundTaskStackIdx_TaskID] ON [BackgroundTaskStack] ([TaskID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [BlackBerryUsersIdx_AccountId] ON [BlackBerryUsers] ([AccountId]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [CommentsIdx_UserID] ON [Comments] ([UserID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [CRMUsersIdx_AccountID] ON [CRMUsers] ([AccountID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [DomainDnsRecordsIdx_DomainId] ON [DomainDnsRecords] ([DomainId]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [DomainsIdx_MailDomainID] ON [Domains] ([MailDomainID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [DomainsIdx_PackageID] ON [Domains] ([PackageID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [DomainsIdx_WebSiteID] ON [Domains] ([WebSiteID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [DomainsIdx_ZoneItemID] ON [Domains] ([ZoneItemID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [EnterpriseFoldersIdx_StorageSpaceFolderId] ON [EnterpriseFolders] ([StorageSpaceFolderId]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [EnterpriseFoldersOwaPermissionsIdx_AccountID] ON [EnterpriseFoldersOwaPermissions] ([AccountID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [EnterpriseFoldersOwaPermissionsIdx_FolderID] ON [EnterpriseFoldersOwaPermissions] ([FolderID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [ExchangeAccountEmailAddressesIdx_AccountID] ON [ExchangeAccountEmailAddresses] ([AccountID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE UNIQUE INDEX [IX_ExchangeAccountEmailAddresses_UniqueEmail] ON [ExchangeAccountEmailAddresses] ([EmailAddress]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [ExchangeAccountsIdx_ItemID] ON [ExchangeAccounts] ([ItemID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [ExchangeAccountsIdx_MailboxPlanId] ON [ExchangeAccounts] ([MailboxPlanId]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE UNIQUE INDEX [IX_ExchangeAccounts_UniqueAccountName] ON [ExchangeAccounts] ([AccountName]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [ExchangeMailboxPlansIdx_ItemID] ON [ExchangeMailboxPlans] ([ItemID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE UNIQUE INDEX [IX_ExchangeMailboxPlans] ON [ExchangeMailboxPlans] ([MailboxPlanId]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [ExchangeOrganizationDomainsIdx_ItemID] ON [ExchangeOrganizationDomains] ([ItemID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    EXEC(N'CREATE UNIQUE INDEX [IX_ExchangeOrganizationDomains_UniqueDomain] ON [ExchangeOrganizationDomains] ([DomainID]) WHERE [DomainID] IS NOT NULL');
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE UNIQUE INDEX [IX_ExchangeOrganizations_UniqueOrg] ON [ExchangeOrganizations] ([OrganizationID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [ExchangeOrganizationSettingsIdx_ItemId] ON [ExchangeOrganizationSettings] ([ItemId]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [ExchangeOrganizationSsFoldersIdx_ItemId] ON [ExchangeOrganizationSsFolders] ([ItemId]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [ExchangeOrganizationSsFoldersIdx_StorageSpaceFolderId] ON [ExchangeOrganizationSsFolders] ([StorageSpaceFolderId]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [GlobalDnsRecordsIdx_IPAddressID] ON [GlobalDnsRecords] ([IPAddressID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [GlobalDnsRecordsIdx_PackageID] ON [GlobalDnsRecords] ([PackageID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [GlobalDnsRecordsIdx_ServerID] ON [GlobalDnsRecords] ([ServerID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [GlobalDnsRecordsIdx_ServiceID] ON [GlobalDnsRecords] ([ServiceID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [IX_HostingPlanQuotas_QuotaID] ON [HostingPlanQuotas] ([QuotaID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [IX_HostingPlanResources_GroupID] ON [HostingPlanResources] ([GroupID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [HostingPlansIdx_PackageID] ON [HostingPlans] ([PackageID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [HostingPlansIdx_ServerID] ON [HostingPlans] ([ServerID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [HostingPlansIdx_UserID] ON [HostingPlans] ([UserID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [IPAddressesIdx_ServerID] ON [IPAddresses] ([ServerID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE UNIQUE INDEX [IX_LyncUserPlans] ON [LyncUserPlans] ([LyncUserPlanId]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [LyncUserPlansIdx_ItemID] ON [LyncUserPlans] ([ItemID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [LyncUsersIdx_LyncUserPlanID] ON [LyncUsers] ([LyncUserPlanID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [PackageAddonsIdx_PackageID] ON [PackageAddons] ([PackageID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [PackageAddonsIdx_PlanID] ON [PackageAddons] ([PlanID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [PackageIPAddressesIdx_AddressID] ON [PackageIPAddresses] ([AddressID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [PackageIPAddressesIdx_ItemID] ON [PackageIPAddresses] ([ItemID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [PackageIPAddressesIdx_PackageID] ON [PackageIPAddresses] ([PackageID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [IX_PackageQuotas_QuotaID] ON [PackageQuotas] ([QuotaID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [IX_PackageResources_GroupID] ON [PackageResources] ([GroupID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [PackageIndex_ParentPackageID] ON [Packages] ([ParentPackageID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [PackageIndex_PlanID] ON [Packages] ([PlanID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [PackageIndex_ServerID] ON [Packages] ([ServerID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [PackageIndex_UserID] ON [Packages] ([UserID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [IX_PackagesBandwidth_GroupID] ON [PackagesBandwidth] ([GroupID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [IX_PackagesDiskspace_GroupID] ON [PackagesDiskspace] ([GroupID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [IX_PackageServices_ServiceID] ON [PackageServices] ([ServiceID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [IX_PackagesTreeCache_PackageID] ON [PackagesTreeCache] ([PackageID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE CLUSTERED INDEX [PackagesTreeCacheIndex] ON [PackagesTreeCache] ([ParentPackageID], [PackageID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [PackageVLANsIdx_PackageID] ON [PackageVLANs] ([PackageID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [PackageVLANsIdx_VlanID] ON [PackageVLANs] ([VlanID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [PrivateIPAddressesIdx_ItemID] ON [PrivateIPAddresses] ([ItemID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [PrivateNetworkVLANsIdx_ServerID] ON [PrivateNetworkVLANs] ([ServerID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [ProvidersIdx_GroupID] ON [Providers] ([GroupID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [QuotasIdx_GroupID] ON [Quotas] ([GroupID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [QuotasIdx_ItemTypeID] ON [Quotas] ([ItemTypeID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [RDSCollectionSettingsIdx_RDSCollectionId] ON [RDSCollectionSettings] ([RDSCollectionId]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [RDSCollectionUsersIdx_AccountID] ON [RDSCollectionUsers] ([AccountID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [RDSCollectionUsersIdx_RDSCollectionId] ON [RDSCollectionUsers] ([RDSCollectionId]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [RDSMessagesIdx_RDSCollectionId] ON [RDSMessages] ([RDSCollectionId]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [RDSServersIdx_RDSCollectionId] ON [RDSServers] ([RDSCollectionId]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [ResourceGroupDnsRecordsIdx_GroupID] ON [ResourceGroupDnsRecords] ([GroupID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [ScheduleIdx_PackageID] ON [Schedule] ([PackageID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [ScheduleIdx_TaskID] ON [Schedule] ([TaskID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [IX_ScheduleTaskViewConfiguration_TaskID] ON [ScheduleTaskViewConfiguration] ([TaskID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [ServersIdx_PrimaryGroupID] ON [Servers] ([PrimaryGroupID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [ServiceItemsIdx_ItemTypeID] ON [ServiceItems] ([ItemTypeID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [ServiceItemsIdx_PackageID] ON [ServiceItems] ([PackageID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [ServiceItemsIdx_ServiceID] ON [ServiceItems] ([ServiceID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [ServiceItemTypesIdx_GroupID] ON [ServiceItemTypes] ([GroupID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [ServicesIdx_ClusterID] ON [Services] ([ClusterID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [ServicesIdx_ProviderID] ON [Services] ([ProviderID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [ServicesIdx_ServerID] ON [Services] ([ServerID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [StorageSpaceFoldersIdx_StorageSpaceId] ON [StorageSpaceFolders] ([StorageSpaceId]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [StorageSpaceLevelResourceGroupsIdx_GroupId] ON [StorageSpaceLevelResourceGroups] ([GroupId]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [StorageSpaceLevelResourceGroupsIdx_LevelId] ON [StorageSpaceLevelResourceGroups] ([LevelId]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [StorageSpacesIdx_ServerId] ON [StorageSpaces] ([ServerId]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [StorageSpacesIdx_ServiceId] ON [StorageSpaces] ([ServiceId]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [IX_TempIds_Created_Scope_Level] ON [TempIds] ([Created], [Scope], [Level]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    EXEC(N'CREATE UNIQUE INDEX [IX_Users_Username] ON [Users] ([Username]) WHERE [Username] IS NOT NULL');
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [UsersIdx_OwnerID] ON [Users] ([OwnerID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [VirtualGroupsIdx_GroupID] ON [VirtualGroups] ([GroupID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [VirtualGroupsIdx_ServerID] ON [VirtualGroups] ([ServerID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [VirtualServicesIdx_ServerID] ON [VirtualServices] ([ServerID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [VirtualServicesIdx_ServiceID] ON [VirtualServices] ([ServiceID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [WebDavAccessTokensIdx_AccountID] ON [WebDavAccessTokens] ([AccountID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE INDEX [WebDavPortalUsersSettingsIdx_AccountId] ON [WebDavPortalUsersSettings] ([AccountId]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    ALTER TABLE [AccessTokens] ADD CONSTRAINT [FK_AccessTokens_UserId] FOREIGN KEY ([AccountID]) REFERENCES [ExchangeAccounts] ([AccountID]) ON DELETE CASCADE;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    ALTER TABLE [BlackBerryUsers] ADD CONSTRAINT [FK_BlackBerryUsers_ExchangeAccounts] FOREIGN KEY ([AccountId]) REFERENCES [ExchangeAccounts] ([AccountID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    ALTER TABLE [CRMUsers] ADD CONSTRAINT [FK_CRMUsers_ExchangeAccounts] FOREIGN KEY ([AccountID]) REFERENCES [ExchangeAccounts] ([AccountID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    ALTER TABLE [DomainDnsRecords] ADD CONSTRAINT [FK_DomainDnsRecords_DomainId] FOREIGN KEY ([DomainId]) REFERENCES [Domains] ([DomainID]) ON DELETE CASCADE;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    ALTER TABLE [Domains] ADD CONSTRAINT [FK_Domains_Packages] FOREIGN KEY ([PackageID]) REFERENCES [Packages] ([PackageID]) ON DELETE CASCADE;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    ALTER TABLE [Domains] ADD CONSTRAINT [FK_Domains_ServiceItems_MailDomain] FOREIGN KEY ([MailDomainID]) REFERENCES [ServiceItems] ([ItemID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    ALTER TABLE [Domains] ADD CONSTRAINT [FK_Domains_ServiceItems_WebSite] FOREIGN KEY ([WebSiteID]) REFERENCES [ServiceItems] ([ItemID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    ALTER TABLE [Domains] ADD CONSTRAINT [FK_Domains_ServiceItems_ZoneItem] FOREIGN KEY ([ZoneItemID]) REFERENCES [ServiceItems] ([ItemID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    ALTER TABLE [EnterpriseFoldersOwaPermissions] ADD CONSTRAINT [FK_EnterpriseFoldersOwaPermissions_AccountId] FOREIGN KEY ([AccountID]) REFERENCES [ExchangeAccounts] ([AccountID]) ON DELETE CASCADE;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    ALTER TABLE [ExchangeAccountEmailAddresses] ADD CONSTRAINT [FK_ExchangeAccountEmailAddresses_ExchangeAccounts] FOREIGN KEY ([AccountID]) REFERENCES [ExchangeAccounts] ([AccountID]) ON DELETE CASCADE;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    ALTER TABLE [ExchangeAccounts] ADD CONSTRAINT [FK_ExchangeAccounts_ExchangeMailboxPlans] FOREIGN KEY ([MailboxPlanId]) REFERENCES [ExchangeMailboxPlans] ([MailboxPlanId]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    ALTER TABLE [ExchangeAccounts] ADD CONSTRAINT [FK_ExchangeAccounts_ServiceItems] FOREIGN KEY ([ItemID]) REFERENCES [ServiceItems] ([ItemID]) ON DELETE CASCADE;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    ALTER TABLE [ExchangeMailboxPlans] ADD CONSTRAINT [FK_ExchangeMailboxPlans_ExchangeOrganizations] FOREIGN KEY ([ItemID]) REFERENCES [ExchangeOrganizations] ([ItemID]) ON DELETE CASCADE;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    ALTER TABLE [ExchangeOrganizationDomains] ADD CONSTRAINT [FK_ExchangeOrganizationDomains_ServiceItems] FOREIGN KEY ([ItemID]) REFERENCES [ServiceItems] ([ItemID]) ON DELETE CASCADE;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    ALTER TABLE [ExchangeOrganizations] ADD CONSTRAINT [FK_ExchangeOrganizations_ServiceItems] FOREIGN KEY ([ItemID]) REFERENCES [ServiceItems] ([ItemID]) ON DELETE CASCADE;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    ALTER TABLE [GlobalDnsRecords] ADD CONSTRAINT [FK_GlobalDnsRecords_Packages] FOREIGN KEY ([PackageID]) REFERENCES [Packages] ([PackageID]) ON DELETE CASCADE;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    ALTER TABLE [HostingPlanQuotas] ADD CONSTRAINT [FK_HostingPlanQuotas_HostingPlans] FOREIGN KEY ([PlanID]) REFERENCES [HostingPlans] ([PlanID]) ON DELETE CASCADE;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    ALTER TABLE [HostingPlanResources] ADD CONSTRAINT [FK_HostingPlanResources_HostingPlans] FOREIGN KEY ([PlanID]) REFERENCES [HostingPlans] ([PlanID]) ON DELETE CASCADE;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    ALTER TABLE [HostingPlans] ADD CONSTRAINT [FK_HostingPlans_Packages] FOREIGN KEY ([PackageID]) REFERENCES [Packages] ([PackageID]) ON DELETE CASCADE;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    DROP PROCEDURE IF EXISTS [dbo].[UpdateWhoisDomainInfo]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateWebDavPortalUsersSettings]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateVirtualGroups]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateUserThemeSetting]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateUserSettings]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateUserPinSecret]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateUserMfaMode]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateUserFailedLoginAttempt]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateUser]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateSupportServiceLevel]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateStorageSpaceLevel]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateStorageSpaceFolder]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateStorageSpace]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateSfBUserPlan]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateSfBUser]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateServiceProperties]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateServiceItem]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateServiceFully]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateService]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateServer]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateSchedule]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateRDSServerSettings]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateRDSServer]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateRDSCollectionSettings]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateRDSCollection]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdatePrivateNetworVLAN]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdatePackageSettings]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdatePackageQuotas]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdatePackageName]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdatePackageDiskSpace]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdatePackageBandwidthUpdate]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdatePackageBandwidth]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdatePackageAddon]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdatePackage]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateLyncUserPlan]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateLyncUser]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateIPAddresses]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateIPAddress]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateHostingPlanQuotas]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateHostingPlan]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateExchangeRetentionPolicyTag]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateExchangeOrganizationSettings]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateExchangeMailboxPlan]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateExchangeDisclaimer]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateExchangeAccountUserPrincipalName]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateExchangeAccountSLSettings]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateExchangeAccount]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateEnterpriseFolder]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateEntepriseFolderStorageSpaceFolder]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateDomainLastUpdateDate]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateDomainExpirationDate]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateDomainDates]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateDomainCreationDate]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateDomain]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateDnsRecord]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateCRMUser]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateBackgroundTask]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[UpdateAdditionalGroup]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[SfBUserExists]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[SetUserOneTimePassword]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[SetSystemSettings]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[SetSfBUserSfBUserPlan]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[SetOrganizationDefaultSfBUserPlan]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[SetOrganizationDefaultLyncUserPlan]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[SetOrganizationDefaultExchangeMailboxPlan]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[SetLyncUserLyncUserPlan]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[SetItemPrivatePrimaryIPAddress]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[SetItemPrimaryIPAddress]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[SetExchangeAccountMailboxplan]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[SetExchangeAccountDisclaimerId]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[SetAccessTokenSmsResponse]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[SearchServiceItemsPaged]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[SearchOrganizationAccounts]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[SearchExchangeAccountsByTypes]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[SearchExchangeAccounts]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[SearchExchangeAccount]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[RemoveStorageSpaceLevel]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[RemoveStorageSpaceFolder]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[RemoveStorageSpace]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[RemoveRDSUserFromRDSCollection]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[RemoveRDSServerFromOrganization]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[RemoveRDSServerFromCollection]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[OrganizationUserExists]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[OrganizationExists]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[MoveServiceItem]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[LyncUserExists]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[InsertStorageSpaceLevel]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[InsertStorageSpace]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[InsertCRMUser]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetWebDavPortalUsersSettingsByAccountId]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetWebDavAccessTokenById]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetWebDavAccessTokenByAccessToken]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetVirtualServices]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetVirtualServers]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetVirtualMachinesPagedProxmox]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetVirtualMachinesPagedForPC]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetVirtualMachinesPaged2012]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetVirtualMachinesPaged]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetUsersSummary]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetUsersPaged]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetUserSettings]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetUserServiceID]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetUsers]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetUserPeers]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetUserParents]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetUserPackagesServerUrls]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetUserEnterpriseFolderWithOwaEditPermission]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetUserDomainsPaged]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetUserByUsernameInternally]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetUserByUsername]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetUserByIdInternally]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetUserById]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetUserByExchangeOrganizationIdInternally]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetUserAvailableHostingPlans]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetUserAvailableHostingAddons]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetUnallottedVLANs]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetUnallottedIPAddresses]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetThreadBackgroundTasks]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetThemeSettings]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetThemeSetting]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetThemes]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetSystemSettings]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetSupportServiceLevels]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetSupportServiceLevel]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetStorageSpacesPaged]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetStorageSpacesByResourceGroupName]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetStorageSpacesByLevelId]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetStorageSpaceLevelsPaged]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetStorageSpaceLevelById]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetStorageSpaceFoldersByStorageSpaceId]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetStorageSpaceFolderById]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetStorageSpaceByServiceAndPath]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetStorageSpaceById]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetSSLCertificateByID]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetSiteCert]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetSfBUsersCount]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetSfBUsersByPlanId]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetSfBUsers]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetSfBUserPlans]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetSfBUserPlanByAccountId]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetSfBUserPlan]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetServicesByServerIDGroupName]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetServicesByServerID]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetServicesByGroupName]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetServicesByGroupID]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetServiceProperties]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetServiceItemTypes]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetServiceItemType]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetServiceItemsPaged]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetServiceItemsForStatistics]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetServiceItemsCountByNameAndServiceId]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetServiceItemsCount]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetServiceItemsByService]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetServiceItemsByPackage]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetServiceItemsByName]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetServiceItems]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetServiceItemByName]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetServiceItem]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetService]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetServerShortDetails]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetServers]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetServerInternal]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetServerByName]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetServer]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetSearchTableByColumns]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetSearchObject]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetSearchableServiceItemTypes]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetScheduleTaskViewConfigurations]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetScheduleTasks]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetScheduleTaskEmailTemplate]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetScheduleTask]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetSchedulesPaged]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetSchedules]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetScheduleParameters]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetScheduleInternal]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetScheduleBackgroundTasks]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetSchedule]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetResourceGroups]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetResourceGroupByName]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetResourceGroup]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetResellerDomains]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetRDSServersPaged]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetRDSServerSettings]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetRDSServersByItemId]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetRDSServersByCollectionId]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetRDSServers]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetRDSServerById]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetRDSMessages]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetRDSControllerServiceIDbyFQDN]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetRDSCollectionUsersByRDSCollectionId]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetRDSCollectionsPaged]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetRDSCollectionSettingsByCollectionId]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetRDSCollectionsByItemId]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetRDSCollectionByName]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetRDSCollectionById]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetRDSCertificateByServiceId]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetRawServicesByServerID]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetQuotas]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetProviderServiceQuota]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetProviders]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetProviderByServiceID]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetProvider]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetProcessBackgroundTasks]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetPrivateNetworVLANsPaged]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetPrivateNetworVLAN]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetPendingSSLForWebsite]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetParentPackageQuotas]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetPackageUnassignedIPAddresses]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetPackagesPaged]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetPackageSettings]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetPackageServiceID]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetPackagesDiskspacePaged]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetPackagesBandwidthPaged]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetPackages]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetPackageQuotasForEdit]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetPackageQuotas]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetPackageQuota]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetPackagePrivateNetworkVLANs]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetPackagePrivateIPAddressesPaged]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetPackagePrivateIPAddresses]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetPackagePackages]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetPackageIPAddressesCount]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetPackageIPAddresses]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetPackageIPAddress]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetPackageDiskspace]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetPackageBandwidthUpdate]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetPackageBandwidth]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetPackageAddons]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetPackageAddon]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetPackage]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetOrganizationStoragSpacesFolderByType]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetOrganizationStoragSpaceFolders]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetOrganizationStatistics]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetOrganizationRdsUsersCount]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetOrganizationRdsServersCount]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetOrganizationRdsCollectionsCount]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetOrganizationObjectsByDomain]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetOrganizationGroupsByDisplayName]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetOrganizationDeletedUser]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetOrganizationCRMUserCount]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetOCSUsersCount]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetOCSUsers]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetNextSchedule]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetNestedPackagesSummary]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetNestedPackagesPaged]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetMyPackages]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetLyncUsersCount]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetLyncUsersByPlanId]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetLyncUsers]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetLyncUserPlans]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetLyncUserPlanByAccountId]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetLyncUserPlan]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetLevelResourceGroups]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetItemPrivateIPAddresses]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetItemIPAddresses]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetItemIdByOrganizationId]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetIPAddressesPaged]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetIPAddresses]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetIPAddress]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetInstanceID]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetHostingPlans]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetHostingPlanQuotas]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetHostingPlan]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetHostingAddons]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetGroupProviders]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetFilterURLByHostingPlan]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetFilterURL]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetExchangeRetentionPolicyTags]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetExchangeRetentionPolicyTag]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetExchangeOrganizationStatistics]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetExchangeOrganizationSettings]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetExchangeOrganizationDomains]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetExchangeOrganization]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetExchangeMailboxPlans]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetExchangeMailboxPlanRetentionPolicyTags]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetExchangeMailboxPlan]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetExchangeMailboxes]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetExchangeDisclaimers]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetExchangeDisclaimer]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetExchangeAccountsPaged]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetExchangeAccounts]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetExchangeAccountEmailAddresses]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetExchangeAccountDisclaimerId]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetExchangeAccountByMailboxPlanId]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetExchangeAccountByAccountNameWithoutItemId]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetExchangeAccountByAccountName]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetExchangeAccount]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetEnterpriseFoldersPaged]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetEnterpriseFolders]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetEnterpriseFolderOwaUsers]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetEnterpriseFolderId]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetEnterpriseFolder]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetDomainsPaged]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetDomainsByZoneID]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetDomainsByDomainItemID]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetDomains]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetDomainDnsRecords]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetDomainByName]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetDomainAllDnsRecords]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetDomain]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetDnsRecordsTotal]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetDnsRecordsByService]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetDnsRecordsByServer]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetDnsRecordsByPackage]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetDnsRecordsByGroup]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetDnsRecord]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetCRMUsersCount]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetCRMUsers]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetCRMUser]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetCRMOrganizationUsers]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetComments]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetClusters]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetCertificatesForSite]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetBlackBerryUsersCount]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetBlackBerryUsers]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetBackgroundTopTask]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetBackgroundTasks]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetBackgroundTaskParams]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetBackgroundTaskLogs]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetBackgroundTask]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetAvailableVirtualServices]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetAuditLogTasks]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetAuditLogSources]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetAuditLogRecordsPaged]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetAuditLogRecord]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetAllServers]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetAllPackages]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetAdditionalGroups]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[GetAccessTokenByAccessToken]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[ExchangeOrganizationExists]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[ExchangeOrganizationDomainExists]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[ExchangeAccountExists]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[ExchangeAccountEmailAddressExists]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DistributePackageServices]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteVirtualServices]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteUserThemeSetting]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteUserEmailAddresses]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteUser]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteSupportServiceLevel]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteSfBUserPlan]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteSfBUser]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteServiceItem]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteService]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteServer]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteSchedule]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteRDSServerSettings]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteRDSServer]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteRDSCollectionSettings]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteRDSCollection]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeletePrivateNetworkVLAN]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeletePackageAddon]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeletePackage]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteOrganizationUsers]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteOrganizationStoragSpacesFolder]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteOrganizationDeletedUser]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteOCSUser]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteLyncUserPlan]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteLyncUser]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteLevelResourceGroups]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteItemPrivateIPAddresses]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteItemPrivateIPAddress]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteItemIPAddresses]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteItemIPAddress]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteIPAddress]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteHostingPlan]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteExpiredWebDavAccessTokens]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteExpiredAccessTokenTokens]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteExchangeRetentionPolicyTag]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteExchangeOrganizationDomain]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteExchangeOrganization]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteExchangeMailboxPlanRetentionPolicyTag]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteExchangeMailboxPlan]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteExchangeDisclaimer]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteExchangeAccountEmailAddress]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteExchangeAccount]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteEnterpriseFolder]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteDomainDnsRecord]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteDomain]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteDnsRecord]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteCRMOrganization]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteComment]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteCluster]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteCertificate]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteBlackBerryUser]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteBackgroundTasks]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteBackgroundTaskParams]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteBackgroundTask]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteAuditLogRecordsComplete]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteAuditLogRecords]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteAllLogRecords]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteAllEnterpriseFolderOwaUsers]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteAdditionalGroup]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeleteAccessToken]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeallocatePackageVLAN]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[DeallocatePackageIPAddress]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[CreateStorageSpaceFolder]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[ConvertToExchangeOrganization]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[CompleteSSLRequest]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[CheckUserExists]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[CheckSSLExistsForWebsite]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[CheckSSL]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[CheckSfBUserExists]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[CheckServiceLevelUsage]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[CheckServiceItemExistsInService]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[CheckServiceItemExists]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[CheckRDSServer]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[CheckOCSUserExists]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[CheckLyncUserExists]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[CheckDomainUsedByHostedOrganization]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[CheckDomain]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[CheckBlackBerryUserExists]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[ChangeUserPassword]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[ChangePackageUser]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[ChangeExchangeAcceptedDomainType]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[CanChangeMfa]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AllocatePackageVLANs]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AllocatePackageIPAddresses]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddWebDavPortalUsersSettings]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddWebDavAccessToken]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddVirtualServices]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddUserToRDSCollection]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddUser]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddSupportServiceLevel]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddSSLRequest]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddSfBUserPlan]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddSfBUser]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddServiceItem]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddService]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddServer]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddSchedule]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddRDSServerToOrganization]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddRDSServerToCollection]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddRDSServer]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddRDSMessage]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddRDSCollectionSettings]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddRDSCollection]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddRDSCertificate]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddPrivateNetworkVlan]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddPFX]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddPackageAddon]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddPackage]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddOrganizationStoragSpacesFolder]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddOrganizationDeletedUser]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddOCSUser]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddLyncUserPlan]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddLyncUser]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddLevelResourceGroups]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddItemPrivateIPAddress]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddItemIPAddress]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddIPAddress]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddHostingPlan]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddExchangeRetentionPolicyTag]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddExchangeOrganizationDomain]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddExchangeOrganization]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddExchangeMailboxPlanRetentionPolicyTag]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddExchangeMailboxPlan]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddExchangeDisclaimer]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddExchangeAccountEmailAddress]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddExchangeAccount]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddEnterpriseFolderOwaUser]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddEnterpriseFolder]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddDomainDnsRecord]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddDomain]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddDnsRecord]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddComment]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddCluster]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddBlackBerryUser]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddBackgroundTaskStack]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddBackgroundTaskParam]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddBackgroundTaskLog]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddBackgroundTask]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddAuditLogRecord]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddAdditionalGroup]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP PROCEDURE IF EXISTS [dbo].[AddAccessToken]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP FUNCTION IF EXISTS [dbo].[UsersTree]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP FUNCTION IF EXISTS [dbo].[UserParents]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP FUNCTION IF EXISTS [dbo].[SplitString]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP FUNCTION IF EXISTS [dbo].[PackagesTree]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP FUNCTION IF EXISTS [dbo].[PackageParents]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP FUNCTION IF EXISTS [dbo].[GetPackageServiceLevelResource]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP FUNCTION IF EXISTS [dbo].[GetPackageExceedingQuotas]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP FUNCTION IF EXISTS [dbo].[GetPackageAllocatedResource]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP FUNCTION IF EXISTS [dbo].[GetPackageAllocatedQuota]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP FUNCTION IF EXISTS [dbo].[GetItemComments]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP FUNCTION IF EXISTS [dbo].[GetFullIPAddress]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP FUNCTION IF EXISTS [dbo].[CheckUserParent]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP FUNCTION IF EXISTS [dbo].[CheckPackageParent]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP FUNCTION IF EXISTS [dbo].[CheckIsUserAdmin]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP FUNCTION IF EXISTS [dbo].[CheckExceedingQuota]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP FUNCTION IF EXISTS [dbo].[CheckActorUserRights]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP FUNCTION IF EXISTS [dbo].[CheckActorParentPackageRights]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP FUNCTION IF EXISTS [dbo].[CheckActorPackageRights]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP FUNCTION IF EXISTS [dbo].[CanUpdateUserDetails]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP FUNCTION IF EXISTS [dbo].[CanUpdatePackageDetails]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP FUNCTION IF EXISTS [dbo].[CanGetUserPassword]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP FUNCTION IF EXISTS [dbo].[CanGetUserDetails]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP FUNCTION IF EXISTS [dbo].[CanCreateUser]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP FUNCTION IF EXISTS [dbo].[CanChangeMfaFunc]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP FUNCTION IF EXISTS [dbo].[CalculateQuotaUsage]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP FUNCTION IF EXISTS [dbo].[CalculatePackageDiskspace]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    DROP FUNCTION IF EXISTS [dbo].[CalculatePackageBandwidth]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    			
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE FUNCTION [dbo].[CalculatePackageBandwidth]
    (
    	@PackageID int
    )
    RETURNS int
    AS
    BEGIN

    DECLARE @d datetime, @StartDate datetime, @EndDate datetime
    SET @d = GETDATE()
    SET @StartDate = DATEADD(Day, -DAY(@d) + 1, @d)
    SET @EndDate = DATEADD(Day, -1, DATEADD(Month, 1, @StartDate))
    --SET @EndDate =  GETDATE()
    --SET @StartDate = DATEADD(month, -1, @EndDate)

    -- remove hours and minutes
    SET @StartDate = CONVERT(datetime, CONVERT(nvarchar, @StartDate, 112))
    SET @EndDate = CONVERT(datetime, CONVERT(nvarchar, @EndDate, 112))

    DECLARE @Bandwidth int
    SELECT
    	@Bandwidth = ROUND(CONVERT(float, SUM(ISNULL(PB.BytesSent + PB.BytesReceived, 0))) / 1024 / 1024, 0) -- in megabytes
    FROM PackagesTreeCache AS PT
    INNER JOIN Packages AS P ON PT.PackageID = P.PackageID
    INNER JOIN PackagesBandwidth AS PB ON PT.PackageID = PB.PackageID
    INNER JOIN HostingPlanResources AS HPR ON PB.GroupID = HPR.GroupID
    	AND HPR.PlanID = P.PlanID AND HPR.CalculateBandwidth = 1
    WHERE
    	PT.ParentPackageID = @PackageID
    	AND PB.LogDate BETWEEN @StartDate AND @EndDate

    IF @Bandwidth IS NULL
    SET @Bandwidth = 0

    RETURN @Bandwidth
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE FUNCTION [dbo].[CalculatePackageDiskspace]
    (
    	@PackageID int
    )
    RETURNS int
    AS
    BEGIN

    DECLARE @Diskspace int

    SELECT
    	@Diskspace = ROUND(CONVERT(float, SUM(ISNULL(PD.DiskSpace, 0))) / 1024 / 1024, 0) -- in megabytes
    FROM PackagesTreeCache AS PT
    INNER JOIN Packages AS P ON PT.PackageID = P.PackageID
    INNER JOIN PackagesDiskspace AS PD ON P.PackageID = PD.PackageID
    INNER JOIN HostingPlanResources AS HPR ON PD.GroupID = HPR.GroupID
    	AND HPR.PlanID = P.PlanID AND HPR.CalculateDiskspace = 1
    WHERE PT.ParentPackageID = @PackageID

    RETURN @Diskspace
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE FUNCTION [dbo].[CalculateQuotaUsage]
    (
    	@PackageID int,
    	@QuotaID int
    )
    RETURNS int
    AS
    	BEGIN

    		DECLARE @QuotaTypeID int
    		DECLARE @QuotaName nvarchar(50)
    		SELECT @QuotaTypeID = QuotaTypeID, @QuotaName = QuotaName FROM Quotas
    		WHERE QuotaID = @QuotaID

    		IF @QuotaTypeID <> 2
    			RETURN 0

    		DECLARE @Result int
    		DECLARE @vhd TABLE (Size int)

    		IF @QuotaID = 52 -- diskspace
    			SET @Result = dbo.CalculatePackageDiskspace(@PackageID)
    		ELSE IF @QuotaID = 51 -- bandwidth
    			SET @Result = dbo.CalculatePackageBandwidth(@PackageID)
    		ELSE IF @QuotaID = 53 -- domains
    			SET @Result = (SELECT COUNT(D.DomainID) FROM PackagesTreeCache AS PT
    				INNER JOIN Domains AS D ON D.PackageID = PT.PackageID
    				WHERE IsSubDomain = 0 AND IsPreviewDomain = 0 AND IsDomainPointer = 0 AND PT.ParentPackageID = @PackageID)
    		ELSE IF @QuotaID = 54 -- sub-domains
    			SET @Result = (SELECT COUNT(D.DomainID) FROM PackagesTreeCache AS PT
    				INNER JOIN Domains AS D ON D.PackageID = PT.PackageID
    				WHERE IsSubDomain = 1 AND IsPreviewDomain = 0 AND IsDomainPointer = 0 AND PT.ParentPackageID = @PackageID)
    		ELSE IF @QuotaID = 220 -- domain pointers
    			SET @Result = (SELECT COUNT(D.DomainID) FROM PackagesTreeCache AS PT
    				INNER JOIN Domains AS D ON D.PackageID = PT.PackageID
    				WHERE IsDomainPointer = 1 AND PT.ParentPackageID = @PackageID)
    		ELSE IF @QuotaID = 71 -- scheduled tasks
    			SET @Result = (SELECT COUNT(S.ScheduleID) FROM PackagesTreeCache AS PT
    				INNER JOIN Schedule AS S ON S.PackageID = PT.PackageID
    				WHERE PT.ParentPackageID = @PackageID)
    		ELSE IF @QuotaID = 305 -- RAM of VPS
    			SET @Result = (SELECT SUM(CAST(SIP.PropertyValue AS int)) FROM ServiceItemProperties AS SIP
    							INNER JOIN ServiceItems AS SI ON SIP.ItemID = SI.ItemID
    							INNER JOIN PackagesTreeCache AS PT ON SI.PackageID = PT.PackageID
    							WHERE SIP.PropertyName = 'RamSize' AND PT.ParentPackageID = @PackageID)
    		ELSE IF @QuotaID = 302 -- CpuNumber of VPS
    			SET @Result = (SELECT SUM(CAST(SIP.PropertyValue AS int)) FROM ServiceItemProperties AS SIP
    							INNER JOIN ServiceItems AS SI ON SIP.ItemID = SI.ItemID
    							INNER JOIN PackagesTreeCache AS PT ON SI.PackageID = PT.PackageID
    							WHERE SIP.PropertyName = 'CpuCores' AND PT.ParentPackageID = @PackageID)
    		ELSE IF @QuotaID = 306 -- HDD of VPS
    		BEGIN
    			INSERT INTO @vhd
    			SELECT (SELECT SUM(CAST([value] AS int)) AS value FROM dbo.SplitString(SIP.PropertyValue,';')) FROM ServiceItemProperties AS SIP
    							INNER JOIN ServiceItems AS SI ON SIP.ItemID = SI.ItemID
    							INNER JOIN PackagesTreeCache AS PT ON SI.PackageID = PT.PackageID
    							WHERE SIP.PropertyName = 'HddSize' AND PT.ParentPackageID = @PackageID
    			SET @Result = (SELECT SUM(Size) FROM @vhd)
    		END
    		ELSE IF @QuotaID = 309 -- External IP addresses of VPS
    			SET @Result = (SELECT COUNT(PIP.PackageAddressID) FROM PackageIPAddresses AS PIP
    							INNER JOIN IPAddresses AS IP ON PIP.AddressID = IP.AddressID
    							INNER JOIN PackagesTreeCache AS PT ON PIP.PackageID = PT.PackageID
    							WHERE PT.ParentPackageID = @PackageID AND IP.PoolID = 3)
    		ELSE IF @QuotaID = 555 -- CpuNumber of VPS2012
    			SET @Result = (SELECT SUM(CAST(SIP.PropertyValue AS int)) FROM ServiceItemProperties AS SIP
    							INNER JOIN ServiceItems AS SI ON SIP.ItemID = SI.ItemID
    							INNER JOIN PackagesTreeCache AS PT ON SI.PackageID = PT.PackageID
    							WHERE SIP.PropertyName = 'CpuCores' AND PT.ParentPackageID = @PackageID)
    		ELSE IF @QuotaID = 558 BEGIN -- RAM of VPS2012
    			DECLARE @Result1 int
    			SET @Result1 = (SELECT SUM(CAST(SIP.PropertyValue AS int)) FROM ServiceItemProperties AS SIP
    							INNER JOIN ServiceItems AS SI ON SIP.ItemID = SI.ItemID
    							INNER JOIN PackagesTreeCache AS PT ON SI.PackageID = PT.PackageID
    							WHERE SIP.PropertyName = 'RamSize' AND PT.ParentPackageID = @PackageID)
    			DECLARE @Result2 int
    			SET @Result2 = (SELECT SUM(CAST(SIP.PropertyValue AS int)) FROM ServiceItemProperties AS SIP
    							INNER JOIN ServiceItems AS SI ON SIP.ItemID = SI.ItemID
    							INNER JOIN ServiceItemProperties AS SIP2 ON 
    								SIP2.ItemID = SI.ItemID AND SIP2.PropertyName = 'DynamicMemory.Enabled' AND SIP2.PropertyValue = 'True'
    							INNER JOIN PackagesTreeCache AS PT ON SI.PackageID = PT.PackageID
    							WHERE SIP.PropertyName = 'DynamicMemory.Maximum' AND PT.ParentPackageID = @PackageID)
    			SET @Result = CASE WHEN isnull(@Result1,0) > isnull(@Result2,0) THEN @Result1 ELSE @Result2 END
    		END
    		ELSE IF @QuotaID = 559 -- HDD of VPS2012
    		BEGIN
    			INSERT INTO @vhd
    			SELECT (SELECT SUM(CAST([value] AS int)) AS value FROM dbo.SplitString(SIP.PropertyValue,';')) FROM ServiceItemProperties AS SIP
    							INNER JOIN ServiceItems AS SI ON SIP.ItemID = SI.ItemID
    							INNER JOIN PackagesTreeCache AS PT ON SI.PackageID = PT.PackageID
    							WHERE SIP.PropertyName = 'HddSize' AND PT.ParentPackageID = @PackageID
    			SET @Result = (SELECT SUM(Size) FROM @vhd)
    		END
    		ELSE IF @QuotaID = 562 -- External IP addresses of VPS2012
    			SET @Result = (SELECT COUNT(PIP.PackageAddressID) FROM PackageIPAddresses AS PIP
    							INNER JOIN IPAddresses AS IP ON PIP.AddressID = IP.AddressID
    							INNER JOIN PackagesTreeCache AS PT ON PIP.PackageID = PT.PackageID
    							WHERE PT.ParentPackageID = @PackageID AND IP.PoolID = 3)
    		ELSE IF @QuotaID = 728 -- Private Network VLANs of VPS2012
    			SET @Result = (SELECT COUNT(PV.PackageVlanID) FROM PackageVLANs AS PV
    							INNER JOIN PrivateNetworkVLANs AS V ON PV.VlanID = V.VlanID
    							INNER JOIN PackagesTreeCache AS PT ON PV.PackageID = PT.PackageID
    							WHERE PT.ParentPackageID = @PackageID)
    		ELSE IF @QuotaID = 100 -- Dedicated Web IP addresses
    			SET @Result = (SELECT COUNT(PIP.PackageAddressID) FROM PackageIPAddresses AS PIP
    							INNER JOIN IPAddresses AS IP ON PIP.AddressID = IP.AddressID
    							INNER JOIN PackagesTreeCache AS PT ON PIP.PackageID = PT.PackageID
    							WHERE PT.ParentPackageID = @PackageID AND IP.PoolID = 2)
    		ELSE IF @QuotaID = 350 -- RAM of VPSforPc
    			SET @Result = (SELECT SUM(CAST(SIP.PropertyValue AS int)) FROM ServiceItemProperties AS SIP
    							INNER JOIN ServiceItems AS SI ON SIP.ItemID = SI.ItemID
    							INNER JOIN PackagesTreeCache AS PT ON SI.PackageID = PT.PackageID
    							WHERE SIP.PropertyName = 'Memory' AND PT.ParentPackageID = @PackageID)
    		ELSE IF @QuotaID = 347 -- CpuNumber of VPSforPc
    			SET @Result = (SELECT SUM(CAST(SIP.PropertyValue AS int)) FROM ServiceItemProperties AS SIP
    							INNER JOIN ServiceItems AS SI ON SIP.ItemID = SI.ItemID
    							INNER JOIN PackagesTreeCache AS PT ON SI.PackageID = PT.PackageID
    							WHERE SIP.PropertyName = 'CpuCores' AND PT.ParentPackageID = @PackageID)
    		ELSE IF @QuotaID = 351 -- HDD of VPSforPc
    		BEGIN
    			INSERT INTO @vhd
    			SELECT (SELECT SUM(CAST([value] AS int)) AS value FROM dbo.SplitString(SIP.PropertyValue,';')) FROM ServiceItemProperties AS SIP
    							INNER JOIN ServiceItems AS SI ON SIP.ItemID = SI.ItemID
    							INNER JOIN PackagesTreeCache AS PT ON SI.PackageID = PT.PackageID
    							WHERE SIP.PropertyName = 'HddSize' AND PT.ParentPackageID = @PackageID
    			SET @Result = (SELECT SUM(Size) FROM @vhd)
    		END
    		ELSE IF @QuotaID = 354 -- External IP addresses of VPSforPc
    			SET @Result = (SELECT COUNT(PIP.PackageAddressID) FROM PackageIPAddresses AS PIP
    							INNER JOIN IPAddresses AS IP ON PIP.AddressID = IP.AddressID
    							INNER JOIN PackagesTreeCache AS PT ON PIP.PackageID = PT.PackageID
    							WHERE PT.ParentPackageID = @PackageID AND IP.PoolID = 3)
    		ELSE IF @QuotaID = 319 -- BB Users
    			SET @Result = (SELECT COUNT(ea.AccountID) FROM ExchangeAccounts ea 
    							INNER JOIN BlackBerryUsers bu ON ea.AccountID = bu.AccountID
    							INNER JOIN ServiceItems  si ON ea.ItemID = si.ItemID
    							INNER JOIN PackagesTreeCache pt ON si.PackageID = pt.PackageID
    							WHERE pt.ParentPackageID = @PackageID)
    		ELSE IF @QuotaID = 320 -- OCS Users
    			SET @Result = (SELECT COUNT(ea.AccountID) FROM ExchangeAccounts ea 
    							INNER JOIN OCSUsers ocs ON ea.AccountID = ocs.AccountID
    							INNER JOIN ServiceItems  si ON ea.ItemID = si.ItemID
    							INNER JOIN PackagesTreeCache pt ON si.PackageID = pt.PackageID
    							WHERE pt.ParentPackageID = @PackageID)
    		ELSE IF @QuotaID = 206 -- HostedSolution.Users
    			SET @Result = (SELECT COUNT(ea.AccountID) FROM ExchangeAccounts AS ea
    				INNER JOIN ServiceItems  si ON ea.ItemID = si.ItemID
    				INNER JOIN PackagesTreeCache pt ON si.PackageID = pt.PackageID
    				WHERE pt.ParentPackageID = @PackageID AND ea.AccountType IN (1,5,6,7))
    		ELSE IF @QuotaID = 78 -- Exchange2007.Mailboxes
    			SET @Result = (SELECT COUNT(ea.AccountID) FROM ExchangeAccounts AS ea
    				INNER JOIN ServiceItems  si ON ea.ItemID = si.ItemID
    				INNER JOIN PackagesTreeCache pt ON si.PackageID = pt.PackageID
    				WHERE pt.ParentPackageID = @PackageID 
    				AND ea.AccountType IN (1)
    				AND ea.MailboxPlanId IS NOT NULL)
    		ELSE IF @QuotaID = 731 -- Exchange2013.JournalingMailboxes
    			SET @Result = (SELECT COUNT(ea.AccountID) FROM ExchangeAccounts AS ea
    				INNER JOIN ServiceItems  si ON ea.ItemID = si.ItemID
    				INNER JOIN PackagesTreeCache pt ON si.PackageID = pt.PackageID
    				WHERE pt.ParentPackageID = @PackageID 
    				AND ea.AccountType IN (12)
    				AND ea.MailboxPlanId IS NOT NULL)
    		ELSE IF @QuotaID = 77 -- Exchange2007.DiskSpace
    			SET @Result = (SELECT SUM(B.MailboxSizeMB) FROM ExchangeAccounts AS ea 
    			INNER JOIN ExchangeMailboxPlans AS B ON ea.MailboxPlanId = B.MailboxPlanId 
    			INNER JOIN ServiceItems  si ON ea.ItemID = si.ItemID
    			INNER JOIN PackagesTreeCache pt ON si.PackageID = pt.PackageID
    			WHERE pt.ParentPackageID = @PackageID AND ea.AccountType in (1, 5, 6, 10, 12))
    		ELSE IF @QuotaID = 370 -- Lync.Users
    			SET @Result = (SELECT COUNT(ea.AccountID) FROM ExchangeAccounts AS ea
    				INNER JOIN LyncUsers lu ON ea.AccountID = lu.AccountID
    				INNER JOIN ServiceItems  si ON ea.ItemID = si.ItemID
    				INNER JOIN PackagesTreeCache pt ON si.PackageID = pt.PackageID
    				WHERE pt.ParentPackageID = @PackageID)
    		ELSE IF @QuotaID = 376 -- Lync.EVUsers
    			SET @Result = (SELECT COUNT(ea.AccountID) FROM ExchangeAccounts AS ea
    				INNER JOIN LyncUsers lu ON ea.AccountID = lu.AccountID
    				INNER JOIN LyncUserPlans lp ON lu.LyncUserPlanId = lp.LyncUserPlanId
    				INNER JOIN ServiceItems  si ON ea.ItemID = si.ItemID
    				INNER JOIN PackagesTreeCache pt ON si.PackageID = pt.PackageID
    				WHERE pt.ParentPackageID = @PackageID AND lp.EnterpriseVoice = 1)
    		ELSE IF @QuotaID = 381 -- Dedicated Lync Phone Numbers
    			SET @Result = (SELECT COUNT(PIP.PackageAddressID) FROM PackageIPAddresses AS PIP
    							INNER JOIN IPAddresses AS IP ON PIP.AddressID = IP.AddressID
    							INNER JOIN PackagesTreeCache AS PT ON PIP.PackageID = PT.PackageID
    							WHERE PT.ParentPackageID = @PackageID AND IP.PoolID = 5)
    		ELSE IF @QuotaID = 430 -- Enterprise Storage
    			SET @Result = (SELECT SUM(ESF.FolderQuota) FROM EnterpriseFolders AS ESF
    							INNER JOIN ServiceItems  SI ON ESF.ItemID = SI.ItemID
    							INNER JOIN PackagesTreeCache PT ON SI.PackageID = PT.PackageID
    							WHERE PT.ParentPackageID = @PackageID)
    		ELSE IF @QuotaID = 431 -- Enterprise Storage Folders
    			SET @Result = (SELECT COUNT(ESF.EnterpriseFolderID) FROM EnterpriseFolders AS ESF
    							INNER JOIN ServiceItems  SI ON ESF.ItemID = SI.ItemID
    							INNER JOIN PackagesTreeCache PT ON SI.PackageID = PT.PackageID
    							WHERE PT.ParentPackageID = @PackageID)
    		ELSE IF @QuotaID = 423 -- HostedSolution.SecurityGroups
    			SET @Result = (SELECT COUNT(ea.AccountID) FROM ExchangeAccounts AS ea
    				INNER JOIN ServiceItems  si ON ea.ItemID = si.ItemID
    				INNER JOIN PackagesTreeCache pt ON si.PackageID = pt.PackageID
    				WHERE pt.ParentPackageID = @PackageID AND ea.AccountType IN (8,9))
    		ELSE IF @QuotaID = 495 -- HostedSolution.DeletedUsers
    			SET @Result = (SELECT COUNT(ea.AccountID) FROM ExchangeAccounts AS ea
    				INNER JOIN ServiceItems  si ON ea.ItemID = si.ItemID
    				INNER JOIN PackagesTreeCache pt ON si.PackageID = pt.PackageID
    				WHERE pt.ParentPackageID = @PackageID AND ea.AccountType = 11)
    		ELSE IF @QuotaID = 450
    			SET @Result = (SELECT COUNT(DISTINCT(RCU.[AccountId])) FROM [dbo].[RDSCollectionUsers] RCU
    				INNER JOIN ExchangeAccounts EA ON EA.AccountId = RCU.AccountId
    				INNER JOIN ServiceItems  si ON ea.ItemID = si.ItemID
    				INNER JOIN PackagesTreeCache pt ON si.PackageID = pt.PackageID
    				WHERE PT.ParentPackageID = @PackageID)
    		ELSE IF @QuotaID = 451
    			SET @Result = (SELECT COUNT(RS.[ID]) FROM [dbo].[RDSServers] RS				
    				INNER JOIN ServiceItems  si ON RS.ItemID = si.ItemID
    				INNER JOIN PackagesTreeCache pt ON si.PackageID = pt.PackageID
    				WHERE PT.ParentPackageID = @PackageID)
    		ELSE IF @QuotaID = 491
    			SET @Result = (SELECT COUNT(RC.[ID]) FROM [dbo].[RDSCollections] RC
    				INNER JOIN ServiceItems  si ON RC.ItemID = si.ItemID
    				INNER JOIN PackagesTreeCache pt ON si.PackageID = pt.PackageID
    				WHERE PT.ParentPackageID = @PackageID)
    		ELSE IF @QuotaName like 'ServiceLevel.%' -- Support Service Level Quota
    		BEGIN
    			DECLARE @LevelID int

    			SELECT @LevelID = LevelID FROM SupportServiceLevels
    			WHERE LevelName = REPLACE(@QuotaName,'ServiceLevel.','')

    			IF (@LevelID IS NOT NULL)
    			SET @Result = (SELECT COUNT(EA.AccountID)
    				FROM SupportServiceLevels AS SL
    				INNER JOIN ExchangeAccounts AS EA ON SL.LevelID = EA.LevelID
    				INNER JOIN ServiceItems  SI ON EA.ItemID = SI.ItemID
    				INNER JOIN PackagesTreeCache PT ON SI.PackageID = PT.PackageID
    				WHERE EA.LevelID = @LevelID AND PT.ParentPackageID = @PackageID)
    			ELSE SET @Result = 0
    		END
    		ELSE
    			SET @Result = (SELECT COUNT(SI.ItemID) FROM Quotas AS Q
    			INNER JOIN ServiceItems AS SI ON SI.ItemTypeID = Q.ItemTypeID
    			INNER JOIN PackagesTreeCache AS PT ON SI.PackageID = PT.PackageID AND PT.ParentPackageID = @PackageID
    			WHERE Q.QuotaID = @QuotaID)

    		RETURN @Result
    	END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE FUNCTION [dbo].[CanChangeMfaFunc]
    (
    	@CallerID int,
    	@ChangeUserID int,
    	@CanPeerChangeMfa bit
    )
    RETURNS bit
    AS
    BEGIN

    DECLARE @IsPeer int, @OwnerID int, @Result int,  @UserId int, @GenerationNumber int
    SET @Result = 0;
    SET @GenerationNumber = 0;
    -- get data for user
    SELECT @IsPeer = IsPeer, @OwnerID = OwnerID, @UserId = UserID FROM Users
    WHERE UserID = @CallerID;

    -- userif not found
    IF(@UserId IS NULL)
    BEGIN
    	RETURN 0
    END

    -- is rootuser serveradmin
    IF (@OwnerID IS NULL)
    BEGIN
    	RETURN 1
    END

    -- check if the user requests himself
    IF (@CallerID = @ChangeUserID AND @IsPeer > 0 AND @CanPeerChangeMfa <> 0)
    BEGIN
    	RETURN 1
    END

    IF (@CallerID = @ChangeUserID AND @IsPeer = 0)
    BEGIN
    	RETURN 1
    END

    IF (@IsPeer = 1)
    BEGIN
    	SET @UserID = @OwnerID
    	SET @GenerationNumber = 1;
    END;

    WITH generation AS (
        SELECT UserID,
               Username,
    		   OwnerID,
    		   IsPeer,
               0 AS generation_number
        FROM Users
    	where UserID = @UserID
    UNION ALL
        SELECT child.UserID,
             child.Username,
             child.OwnerId,
    		 child.IsPeer,
    		 generation_number + 1 AS generation_number
        FROM Users child
        JOIN generation g
          ON g.UserID = child.OwnerId
    )

    Select @Result = count(*)
    FROM generation g
    JOIN Users parent
    ON g.OwnerID = parent.UserID
    where (g.generation_number > @GenerationNumber or g.IsPeer <> 1) and g.UserID = @ChangeUserID;

    if(@Result > 0)
    BEGIN
    	RETURN 1
    END
    ELSE
    BEGIN
    	RETURN 0
    END

    RETURN 0
    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE FUNCTION [dbo].[CanCreateUser]
    (
    	@ActorID int,
    	@UserID int
    )
    RETURNS bit
    AS
    BEGIN

    IF @ActorID = -1
    RETURN 1

    -- check if the user requests himself
    IF @ActorID = @UserID
    RETURN 1

    DECLARE @IsPeer bit
    DECLARE @OwnerID int

    SELECT @IsPeer = IsPeer, @OwnerID = OwnerID FROM Users
    WHERE UserID = @ActorID

    IF @IsPeer = 1
    BEGIN
    	SET @ActorID = @OwnerID
    END

    IF @ActorID = @UserID
    RETURN 1

    DECLARE @ParentUserID int, @TmpUserID int
    SET @TmpUserID = @UserID

    WHILE 10 = 10
    BEGIN

    	SET @ParentUserID = NULL --reset var

    	-- get owner
    	SELECT
    		@ParentUserID = OwnerID
    	FROM Users
    	WHERE UserID = @TmpUserID

    	IF @ParentUserID IS NULL -- the last parent
    		BREAK

    	IF @ParentUserID = @ActorID
    	RETURN 1

    	SET @TmpUserID = @ParentUserID
    END

    RETURN 0
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE FUNCTION [dbo].[CanGetUserDetails]
    (
    	@ActorID int,
    	@UserID int
    )
    RETURNS bit
    AS
    BEGIN

    IF @ActorID = -1
    RETURN 1

    -- check if the user requests himself
    IF @ActorID = @UserID
    BEGIN
    	RETURN 1
    END

    DECLARE @IsPeer bit
    DECLARE @OwnerID int

    SELECT @IsPeer = IsPeer, @OwnerID = OwnerID FROM Users
    WHERE UserID = @ActorID

    IF @IsPeer = 1
    SET @ActorID = @OwnerID

    -- get user's owner
    SELECT @OwnerID = OwnerID FROM Users
    WHERE UserID = @ActorID

    IF @UserID = @OwnerID
    RETURN 1 -- user can get the details of his owner

    -- check if the user requests himself
    IF @ActorID = @UserID
    BEGIN
    	RETURN 1
    END

    DECLARE @ParentUserID int, @TmpUserID int
    SET @TmpUserID = @UserID

    WHILE 10 = 10
    BEGIN

    	SET @ParentUserID = NULL --reset var

    	-- get owner
    	SELECT
    		@ParentUserID = OwnerID
    	FROM Users
    	WHERE UserID = @TmpUserID

    	IF @ParentUserID IS NULL -- the last parent
    		BREAK

    	IF @ParentUserID = @ActorID
    	RETURN 1

    	SET @TmpUserID = @ParentUserID
    END

    RETURN 0
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE FUNCTION [dbo].[CanGetUserPassword]
    (
    	@ActorID int,
    	@UserID int
    )
    RETURNS bit
    AS
    BEGIN

    IF @ActorID = -1
    RETURN 1 -- unauthenticated mode

    -- check if the user requests himself
    IF @ActorID = @UserID
    BEGIN
    	RETURN 1
    END

    DECLARE @IsPeer bit
    DECLARE @OwnerID int

    SELECT @IsPeer = IsPeer, @OwnerID = OwnerID FROM Users
    WHERE UserID = @ActorID

    IF @IsPeer = 1
    BEGIN
    	-- peer can't get the password of his peers
    	-- and his owner
    	IF @UserID = @OwnerID
    	RETURN 0

    	IF EXISTS (
    		SELECT UserID FROM Users
    		WHERE IsPeer = 1 AND OwnerID = @OwnerID AND UserID = @UserID
    	) RETURN 0

    	-- set actor to his owner
    	SET @ActorID = @OwnerID
    END

    -- get user's owner
    SELECT @OwnerID = OwnerID FROM Users
    WHERE UserID = @ActorID

    IF @UserID = @OwnerID
    RETURN 0 -- user can't get the password of his owner

    DECLARE @ParentUserID int, @TmpUserID int
    SET @TmpUserID = @UserID

    WHILE 10 = 10
    BEGIN

    	SET @ParentUserID = NULL --reset var

    	-- get owner
    	SELECT
    		@ParentUserID = OwnerID
    	FROM Users
    	WHERE UserID = @TmpUserID

    	IF @ParentUserID IS NULL -- the last parent
    		BREAK

    	IF @ParentUserID = @ActorID
    	RETURN 1

    	SET @TmpUserID = @ParentUserID
    END

    RETURN 0
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE FUNCTION [dbo].[CanUpdatePackageDetails]
    (
    	@ActorID int,
    	@PackageID int
    )
    RETURNS bit
    AS
    BEGIN

    IF @ActorID = -1
    RETURN 1

    DECLARE @UserID int
    SELECT @UserID = UserID FROM Packages
    WHERE PackageID = @PackageID

    -- check if the user requests himself
    IF @ActorID = @UserID
    RETURN 1

    DECLARE @IsPeer bit
    DECLARE @OwnerID int

    SELECT @IsPeer = IsPeer, @OwnerID = OwnerID FROM Users
    WHERE UserID = @ActorID

    IF @IsPeer = 1
    SET @ActorID = @OwnerID

    IF @ActorID = @UserID
    RETURN 1

    DECLARE @ParentUserID int, @TmpUserID int
    SET @TmpUserID = @UserID

    WHILE 10 = 10
    BEGIN

    	SET @ParentUserID = NULL --reset var

    	-- get owner
    	SELECT
    		@ParentUserID = OwnerID
    	FROM Users
    	WHERE UserID = @TmpUserID

    	IF @ParentUserID IS NULL -- the last parent
    		BREAK

    	IF @ParentUserID = @ActorID
    	RETURN 1

    	SET @TmpUserID = @ParentUserID
    END

    RETURN 0
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE FUNCTION [dbo].[CanUpdateUserDetails]
    (
    	@ActorID int,
    	@UserID int
    )
    RETURNS bit
    AS
    BEGIN

    IF @ActorID = -1
    RETURN 1

    -- check if the user requests himself
    IF @ActorID = @UserID
    BEGIN
    	RETURN 1
    END

    DECLARE @IsPeer bit
    DECLARE @OwnerID int

    SELECT @IsPeer = IsPeer, @OwnerID = OwnerID FROM Users
    WHERE UserID = @ActorID

    IF @IsPeer = 1
    BEGIN
    	-- check if the peer is trying to update his owner
    	IF @UserID = @OwnerID
    	RETURN 0

    	-- check if the peer is trying to update his peers
    	IF EXISTS (SELECT UserID FROM Users
    	WHERE IsPeer = 1 AND OwnerID = @OwnerID AND UserID = @UserID)
    	RETURN 0

    	SET @ActorID = @OwnerID
    END

    DECLARE @ParentUserID int, @TmpUserID int
    SET @TmpUserID = @UserID

    WHILE 10 = 10
    BEGIN

    	SET @ParentUserID = NULL --reset var

    	-- get owner
    	SELECT
    		@ParentUserID = OwnerID
    	FROM Users
    	WHERE UserID = @TmpUserID

    	IF @ParentUserID IS NULL -- the last parent
    		BREAK

    	IF @ParentUserID = @ActorID
    	RETURN 1

    	SET @TmpUserID = @ParentUserID
    END

    RETURN 0
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE FUNCTION [dbo].[CheckActorPackageRights]
    (
    	@ActorID int,
    	@PackageID int
    )
    RETURNS bit
    AS
    BEGIN

    IF @ActorID = -1 OR @PackageID IS NULL
    RETURN 1

    -- check if this is a 'system' package
    IF @PackageID < 2 AND @PackageID > -1 AND dbo.CheckIsUserAdmin(@ActorID) = 0
    RETURN 0

    -- get package owner
    DECLARE @UserID int
    SELECT @UserID = UserID FROM Packages
    WHERE PackageID = @PackageID

    IF @UserID IS NULL
    RETURN 1 -- unexisting package

    -- check user
    RETURN dbo.CheckActorUserRights(@ActorID, @UserID)

    RETURN 0
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE FUNCTION [dbo].[CheckActorParentPackageRights]
    (
    	@ActorID int,
    	@PackageID int
    )
    RETURNS bit
    AS
    BEGIN

    IF @ActorID = -1 OR @PackageID IS NULL
    RETURN 1

    -- get package owner
    DECLARE @UserID int
    SELECT @UserID = UserID FROM Packages
    WHERE PackageID = @PackageID

    IF @UserID IS NULL
    RETURN 1 -- unexisting package

    -- check user
    RETURN dbo.CanGetUserDetails(@ActorID, @UserID)

    RETURN 0
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE FUNCTION [dbo].[CheckActorUserRights]
    (
    	@ActorID int,
    	@UserID int
    )
    RETURNS bit
    AS
    BEGIN

    IF @ActorID = -1 OR @UserID IS NULL
    RETURN 1

    -- check if the user requests himself
    IF @ActorID = @UserID
    BEGIN
    	RETURN 1
    END

    DECLARE @IsPeer bit
    DECLARE @OwnerID int

    SELECT @IsPeer = IsPeer, @OwnerID = OwnerID FROM Users
    WHERE UserID = @ActorID

    IF @IsPeer = 1
    SET @ActorID = @OwnerID

    -- check if the user requests his owner
    /*
    IF @ActorID = @UserID
    BEGIN
    	RETURN 0
    END
    */
    IF @ActorID = @UserID
    BEGIN
    	RETURN 1
    END

    DECLARE @ParentUserID int, @TmpUserID int
    SET @TmpUserID = @UserID

    WHILE 10 = 10
    BEGIN

    	SET @ParentUserID = NULL --reset var

    	-- get owner
    	SELECT
    		@ParentUserID = OwnerID
    	FROM Users
    	WHERE UserID = @TmpUserID

    	IF @ParentUserID IS NULL -- the last parent
    		BREAK

    	IF @ParentUserID = @ActorID
    	RETURN 1

    	SET @TmpUserID = @ParentUserID
    END

    RETURN 0
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE FUNCTION [dbo].[CheckExceedingQuota]
    (
    	@PackageID int,
    	@QuotaID int,
    	@QuotaTypeID int
    )
    RETURNS int
    AS
    BEGIN

    DECLARE @ExceedValue int
    SET @ExceedValue = 0

    DECLARE @PackageQuotaValue int
    SET @PackageQuotaValue = dbo.GetPackageAllocatedQuota(@PackageID, @QuotaID)

    -- check boolean quota
    IF @QuotaTypeID = 1-- AND @PackageQuotaValue > 0 -- enabled
    RETURN 0 -- can exceed

    -- check numeric quota
    IF @QuotaTypeID = 2 AND @PackageQuotaValue = -1 -- unlimited
    RETURN 0 -- can exceed

    -- get summary usage for the numeric quota
    DECLARE @UsedQuantity int
    DECLARE @UsedPlans int
    DECLARE @UsedOverrides int
    DECLARE @UsedAddons int

    	-- limited by hosting plans
    	SELECT @UsedPlans = SUM(HPQ.QuotaValue) FROM Packages AS P
    	INNER JOIN HostingPlanQuotas AS HPQ ON P.PlanID = HPQ.PlanID
    	WHERE HPQ.QuotaID = @QuotaID
    		AND P.ParentPackageID = @PackageID
    		AND P.OverrideQuotas = 0

    	-- overrides
    	SELECT @UsedOverrides = SUM(PQ.QuotaValue) FROM Packages AS P
    	INNER JOIN PackageQuotas AS PQ ON P.PackageID = PQ.PackageID AND PQ.QuotaID = @QuotaID
    	WHERE P.ParentPackageID = @PackageID
    		AND P.OverrideQuotas = 1

    	-- addons
    	SELECT @UsedAddons = SUM(HPQ.QuotaValue * PA.Quantity)
    	FROM Packages AS P
    	INNER JOIN PackageAddons AS PA ON P.PackageID = PA.PackageID
    	INNER JOIN HostingPlanQuotas AS HPQ ON PA.PlanID = HPQ.PlanID
    	WHERE P.ParentPackageID = @PackageID AND HPQ.QuotaID = @QuotaID AND PA.StatusID = 1 -- active

    --SET @UsedQuantity = (SELECT SUM(dbo.GetPackageAllocatedQuota(PackageID, @QuotaID)) FROM Packages WHERE ParentPackageID = @PackageID)

    SET @UsedQuantity = @UsedPlans + @UsedOverrides + @UsedAddons

    IF @UsedQuantity IS NULL
    RETURN 0 -- can exceed

    SET @ExceedValue = @UsedQuantity - @PackageQuotaValue

    RETURN @ExceedValue
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE FUNCTION [dbo].[CheckIsUserAdmin]
    (
    	@UserID int
    )
    RETURNS bit
    AS
    BEGIN

    IF @UserID = -1
    RETURN 1

    IF EXISTS (SELECT UserID FROM Users
    WHERE UserID = @UserID AND RoleID = 1) -- administrator
    RETURN 1

    RETURN 0
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE FUNCTION [dbo].[CheckPackageParent]
    (
    	@ParentPackageID int,
    	@PackageID int
    )
    RETURNS bit
    AS
    BEGIN

    -- check if the user requests hiself
    IF @ParentPackageID = @PackageID
    BEGIN
    	RETURN 1
    END

    DECLARE @TmpParentPackageID int, @TmpPackageID int
    SET @TmpPackageID = @PackageID

    WHILE 10 = 10
    BEGIN

    	SET @TmpParentPackageID = NULL --reset var

    	-- get owner
    	SELECT
    		@TmpParentPackageID = ParentPackageID
    	FROM Packages
    	WHERE PackageID = @TmpPackageID

    	IF @TmpParentPackageID IS NULL -- the last parent package
    		BREAK

    	IF @TmpParentPackageID = @ParentPackageID
    	RETURN 1

    	SET @TmpPackageID = @TmpParentPackageID
    END

    RETURN 0
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE FUNCTION [dbo].[CheckUserParent]
    (
    	@OwnerID int,
    	@UserID int
    )
    RETURNS bit
    AS
    BEGIN

    -- check if the user requests himself
    IF @OwnerID = @UserID
    BEGIN
    	RETURN 1
    END

    -- check if the owner is peer
    DECLARE @IsPeer int, @TmpOwnerID int
    SELECT @IsPeer = IsPeer, @TmpOwnerID = OwnerID FROM Users
    WHERE UserID = @OwnerID

    IF @IsPeer = 1
    SET @OwnerID = @TmpOwnerID

    -- check if the user requests himself
    IF @OwnerID = @UserID
    BEGIN
    	RETURN 1
    END

    DECLARE @ParentUserID int, @TmpUserID int
    SET @TmpUserID = @UserID

    WHILE 10 = 10
    BEGIN

    	SET @ParentUserID = NULL --reset var

    	-- get owner
    	SELECT
    		@ParentUserID = OwnerID
    	FROM Users
    	WHERE UserID = @TmpUserID

    	IF @ParentUserID IS NULL -- the last parent
    		BREAK

    	IF @ParentUserID = @OwnerID
    	RETURN 1

    	SET @TmpUserID = @ParentUserID
    END

    RETURN 0
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE FUNCTION [dbo].[GetFullIPAddress]
    (
    	@ExternalIP varchar(24),
    	@InternalIP varchar(24)
    )
    RETURNS varchar(60)
    AS
    BEGIN
    DECLARE @IP varchar(60)
    SET @IP = ''

    IF @ExternalIP IS NOT NULL AND @ExternalIP <> ''
    SET @IP = @ExternalIP

    IF @InternalIP IS NOT NULL AND @InternalIP <> ''
    SET @IP = @IP + ' (' + @InternalIP + ')'

    RETURN @IP
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE FUNCTION [dbo].[GetItemComments]
    (
    	@ItemID int,
    	@ItemTypeID varchar(50),
    	@ActorID int
    )
    RETURNS nvarchar(3000)
    AS
    BEGIN
    DECLARE @text nvarchar(3000)
    SET @text = ''

    SELECT @text = @text + U.Username + ' - ' + CONVERT(nvarchar(50), C.CreatedDate) + '
    ' + CommentText + '
    --------------------------------------
    ' FROM Comments AS C
    INNER JOIN UsersDetailed AS U ON C.UserID = U.UserID
    WHERE
    	ItemID = @ItemID
    	AND ItemTypeID = @ItemTypeID
    	AND dbo.CheckUserParent(@ActorID, C.UserID) = 1
    ORDER BY C.CreatedDate DESC

    RETURN @text
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE FUNCTION [dbo].[GetPackageAllocatedQuota]
    (
    	@PackageID int,
    	@QuotaID int
    )
    RETURNS int
    AS
    BEGIN

    DECLARE @Result int

    DECLARE @QuotaTypeID int
    SELECT @QuotaTypeID = QuotaTypeID FROM Quotas
    WHERE QuotaID = @QuotaID

    IF @QuotaTypeID = 1
    	SET @Result = 1 -- enabled
    ELSE
    	SET @Result = -1 -- unlimited

    DECLARE @PID int, @ParentPackageID int
    SET @PID = @PackageID

    DECLARE @OverrideQuotas bit

    WHILE 1 = 1
    BEGIN

    	DECLARE @QuotaValue int

    	-- get package info
    	SELECT
    		@ParentPackageID = ParentPackageID,
    		@OverrideQuotas = OverrideQuotas
    	FROM Packages WHERE PackageID = @PID

    	SET @QuotaValue = NULL

    	-- check if this is a root 'System' package
    	IF @ParentPackageID IS NULL
    	BEGIN
    		IF @QuotaTypeID = 1 -- boolean
    			SET @QuotaValue = 1 -- enabled
    		ELSE IF @QuotaTypeID > 1 -- numeric
    			SET @QuotaValue = -1 -- unlimited
    	END
    	ELSE
    	BEGIN
    		-- check the current package
    		IF @OverrideQuotas = 1
    			SELECT @QuotaValue = QuotaValue FROM PackageQuotas WHERE QuotaID = @QuotaID AND PackageID = @PID
    		ELSE
    			SELECT @QuotaValue = HPQ.QuotaValue FROM Packages AS P
    			INNER JOIN HostingPlanQuotas AS HPQ ON P.PlanID = HPQ.PlanID
    			WHERE HPQ.QuotaID = @QuotaID AND P.PackageID = @PID

    		IF @QuotaValue IS NULL
    		SET @QuotaValue = 0

    		-- check package addons
    		DECLARE @QuotaAddonValue int
    		SELECT
    			@QuotaAddonValue = SUM(HPQ.QuotaValue * PA.Quantity)
    		FROM PackageAddons AS PA
    		INNER JOIN HostingPlanQuotas AS HPQ ON PA.PlanID = HPQ.PlanID
    		WHERE PA.PackageID = @PID AND HPQ.QuotaID = @QuotaID AND PA.StatusID = 1 -- active

    		-- process bool quota
    		IF @QuotaAddonValue IS NOT NULL
    		BEGIN
    			IF @QuotaTypeID = 1
    			BEGIN
    				IF @QuotaAddonValue > 0 AND @QuotaValue = 0 -- enabled
    				SET @QuotaValue = 1
    			END
    			ELSE
    			BEGIN -- numeric quota
    				IF @QuotaAddonValue < 0 -- unlimited
    					SET @QuotaValue = -1
    				ELSE
    					SET @QuotaValue = @QuotaValue + @QuotaAddonValue
    			END
    		END
    	END

    	-- process bool quota
    	IF @QuotaTypeID = 1
    	BEGIN
    		IF @QuotaValue = 0 OR @QuotaValue IS NULL -- disabled
    		RETURN 0
    	END
    	ELSE
    	BEGIN -- numeric quota
    		IF @QuotaValue = 0 OR @QuotaValue IS NULL -- zero quantity
    		RETURN 0

    		IF (@QuotaValue <> -1 AND @Result = -1) OR (@QuotaValue < @Result AND @QuotaValue <> -1)
    			SET @Result = @QuotaValue
    	END

    	IF @ParentPackageID IS NULL
    	RETURN @Result -- exit from the loop

    	SET @PID = @ParentPackageID

    END -- end while

    RETURN @Result
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE FUNCTION [dbo].[GetPackageAllocatedResource]
    (
    	@PackageID int,
    	@GroupID int,
    	@ServerID int
    )
    RETURNS bit
    AS
    BEGIN

    IF @PackageID IS NULL
    RETURN 1

    DECLARE @Result bit
    SET @Result = 1 -- enabled

    DECLARE @PID int, @ParentPackageID int
    SET @PID = @PackageID

    DECLARE @OverrideQuotas bit

    IF @ServerID IS NULL OR @ServerID = 0
    SELECT @ServerID = ServerID FROM Packages
    WHERE PackageID = @PackageID

    WHILE 1 = 1
    BEGIN

    	DECLARE @GroupEnabled int

    	-- get package info
    	SELECT
    		@ParentPackageID = ParentPackageID,
    		@OverrideQuotas = OverrideQuotas
    	FROM Packages WHERE PackageID = @PID

    	-- check if this is a root 'System' package
    	SET @GroupEnabled = 1 -- enabled
    	IF @ParentPackageID IS NULL
    	BEGIN

    		IF @ServerID = -1 OR @ServerID IS NULL
    		RETURN 1

    		IF EXISTS (SELECT VirtualServer FROM Servers WHERE ServerID = @ServerID AND VirtualServer = 1)
    		BEGIN
    			IF NOT EXISTS(
    				SELECT
    					DISTINCT(PROV.GroupID)
    				FROM VirtualServices AS VS
    				INNER JOIN Services AS S ON VS.ServiceID = S.ServiceID
    				INNER JOIN Providers AS PROV ON S.ProviderID = PROV.ProviderID
    				WHERE PROV.GroupID = @GroupID AND VS.ServerID = @ServerID
    			)
    			SET @GroupEnabled = 0
    		END
    		ELSE
    		BEGIN
    			IF NOT EXISTS(
    				SELECT
    					DISTINCT(PROV.GroupID)
    				FROM Services AS S
    				INNER JOIN Providers AS PROV ON S.ProviderID = PROV.ProviderID
    				WHERE PROV.GroupID = @GroupID AND  S.ServerID = @ServerID
    			)
    			SET @GroupEnabled = 0
    		END

    		RETURN @GroupEnabled -- exit from the loop
    	END
    	ELSE -- parentpackage is not null
    	BEGIN
    		-- check the current package
    		IF @OverrideQuotas = 1
    		BEGIN
    			IF NOT EXISTS(
    				SELECT GroupID FROM PackageResources WHERE GroupID = @GroupID AND PackageID = @PID
    			)
    			SET @GroupEnabled = 0
    		END
    		ELSE
    		BEGIN
    			IF NOT EXISTS(
    				SELECT HPR.GroupID FROM Packages AS P
    				INNER JOIN HostingPlanResources AS HPR ON P.PlanID = HPR.PlanID
    				WHERE HPR.GroupID = @GroupID AND P.PackageID = @PID
    			)
    			SET @GroupEnabled = 0
    		END

    		-- check addons
    		IF EXISTS(
    			SELECT HPR.GroupID FROM PackageAddons AS PA
    			INNER JOIN HostingPlanResources AS HPR ON PA.PlanID = HPR.PlanID
    			WHERE HPR.GroupID = @GroupID AND PA.PackageID = @PID
    			AND PA.StatusID = 1 -- active add-on
    		)
    		SET @GroupEnabled = 1
    	END

    	IF @GroupEnabled = 0
    		RETURN 0

    	SET @PID = @ParentPackageID

    END -- end while

    RETURN @Result
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE FUNCTION [dbo].[GetPackageExceedingQuotas]
    (
    	@PackageID int
    )
    RETURNS @quotas TABLE (QuotaID int, QuotaName nvarchar(50), QuotaValue int)
    AS
    BEGIN

    DECLARE @ParentPackageID int
    DECLARE @PlanID int
    DECLARE @OverrideQuotas bit

    SELECT
    	@ParentPackageID = ParentPackageID,
    	@PlanID = PlanID,
    	@OverrideQuotas = OverrideQuotas
    FROM Packages WHERE PackageID = @PackageID

    IF @ParentPackageID IS NOT NULL -- not root package
    BEGIN

    	IF @OverrideQuotas = 0 -- hosting plan quotas
    		BEGIN
    			INSERT INTO @quotas (QuotaID, QuotaName, QuotaValue)
    			SELECT
    				Q.QuotaID,
    				Q.QuotaName,
    				dbo.CheckExceedingQuota(@PackageID, Q.QuotaID, Q.QuotaTypeID) AS QuotaValue
    			FROM HostingPlanQuotas AS HPQ
    			INNER JOIN Quotas AS Q ON HPQ.QuotaID = Q.QuotaID
    			WHERE HPQ.PlanID = @PlanID AND Q.QuotaTypeID <> 3
    		END
    	ELSE -- overriden quotas
    		BEGIN
    			INSERT INTO @quotas (QuotaID, QuotaName, QuotaValue)
    			SELECT
    				Q.QuotaID,
    				Q.QuotaName,
    				dbo.CheckExceedingQuota(@PackageID, Q.QuotaID, Q.QuotaTypeID) AS QuotaValue
    			FROM PackageQuotas AS PQ
    			INNER JOIN Quotas AS Q ON PQ.QuotaID = Q.QuotaID
    			WHERE PQ.PackageID = @PackageID AND Q.QuotaTypeID <> 3
    		END
    END -- if 'root' package

    RETURN
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE FUNCTION [dbo].[GetPackageServiceLevelResource]
    (
    	@PackageID int,
    	@GroupID int,
    	@ServerID int
    )
    RETURNS bit
    AS
    BEGIN

    IF NOT EXISTS (SELECT * FROM dbo.ResourceGroups WHERE GroupID = @GroupID AND GroupName = 'Service Levels')
    RETURN 0

    IF @PackageID IS NULL
    RETURN 1

    DECLARE @Result bit
    SET @Result = 1 -- enabled

    DECLARE @PID int, @ParentPackageID int
    SET @PID = @PackageID

    DECLARE @OverrideQuotas bit

    IF @ServerID IS NULL OR @ServerID = 0
    SELECT @ServerID = ServerID FROM Packages
    WHERE PackageID = @PackageID

    WHILE 1 = 1
    BEGIN

    	DECLARE @GroupEnabled int

    	-- get package info
    	SELECT
    		@ParentPackageID = ParentPackageID,
    		@OverrideQuotas = OverrideQuotas
    	FROM Packages WHERE PackageID = @PID

    	-- check if this is a root 'System' package
    	SET @GroupEnabled = 1 -- enabled
    	IF @ParentPackageID IS NULL
    	BEGIN

    		IF @ServerID = 0
    		RETURN 0
    		ELSE IF @PID = -1
    		RETURN 1
    		ELSE IF @ServerID IS NULL
    		RETURN 1
    		ELSE IF @ServerID > 0
    		RETURN 1
    		ELSE RETURN 0
    	END
    	ELSE -- parentpackage is not null
    	BEGIN
    		-- check the current package
    		IF @OverrideQuotas = 1
    		BEGIN
    			IF NOT EXISTS(
    				SELECT GroupID FROM PackageResources WHERE GroupID = @GroupID AND PackageID = @PID
    			)
    			SET @GroupEnabled = 0
    		END
    		ELSE
    		BEGIN
    			IF NOT EXISTS(
    				SELECT HPR.GroupID FROM Packages AS P
    				INNER JOIN HostingPlanResources AS HPR ON P.PlanID = HPR.PlanID
    				WHERE HPR.GroupID = @GroupID AND P.PackageID = @PID
    			)
    			SET @GroupEnabled = 0
    		END

    		-- check addons
    		IF EXISTS(
    			SELECT HPR.GroupID FROM PackageAddons AS PA
    			INNER JOIN HostingPlanResources AS HPR ON PA.PlanID = HPR.PlanID
    			WHERE HPR.GroupID = @GroupID AND PA.PackageID = @PID
    			AND PA.StatusID = 1 -- active add-on
    		)
    		SET @GroupEnabled = 1
    	END

    	IF @GroupEnabled = 0
    		RETURN 0

    	SET @PID = @ParentPackageID

    END -- end while

    RETURN @Result
    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE FUNCTION [dbo].[PackageParents]
    (
    	@PackageID int
    )
    RETURNS @T TABLE (PackageOrder int IDENTITY(1,1), PackageID int)
    AS
    BEGIN
    	-- insert current user
    	INSERT @T VALUES (@PackageID)

    	-- owner
    	DECLARE @ParentPackageID int, @TmpPackageID int
    	SET @TmpPackageID = @PackageID

    	WHILE 10 = 10
    	BEGIN

    		SET @ParentPackageID = NULL --reset var
    		SELECT @ParentPackageID = ParentPackageID FROM Packages
    		WHERE PackageID = @TmpPackageID

    		IF @ParentPackageID IS NULL -- parent not found
    		BREAK

    		INSERT @T VALUES (@ParentPackageID)

    		SET @TmpPackageID = @ParentPackageID
    	END

    RETURN
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE FUNCTION [dbo].[PackagesTree]
    (
    	@PackageID int,
    	@Recursive bit = 0
    )
    RETURNS @T TABLE (PackageID int)
    AS
    BEGIN

    INSERT INTO @T VALUES (@PackageID)

    IF @Recursive = 1
    BEGIN
    	WITH RecursivePackages(ParentPackageID, PackageID, PackageLevel) AS
    	(
    		SELECT ParentPackageID, PackageID, 0 AS PackageLevel
    		FROM Packages
    		WHERE ParentPackageID = @PackageID
    		UNION ALL
    		SELECT p.ParentPackageID, p.PackageID, PackageLevel + 1
    		FROM Packages p
    			INNER JOIN RecursivePackages d
    			ON p.ParentPackageID = d.PackageID
    		WHERE @Recursive = 1
    	)
    	INSERT INTO @T
    	SELECT PackageID
    	FROM RecursivePackages
    END

    RETURN
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE FUNCTION [dbo].[SplitString] (@stringToSplit VARCHAR(MAX), @separator CHAR)
    RETURNS
     @returnList TABLE ([value] [nvarchar] (500))
    AS
    BEGIN

     DECLARE @value NVARCHAR(255)
     DECLARE @pos INT

     WHILE CHARINDEX(@separator, @stringToSplit) > 0
     BEGIN
      SELECT @pos  = CHARINDEX(@separator, @stringToSplit)  
      SELECT @value = SUBSTRING(@stringToSplit, 1, @pos-1)

      INSERT INTO @returnList 
      SELECT @value

      SELECT @stringToSplit = SUBSTRING(@stringToSplit, @pos+1, LEN(@stringToSplit)-@pos)
     END

     INSERT INTO @returnList
     SELECT @stringToSplit

     RETURN
    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE FUNCTION [dbo].[UserParents]
    (
    	@ActorID int,
    	@UserID int
    )
    RETURNS @T TABLE (UserOrder int IDENTITY(1,1), UserID int)
    AS
    BEGIN
    	-- insert current user
    	INSERT @T VALUES (@UserID)

    	DECLARE @TopUserID int
    	IF @ActorID = -1
    	BEGIN
    		SELECT @TopUserID = UserID FROM Users WHERE OwnerID IS NULL
    	END
    	ELSE
    	BEGIN
    		SET @TopUserID = @ActorID

    		IF EXISTS (SELECT UserID FROM Users WHERE UserID = @ActorID AND IsPeer = 1)
    		SELECT @TopUserID = OwnerID FROM Users WHERE UserID = @ActorID AND IsPeer = 1
    	END

    	-- owner
    	DECLARE @OwnerID int, @TmpUserID int

    	SET @TmpUserID = @UserID

    	WHILE (@TmpUserID <> @TopUserID)
    	BEGIN

    		SET @OwnerID = NULL
    		SELECT @OwnerID = OwnerID FROM Users WHERE UserID = @TmpUserID

    		IF @OwnerID IS NOT NULL
    		BEGIN
    			INSERT @T VALUES (@OwnerID)
    			SET @TmpUserID = @OwnerID
    		END
    	END

    RETURN
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE FUNCTION [dbo].[UsersTree]
    (
    	@OwnerID int,
    	@Recursive bit = 0
    )
    RETURNS @T TABLE (UserID int)
    AS
    BEGIN

    	IF @Recursive = 1
    	BEGIN
    		-- insert "root" user
    		INSERT @T VALUES(@OwnerID)

    		-- get all children recursively
    		WHILE @@ROWCOUNT > 0
    		BEGIN
    			INSERT @T SELECT UserID
    			FROM Users
    			WHERE OwnerID IN(SELECT UserID from @T) AND UserID NOT IN(SELECT UserID FROM @T)
    		END
    	END
    	ELSE
    	BEGIN
    		INSERT @T VALUES(@OwnerID)
    	END

    RETURN
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[AddAccessToken]
    (
    	@TokenID INT OUTPUT,
    	@AccessToken UNIQUEIDENTIFIER,
    	@ExpirationDate DATETIME,
    	@AccountID INT,
    	@ItemId INT,
    	@TokenType INT
    )
    AS
    INSERT INTO AccessTokens
    (
    	AccessTokenGuid,
    	ExpirationDate,
    	AccountID  ,
    	ItemId,
    	TokenType
    )
    VALUES
    (
    	@AccessToken  ,
    	@ExpirationDate ,
    	@AccountID,
    	@ItemId,
    	@TokenType
    )

    SET @TokenID = SCOPE_IDENTITY()

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddAdditionalGroup]
    (
    	@GroupID INT OUTPUT,
    	@UserID INT,
    	@GroupName NVARCHAR(255)
    )
    AS

    INSERT INTO AdditionalGroups
    (
    	UserID,
    	GroupName
    )
    VALUES
    (
    	@UserID,
    	@GroupName
    )

    SET @GroupID = SCOPE_IDENTITY()

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddAuditLogRecord]
    (
    	@RecordID varchar(32),
    	@SeverityID int,
    	@UserID int,
    	@PackageID int,
    	@Username nvarchar(50),
    	@ItemID int,
    	@StartDate datetime,
    	@FinishDate datetime,
    	@SourceName varchar(50),
    	@TaskName varchar(50),
    	@ItemName nvarchar(50),
    	@ExecutionLog ntext
    )
    AS

    IF @ItemID = 0 SET @ItemID = NULL
    IF @UserID = 0 OR @UserID = -1 SET @UserID = NULL

    INSERT INTO AuditLog
    (
    	RecordID,
    	SeverityID,
    	UserID,
    	PackageID,
    	Username,
    	ItemID,
    	SourceName,
    	StartDate,
    	FinishDate,
    	TaskName,
    	ItemName,
    	ExecutionLog
    )
    VALUES
    (
    	@RecordID,
    	@SeverityID,
    	@UserID,
    	@PackageID,
    	@Username,
    	@ItemID,
    	@SourceName,
    	@StartDate,
    	@FinishDate,
    	@TaskName,
    	@ItemName,
    	@ExecutionLog
    )
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddBackgroundTask]
    (
    	@BackgroundTaskID INT OUTPUT,
    	@Guid UNIQUEIDENTIFIER,
    	@TaskID NVARCHAR(255),
    	@ScheduleID INT,
    	@PackageID INT,
    	@UserID INT,
    	@EffectiveUserID INT,
    	@TaskName NVARCHAR(255),
    	@ItemID INT,
    	@ItemName NVARCHAR(255),
    	@StartDate DATETIME,
    	@IndicatorCurrent INT,
    	@IndicatorMaximum INT,
    	@MaximumExecutionTime INT,
    	@Source NVARCHAR(MAX),
    	@Severity INT,
    	@Completed BIT,
    	@NotifyOnComplete BIT,
    	@Status INT
    )
    AS

    INSERT INTO BackgroundTasks
    (
    	Guid,
    	TaskID,
    	ScheduleID,
    	PackageID,
    	UserID,
    	EffectiveUserID,
    	TaskName,
    	ItemID,
    	ItemName,
    	StartDate,
    	IndicatorCurrent,
    	IndicatorMaximum,
    	MaximumExecutionTime,
    	Source,
    	Severity,
    	Completed,
    	NotifyOnComplete,
    	Status
    )
    VALUES
    (
    	@Guid,
    	@TaskID,
    	@ScheduleID,
    	@PackageID,
    	@UserID,
    	@EffectiveUserID,
    	@TaskName,
    	@ItemID,
    	@ItemName,
    	@StartDate,
    	@IndicatorCurrent,
    	@IndicatorMaximum,
    	@MaximumExecutionTime,
    	@Source,
    	@Severity,
    	@Completed,
    	@NotifyOnComplete,
    	@Status
    )

    SET @BackgroundTaskID = SCOPE_IDENTITY()

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddBackgroundTaskLog]
    (
    	@TaskID INT,
    	@Date DATETIME,
    	@ExceptionStackTrace NTEXT,
    	@InnerTaskStart INT,
    	@Severity INT,
    	@Text NTEXT,
    	@TextIdent INT,
    	@XmlParameters NTEXT
    )
    AS

    INSERT INTO BackgroundTaskLogs
    (
    	TaskID,
    	Date,
    	ExceptionStackTrace,
    	InnerTaskStart,
    	Severity,
    	Text,
    	TextIdent,
    	XmlParameters
    )
    VALUES
    (
    	@TaskID,
    	@Date,
    	@ExceptionStackTrace,
    	@InnerTaskStart,
    	@Severity,
    	@Text,
    	@TextIdent,
    	@XmlParameters
    )
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddBackgroundTaskParam]
    (
    	@TaskID INT,
    	@Name NVARCHAR(255),
    	@Value NTEXT,
    	@TypeName NVARCHAR(255)
    )
    AS

    INSERT INTO BackgroundTaskParameters
    (
    	TaskID,
    	Name,
    	SerializerValue,
    	TypeName
    )
    VALUES
    (
    	@TaskID,
    	@Name,
    	@Value,
    	@TypeName
    )
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddBackgroundTaskStack]
    (
    	@TaskID INT
    )
    AS

    INSERT INTO BackgroundTaskStack
    (
    	TaskID
    )
    VALUES
    (
    	@TaskID
    )
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddBlackBerryUser]
    	@AccountID int
    AS
    BEGIN
    	SET NOCOUNT ON;

    INSERT INTO
    	dbo.BlackBerryUsers
    	(

    	 AccountID,
    	 CreatedDate,
    	 ModifiedDate)
    VALUES
    (
    	@AccountID,
    	getdate(),
    	getdate()
    )
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddCluster]
    (
    	@ClusterID int OUTPUT,
    	@ClusterName nvarchar(100)
    )
    AS
    INSERT INTO Clusters
    (
    	ClusterName
    )
    VALUES
    (
    	@ClusterName
    )

    SET @ClusterID = SCOPE_IDENTITY()
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddComment]
    (
    	@ActorID int,
    	@ItemTypeID varchar(50),
    	@ItemID int,
    	@CommentText nvarchar(1000),
    	@SeverityID int
    )
    AS
    INSERT INTO Comments
    (
    	ItemTypeID,
    	ItemID,
    	UserID,
    	CreatedDate,
    	CommentText,
    	SeverityID
    )
    VALUES
    (
    	@ItemTypeID,
    	@ItemID,
    	@ActorID,
    	GETDATE(),
    	@CommentText,
    	@SeverityID
    )
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddDnsRecord]
    (
    	@ActorID int,
    	@ServiceID int,
    	@ServerID int,
    	@PackageID int,
    	@RecordType nvarchar(10),
    	@RecordName nvarchar(50),
    	@RecordData nvarchar(500),
    	@MXPriority int,
    	@SrvPriority int,
    	@SrvWeight int,
    	@SrvPort int,
    	@IPAddressID int
    )
    AS

    IF (@ServiceID > 0 OR @ServerID > 0) AND dbo.CheckIsUserAdmin(@ActorID) = 0
    RAISERROR('You should have administrator role to perform such operation', 16, 1)

    IF (@PackageID > 0) AND dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    IF @ServiceID = 0 SET @ServiceID = NULL
    IF @ServerID = 0 SET @ServerID = NULL
    IF @PackageID = 0 SET @PackageID = NULL
    IF @IPAddressID = 0 SET @IPAddressID = NULL

    IF EXISTS
    (
    	SELECT RecordID FROM GlobalDnsRecords WHERE
    	ServiceID = @ServiceID AND ServerID = @ServerID AND PackageID = @PackageID
    	AND RecordName = @RecordName AND RecordType = @RecordType
    )

    	UPDATE GlobalDnsRecords
    	SET
    		RecordData = RecordData,
    		MXPriority = MXPriority,
    		SrvPriority = SrvPriority,
    		SrvWeight = SrvWeight,
    		SrvPort = SrvPort,

    		IPAddressID = @IPAddressID
    	WHERE
    		ServiceID = @ServiceID AND ServerID = @ServerID AND PackageID = @PackageID
    ELSE
    	INSERT INTO GlobalDnsRecords
    	(
    		ServiceID,
    		ServerID,
    		PackageID,
    		RecordType,
    		RecordName,
    		RecordData,
    		MXPriority,
    		SrvPriority,
    		SrvWeight,
    		SrvPort,
    		IPAddressID
    	)
    	VALUES
    	(
    		@ServiceID,
    		@ServerID,
    		@PackageID,
    		@RecordType,
    		@RecordName,
    		@RecordData,
    		@MXPriority,
    		@SrvPriority,
    		@SrvWeight,
    		@SrvPort,
    		@IPAddressID
    	)

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[AddDomain]
    (
    	@DomainID int OUTPUT,
    	@ActorID int,
    	@PackageID int,
    	@ZoneItemID int,
    	@DomainName nvarchar(200),
    	@HostingAllowed bit,
    	@WebSiteID int,
    	@MailDomainID int,
    	@IsSubDomain bit,
    	@IsPreviewDomain bit,
    	@IsDomainPointer bit
    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    IF @ZoneItemID = 0 SET @ZoneItemID = NULL
    IF @WebSiteID = 0 SET @WebSiteID = NULL
    IF @MailDomainID = 0 SET @MailDomainID = NULL

    -- insert record
    INSERT INTO Domains
    (
    	PackageID,
    	ZoneItemID,
    	DomainName,
    	HostingAllowed,
    	WebSiteID,
    	MailDomainID,
    	IsSubDomain,
    	IsPreviewDomain,
    	IsDomainPointer
    )
    VALUES
    (
    	@PackageID,
    	@ZoneItemID,
    	@DomainName,
    	@HostingAllowed,
    	@WebSiteID,
    	@MailDomainID,
    	@IsSubDomain,
    	@IsPreviewDomain,
    	@IsDomainPointer
    )

    SET @DomainID = SCOPE_IDENTITY()
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[AddDomainDnsRecord]
    (
    	@DomainId INT,
    	@RecordType INT,
    	@DnsServer NVARCHAR(255),
    	@Value NVARCHAR(255),
    	@Date DATETIME
    )
    AS

    INSERT INTO DomainDnsRecords
    (
    	DomainId,
    	DnsServer,
    	RecordType,
    	Value,
    	Date
    )
    VALUES
    (
    	@DomainId,
    	@DnsServer,
    	@RecordType,
    	@Value,
    	@Date
    )
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddEnterpriseFolder]
    (
    	@FolderID INT OUTPUT,
    	@ItemID INT,
    	@FolderName NVARCHAR(255),
    	@FolderQuota INT,
    	@LocationDrive NVARCHAR(255),
    	@HomeFolder NVARCHAR(255),
    	@Domain NVARCHAR(255),
    	@StorageSpaceFolderId INT
    )
    AS

    INSERT INTO EnterpriseFolders
    (
    	ItemID,
    	FolderName,
    	FolderQuota,
    	LocationDrive,
    	HomeFolder,
    	Domain,
    	StorageSpaceFolderId
    )
    VALUES
    (
    	@ItemID,
    	@FolderName,
    	@FolderQuota,
    	@LocationDrive,
    	@HomeFolder,
    	@Domain,
    	@StorageSpaceFolderId
    )

    SET @FolderID = SCOPE_IDENTITY()

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[AddEnterpriseFolderOwaUser]
    (
    	@ESOwsaUserId INT OUTPUT,
    	@ItemID INT,
    	@FolderID INT, 
    	@AccountID INT 
    )
    AS
    INSERT INTO EnterpriseFoldersOwaPermissions
    (
    	ItemID ,
    	FolderID, 
    	AccountID
    )
    VALUES
    (
    	@ItemID,
    	@FolderID, 
    	@AccountID 
    )

    SET @ESOwsaUserId = SCOPE_IDENTITY()

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[AddExchangeAccount] 
    (
    	@AccountID int OUTPUT,
    	@ItemID int,
    	@AccountType int,
    	@AccountName nvarchar(300),
    	@DisplayName nvarchar(300),
    	@PrimaryEmailAddress nvarchar(300),
    	@MailEnabledPublicFolder bit,
    	@MailboxManagerActions varchar(200),
    	@SamAccountName nvarchar(100),
    	@MailboxPlanId int,
    	@SubscriberNumber nvarchar(32)
    )
    AS

    INSERT INTO ExchangeAccounts
    (
    	ItemID,
    	AccountType,
    	AccountName,
    	DisplayName,
    	PrimaryEmailAddress,
    	MailEnabledPublicFolder,
    	MailboxManagerActions,
    	SamAccountName,
    	MailboxPlanId,
    	SubscriberNumber,
    	UserPrincipalName
    )
    VALUES
    (
    	@ItemID,
    	@AccountType,
    	@AccountName,
    	@DisplayName,
    	@PrimaryEmailAddress,
    	@MailEnabledPublicFolder,
    	@MailboxManagerActions,
    	@SamAccountName,
    	@MailboxPlanId,
    	@SubscriberNumber,
    	@PrimaryEmailAddress
    )

    SET @AccountID = SCOPE_IDENTITY()

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddExchangeAccountEmailAddress]
    (
    	@AccountID int,
    	@EmailAddress nvarchar(300)
    )
    AS
    INSERT INTO ExchangeAccountEmailAddresses
    (
    	AccountID,
    	EmailAddress
    )
    VALUES
    (
    	@AccountID,
    	@EmailAddress
    )
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[AddExchangeDisclaimer] 
    (
    	@ExchangeDisclaimerId int OUTPUT,
    	@ItemID int,
    	@DisclaimerName	nvarchar(300),
    	@DisclaimerText	nvarchar(MAX)
    )
    AS

    INSERT INTO ExchangeDisclaimers
    (
    	ItemID,
    	DisclaimerName,
    	DisclaimerText
    )
    VALUES
    (
    	@ItemID,
    	@DisclaimerName,
    	@DisclaimerText
    )

    SET @ExchangeDisclaimerId = SCOPE_IDENTITY()

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddExchangeMailboxPlan] 
    (
    	@MailboxPlanId int OUTPUT,
    	@ItemID int,
    	@MailboxPlan	nvarchar(300),
    	@EnableActiveSync bit,
    	@EnableIMAP bit,
    	@EnableMAPI bit,
    	@EnableOWA bit,
    	@EnablePOP bit,
    	@EnableAutoReply bit,
    	@IsDefault bit,
    	@IssueWarningPct int,
    	@KeepDeletedItemsDays int,
    	@MailboxSizeMB int,
    	@MaxReceiveMessageSizeKB int,
    	@MaxRecipients int,
    	@MaxSendMessageSizeKB int,
    	@ProhibitSendPct int,
    	@ProhibitSendReceivePct int	,
    	@HideFromAddressBook bit,
    	@MailboxPlanType int,
    	@AllowLitigationHold bit,
    	@RecoverableItemsWarningPct int,
    	@RecoverableItemsSpace int,
    	@LitigationHoldUrl nvarchar(256),
    	@LitigationHoldMsg nvarchar(512),
    	@Archiving bit,
    	@EnableArchiving bit,
    	@ArchiveSizeMB int,
    	@ArchiveWarningPct int,
    	@EnableForceArchiveDeletion bit,
    	@IsForJournaling bit
    )
    AS

    IF (((SELECT Count(*) FROM ExchangeMailboxPlans WHERE ItemId = @ItemID) = 0) AND (@MailboxPlanType=0))
    BEGIN
    	SET @IsDefault = 1
    END
    ELSE
    BEGIN
    	IF ((@IsDefault = 1) AND (@MailboxPlanType=0))
    	BEGIN
    		UPDATE ExchangeMailboxPlans SET IsDefault = 0 WHERE ItemID = @ItemID
    	END
    END

    INSERT INTO ExchangeMailboxPlans
    (
    	ItemID,
    	MailboxPlan,
    	EnableActiveSync,
    	EnableIMAP,
    	EnableMAPI,
    	EnableOWA,
    	EnablePOP,
    	EnableAutoReply,
    	IsDefault,
    	IssueWarningPct,
    	KeepDeletedItemsDays,
    	MailboxSizeMB,
    	MaxReceiveMessageSizeKB,
    	MaxRecipients,
    	MaxSendMessageSizeKB,
    	ProhibitSendPct,
    	ProhibitSendReceivePct,
    	HideFromAddressBook,
    	MailboxPlanType,
    	AllowLitigationHold,
    	RecoverableItemsWarningPct,
    	RecoverableItemsSpace,
    	LitigationHoldUrl,
    	LitigationHoldMsg,
    	Archiving,
    	EnableArchiving,
    	ArchiveSizeMB,
    	ArchiveWarningPct,
    	EnableForceArchiveDeletion,
    	IsForJournaling
    )
    VALUES
    (
    	@ItemID,
    	@MailboxPlan,
    	@EnableActiveSync,
    	@EnableIMAP,
    	@EnableMAPI,
    	@EnableOWA,
    	@EnablePOP,
    	@EnableAutoReply,
    	@IsDefault,
    	@IssueWarningPct,
    	@KeepDeletedItemsDays,
    	@MailboxSizeMB,
    	@MaxReceiveMessageSizeKB,
    	@MaxRecipients,
    	@MaxSendMessageSizeKB,
    	@ProhibitSendPct,
    	@ProhibitSendReceivePct,
    	@HideFromAddressBook,
    	@MailboxPlanType,
    	@AllowLitigationHold,
    	@RecoverableItemsWarningPct,
    	@RecoverableItemsSpace,
    	@LitigationHoldUrl,
    	@LitigationHoldMsg,
    	@Archiving,
    	@EnableArchiving,
    	@ArchiveSizeMB,
    	@ArchiveWarningPct,
    	@EnableForceArchiveDeletion,
    	@IsForJournaling
    )

    SET @MailboxPlanId = SCOPE_IDENTITY()

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddExchangeMailboxPlanRetentionPolicyTag] 
    (
    	@PlanTagID int OUTPUT,
    	@TagID int,
    	@MailboxPlanId int
    )
    AS
    BEGIN

    INSERT INTO ExchangeMailboxPlanRetentionPolicyTags
    (
    	TagID,
    	MailboxPlanId
    )
    VALUES
    (
    	@TagID,
    	@MailboxPlanId
    )

    SET @PlanTagID = SCOPE_IDENTITY()

    RETURN

    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddExchangeOrganization]
    (
    	@ItemID int,
    	@OrganizationID nvarchar(128)
    )
    AS

    IF NOT EXISTS(SELECT * FROM ExchangeOrganizations WHERE OrganizationID = @OrganizationID)
    BEGIN
    	INSERT INTO ExchangeOrganizations
    	(ItemID, OrganizationID)
    	VALUES
    	(@ItemID, @OrganizationID)
    END

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddExchangeOrganizationDomain]
    (
    	@ItemID int,
    	@DomainID int,
    	@IsHost bit
    )
    AS
    INSERT INTO ExchangeOrganizationDomains
    (ItemID, DomainID, IsHost)
    VALUES
    (@ItemID, @DomainID, @IsHost)
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddExchangeRetentionPolicyTag] 
    (
    	@TagID int OUTPUT,
    	@ItemID int,
    	@TagName nvarchar(255),
    	@TagType int,
    	@AgeLimitForRetention int,
    	@RetentionAction int
    )
    AS
    BEGIN

    INSERT INTO ExchangeRetentionPolicyTags
    (
    	ItemID,
    	TagName,
    	TagType,
    	AgeLimitForRetention,
    	RetentionAction
    )
    VALUES
    (
    	@ItemID,
    	@TagName,
    	@TagType,
    	@AgeLimitForRetention,
    	@RetentionAction
    )

    SET @TagID = SCOPE_IDENTITY()

    RETURN

    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddHostingPlan]
    (
    	@ActorID int,
    	@PlanID int OUTPUT,
    	@UserID int,
    	@PackageID int,
    	@PlanName nvarchar(200),
    	@PlanDescription ntext,
    	@Available bit,
    	@ServerID int,
    	@SetupPrice money,
    	@RecurringPrice money,
    	@RecurrenceLength int,
    	@RecurrenceUnit int,
    	@IsAddon bit,
    	@QuotasXml ntext
    )
    AS

    -- check rights
    IF dbo.CheckActorUserRights(@ActorID, @UserID) = 0
    RAISERROR('You are not allowed to access this account', 16, 1)

    BEGIN TRAN

    IF @ServerID = 0
    SELECT @ServerID = ServerID FROM Packages
    WHERE PackageID = @PackageID

    IF @IsAddon = 1
    SET @ServerID = NULL

    IF @PackageID = 0 SET @PackageID = NULL

    INSERT INTO HostingPlans
    (
    	UserID,
    	PackageID,
    	PlanName,
    	PlanDescription,
    	Available,
    	ServerID,
    	SetupPrice,
    	RecurringPrice,
    	RecurrenceLength,
    	RecurrenceUnit,
    	IsAddon
    )
    VALUES
    (
    	@UserID,
    	@PackageID,
    	@PlanName,
    	@PlanDescription,
    	@Available,
    	@ServerID,
    	@SetupPrice,
    	@RecurringPrice,
    	@RecurrenceLength,
    	@RecurrenceUnit,
    	@IsAddon
    )

    SET @PlanID = SCOPE_IDENTITY()

    -- save quotas
    EXEC UpdateHostingPlanQuotas @ActorID, @PlanID, @QuotasXml

    COMMIT TRAN
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddIPAddress]
    (
     @AddressID int OUTPUT,
     @ServerID int,
     @ExternalIP varchar(24),
     @InternalIP varchar(24),
     @PoolID int,
     @SubnetMask varchar(15),
     @DefaultGateway varchar(15),
     @Comments ntext,
     @VLAN int
    )
    AS
    BEGIN
     IF @ServerID = 0
     SET @ServerID = NULL

     INSERT INTO IPAddresses (ServerID, ExternalIP, InternalIP, PoolID, SubnetMask, DefaultGateway, Comments, VLAN)
     VALUES (@ServerID, @ExternalIP, @InternalIP, @PoolID, @SubnetMask, @DefaultGateway, @Comments, @VLAN)

     SET @AddressID = SCOPE_IDENTITY()

     RETURN
    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddItemIPAddress]
    (
    	@ActorID int,
    	@ItemID int,
    	@PackageAddressID int
    )
    AS
    BEGIN
    	UPDATE PackageIPAddresses
    	SET
    		ItemID = @ItemID,
    		IsPrimary = 0
    	FROM PackageIPAddresses AS PIP
    	WHERE
    		PIP.PackageAddressID = @PackageAddressID
    		AND dbo.CheckActorPackageRights(@ActorID, PIP.PackageID) = 1
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddItemPrivateIPAddress]
    (
    	@ActorID int,
    	@ItemID int,
    	@IPAddress varchar(15)
    )
    AS

    IF EXISTS (SELECT ItemID FROM ServiceItems AS SI WHERE
    	ItemID = @ItemID AND -- bugfix added by Simon Egli, 27.6.2024
    	dbo.CheckActorPackageRights(@ActorID, SI.PackageID) = 1)
    BEGIN

    	INSERT INTO PrivateIPAddresses
    	(
    		ItemID,
    		IPAddress,
    		IsPrimary
    	)
    	VALUES
    	(
    		@ItemID,
    		@IPAddress,
    		0 -- not primary
    	)

    END

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddLevelResourceGroups]
    (
    	@LevelId INT,
    	@GroupId INT
    )
    AS
    	INSERT INTO [dbo].[StorageSpaceLevelResourceGroups] (LevelId, GroupId)
    	VALUES (@LevelId, @GroupId)
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddLyncUser]
    	@AccountID int,
    	@LyncUserPlanID int,
    	@SipAddress nvarchar(300)
    AS
    INSERT INTO
    	dbo.LyncUsers
    	(AccountID,
    	 LyncUserPlanID,
    	 CreatedDate,
    	 ModifiedDate,
    	 SipAddress)
    VALUES
    (
    	@AccountID,
    	@LyncUserPlanID,
    	getdate(),
    	getdate(),
    	@SipAddress
    )

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[AddLyncUserPlan] 
    (
    	@LyncUserPlanId int OUTPUT,
    	@ItemID int,
    	@LyncUserPlanName	nvarchar(300),
    	@LyncUserPlanType int,
    	@IM bit,
    	@Mobility bit,
    	@MobilityEnableOutsideVoice bit,
    	@Federation bit,
    	@Conferencing bit,
    	@EnterpriseVoice bit,
    	@VoicePolicy int,
    	@IsDefault bit,

    	@RemoteUserAccess bit,
    	@PublicIMConnectivity bit,

    	@AllowOrganizeMeetingsWithExternalAnonymous bit,

    	@Telephony int,

    	@ServerURI nvarchar(300),

    	@ArchivePolicy  nvarchar(300),
    	@TelephonyDialPlanPolicy nvarchar(300),
    	@TelephonyVoicePolicy nvarchar(300)

    )
    AS

    IF (((SELECT Count(*) FROM LyncUserPlans WHERE ItemId = @ItemID) = 0) AND (@LyncUserPlanType=0))
    BEGIN
    	SET @IsDefault = 1
    END
    ELSE
    BEGIN
    	IF ((@IsDefault = 1) AND (@LyncUserPlanType=0))
    	BEGIN
    		UPDATE LyncUserPlans SET IsDefault = 0 WHERE ItemID = @ItemID
    	END
    END

    INSERT INTO LyncUserPlans
    (
    	ItemID,
    	LyncUserPlanName,
    	LyncUserPlanType,
    	IM,
    	Mobility,
    	MobilityEnableOutsideVoice,
    	Federation,
    	Conferencing,
    	EnterpriseVoice,
    	VoicePolicy,
    	IsDefault,

    	RemoteUserAccess,
    	PublicIMConnectivity,

    	AllowOrganizeMeetingsWithExternalAnonymous,

    	Telephony,

    	ServerURI,

    	ArchivePolicy,
    	TelephonyDialPlanPolicy,
    	TelephonyVoicePolicy

    )
    VALUES
    (
    	@ItemID,
    	@LyncUserPlanName,
    	@LyncUserPlanType,
    	@IM,
    	@Mobility,
    	@MobilityEnableOutsideVoice,
    	@Federation,
    	@Conferencing,
    	@EnterpriseVoice,
    	@VoicePolicy,
    	@IsDefault,

    	@RemoteUserAccess,
    	@PublicIMConnectivity,

    	@AllowOrganizeMeetingsWithExternalAnonymous,

    	@Telephony,

    	@ServerURI,

    	@ArchivePolicy,
    	@TelephonyDialPlanPolicy,
    	@TelephonyVoicePolicy

    )

    SET @LyncUserPlanId = SCOPE_IDENTITY()

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddOCSUser]
    	@AccountID int,
    	@InstanceID nvarchar(50)
    AS
    BEGIN
    	SET NOCOUNT ON;

    INSERT INTO
    	dbo.OCSUsers
    	(

    	 AccountID,
         InstanceID,
    	 CreatedDate,
    	 ModifiedDate)
    VALUES
    (
    	@AccountID,
    	@InstanceID,
    	getdate(),
    	getdate()
    )
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddOrganizationDeletedUser] 
    (
    	@ID int OUTPUT,
    	@AccountID int,
    	@OriginAT int,
    	@StoragePath nvarchar(255),
    	@FolderName nvarchar(128),
    	@FileName nvarchar(128),
    	@ExpirationDate datetime
    )
    AS

    INSERT INTO ExchangeDeletedAccounts
    (
    	AccountID,
    	OriginAT,
    	StoragePath,
    	FolderName,
    	FileName,
    	ExpirationDate
    )
    VALUES
    (
    	@AccountID,
    	@OriginAT,
    	@StoragePath,
    	@FolderName,
    	@FileName,
    	@ExpirationDate
    )

    SET @ID = SCOPE_IDENTITY()

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddOrganizationStoragSpacesFolder]
    (
    	@Id INT OUTPUT,
    	@ItemId INT,
    	@Type varchar(100),
    	@StorageSpaceFolderId INT
    )
    AS
    	INSERT INTO [ExchangeOrganizationSsFolders]
    	(
    		ItemId,
    		Type,
    		StorageSpaceFolderId
    	)
    	VALUES 
    	(
    		@ItemId,
    		@Type,
    		@StorageSpaceFolderId
    	)

    	SET @Id = @StorageSpaceFolderId
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddPackage]
    (
    	@ActorID int,
    	@PackageID int OUTPUT,
    	@UserID int,
    	@PackageName nvarchar(300),
    	@PackageComments ntext,
    	@StatusID int,
    	@PlanID int,
    	@PurchaseDate datetime
    )
    AS

    DECLARE @ParentPackageID int, @PlanServerID int
    SELECT @ParentPackageID = PackageID, @PlanServerID = ServerID FROM HostingPlans
    WHERE PlanID = @PlanID

    IF @ParentPackageID = 0 OR @ParentPackageID IS NULL
    SELECT @ParentPackageID = PackageID FROM Packages
    WHERE ParentPackageID IS NULL -- root space

    DECLARE @datelastyear datetime = DATEADD(year,-1,GETDATE())

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @ParentPackageID) = 0
    BEGIN
    	RAISERROR('You are not allowed to access this package', 16, 1);
    	RETURN;
    END

    BEGIN TRAN
    -- insert package
    INSERT INTO Packages
    (
    	ParentPackageID,
    	UserID,
    	PackageName,
    	PackageComments,
    	ServerID,
    	StatusID,
    	PlanID,
    	PurchaseDate,
    	BandwidthUpdated
    )
    VALUES
    (
    	@ParentPackageID,
    	@UserID,
    	@PackageName,
    	@PackageComments,
    	@PlanServerID,
    	@StatusID,
    	@PlanID,
    	@PurchaseDate,
    	@datelastyear
    )

    SET @PackageID = SCOPE_IDENTITY()

    -- add package to packages cache
    INSERT INTO PackagesTreeCache (ParentPackageID, PackageID)
    SELECT PackageID, @PackageID FROM dbo.PackageParents(@PackageID)

    DECLARE @ExceedingQuotas AS TABLE (QuotaID int, QuotaName nvarchar(50), QuotaValue int)
    INSERT INTO @ExceedingQuotas
    SELECT * FROM dbo.GetPackageExceedingQuotas(@ParentPackageID) WHERE QuotaValue > 0

    SELECT * FROM @ExceedingQuotas

    IF EXISTS(SELECT * FROM @ExceedingQuotas)
    BEGIN
    	ROLLBACK TRAN
    	RETURN
    END

    COMMIT TRAN

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddPackageAddon]
    (
    	@ActorID int,
    	@PackageAddonID int OUTPUT,
    	@PackageID int,
    	@PlanID int,
    	@Quantity int,
    	@StatusID int,
    	@PurchaseDate datetime,
    	@Comments ntext
    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    BEGIN TRAN

    DECLARE @ParentPackageID int
    SELECT @ParentPackageID = ParentPackageID FROM Packages
    WHERE PackageID = @PackageID

    -- insert record
    INSERT INTO PackageAddons
    (
    	PackageID,
    	PlanID,
    	PurchaseDate,
    	Quantity,
    	StatusID,
    	Comments
    )
    VALUES
    (
    	@PackageID,
    	@PlanID,
    	@PurchaseDate,
    	@Quantity,
    	@StatusID,
    	@Comments
    )

    SET @PackageAddonID = SCOPE_IDENTITY()

    DECLARE @ExceedingQuotas AS TABLE (QuotaID int, QuotaName nvarchar(50), QuotaValue int)
    INSERT INTO @ExceedingQuotas
    SELECT * FROM dbo.GetPackageExceedingQuotas(@ParentPackageID) WHERE QuotaValue > 0

    SELECT * FROM @ExceedingQuotas

    IF EXISTS(SELECT * FROM @ExceedingQuotas)
    BEGIN
    	ROLLBACK TRAN
    	RETURN
    END

    COMMIT TRAN
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddPFX]
    (
    	@ActorID int,
    	@PackageID int,
    	@UserID int,
    	@WebSiteID int,
    	@FriendlyName nvarchar(255),
    	@HostName nvarchar(255),
    	@CSRLength int,
    	@DistinguishedName nvarchar(500),
    	@SerialNumber nvarchar(250),
    	@ValidFrom datetime,
    	@ExpiryDate datetime

    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    BEGIN
    	RAISERROR('You are not allowed to access this package', 16, 1)
    	RETURN
    END

    -- insert record
    INSERT INTO [dbo].[SSLCertificates]
    	([UserID], [SiteID], [FriendlyName], [Hostname], [DistinguishedName], [CSRLength], [SerialNumber], [ValidFrom], [ExpiryDate], [Installed])
    VALUES
    	(@UserID, @WebSiteID, @FriendlyName, @HostName, @DistinguishedName, @CSRLength, @SerialNumber, @ValidFrom, @ExpiryDate, 1)

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddPrivateNetworkVlan]
    (
     @VlanID int OUTPUT,
     @Vlan int,
     @ServerID int,
     @Comments ntext
    )
    AS
    BEGIN
     IF @ServerID = 0
     SET @ServerID = NULL

     INSERT INTO PrivateNetworkVLANs(Vlan, ServerID, Comments)
     VALUES (@Vlan, @ServerID, @Comments)

     SET @VlanID = SCOPE_IDENTITY()

     RETURN
    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[AddRDSCertificate]
    (
    	@RDSCertificateId INT OUTPUT,
    	@ServiceId INT,
    	@Content NTEXT,
    	@Hash NVARCHAR(255),
    	@FileName NVARCHAR(255),
    	@ValidFrom DATETIME,
    	@ExpiryDate DATETIME
    )
    AS
    INSERT INTO RDSCertificates
    (
    	ServiceId,
    	Content,
    	Hash,
    	FileName,
    	ValidFrom,
    	ExpiryDate	
    )
    VALUES
    (
    	@ServiceId,
    	@Content,
    	@Hash,
    	@FileName,
    	@ValidFrom,
    	@ExpiryDate
    )

    SET @RDSCertificateId = SCOPE_IDENTITY()

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[AddRDSCollection]
    (
    	@RDSCollectionID INT OUTPUT,
    	@ItemID INT,
    	@Name NVARCHAR(255),
    	@Description NVARCHAR(255),
    	@DisplayName NVARCHAR(255)
    )
    AS

    INSERT INTO RDSCollections
    (
    	ItemID,
    	Name,
    	Description,
    	DisplayName
    )
    VALUES
    (
    	@ItemID,
    	@Name,
    	@Description,
    	@DisplayName
    )

    SET @RDSCollectionID = SCOPE_IDENTITY()

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[AddRDSCollectionSettings]
    (
    	@RDSCollectionSettingsID INT OUTPUT,
    	@RDSCollectionId INT,
    	@DisconnectedSessionLimitMin INT, 
    	@ActiveSessionLimitMin INT,
    	@IdleSessionLimitMin INT,
    	@BrokenConnectionAction NVARCHAR(20),
    	@AutomaticReconnectionEnabled BIT,
    	@TemporaryFoldersDeletedOnExit BIT,
    	@TemporaryFoldersPerSession BIT,
    	@ClientDeviceRedirectionOptions NVARCHAR(250),
    	@ClientPrinterRedirected BIT,
    	@ClientPrinterAsDefault BIT,
    	@RDEasyPrintDriverEnabled BIT,
    	@MaxRedirectedMonitors INT,
    	@SecurityLayer NVARCHAR(20),
    	@EncryptionLevel NVARCHAR(20),
    	@AuthenticateUsingNLA BIT
    )
    AS

    INSERT INTO RDSCollectionSettings
    (
    	RDSCollectionId,
    	DisconnectedSessionLimitMin, 
    	ActiveSessionLimitMin,
    	IdleSessionLimitMin,
    	BrokenConnectionAction,
    	AutomaticReconnectionEnabled,
    	TemporaryFoldersDeletedOnExit,
    	TemporaryFoldersPerSession,
    	ClientDeviceRedirectionOptions,
    	ClientPrinterRedirected,
    	ClientPrinterAsDefault,
    	RDEasyPrintDriverEnabled,
    	MaxRedirectedMonitors,
    	SecurityLayer,
    	EncryptionLevel,
    	AuthenticateUsingNLA
    )
    VALUES
    (
    	@RDSCollectionId,
    	@DisconnectedSessionLimitMin, 
    	@ActiveSessionLimitMin,
    	@IdleSessionLimitMin,
    	@BrokenConnectionAction,
    	@AutomaticReconnectionEnabled,
    	@TemporaryFoldersDeletedOnExit,
    	@TemporaryFoldersPerSession,
    	@ClientDeviceRedirectionOptions,
    	@ClientPrinterRedirected,
    	@ClientPrinterAsDefault,
    	@RDEasyPrintDriverEnabled,
    	@MaxRedirectedMonitors,
    	@SecurityLayer,
    	@EncryptionLevel,
    	@AuthenticateUsingNLA
    )

    SET @RDSCollectionSettingsID = SCOPE_IDENTITY()

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[AddRDSMessage]
    (
    	@RDSMessageId INT OUTPUT,
    	@RDSCollectionId INT,
    	@MessageText NTEXT,
    	@UserName NVARCHAR(255),
    	@Date DATETIME
    )
    AS
    INSERT INTO RDSMessages
    (
    	RDSCollectionId,
    	[MessageText],
    	UserName,
    	[Date]
    )
    VALUES
    (
    	@RDSCollectionId,
    	@MessageText,
    	@UserName,
    	@Date
    )

    SET @RDSMessageId = SCOPE_IDENTITY()

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[AddRDSServer]
    (
    	@RDSServerID INT OUTPUT,
    	@Name NVARCHAR(255),
    	@FqdName NVARCHAR(255),
    	@Description NVARCHAR(255),
    	@Controller INT
    )
    AS
    INSERT INTO RDSServers
    (
    	Name,
    	FqdName,
    	Description,
    	Controller
    )
    VALUES
    (
    	@Name,
    	@FqdName,
    	@Description,
    	@Controller
    )

    SET @RDSServerID = SCOPE_IDENTITY()

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[AddRDSServerToCollection]
    (
    	@Id  INT,
    	@RDSCollectionId INT
    )
    AS

    UPDATE RDSServers
    SET
    	RDSCollectionId = @RDSCollectionId
    WHERE ID = @Id
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[AddRDSServerToOrganization]
    (
    	@Id  INT,
    	@ItemID INT
    )
    AS

    UPDATE RDSServers
    SET
    	ItemID = @ItemID
    WHERE ID = @Id
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddSchedule]
    (
    	@ActorID int,
    	@ScheduleID int OUTPUT,
    	@TaskID nvarchar(100),
    	@PackageID int,
    	@ScheduleName nvarchar(100),
    	@ScheduleTypeID nvarchar(50),
    	@Interval int,
    	@FromTime datetime,
    	@ToTime datetime,
    	@StartTime datetime,
    	@NextRun datetime,
    	@Enabled bit,
    	@PriorityID nvarchar(50),
    	@HistoriesNumber int,
    	@MaxExecutionTime int,
    	@WeekMonthDay int,
    	@XmlParameters ntext
    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    -- insert record
    BEGIN TRAN
    INSERT INTO Schedule
    (
    	TaskID,
    	PackageID,
    	ScheduleName,
    	ScheduleTypeID,
    	Interval,
    	FromTime,
    	ToTime,
    	StartTime,
    	NextRun,
    	Enabled,
    	PriorityID,
    	HistoriesNumber,
    	MaxExecutionTime,
    	WeekMonthDay
    )
    VALUES
    (
    	@TaskID,
    	@PackageID,
    	@ScheduleName,
    	@ScheduleTypeID,
    	@Interval,
    	@FromTime,
    	@ToTime,
    	@StartTime,
    	@NextRun,
    	@Enabled,
    	@PriorityID,
    	@HistoriesNumber,
    	@MaxExecutionTime,
    	@WeekMonthDay
    )

    SET @ScheduleID = SCOPE_IDENTITY()

    DECLARE @idoc int
    --Create an internal representation of the XML document.
    EXEC sp_xml_preparedocument @idoc OUTPUT, @XmlParameters

    -- Execute a SELECT statement that uses the OPENXML rowset provider.
    DELETE FROM ScheduleParameters
    WHERE ScheduleID = @ScheduleID

    INSERT INTO ScheduleParameters
    (
    	ScheduleID,
    	ParameterID,
    	ParameterValue
    )
    SELECT
    	@ScheduleID,
    	ParameterID,
    	ParameterValue
    FROM OPENXML(@idoc, '/parameters/parameter',1) WITH
    (
    	ParameterID nvarchar(50) '@id',
    	ParameterValue nvarchar(3000) '@value'
    ) as PV

    -- remove document
    exec sp_xml_removedocument @idoc

    COMMIT TRAN

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddServer]
    (
    	@ServerID int OUTPUT,
    	@ServerName nvarchar(100),
    	@ServerUrl nvarchar(255),
    	@Password nvarchar(100),
    	@Comments ntext,
    	@VirtualServer bit,
    	@InstantDomainAlias nvarchar(200),
    	@PrimaryGroupID int,
    	@ADEnabled bit,
    	@ADRootDomain nvarchar(200),
    	@ADUsername nvarchar(100),
    	@ADPassword nvarchar(100),
    	@ADAuthenticationType varchar(50),
    	@OSPlatform int,
    	@IsCore bit,
    	@PasswordIsSHA256 bit
    )
    AS

    IF @PrimaryGroupID = 0

    SET @PrimaryGroupID = NULL

    INSERT INTO Servers
    (
    	ServerName,
    	ServerUrl,
    	Password,
    	Comments,
    	VirtualServer,
    	InstantDomainAlias,
    	PrimaryGroupID,
    	ADEnabled,
    	ADRootDomain,
    	ADUsername,
    	ADPassword,
    	ADAuthenticationType,
    	OSPlatform,
    	IsCore,
    	PasswordIsSHA256
    )
    VALUES
    (
    	@ServerName,
    	@ServerUrl,
    	@Password,
    	@Comments,
    	@VirtualServer,
    	@InstantDomainAlias,
    	@PrimaryGroupID,
    	@ADEnabled,
    	@ADRootDomain,
    	@ADUsername,
    	@ADPassword,
    	@ADAuthenticationType,
    	@OSPlatform,
    	@IsCore,
    	@PasswordIsSHA256
    )

    SET @ServerID = SCOPE_IDENTITY()

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddService]
    (
    	@ServiceID int OUTPUT,
    	@ServerID int,
    	@ProviderID int,
    	@ServiceQuotaValue int,
    	@ServiceName nvarchar(50),
    	@ClusterID int,
    	@Comments ntext
    )
    AS
    BEGIN

    BEGIN TRAN
    IF @ClusterID = 0 SET @ClusterID = NULL

    INSERT INTO Services
    (
    	ServerID,
    	ProviderID,
    	ServiceName,
    	ServiceQuotaValue,
    	ClusterID,
    	Comments
    )
    VALUES
    (
    	@ServerID,
    	@ProviderID,
    	@ServiceName,
    	@ServiceQuotaValue,
    	@ClusterID,
    	@Comments
    )

    SET @ServiceID = SCOPE_IDENTITY()

    -- copy default service settings
    INSERT INTO ServiceProperties (ServiceID, PropertyName, PropertyValue)
    SELECT @ServiceID, PropertyName, PropertyValue
    FROM ServiceDefaultProperties
    WHERE ProviderID = @ProviderID

    -- copy all default DNS records for the given service
    DECLARE @GroupID int
    SELECT @GroupID = GroupID FROM Providers
    WHERE ProviderID = @ProviderID

    -- default IP address for added records
    DECLARE @AddressID int
    SELECT TOP 1 @AddressID = AddressID FROM IPAddresses
    WHERE ServerID = @ServerID

    INSERT INTO GlobalDnsRecords
    (
    	RecordType,
    	RecordName,
    	RecordData,
    	MXPriority,
    	IPAddressID,
    	ServiceID,
    	ServerID,
    	PackageID
    )
    SELECT
    	RecordType,
    	RecordName,
    	CASE WHEN RecordData = '[ip]' THEN ''
    	ELSE RecordData END,
    	MXPriority,
    	CASE WHEN RecordData = '[ip]' THEN @AddressID
    	ELSE NULL END,
    	@ServiceID,
    	NULL, -- server
    	NULL -- package
    FROM
    	ResourceGroupDnsRecords
    WHERE GroupID = @GroupID
    ORDER BY RecordOrder
    COMMIT TRAN

    END
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddServiceItem]
    (
    	@ActorID int,
    	@PackageID int,
    	@ServiceID int,
    	@ItemName nvarchar(500),
    	@ItemTypeName nvarchar(200),
    	@ItemID int OUTPUT,
    	@XmlProperties ntext,
    	@CreatedDate datetime
    )
    AS
    BEGIN TRAN

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    -- get GroupID
    DECLARE @GroupID int
    SELECT
    	@GroupID = PROV.GroupID
    FROM Services AS S
    INNER JOIN Providers AS PROV ON S.ProviderID = PROV.ProviderID
    WHERE S.ServiceID = @ServiceID

    DECLARE @ItemTypeID int
    SELECT @ItemTypeID = ItemTypeID FROM ServiceItemTypes
    WHERE TypeName = @ItemTypeName
    AND ((@GroupID IS NULL) OR (@GroupID IS NOT NULL AND GroupID = @GroupID))

    -- Fix to allow plans assigned to serveradmin
    IF (@ItemTypeName = 'SolidCP.Providers.HostedSolution.Organization, SolidCP.Providers.Base')
    BEGIN
    	IF NOT EXISTS (SELECT * FROM ServiceItems WHERE PackageID = 1)
    	BEGIN
    		INSERT INTO ServiceItems (PackageID, ItemTypeID,ServiceID,ItemName,CreatedDate)
    		VALUES(1, @ItemTypeID, @ServiceID, 'System',  @CreatedDate)

    		DECLARE @TempItemID int

    		SET @TempItemID = SCOPE_IDENTITY()
    		INSERT INTO ExchangeOrganizations (ItemID, OrganizationID)
    		VALUES(@TempItemID, 'System')
    	END
    END

    -- add item
    INSERT INTO ServiceItems
    (
    	PackageID,
    	ServiceID,
    	ItemName,
    	ItemTypeID,
    	CreatedDate
    )
    VALUES
    (
    	@PackageID,
    	@ServiceID,
    	@ItemName,
    	@ItemTypeID,
    	@CreatedDate
    )

    SET @ItemID = SCOPE_IDENTITY()

    DECLARE @idoc int
    --Create an internal representation of the XML document.
    EXEC sp_xml_preparedocument @idoc OUTPUT, @XmlProperties

    -- Execute a SELECT statement that uses the OPENXML rowset provider.
    DELETE FROM ServiceItemProperties
    WHERE ItemID = @ItemID

    CREATE TABLE #TempTable(
    	ItemID int,
    	PropertyName nvarchar(50),
    	PropertyValue  nvarchar(max))

    INSERT INTO #TempTable (ItemID, PropertyName, PropertyValue)
    SELECT
    	@ItemID,
    	PropertyName,
    	PropertyValue
    FROM OPENXML(@idoc, '/properties/property',1) WITH 
    (
    	PropertyName nvarchar(50) '@name',
    	PropertyValue nvarchar(max) '@value'
    ) as PV

    -- Move data from temp table to real table
    INSERT INTO ServiceItemProperties
    (
    	ItemID,
    	PropertyName,
    	PropertyValue
    )
    SELECT 
    	ItemID, 
    	PropertyName, 
    	PropertyValue
    FROM #TempTable

    DROP TABLE #TempTable

    -- remove document
    exec sp_xml_removedocument @idoc

    COMMIT TRAN
    RETURN 
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddSfBUser]
    	@AccountID int,
    	@SfBUserPlanID int,
    	@SipAddress nvarchar(300)
    AS
    INSERT INTO
    	dbo.SfBUsers
    	(AccountID,
    	 SfBUserPlanID,
    	 CreatedDate,
    	 ModifiedDate,
    	 SipAddress)
    VALUES
    (
    	@AccountID,
    	@SfBUserPlanID,
    	getdate(),
    	getdate(),
    	@SipAddress
    )

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddSfBUserPlan]
    (
    	@SfBUserPlanId int OUTPUT,
    	@ItemID int,
    	@SfBUserPlanName	nvarchar(300),
    	@SfBUserPlanType int,
    	@IM bit,
    	@Mobility bit,
    	@MobilityEnableOutsideVoice bit,
    	@Federation bit,
    	@Conferencing bit,
    	@EnterpriseVoice bit,
    	@VoicePolicy int,
    	@IsDefault bit,
    	@RemoteUserAccess bit,
    	@PublicIMConnectivity bit,
    	@AllowOrganizeMeetingsWithExternalAnonymous bit,
    	@Telephony int,
    	@ServerURI nvarchar(300),
    	@ArchivePolicy  nvarchar(300),
    	@TelephonyDialPlanPolicy nvarchar(300),
    	@TelephonyVoicePolicy nvarchar(300)

    )
    AS

    IF (((SELECT Count(*) FROM SfBUserPlans WHERE ItemId = @ItemID) = 0) AND (@SfBUserPlanType=0))
    BEGIN
    	SET @IsDefault = 1
    END
    ELSE
    BEGIN
    	IF ((@IsDefault = 1) AND (@SfBUserPlanType=0))
    	BEGIN
    		UPDATE SfBUserPlans SET IsDefault = 0 WHERE ItemID = @ItemID
    	END
    END

    INSERT INTO SfBUserPlans
    (
    	ItemID,
    	SfBUserPlanName,
    	SfBUserPlanType,
    	IM,
    	Mobility,
    	MobilityEnableOutsideVoice,
    	Federation,
    	Conferencing,
    	EnterpriseVoice,
    	VoicePolicy,
    	IsDefault,
    	RemoteUserAccess,
    	PublicIMConnectivity,
    	AllowOrganizeMeetingsWithExternalAnonymous,
    	Telephony,
    	ServerURI,
    	ArchivePolicy,
    	TelephonyDialPlanPolicy,
    	TelephonyVoicePolicy

    )
    VALUES
    (
    	@ItemID,
    	@SfBUserPlanName,
    	@SfBUserPlanType,
    	@IM,
    	@Mobility,
    	@MobilityEnableOutsideVoice,
    	@Federation,
    	@Conferencing,
    	@EnterpriseVoice,
    	@VoicePolicy,
    	@IsDefault,
    	@RemoteUserAccess,
    	@PublicIMConnectivity,
    	@AllowOrganizeMeetingsWithExternalAnonymous,
    	@Telephony,
    	@ServerURI,
    	@ArchivePolicy,
    	@TelephonyDialPlanPolicy,
    	@TelephonyVoicePolicy
    )

    SET @SfBUserPlanId = SCOPE_IDENTITY()
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddSSLRequest]
    (
    	@SSLID int OUTPUT,
    	@ActorID int,
    	@PackageID int,
    	@UserID int,
    	@WebSiteID int,
    	@FriendlyName nvarchar(255),
    	@HostName nvarchar(255),
    	@CSR ntext,
    	@CSRLength int,
    	@DistinguishedName nvarchar(500),
    	@IsRenewal bit = 0,
    	@PreviousId int = NULL

    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    BEGIN
    	RAISERROR('You are not allowed to access this package', 16, 1)
    	RETURN
    END

    -- insert record
    INSERT INTO [dbo].[SSLCertificates]
    	([UserID], [SiteID], [FriendlyName], [Hostname], [DistinguishedName], [CSR], [CSRLength], [IsRenewal], [PreviousId])
    VALUES
    	(@UserID, @WebSiteID, @FriendlyName, @HostName, @DistinguishedName, @CSR, @CSRLength, @IsRenewal, @PreviousId)

    SET @SSLID = SCOPE_IDENTITY()
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddSupportServiceLevel]
    (
    	@LevelID int OUTPUT,
    	@LevelName nvarchar(100),
    	@LevelDescription nvarchar(1000)
    )
    AS
    BEGIN

    	IF EXISTS (SELECT * FROM SupportServiceLevels WHERE LevelName = @LevelName)
    	BEGIN
    		SET @LevelID = -1

    		RETURN
    	END

    	INSERT INTO SupportServiceLevels
    	(
    		LevelName,
    		LevelDescription
    	)
    	VALUES
    	(
    		@LevelName,
    		@LevelDescription
    	)

    	SET @LevelID = SCOPE_IDENTITY()

    	DECLARE @ResourseGroupID int

    	IF EXISTS (SELECT * FROM ResourceGroups WHERE GroupName = 'Service Levels')
    	BEGIN
    		DECLARE @QuotaLastID int, @CurQuotaName nvarchar(100), 
    			@CurQuotaDescription nvarchar(1000), @QuotaOrderInGroup int

    		SET @CurQuotaName = N'ServiceLevel.' + @LevelName
    		SET @CurQuotaDescription = @LevelName + N', users'

    		SELECT @ResourseGroupID = GroupID FROM ResourceGroups WHERE GroupName = 'Service Levels'

    		SELECT @QuotaLastID = MAX(QuotaID) FROM Quotas

    		SELECT @QuotaOrderInGroup = MAX(QuotaOrder) FROM Quotas WHERE GroupID = @ResourseGroupID

    		IF @QuotaOrderInGroup IS NULL SET @QuotaOrderInGroup = 0

    		IF NOT EXISTS (SELECT * FROM Quotas WHERE QuotaName = @CurQuotaName)
    		BEGIN
    			INSERT Quotas 
    				(QuotaID, 
    				GroupID, 
    				QuotaOrder, 
    				QuotaName, 
    				QuotaDescription, 
    				QuotaTypeID, 
    				ServiceQuota, 
    				ItemTypeID) 
    			VALUES 
    				(@QuotaLastID + 1, 
    				@ResourseGroupID, 
    				@QuotaOrderInGroup + 1, 
    				@CurQuotaName, 
    				@CurQuotaDescription,
    				2, 
    				0, 
    				NULL)
    		END
    	END

    END

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddUser]
    (
    	@ActorID int,
    	@UserID int OUTPUT,
    	@OwnerID int,
    	@RoleID int,
    	@StatusID int,
    	@SubscriberNumber nvarchar(32),
    	@LoginStatusID int,
    	@IsDemo bit,
    	@IsPeer bit,
    	@Comments ntext,
    	@Username nvarchar(50),
    	@Password nvarchar(200),
    	@FirstName nvarchar(50),
    	@LastName nvarchar(50),
    	@Email nvarchar(255),
    	@SecondaryEmail nvarchar(255),
    	@Address nvarchar(200),
    	@City nvarchar(50),
    	@State nvarchar(50),
    	@Country nvarchar(50),
    	@Zip varchar(20),
    	@PrimaryPhone varchar(30),
    	@SecondaryPhone varchar(30),
    	@Fax varchar(30),
    	@InstantMessenger nvarchar(200),
    	@HtmlMail bit,
    	@CompanyName nvarchar(100),
    	@EcommerceEnabled bit
    )
    AS

    -- check if the user already exists
    IF EXISTS(SELECT UserID FROM Users WHERE Username = @Username)
    BEGIN
    	SET @UserID = -1
    	RETURN
    END

    -- check actor rights
    IF dbo.CanCreateUser(@ActorID, @OwnerID) = 0
    BEGIN
    	SET @UserID = -2
    	RETURN
    END

    INSERT INTO Users
    (
    	OwnerID,
    	RoleID,
    	StatusID,
    	SubscriberNumber,
    	LoginStatusID,
    	Created,
    	Changed,
    	IsDemo,
    	IsPeer,
    	Comments,
    	Username,
    	Password,
    	FirstName,
    	LastName,
    	Email,
    	SecondaryEmail,
    	Address,
    	City,
    	State,
    	Country,
    	Zip,
    	PrimaryPhone,
    	SecondaryPhone,
    	Fax,
    	InstantMessenger,
    	HtmlMail,
    	CompanyName,
    	EcommerceEnabled
    )
    VALUES
    (
    	@OwnerID,
    	@RoleID,
    	@StatusID,
    	@SubscriberNumber,
    	@LoginStatusID,
    	GetDate(),
    	GetDate(),
    	@IsDemo,
    	@IsPeer,
    	@Comments,
    	@Username,
    	@Password,
    	@FirstName,
    	@LastName,
    	@Email,
    	@SecondaryEmail,
    	@Address,
    	@City,
    	@State,
    	@Country,
    	@Zip,
    	@PrimaryPhone,
    	@SecondaryPhone,
    	@Fax,
    	@InstantMessenger,
    	@HtmlMail,
    	@CompanyName,
    	@EcommerceEnabled
    )

    SET @UserID = SCOPE_IDENTITY()

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[AddUserToRDSCollection]
    (
    	@RDSCollectionID INT,
    	@AccountId INT
    )
    AS

    INSERT INTO RDSCollectionUsers
    (
    	RDSCollectionId, 
    	AccountID
    )
    VALUES
    (
    	@RDSCollectionID,
    	@AccountId
    )
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddVirtualServices]
    (
    	@ServerID int,
    	@Xml ntext
    )
    AS

    /*
    XML Format:

    <services>
    	<service id="16" />
    </services>

    */

    BEGIN TRAN
    DECLARE @idoc int
    --Create an internal representation of the XML document.
    EXEC sp_xml_preparedocument @idoc OUTPUT, @xml

    -- update HP resources
    INSERT INTO VirtualServices
    (
    	ServerID,
    	ServiceID
    )
    SELECT
    	@ServerID,
    	ServiceID
    FROM OPENXML(@idoc, '/services/service',1) WITH
    (
    	ServiceID int '@id'
    ) as XS
    WHERE XS.ServiceID NOT IN (SELECT ServiceID FROM VirtualServices WHERE ServerID = @ServerID)

    -- remove document
    exec sp_xml_removedocument @idoc

    COMMIT TRAN
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[AddWebDavAccessToken]
    (
    	@TokenID INT OUTPUT,
    	@FilePath NVARCHAR(MAX),
    	@AccessToken UNIQUEIDENTIFIER,
    	@AuthData NVARCHAR(MAX),
    	@ExpirationDate DATETIME,
    	@AccountID INT,
    	@ItemId INT
    )
    AS
    INSERT INTO WebDavAccessTokens
    (
    	FilePath,
    	AccessToken,
    	AuthData,
    	ExpirationDate,
    	AccountID  ,
    	ItemId
    )
    VALUES
    (
    	@FilePath ,
    	@AccessToken  ,
    	@AuthData,
    	@ExpirationDate ,
    	@AccountID,
    	@ItemId
    )

    SET @TokenID = SCOPE_IDENTITY()

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[AddWebDavPortalUsersSettings]
    (
    	@WebDavPortalUsersSettingsId INT OUTPUT,
    	@AccountId INT,
    	@Settings NVARCHAR(max)
    )
    AS

    INSERT INTO WebDavPortalUsersSettings
    (
    	AccountId,
    	Settings
    )
    VALUES
    (
    	@AccountId,
    	@Settings
    )

    SET @WebDavPortalUsersSettingsId = SCOPE_IDENTITY()

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AllocatePackageIPAddresses]
    (
    	@PackageID int,
    	@OrgID int,
    	@xml ntext
    )
    AS
    BEGIN

    	SET NOCOUNT ON;

    	DECLARE @idoc int
    	--Create an internal representation of the XML document.
    	EXEC sp_xml_preparedocument @idoc OUTPUT, @xml

    	-- delete
    	DELETE FROM PackageIPAddresses
    	FROM PackageIPAddresses AS PIP
    	INNER JOIN OPENXML(@idoc, '/items/item', 1) WITH 
    	(
    		AddressID int '@id'
    	) as PV ON PIP.AddressID = PV.AddressID

    	-- insert
    	INSERT INTO dbo.PackageIPAddresses
    	(		
    		PackageID,
    		OrgID,
    		AddressID	
    	)
    	SELECT		
    		@PackageID,
    		@OrgID,
    		AddressID

    	FROM OPENXML(@idoc, '/items/item', 1) WITH 
    	(
    		AddressID int '@id'
    	) as PV

    	-- remove document
    	exec sp_xml_removedocument @idoc

    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[AllocatePackageVLANs]
    (
    	@PackageID int,
    	@IsDmz bit,
    	@xml ntext
    )
    AS
    BEGIN

    	SET NOCOUNT ON;

    	DECLARE @idoc int
    	--Create an internal representation of the XML document.
    	EXEC sp_xml_preparedocument @idoc OUTPUT, @xml

    	-- delete
    	DELETE FROM PackageVLANs
    	FROM PackageVLANs AS PV
    	INNER JOIN OPENXML(@idoc, '/items/item', 1) WITH 
    	(
    		VlanID int '@id'
    	) as PX ON PV.VlanID = PX.VlanID


    	-- insert
    	INSERT INTO dbo.PackageVLANs
    	(		
    		PackageID,
    		VlanID,
    		IsDmz
    	)
    	SELECT		
    		@PackageID,
    		VlanID,
    		@IsDmz

    	FROM OPENXML(@idoc, '/items/item', 1) WITH 
    	(
    		VlanID int '@id'
    	) as PX

    	-- remove document
    	exec sp_xml_removedocument @idoc

    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[CanChangeMfa]
    (
    	@CallerID int,
    	@ChangeUserID int,
    	@CanPeerChangeMfa bit,
    	@Result bit OUTPUT
    )
    AS
    	SET @Result = dbo.CanChangeMfaFunc(@CallerID, @ChangeUserID, @CanPeerChangeMfa)
    	RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[ChangeExchangeAcceptedDomainType]
    (
    	@ItemID int,
    	@DomainID int,
    	@DomainTypeID int
    )
    AS
    UPDATE ExchangeOrganizationDomains
    SET DomainTypeID=@DomainTypeID
    WHERE ItemID=ItemID AND DomainID=@DomainID
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[ChangePackageUser]
    (
    	@PackageID int,
    	@ActorID int,
    	@UserID int
    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    BEGIN TRAN

    UPDATE Packages
    SET UserID = @UserID
    WHERE PackageID = @PackageID

    COMMIT TRAN

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[ChangeUserPassword]
    (
    	@ActorID int,
    	@UserID int,
    	@Password nvarchar(200)
    )
    AS

    -- check actor rights
    IF dbo.CanUpdateUserDetails(@ActorID, @UserID) = 0
    RETURN

    UPDATE Users
    SET Password = @Password, OneTimePasswordState = 0
    WHERE UserID = @UserID

    RETURN 
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[CheckBlackBerryUserExists]
    	@AccountID int
    AS
    BEGIN
    	SELECT
    		COUNT(AccountID)
    	FROM
    		dbo.BlackBerryUsers
    	WHERE AccountID = @AccountID
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[CheckDomain]
    (
    	@PackageID int,
    	@DomainName nvarchar(100),
    	@IsDomainPointer bit,
    	@Result int OUTPUT
    )
    AS

    /*
    @Result values:
    	0 - OK
    	-1 - already exists
    	-2 - sub-domain of prohibited domain
    */

    SET @Result = 0 -- OK

    -- check if the domain already exists
    IF EXISTS(
    SELECT DomainID FROM Domains
    WHERE DomainName = @DomainName AND IsDomainPointer = @IsDomainPointer
    )
    BEGIN
    	SET @Result = -1
    	RETURN
    END

    -- check if this is a sub-domain of other domain
    -- that is not allowed for 3rd level hosting

    DECLARE @UserID int
    SELECT @UserID = UserID FROM Packages
    WHERE PackageID = @PackageID

    -- find sub-domains
    DECLARE @DomainUserID int, @HostingAllowed bit
    SELECT
    	@DomainUserID = P.UserID,
    	@HostingAllowed = D.HostingAllowed
    FROM Domains AS D
    INNER JOIN Packages AS P ON D.PackageID = P.PackageID
    WHERE CHARINDEX('.' + DomainName, @DomainName) > 0
    AND (CHARINDEX('.' + DomainName, @DomainName) + LEN('.' + DomainName)) = LEN(@DomainName) + 1
    AND IsDomainPointer = 0

    -- this is a domain of other user
    IF @UserID <> @DomainUserID AND @HostingAllowed = 0
    BEGIN
    	SET @Result = -2
    	RETURN
    END

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    -- fix check domain used by HostedOrganization

    CREATE PROCEDURE [dbo].[CheckDomainUsedByHostedOrganization] 
    	@DomainName nvarchar(100),
    	@Result int OUTPUT
    AS
    	SET @Result = 0
    	IF EXISTS(SELECT 1 FROM ExchangeAccounts WHERE UserPrincipalName LIKE '%@'+ @DomainName AND AccountType!=2)
    	BEGIN
    		SET @Result = 1
    	END
    	ELSE
    	IF EXISTS(SELECT 1 FROM ExchangeAccountEmailAddresses WHERE EmailAddress LIKE '%@'+ @DomainName)
    	BEGIN
    		SET @Result = 1
    	END
    	ELSE
    	IF EXISTS(SELECT 1 FROM LyncUsers WHERE SipAddress LIKE '%@'+ @DomainName)
    	BEGIN
    		SET @Result = 1
    	END
    	ELSE
    	IF EXISTS(SELECT 1 FROM SfBUsers WHERE SipAddress LIKE '%@'+ @DomainName)
    	BEGIN
    		SET @Result = 1
    	END

    	RETURN @Result
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[CheckLyncUserExists]
    	@AccountID int
    AS
    BEGIN
    	SELECT
    		COUNT(AccountID)
    	FROM
    		dbo.LyncUsers
    	WHERE AccountID = @AccountID
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[CheckOCSUserExists]
    	@AccountID int
    AS
    BEGIN
    	SELECT
    		COUNT(AccountID)
    	FROM
    		dbo.OCSUsers
    	WHERE AccountID = @AccountID
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[CheckRDSServer]
    (
    	@ServerFQDN nvarchar(100),
    	@Result int OUTPUT
    )
    AS

    /*
    @Result values:
    	0 - OK
    	-1 - already exists
    */

    SET @Result = 0 -- OK

    -- check if the domain already exists
    IF EXISTS(
    SELECT FqdName FROM RDSServers
    WHERE FqdName = @ServerFQDN
    )
    BEGIN
    	SET @Result = -1
    	RETURN
    END

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[CheckServiceItemExists]
    (
    	@Exists bit OUTPUT,
    	@ItemName nvarchar(500),
    	@ItemTypeName nvarchar(200),
    	@GroupName nvarchar(100) = NULL
    )
    AS

    SET @Exists = 0

    DECLARE @ItemTypeID int
    SELECT @ItemTypeID = ItemTypeID FROM ServiceItemTypes
    WHERE TypeName = @ItemTypeName

    IF EXISTS (
    SELECT ItemID FROM ServiceItems AS SI
    INNER JOIN Services AS S ON SI.ServiceID = S.ServiceID
    INNER JOIN Providers AS PROV ON S.ProviderID = PROV.ProviderID
    INNER JOIN ResourceGroups AS RG ON PROV.GroupID = RG.GroupID
    WHERE SI.ItemName = @ItemName AND SI.ItemTypeID = @ItemTypeID
    AND ((@GroupName IS NULL) OR (@GroupName IS NOT NULL AND RG.GroupName = @GroupName))
    )
    SET @Exists = 1

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[CheckServiceItemExistsInService]
    (
    	@Exists bit OUTPUT,
    	@ServiceID int,
    	@ItemName nvarchar(500),
    	@ItemTypeName nvarchar(200)
    )
    AS

    SET @Exists = 0

    DECLARE @ItemTypeID int
    SELECT @ItemTypeID = ItemTypeID FROM ServiceItemTypes
    WHERE TypeName = @ItemTypeName

    IF EXISTS (SELECT ItemID FROM ServiceItems
    WHERE ItemName = @ItemName AND ItemTypeID = @ItemTypeID AND ServiceID = @ServiceID)
    SET @Exists = 1

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[CheckServiceLevelUsage]
    (
    	@LevelID int
    )
    AS
    SELECT COUNT(EA.AccountID)
    FROM SupportServiceLevels AS SL
    INNER JOIN ExchangeAccounts AS EA ON SL.LevelID = EA.LevelID
    WHERE EA.LevelID = @LevelID
    RETURN 
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[CheckSfBUserExists]
    	@AccountID int
    AS
    BEGIN
    	SELECT
    		COUNT(AccountID)
    	FROM
    		dbo.SfBUsers
    	WHERE AccountID = @AccountID
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[CheckSSL]
    (
    	@siteID int,
    	@Renewal bit = 0,
    	@Result int OUTPUT
    )
    AS

    /*
    @Result values:
    	0 - OK
    	-1 - already exists
    */

    SET @Result = 0 -- OK

    -- check if a SSL Certificate is installed for domain
    IF EXISTS(SELECT [ID] FROM [dbo].[SSLCertificates] WHERE [SiteID] = @siteID)
    BEGIN
    	SET @Result = -1
    	RETURN
    END

    --To Do add renewal stuff

    RETURN

    SET ANSI_NULLS ON

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[CheckSSLExistsForWebsite]
    (
    	@siteID int,
    	@SerialNumber nvarchar(250),
    	@Result bit OUTPUT
    )
    AS

    /*
    @Result values:
    	0 - OK
    	-1 - already exists
    */

    SET @Result = 0 -- OK

    -- check if a SSL Certificate is installed for domain
    IF EXISTS(SELECT [ID] FROM [dbo].[SSLCertificates] WHERE [SiteID] = @siteID
    --AND SerialNumber=@SerialNumber
    )
    BEGIN
    	SET @Result = 1
    	RETURN
    END

    RETURN

    SET ANSI_NULLS ON

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[CheckUserExists]
    (
    	@Exists bit OUTPUT,
    	@Username nvarchar(100)
    )
    AS

    SET @Exists = 0

    IF EXISTS (SELECT UserID FROM Users
    WHERE Username = @Username)
    SET @Exists = 1

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[CompleteSSLRequest]
    (
    	@ActorID int,
    	@PackageID int,
    	@ID int,
    	@Certificate ntext,
    	@SerialNumber nvarchar(250),
    	@Hash ntext,
    	@DistinguishedName nvarchar(500),
    	@ValidFrom datetime,
    	@ExpiryDate datetime

    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    BEGIN
    	RAISERROR('You are not allowed to access this package', 16, 1)
    	RETURN
    END

    -- insert record
    UPDATE
    	[dbo].[SSLCertificates]
    SET
    	[Certificate] = @Certificate,
    	[Installed] = 1,
    	[SerialNumber] = @SerialNumber,
    	[DistinguishedName] = @DistinguishedName,
    	[Hash] = @Hash,
    	[ValidFrom] = @ValidFrom,
    	[ExpiryDate] = @ExpiryDate
    WHERE
    	[ID] = @ID;

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[ConvertToExchangeOrganization]
    (
    	@ItemID int
    )
    AS

    UPDATE
    	[dbo].[ServiceItems]
    SET
    	[ItemTypeID] = 26
    WHERE
    	[ItemID] = @ItemID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[CreateStorageSpaceFolder]
    (
    	@ID INT OUTPUT,
    	@Name varchar(300),
    	@StorageSpaceId INT,
    	@Path varchar(max),
    	@UncPath varchar(max),
    	@IsShared BIT,
    	@FsrmQuotaType INT,
    	@FsrmQuotaSizeBytes BIGINT 
    )
    AS
    INSERT INTO StorageSpaceFolders (	
    	Name,
    	StorageSpaceId,
    	Path,
    	UncPath,
    	IsShared,
    	FsrmQuotaType,
    	FsrmQuotaSizeBytes)
    VALUES (
    	@Name,
    	@StorageSpaceId,
    	@Path,
    	@UncPath,
    	@IsShared,
    	@FsrmQuotaType,
    	@FsrmQuotaSizeBytes)

    SET @ID = SCOPE_IDENTITY()

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeallocatePackageIPAddress]
    	@PackageAddressID int
    AS
    BEGIN

    	SET NOCOUNT ON;

    	-- check parent package
    	DECLARE @ParentPackageID int

    	SELECT @ParentPackageID = P.ParentPackageID
    	FROM PackageIPAddresses AS PIP
    	INNER JOIN Packages AS P ON PIP.PackageID = P.PackageId
    	WHERE PIP.PackageAddressID = @PackageAddressID

    	IF (@ParentPackageID = 1) -- "System" space
    	BEGIN
    		DELETE FROM dbo.PackageIPAddresses
    		WHERE PackageAddressID = @PackageAddressID
    	END
    	ELSE -- 2rd level space and below
    	BEGIN
    		UPDATE PackageIPAddresses
    		SET PackageID = @ParentPackageID
    		WHERE PackageAddressID = @PackageAddressID
    	END

    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeallocatePackageVLAN]
    	@PackageVlanID int
    AS
    BEGIN

    	SET NOCOUNT ON;

    	-- check parent package
    	DECLARE @ParentPackageID int

    	SELECT @ParentPackageID = P.ParentPackageID
    	FROM PackageVLANs AS PV
    	INNER JOIN Packages AS P ON PV.PackageID = P.PackageId
    	WHERE PV.PackageVlanID = @PackageVlanID

    	IF (@ParentPackageID = 1) -- "System" space
    	BEGIN
    		DELETE FROM dbo.PackageVLANs
    		WHERE PackageVlanID = @PackageVlanID
    	END
    	ELSE -- 2rd level space and below
    	BEGIN
    		UPDATE PackageVLANs
    		SET PackageID = @ParentPackageID
    		WHERE PackageVlanID = @PackageVlanID
    	END

    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[DeleteAccessToken]
    (
    	@AccessToken UNIQUEIDENTIFIER,
    	@TokenType INT
    )
    AS
    DELETE FROM AccessTokens
    WHERE AccessTokenGuid = @AccessToken AND TokenType = @TokenType
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteAdditionalGroup]
    (
    	@GroupID INT
    )
    AS

    DELETE FROM AdditionalGroups
    WHERE ID = @GroupID
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[DeleteAllEnterpriseFolderOwaUsers]
    (
    	@ItemID  int,
    	@FolderID int
    )
    AS
    DELETE FROM EnterpriseFoldersOwaPermissions
    WHERE ItemId = @ItemID AND FolderID = @FolderID
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteAllLogRecords]
    AS

    DELETE FROM Log

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteAuditLogRecords]
    (
    	@ActorID int,
    	@UserID int,
    	@ItemID int,
    	@ItemName nvarchar(100),
    	@StartDate datetime,
    	@EndDate datetime,
    	@SeverityID int,
    	@SourceName varchar(100),
    	@TaskName varchar(100)
    )
    AS

    -- check rights
    IF dbo.CheckActorUserRights(@ActorID, @UserID) = 0
    RAISERROR('You are not allowed to access this account', 16, 1)

    DECLARE @IsAdmin bit
    SET @IsAdmin = 0
    IF EXISTS(SELECT UserID FROM Users WHERE UserID = @ActorID AND RoleID = 1)
    SET @IsAdmin = 1

    DELETE FROM AuditLog
    WHERE (dbo.CheckUserParent(@UserID, UserID) = 1 OR (UserID IS NULL AND @IsAdmin = 1))
    AND StartDate BETWEEN @StartDate AND @EndDate
    AND ((@SourceName = '') OR (@SourceName <> '' AND SourceName = @SourceName))
    AND ((@TaskName = '') OR (@TaskName <> '' AND TaskName = @TaskName))
    AND ((@ItemID = 0) OR (@ItemID > 0 AND ItemID = @ItemID))
    AND ((@ItemName = '') OR (@ItemName <> '' AND ItemName LIKE @ItemName))

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteAuditLogRecordsComplete]
    AS

    TRUNCATE TABLE AuditLog

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteBackgroundTask]
    (
    	@ID INT
    )
    AS

    DELETE FROM BackgroundTaskStack
    WHERE TaskID = @ID

    DELETE FROM BackgroundTaskLogs
    WHERE TaskID = @ID

    DELETE FROM BackgroundTaskParameters
    WHERE TaskID = @ID

    DELETE FROM BackgroundTasks
    WHERE ID = @ID
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteBackgroundTaskParams]
    (
    	@TaskID INT
    )
    AS

    DELETE FROM BackgroundTaskParameters
    WHERE TaskID = @TaskID
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteBackgroundTasks]
    (
    	@Guid UNIQUEIDENTIFIER
    )
    AS

    DELETE FROM BackgroundTaskStack
    WHERE TaskID IN (SELECT ID FROM BackgroundTasks WHERE Guid = @Guid)

    DELETE FROM BackgroundTaskLogs
    WHERE TaskID IN (SELECT ID FROM BackgroundTasks WHERE Guid = @Guid)

    DELETE FROM BackgroundTaskParameters
    WHERE TaskID IN (SELECT ID FROM BackgroundTasks WHERE Guid = @Guid)

    DELETE FROM BackgroundTasks
    WHERE ID IN (SELECT ID FROM BackgroundTasks WHERE Guid = @Guid)
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteBlackBerryUser]
    (
    	@AccountID int
    )
    AS

    DELETE FROM
    	BlackBerryUsers
    WHERE
    	AccountID = @AccountID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteCertificate]
    (
    	@ActorID int,
    	@PackageID int,
    	@id int

    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    BEGIN
    	RAISERROR('You are not allowed to access this package', 16, 1)
    	RETURN
    END

    -- insert record
    DELETE FROM
    	[dbo].[SSLCertificates]
    WHERE
    	[ID] = @id

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteCluster]
    (
    	@ClusterID int
    )
    AS

    -- reset cluster in services
    UPDATE Services
    SET ClusterID = NULL
    WHERE ClusterID = @ClusterID

    -- delete cluster
    DELETE FROM Clusters
    WHERE ClusterID = @ClusterID
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteComment]
    (
    	@ActorID int,
    	@CommentID int
    )
    AS

    -- check rights
    DECLARE @UserID int
    SELECT @UserID = UserID FROM Comments
    WHERE CommentID = @CommentID

    -- check rights
    IF dbo.CheckActorUserRights(@ActorID, @UserID) = 0
    RAISERROR('You are not allowed to perform this operation', 16, 1)

    -- delete comment
    DELETE FROM Comments
    WHERE CommentID = @CommentID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteCRMOrganization]
    	@ItemID int
    AS
    BEGIN
    	SET NOCOUNT ON
    DELETE FROM dbo.CRMUsers WHERE AccountID IN (SELECT AccountID FROM dbo.ExchangeAccounts WHERE ItemID = @ItemID)
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteDnsRecord]
    (
    	@ActorID int,
    	@RecordID int
    )
    AS

    -- check rights
    DECLARE @ServiceID int, @ServerID int, @PackageID int
    SELECT
    	@ServiceID = ServiceID,
    	@ServerID = ServerID,
    	@PackageID = PackageID
    FROM GlobalDnsRecords
    WHERE
    	RecordID = @RecordID

    IF (@ServiceID > 0 OR @ServerID > 0) AND dbo.CheckIsUserAdmin(@ActorID) = 0
    RETURN

    IF (@PackageID > 0) AND dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RETURN

    -- delete record
    DELETE FROM GlobalDnsRecords
    WHERE RecordID = @RecordID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteDomain]
    (
    	@DomainID int,
    	@ActorID int
    )
    AS

    -- check rights
    DECLARE @PackageID int
    SELECT @PackageID = PackageID FROM Domains
    WHERE DomainID = @DomainID

    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    DELETE FROM Domains
    WHERE DomainID = @DomainID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[DeleteDomainDnsRecord]
    (
    	@Id  INT
    )
    AS
    DELETE FROM DomainDnsRecords
    WHERE Id = @Id
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteEnterpriseFolder]
    (
    	@ItemID INT,
    	@FolderName NVARCHAR(255)
    )
    AS

    DELETE FROM EnterpriseFolders
    WHERE ItemID = @ItemID AND FolderName = @FolderName
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteExchangeAccount]
    (
    	@ItemID int,
    	@AccountID int
    )
    AS

    -- delete e-mail addresses
    DELETE FROM ExchangeAccountEmailAddresses
    WHERE AccountID = @AccountID

    -- delete account
    DELETE FROM ExchangeAccounts
    WHERE ItemID = @ItemID AND AccountID = @AccountID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteExchangeAccountEmailAddress]
    (
    	@AccountID int,
    	@EmailAddress nvarchar(300)
    )
    AS
    DELETE FROM ExchangeAccountEmailAddresses
    WHERE AccountID = @AccountID AND EmailAddress = @EmailAddress
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[DeleteExchangeDisclaimer]
    (
    	@ExchangeDisclaimerId int
    )
    AS

    DELETE FROM ExchangeDisclaimers
    WHERE ExchangeDisclaimerId = @ExchangeDisclaimerId

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteExchangeMailboxPlan]
    (
    	@MailboxPlanId int
    )
    AS

    -- delete mailboxplan
    DELETE FROM ExchangeMailboxPlans
    WHERE MailboxPlanId = @MailboxPlanId

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteExchangeMailboxPlanRetentionPolicyTag]
    (
            @PlanTagID int
    )
    AS
    DELETE FROM ExchangeMailboxPlanRetentionPolicyTags
    WHERE
    	PlanTagID = @PlanTagID
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteExchangeOrganization]
    (
    	@ItemID int
    )
    AS
    BEGIN TRAN
    	DELETE FROM ExchangeMailboxPlans WHERE ItemID = @ItemID
    	DELETE FROM ExchangeOrganizations WHERE ItemID = @ItemID
    COMMIT TRAN
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteExchangeOrganizationDomain]
    (
    	@ItemID int,
    	@DomainID int
    )
    AS
    DELETE FROM ExchangeOrganizationDomains
    WHERE DomainID = @DomainID AND ItemID = @ItemID
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteExchangeRetentionPolicyTag]
    (
            @TagID int
    )
    AS
    DELETE FROM ExchangeRetentionPolicyTags
    WHERE
    	TagID = @TagID
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[DeleteExpiredAccessTokenTokens]
    AS
    DELETE FROM AccessTokens
    WHERE ExpirationDate < getdate()
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[DeleteExpiredWebDavAccessTokens]
    AS
    DELETE FROM WebDavAccessTokens
    WHERE ExpirationDate < getdate()
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteHostingPlan]
    (
    	@ActorID int,
    	@PlanID int,
    	@Result int OUTPUT
    )
    AS
    SET @Result = 0

    -- check rights
    DECLARE @PackageID int
    SELECT @PackageID = PackageID FROM HostingPlans
    WHERE PlanID = @PlanID

    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    -- check if some packages uses this plan
    IF EXISTS (SELECT PackageID FROM Packages WHERE PlanID = @PlanID)
    BEGIN
    	SET @Result = -1
    	RETURN
    END

    -- check if some package addons uses this plan
    IF EXISTS (SELECT PackageID FROM PackageAddons WHERE PlanID = @PlanID)
    BEGIN
    	SET @Result = -2
    	RETURN
    END

    -- delete hosting plan
    DELETE FROM HostingPlans
    WHERE PlanID = @PlanID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteIPAddress]
    (
    	@AddressID int,
    	@Result int OUTPUT
    )
    AS

    SET @Result = 0

    IF EXISTS(SELECT RecordID FROM GlobalDnsRecords WHERE IPAddressID = @AddressID)
    BEGIN
    	SET @Result = -1
    	RETURN
    END

    IF EXISTS(SELECT AddressID FROM PackageIPAddresses WHERE AddressID = @AddressID AND ItemID IS NOT NULL)
    BEGIN
    	SET @Result = -2

    	RETURN
    END

    -- delete package-IP relation
    DELETE FROM PackageIPAddresses
    WHERE AddressID = @AddressID

    -- delete IP address
    DELETE FROM IPAddresses
    WHERE AddressID = @AddressID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteItemIPAddress]
    (
    	@ActorID int,
    	@ItemID int,
    	@PackageAddressID int
    )
    AS
    BEGIN
    	UPDATE PackageIPAddresses
    	SET
    		ItemID = NULL,
    		IsPrimary = 0
    	FROM PackageIPAddresses AS PIP
    	WHERE
    		PIP.PackageAddressID = @PackageAddressID
    		AND dbo.CheckActorPackageRights(@ActorID, PIP.PackageID) = 1
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteItemIPAddresses]
    (
    	@ActorID int,
    	@ItemID int
    )
    AS
    BEGIN
    	UPDATE PackageIPAddresses
    	SET
    		ItemID = NULL,
    		IsPrimary = 0
    	FROM PackageIPAddresses AS PIP
    	WHERE
    		PIP.ItemID = @ItemID
    		AND dbo.CheckActorPackageRights(@ActorID, PIP.PackageID) = 1
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteItemPrivateIPAddress]
    (
    	@ActorID int,
    	@ItemID int,
    	@PrivateAddressID int
    )
    AS
    BEGIN
    	DELETE FROM PrivateIPAddresses
    	FROM PrivateIPAddresses AS PIP
    	INNER JOIN ServiceItems AS SI ON PIP.ItemID = SI.ItemID
    	WHERE PIP.PrivateAddressID = @PrivateAddressID
    	AND dbo.CheckActorPackageRights(@ActorID, SI.PackageID) = 1
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteItemPrivateIPAddresses]
    (
    	@ActorID int,
    	@ItemID int
    )
    AS
    BEGIN
    	DELETE FROM PrivateIPAddresses
    	FROM PrivateIPAddresses AS PIP
    	INNER JOIN ServiceItems AS SI ON PIP.ItemID = SI.ItemID
    	WHERE PIP.ItemID = @ItemID
    	AND dbo.CheckActorPackageRights(@ActorID, SI.PackageID) = 1
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteLevelResourceGroups]
    (
    	@LevelId INT
    )
    AS
    	DELETE 
    	FROM [dbo].[StorageSpaceLevelResourceGroups]
    	WHERE LevelId = @LevelId
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteLyncUser]
    (
    	@AccountId int
    )
    AS

    DELETE FROM
    	LyncUsers
    WHERE
    	AccountId = @AccountId

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[DeleteLyncUserPlan]
    (
    	@LyncUserPlanId int
    )
    AS

    -- delete lyncuserplan
    DELETE FROM LyncUserPlans
    WHERE LyncUserPlanId = @LyncUserPlanId

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteOCSUser]
    (
    	@InstanceId nvarchar(50)
    )
    AS

    DELETE FROM
    	OCSUsers
    WHERE
    	InstanceId = @InstanceId

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteOrganizationDeletedUser]
    (
    	@ID int
    )
    AS
    DELETE FROM	ExchangeDeletedAccounts WHERE AccountID = @ID
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteOrganizationStoragSpacesFolder]
    (
    	@Id INT
    )
    AS
    	DELETE
    	FROM [ExchangeOrganizationSsFolders]
    	WHERE StorageSpaceFolderId = @Id
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteOrganizationUsers]
    	@ItemID int
    AS
    BEGIN
    	SET NOCOUNT ON;

        DELETE FROM ExchangeAccounts WHERE ItemID = @ItemID
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeletePackage]
    (
    	@ActorID int,
    	@PackageID int
    )
    AS
    BEGIN
    	-- check rights
    	IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    	RAISERROR('You are not allowed to access this package', 16, 1)

    	BEGIN TRAN

    	-- remove package from cache
    	DELETE FROM PackagesTreeCache
    	WHERE
    		ParentPackageID = @PackageID OR
    		PackageID = @PackageID

    	-- delete package comments
    	DELETE FROM Comments
    	WHERE ItemID = @PackageID AND ItemTypeID = 'PACKAGE'

    	-- delete diskspace
    	DELETE FROM PackagesDiskspace
    	WHERE PackageID = @PackageID

    	-- delete bandwidth
    	DELETE FROM PackagesBandwidth
    	WHERE PackageID = @PackageID

    	-- delete settings
    	DELETE FROM PackageSettings
    	WHERE PackageID = @PackageID

    	-- delete domains
    	DELETE FROM Domains
    	WHERE PackageID = @PackageID

    	-- delete package IP addresses
    	DELETE FROM PackageIPAddresses
    	WHERE PackageID = @PackageID

    	-- delete service items
    	DELETE FROM ServiceItems
    	WHERE PackageID = @PackageID

    	-- delete global DNS records
    	DELETE FROM GlobalDnsRecords
    	WHERE PackageID = @PackageID

    	-- delete package services
    	DELETE FROM PackageServices
    	WHERE PackageID = @PackageID

    	-- delete package quotas
    	DELETE FROM PackageQuotas
    	WHERE PackageID = @PackageID

    	-- delete package resources
    	DELETE FROM PackageResources
    	WHERE PackageID = @PackageID

    	-- delete package
    	DELETE FROM Packages
    	WHERE PackageID = @PackageID

    	COMMIT TRAN
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeletePackageAddon]
    (
    	@ActorID int,
    	@PackageAddonID int
    )
    AS

    DECLARE @PackageID int
    SELECT @PackageID = PackageID FROM PackageAddons
    WHERE PackageAddonID = @PackageAddonID

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    -- delete record
    DELETE FROM PackageAddons
    WHERE PackageAddonID = @PackageAddonID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeletePrivateNetworkVLAN]
    (
    	@VlanID int,
    	@Result int OUTPUT
    )
    AS

    SET @Result = 0
    IF EXISTS(SELECT VlanID FROM PackageVLANs WHERE VlanID = @VlanID)
    BEGIN
    	SET @Result = -2
    	RETURN
    END

    DELETE FROM PrivateNetworkVLANs
    WHERE VlanID = @VlanID
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[DeleteRDSCollection]
    (
    	@Id  int
    )
    AS

    UPDATE RDSServers
    SET
    	RDSCollectionId = Null
    WHERE RDSCollectionId = @Id

    DELETE FROM RDSCollections
    WHERE Id = @Id
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[DeleteRDSCollectionSettings]
    (
    	@Id  int
    )
    AS

    DELETE FROM DeleteRDSCollectionSettings
    WHERE Id = @Id
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[DeleteRDSServer]
    (
    	@Id  int
    )
    AS
    DELETE FROM RDSServers
    WHERE Id = @Id
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[DeleteRDSServerSettings]
    (
    	@ServerId int
    )
    AS
    	DELETE FROM RDSServerSettings WHERE RDSServerId = @ServerId
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteSchedule]
    (
    	@ActorID int,
    	@ScheduleID int
    )
    AS

    -- check rights
    DECLARE @PackageID int
    SELECT @PackageID = PackageID FROM Schedule
    WHERE ScheduleID = @ScheduleID

    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    BEGIN TRAN
    -- delete schedule parameters
    DELETE FROM ScheduleParameters
    WHERE ScheduleID = @ScheduleID

    -- delete schedule
    DELETE FROM Schedule
    WHERE ScheduleID = @ScheduleID

    COMMIT TRAN

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteServer]
    (
    	@ServerID int,
    	@Result int OUTPUT
    )
    AS
    SET @Result = 0

    -- check related services
    IF EXISTS (SELECT ServiceID FROM Services WHERE ServerID = @ServerID)
    BEGIN
    	SET @Result = -1
    	RETURN
    END

    -- check related packages
    IF EXISTS (SELECT PackageID FROM Packages WHERE ServerID = @ServerID)
    BEGIN
    	SET @Result = -2
    	RETURN
    END

    -- check related hosting plans
    IF EXISTS (SELECT PlanID FROM HostingPlans WHERE ServerID = @ServerID)
    BEGIN
    	SET @Result = -3
    	RETURN
    END

    BEGIN TRAN

    -- delete IP addresses
    DELETE FROM IPAddresses
    WHERE ServerID = @ServerID

    -- delete global DNS records
    DELETE FROM GlobalDnsRecords
    WHERE ServerID = @ServerID

    -- delete server
    DELETE FROM Servers
    WHERE ServerID = @ServerID

    -- delete virtual services if any
    DELETE FROM VirtualServices
    WHERE ServerID = @ServerID
    COMMIT TRAN

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteService]
    (
    	@ServiceID int,
    	@Result int OUTPUT
    )
    AS

    SET @Result = 0

    -- check related service items
    IF EXISTS (SELECT ItemID FROM ServiceItems WHERE ServiceID = @ServiceID)
    BEGIN
    	SET @Result = -1
    	RETURN
    END

    IF EXISTS (SELECT ServiceID FROM VirtualServices WHERE ServiceID = @ServiceID)
    BEGIN
    	SET @Result = -2
    	RETURN
    END

    BEGIN TRAN
    -- delete global DNS records
    DELETE FROM GlobalDnsRecords
    WHERE ServiceID = @ServiceID

    -- delete service
    DELETE FROM Services
    WHERE ServiceID = @ServiceID

    COMMIT TRAN

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteServiceItem]
    (
    	@ActorID int,
    	@ItemID int
    )
    AS

    -- check rights
    DECLARE @PackageID int
    SELECT @PackageID = PackageID FROM ServiceItems
    WHERE ItemID = @ItemID

    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    BEGIN TRAN

    UPDATE Domains
    SET ZoneItemID = NULL
    WHERE ZoneItemID = @ItemID

    DELETE FROM Domains
    WHERE WebSiteID = @ItemID AND IsDomainPointer = 1

    UPDATE Domains
    SET WebSiteID = NULL
    WHERE WebSiteID = @ItemID

    UPDATE Domains
    SET MailDomainID = NULL
    WHERE MailDomainID = @ItemID

    -- delete item comments
    DELETE FROM Comments
    WHERE ItemID = @ItemID AND ItemTypeID = 'SERVICE_ITEM'

    -- delete item properties
    DELETE FROM ServiceItemProperties
    WHERE ItemID = @ItemID

    -- delete external IP addresses
    EXEC dbo.DeleteItemIPAddresses @ActorID, @ItemID

    -- delete item
    DELETE FROM ServiceItems
    WHERE ItemID = @ItemID

    COMMIT TRAN

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteSfBUser]
    (
    	@AccountId int
    )
    AS

    DELETE FROM
    	LyncUsers
    WHERE
    	AccountId = @AccountId

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteSfBUserPlan]
    (
    	@SfBUserPlanId int
    )
    AS

    -- delete sfbuserplan
    DELETE FROM SfBUserPlans
    WHERE SfBUserPlanId = @SfBUserPlanId

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteSupportServiceLevel]
    (
    	@LevelID int
    )
    AS
    BEGIN

    	DECLARE @LevelName nvarchar(100), @QuotaName nvarchar(100), @QuotaID int

    	SELECT @LevelName = LevelName FROM SupportServiceLevels WHERE LevelID = @LevelID

    	SET @QuotaName = N'ServiceLevel.' + @LevelName

    	SELECT @QuotaID = QuotaID FROM Quotas WHERE QuotaName = @QuotaName

    	IF @QuotaID IS NOT NULL
    	BEGIN
    		DELETE FROM HostingPlanQuotas WHERE QuotaID = @QuotaID
    		DELETE FROM PackageQuotas WHERE QuotaID = @QuotaID
    		DELETE FROM Quotas WHERE QuotaID = @QuotaID
    	END

    	IF EXISTS (SELECT * FROM ExchangeAccounts WHERE LevelID = @LevelID)
    	UPDATE ExchangeAccounts
    	   SET LevelID = NULL
    	 WHERE LevelID = @LevelID

    	DELETE FROM SupportServiceLevels WHERE LevelID = @LevelID

    END

    RETURN 
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteUser]
    (
    	@ActorID int,
    	@UserID int
    )
    AS

    -- check actor rights
    IF dbo.CanUpdateUserDetails(@ActorID, @UserID) = 0
    RETURN

    BEGIN TRAN
    -- delete user comments
    DELETE FROM Comments
    WHERE ItemID = @UserID AND ItemTypeID = 'USER'

    IF (@@ERROR <> 0 )
          BEGIN
                ROLLBACK TRANSACTION
                RETURN -1
          END

    --delete reseller addon
    DELETE FROM HostingPlans WHERE UserID = @UserID AND IsAddon = 'True'

    IF (@@ERROR <> 0 )
          BEGIN
                ROLLBACK TRANSACTION
                RETURN -1
          END

    -- delete user peers
    DELETE FROM Users
    WHERE IsPeer = 1 AND OwnerID = @UserID

    IF (@@ERROR <> 0 )
          BEGIN
                ROLLBACK TRANSACTION
                RETURN -1
          END

    -- delete user
    DELETE FROM Users
    WHERE UserID = @UserID

    IF (@@ERROR <> 0 )
          BEGIN
                ROLLBACK TRANSACTION
                RETURN -1
          END

    COMMIT TRAN

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    -- =============================================
    -- Description:	Delete user email addresses except primary email
    -- =============================================
    CREATE PROCEDURE [dbo].[DeleteUserEmailAddresses]
    	@AccountId int,
    	@PrimaryEmailAddress nvarchar(300)
    AS
    BEGIN

    DELETE FROM
    	ExchangeAccountEmailAddresses
    WHERE
    	AccountID = @AccountID AND LOWER(EmailAddress) <> LOWER(@PrimaryEmailAddress)
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[DeleteUserThemeSetting]
    (
    	@ActorID int,
    	@UserID int,
    	@PropertyName NVARCHAR(255)
    )
    AS

    -- check rights
    IF dbo.CheckActorUserRights(@ActorID, @UserID) = 0
    RAISERROR('You are not allowed to access this account', 16, 1)

    DELETE FROM UserSettings
    WHERE UserID = @UserID
    AND SettingsName = N'Theme'
    AND PropertyName = @PropertyName

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DeleteVirtualServices]
    (
    	@ServerID int,
    	@Xml ntext
    )
    AS

    /*
    XML Format:

    <services>
    	<service id="16" />
    </services>

    */

    BEGIN TRAN
    DECLARE @idoc int
    --Create an internal representation of the XML document.
    EXEC sp_xml_preparedocument @idoc OUTPUT, @xml

    -- update HP resources
    DELETE FROM VirtualServices
    WHERE ServiceID IN (
    SELECT
    	ServiceID
    FROM OPENXML(@idoc, '/services/service',1) WITH
    (
    	ServiceID int '@id'
    ) as XS)
    AND ServerID = @ServerID

    -- remove document
    EXEC sp_xml_removedocument @idoc

    COMMIT TRAN
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[DistributePackageServices]
    (
    	@ActorID int,
    	@PackageID int
    )
    AS

    -- get primary distribution group
    DECLARE @PrimaryGroupID int
    DECLARE @VirtualServer bit
    DECLARE @PlanID int
    DECLARE @ServerID int
    SELECT
    	@PrimaryGroupID = ISNULL(S.PrimaryGroupID, 0),
    	@VirtualServer = S.VirtualServer,
    	@PlanID = P.PlanID,
    	@ServerID = P.ServerID
    FROM Packages AS P
    INNER JOIN Servers AS S ON P.ServerID = S.ServerID
    WHERE P.PackageID = @PackageID

    -- get the list of available groups from hosting plan
    DECLARE @Groups TABLE
    (
    	GroupID int,
    	PrimaryGroup bit
    )

    INSERT INTO @Groups (GroupID, PrimaryGroup)
    SELECT
    	RG.GroupID,
    	CASE WHEN RG.GroupID = @PrimaryGroupID THEN 1 -- mark primary group
    	ELSE 0
    	END
    FROM ResourceGroups AS RG
    WHERE dbo.GetPackageAllocatedResource(@PackageID, RG.GroupID, NULL) = 1
    AND RG.GroupID NOT IN
    (
    	SELECT P.GroupID
    	FROM PackageServices AS PS
    	INNER JOIN Services AS S ON PS.ServiceID = S.ServiceID
    	INNER JOIN Providers AS P ON S.ProviderID = P.ProviderID
    	WHERE PS.PackageID = @PackageID
    )

    IF @VirtualServer <> 1
    BEGIN
    	-- PHYSICAL SERVER
    	-- just return the list of services based on the plan
    	INSERT INTO PackageServices (PackageID, ServiceID)
    	SELECT
    		@PackageID,
    		S.ServiceID
    	FROM Services AS S
    	INNER JOIN Providers AS P ON S.ProviderID = P.ProviderID
    	INNER JOIN @Groups AS G ON P.GroupID = G.GroupID
    	WHERE S.ServerID = @ServerID
    		AND S.ServiceID NOT IN (SELECT ServiceID FROM PackageServices WHERE PackageID = @PackageID)
    END
    ELSE
    BEGIN
    	-- VIRTUAL SERVER

    	DECLARE @GroupID int, @PrimaryGroup int
    	DECLARE GroupsCursor CURSOR FOR
    	SELECT GroupID, PrimaryGroup FROM @Groups
    	ORDER BY PrimaryGroup DESC

    	OPEN GroupsCursor

    	WHILE (10 = 10)
    	BEGIN    --LOOP 10: thru groups
    		FETCH NEXT FROM GroupsCursor
    		INTO @GroupID, @PrimaryGroup

    		IF (@@fetch_status <> 0)
    		BEGIN
    			DEALLOCATE GroupsCursor
    			BREAK
    		END

    		-- read group information
    		DECLARE @DistributionType int, @BindDistributionToPrimary int
    		SELECT
    			@DistributionType = DistributionType,
    			@BindDistributionToPrimary = BindDistributionToPrimary
    		FROM VirtualGroups AS VG
    		WHERE ServerID = @ServerID AND GroupID = @GroupID

    		-- bind distribution to primary
    		IF @BindDistributionToPrimary = 1 AND @PrimaryGroup = 0 AND @PrimaryGroupID <> 0
    		BEGIN
    			-- if only one service found just use it and do not distribute
    			IF (SELECT COUNT(*) FROM VirtualServices AS VS
    				INNER JOIN Services AS S ON VS.ServiceID = S.ServiceID
    				INNER JOIN Providers AS P ON S.ProviderID = P.ProviderID
    				WHERE VS.ServerID = @ServerID AND P.GroupID = @GroupID) = 1
    				BEGIN
    					INSERT INTO PackageServices (PackageID, ServiceID)
    					SELECT
    						@PackageID,
    						VS.ServiceID
    					FROM VirtualServices AS VS
    					INNER JOIN Services AS S ON VS.ServiceID = S.ServiceID
    					INNER JOIN Providers AS P ON S.ProviderID = P.ProviderID
    					WHERE VS.ServerID = @ServerID AND P.GroupID = @GroupID
    				END
    			ELSE
    				BEGIN
    					DECLARE @PrimaryServerID int
    					-- try to get primary distribution server
    					SELECT
    						@PrimaryServerID = S.ServerID
    					FROM PackageServices AS PS
    					INNER JOIN Services AS S ON PS.ServiceID = S.ServiceID
    					INNER JOIN Providers AS P ON S.ProviderID = P.ProviderID
    					WHERE PS.PackageID = @PackageID AND P.GroupID = @PrimaryGroupID

    					INSERT INTO PackageServices (PackageID, ServiceID)
    					SELECT
    						@PackageID,
    						VS.ServiceID
    					FROM VirtualServices AS VS
    					INNER JOIN Services AS S ON VS.ServiceID = S.ServiceID
    					INNER JOIN Providers AS P ON S.ProviderID = P.ProviderID
    					WHERE VS.ServerID = @ServerID AND P.GroupID = @GroupID AND S.ServerID = @PrimaryServerID
    				END
    		END
    		ELSE
    		BEGIN

    			-- DISTRIBUTION
    			DECLARE @Services TABLE
    			(
    				ServiceID int,
    				ItemsNumber int,
    				RandomNumber int
    			)

    			DELETE FROM @Services

    			INSERT INTO @Services (ServiceID, ItemsNumber, RandomNumber)
    			SELECT
    				VS.ServiceID,
    				(SELECT COUNT(ItemID) FROM ServiceItems WHERE ServiceID = VS.ServiceID),
    				RAND()
    			FROM VirtualServices AS VS
    			INNER JOIN Services AS S ON VS.ServiceID = S.ServiceID
    			INNER JOIN Providers AS P ON S.ProviderID = P.ProviderID
    			WHERE VS.ServerID = @ServerID AND P.GroupID = @GroupID

    			-- BALANCED DISTRIBUTION
    			IF @DistributionType = 1
    			BEGIN
    				-- get the less allocated service
    				INSERT INTO PackageServices (PackageID, ServiceID)
    				SELECT TOP 1
    					@PackageID,
    					ServiceID
    				FROM @Services
    				ORDER BY ItemsNumber
    			END
    			ELSE
    			-- RANDOMIZED DISTRIBUTION
    			BEGIN
    				-- get the less allocated service
    				INSERT INTO PackageServices (PackageID, ServiceID)
    				SELECT TOP 1
    					@PackageID,
    					ServiceID
    				FROM @Services
    				ORDER BY RandomNumber
    			END
    		END

    		IF @PrimaryGroup = 1
    		SET @PrimaryGroupID = @GroupID

    	END -- while groups

    END -- end virtual server

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[ExchangeAccountEmailAddressExists]
    (
    	@EmailAddress nvarchar(300),
    	@checkContacts bit,
    	@Exists bit OUTPUT
    )
    AS
    	SET @Exists = 0
    	IF EXISTS(SELECT * FROM [dbo].[ExchangeAccountEmailAddresses] WHERE [EmailAddress] = @EmailAddress)
    		BEGIN
    			SET @Exists = 1
    		END
    	ELSE IF EXISTS(SELECT * FROM [dbo].[ExchangeAccounts] WHERE [PrimaryEmailAddress] = @EmailAddress AND ([AccountType] <> 2 OR @checkContacts = 1))
    		BEGIN
    			SET @Exists = 1
    		END

    	RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[ExchangeAccountExists]
    (
    	@AccountName nvarchar(20),
    	@Exists bit OUTPUT
    )
    AS
    SET @Exists = 0
    IF EXISTS(SELECT * FROM ExchangeAccounts WHERE sAMAccountName LIKE '%\'+@AccountName)
    BEGIN
    	SET @Exists = 1
    END

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[ExchangeOrganizationDomainExists]
    (
    	@DomainID int,
    	@Exists bit OUTPUT
    )
    AS
    SET @Exists = 0
    IF EXISTS(SELECT * FROM ExchangeOrganizationDomains WHERE DomainID = @DomainID)
    BEGIN
    	SET @Exists = 1
    END
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[ExchangeOrganizationExists]
    (
    	@OrganizationID nvarchar(10),
    	@Exists bit OUTPUT
    )
    AS
    SET @Exists = 0
    IF EXISTS(SELECT * FROM ExchangeOrganizations WHERE OrganizationID = @OrganizationID)
    BEGIN
    	SET @Exists = 1
    END

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetAccessTokenByAccessToken]
    (
    	@AccessToken UNIQUEIDENTIFIER,
    	@TokenType INT
    )
    AS
    SELECT 
    	ID ,
    	AccessTokenGuid,
    	ExpirationDate,
    	AccountID,
    	ItemId,
    	TokenType,
    	SmsResponse
    	FROM AccessTokens 
    	Where AccessTokenGuid = @AccessToken AND ExpirationDate > getdate() AND TokenType = @TokenType
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetAdditionalGroups]
    (
    	@UserID INT
    )
    AS

    SELECT
    	AG.ID,
    	AG.UserID,
    	AG.GroupName
    FROM AdditionalGroups AS AG
    WHERE AG.UserID = @UserID
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetAllPackages]
    AS
    SELECT
    	   [PackageID]
          ,[ParentPackageID]
          ,[UserID]
          ,[PackageName]
          ,[PackageComments]
          ,[ServerID]
          ,[StatusID]
          ,[PlanID]
          ,[PurchaseDate]
          ,[OverrideQuotas]
          ,[BandwidthUpdated]
      FROM [dbo].[Packages]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetAllServers]
    (
    	@ActorID int
    )
    AS

    -- check rights
    DECLARE @IsAdmin bit
    SET @IsAdmin = dbo.CheckIsUserAdmin(@ActorID)

    SELECT
    	S.ServerID,
    	S.ServerName,
    	S.ServerUrl,
    	(SELECT COUNT(SRV.ServiceID) FROM VirtualServices AS SRV WHERE S.ServerID = SRV.ServerID) AS ServicesNumber,
    	S.Comments
    FROM Servers AS S
    WHERE @IsAdmin = 1
    ORDER BY S.VirtualServer, S.ServerName

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetAuditLogRecord]
    (
    	@RecordID varchar(32)
    )
    AS

    SELECT
    	L.RecordID,
        L.SeverityID,
        L.StartDate,
        L.FinishDate,
        L.ItemID,
        L.SourceName,
        L.TaskName,
        L.ItemName,
        L.ExecutionLog,

        ISNULL(L.UserID, 0) AS UserID,
    	L.Username,
    	U.FirstName,
    	U.LastName,
    	U.FullName,
    	ISNULL(U.RoleID, 0) AS RoleID,
    	U.Email
    FROM AuditLog AS L
    LEFT OUTER JOIN UsersDetailed AS U ON L.UserID = U.UserID
    WHERE RecordID = @RecordID
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetAuditLogRecordsPaged]
    (
    	@ActorID int,
    	@UserID int,
    	@PackageID int,
    	@ItemID int,
    	@ItemName nvarchar(100),
    	@StartDate datetime,
    	@EndDate datetime,
    	@SeverityID int,
    	@SourceName varchar(100),
    	@TaskName varchar(100),
    	@SortColumn nvarchar(50),
    	@StartRow int,
    	@MaximumRows int
    )
    AS

    -- check rights
    IF dbo.CheckActorUserRights(@ActorID, @UserID) = 0
    RAISERROR('You are not allowed to access this account', 16, 1)

    IF @SourceName IS NULL SET @SourceName = ''
    IF @TaskName IS NULL SET @TaskName = ''
    IF @ItemName IS NULL SET @ItemName = ''

    IF @SortColumn IS NULL OR @SortColumn = ''
    SET @SortColumn = 'L.StartDate DESC'

    -- build query and run it to the temporary table
    DECLARE @sql nvarchar(2000)

    SET @sql = '
    DECLARE @IsAdmin bit
    SET @IsAdmin = 0
    IF EXISTS(SELECT UserID FROM Users WHERE UserID = @ActorID AND RoleID = 1)
    SET @IsAdmin = 1

    DECLARE @EndRow int
    SET @EndRow = @StartRow + @MaximumRows
    DECLARE @Records TABLE
    (
    	ItemPosition int IDENTITY(1,1),
    	RecordID varchar(32)
    )
    INSERT INTO @Records (RecordID)
    SELECT
    	L.RecordID
    FROM AuditLog AS L
    WHERE
    ((@PackageID = 0 AND dbo.CheckUserParent(@UserID, L.UserID) = 1 OR (L.UserID IS NULL AND @IsAdmin = 1))
    	OR (@PackageID > 0 AND L.PackageID = @PackageID))
    AND L.StartDate BETWEEN @StartDate AND @EndDate
    AND ((@SourceName = '''') OR (@SourceName <> '''' AND L.SourceName = @SourceName))
    AND ((@TaskName = '''') OR (@TaskName <> '''' AND L.TaskName = @TaskName))
    AND ((@ItemID = 0) OR (@ItemID > 0 AND L.ItemID = @ItemID))
    AND ((@ItemName = '''') OR (@ItemName <> '''' AND L.ItemName LIKE @ItemName))
    AND ((@SeverityID = -1) OR (@SeverityID > -1 AND L.SeverityID = @SeverityID)) '

    IF @SortColumn <> '' AND @SortColumn IS NOT NULL
    SET @sql = @sql + ' ORDER BY ' + @SortColumn + ' '

    SET @sql = @sql + ' SELECT COUNT(RecordID) FROM @Records;
    SELECT
    	TL.RecordID,
        L.SeverityID,
        L.StartDate,
        L.FinishDate,
        L.ItemID,
        L.SourceName,
        L.TaskName,
        L.ItemName,
        L.ExecutionLog,

        ISNULL(L.UserID, 0) AS UserID,
    	L.Username,
    	U.FirstName,
    	U.LastName,
    	U.FullName,
    	ISNULL(U.RoleID, 0) AS RoleID,
    	U.Email,
    	CASE U.IsPeer
    		WHEN 1 THEN U.OwnerID
    		ELSE U.UserID
    	END EffectiveUserID
    FROM @Records AS TL
    INNER JOIN AuditLog AS L ON TL.RecordID = L.RecordID
    LEFT OUTER JOIN UsersDetailed AS U ON L.UserID = U.UserID
    WHERE TL.ItemPosition BETWEEN @StartRow + 1 AND @EndRow'

    exec sp_executesql @sql, N'@TaskName varchar(100), @SourceName varchar(100), @PackageID int, @ItemID int, @ItemName nvarchar(100), @StartDate datetime,
    @EndDate datetime, @StartRow int, @MaximumRows int, @UserID int, @ActorID int, @SeverityID int',
    @TaskName, @SourceName, @PackageID, @ItemID, @ItemName, @StartDate, @EndDate, @StartRow, @MaximumRows, @UserID, @ActorID,
    @SeverityID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetAuditLogSources]
    AS

    SELECT SourceName FROM AuditLogSources

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetAuditLogTasks]
    (
    	@SourceName varchar(100)
    )
    AS

    IF @SourceName = '' SET @SourceName = NULL

    SELECT SourceName, TaskName FROM AuditLogTasks
    WHERE (@SourceName = NULL OR @SourceName IS NOT NULL AND SourceName = @SourceName)

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetAvailableVirtualServices]
    (
    	@ActorID int,
    	@ServerID int
    )
    AS

    -- check rights
    DECLARE @IsAdmin bit
    SET @IsAdmin = dbo.CheckIsUserAdmin(@ActorID)

    SELECT
    	S.ServerID,
    	S.ServerName,
    	S.Comments
    FROM Servers AS S
    WHERE
    	VirtualServer = 0 -- get only physical servers
    	AND @IsAdmin = 1

    -- services
    SELECT
    	ServiceID,
    	ServerID,
    	ProviderID,
    	ServiceName,
    	Comments
    FROM Services
    WHERE
    	ServiceID NOT IN (SELECT ServiceID FROM VirtualServices WHERE ServerID = @ServerID)
    	AND @IsAdmin = 1

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetBackgroundTask]
    (
    	@TaskID NVARCHAR(255)
    )
    AS

    SELECT TOP 1
    	T.ID,
    	T.Guid,
    	T.TaskID,
    	T.ScheduleID,
    	T.PackageID,
    	T.UserID,
    	T.EffectiveUserID,
    	T.TaskName,
    	T.ItemID,
    	T.ItemName,
    	T.StartDate,
    	T.FinishDate,
    	T.IndicatorCurrent,
    	T.IndicatorMaximum,
    	T.MaximumExecutionTime,
    	T.Source,
    	T.Severity,
    	T.Completed,
    	T.NotifyOnComplete,
    	T.Status
    FROM BackgroundTasks AS T
    INNER JOIN BackgroundTaskStack AS TS
    	ON TS.TaskId = T.ID
    WHERE T.TaskID = @TaskID 
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetBackgroundTaskLogs]
    (
    	@TaskID INT,
    	@StartLogTime DATETIME
    )
    AS

    SELECT
    	L.LogID,
    	L.TaskID,
    	L.Date,
    	L.ExceptionStackTrace,
    	L.InnerTaskStart,
    	L.Severity,
    	L.Text,
    	L.XmlParameters
    FROM BackgroundTaskLogs AS L
    WHERE L.TaskID = @TaskID AND L.Date >= @StartLogTime
    ORDER BY L.Date
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetBackgroundTaskParams]
    (
    	@TaskID INT
    )
    AS

    SELECT
    	P.ParameterID,
    	P.TaskID,
    	P.Name,
    	P.SerializerValue,
    	P.TypeName
    FROM BackgroundTaskParameters AS P
    WHERE P.TaskID = @TaskID
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetBackgroundTasks]
    (
    	@ActorID INT
    )
    AS

     with GetChildUsersId(id) as (
        select UserID
        from Users
        where UserID = @ActorID
        union all
        select C.UserId
        from GetChildUsersId P
        inner join Users C on P.id = C.OwnerID
    )

    SELECT 
    	T.ID,
    	T.Guid,
    	T.TaskID,
    	T.ScheduleId,
    	T.PackageId,
    	T.UserId,
    	T.EffectiveUserId,
    	T.TaskName,
    	T.ItemId,
    	T.ItemName,
    	T.StartDate,
    	T.FinishDate,
    	T.IndicatorCurrent,
    	T.IndicatorMaximum,
    	T.MaximumExecutionTime,
    	T.Source,
    	T.Severity,
    	T.Completed,
    	T.NotifyOnComplete,
    	T.Status
    FROM BackgroundTasks AS T
    INNER JOIN (SELECT T.Guid, MIN(T.StartDate) AS Date
    			FROM BackgroundTasks AS T
    			INNER JOIN BackgroundTaskStack AS TS
    				ON TS.TaskId = T.ID
    			WHERE T.UserID in (select id from GetChildUsersId)
    			GROUP BY T.Guid) AS TT ON TT.Guid = T.Guid AND TT.Date = T.StartDate
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetBackgroundTopTask]
    (
    	@Guid UNIQUEIDENTIFIER
    )
    AS

    SELECT TOP 1
    	T.ID,
    	T.Guid,
    	T.TaskID,
    	T.ScheduleId,
    	T.PackageId,
    	T.UserId,
    	T.EffectiveUserId,
    	T.TaskName,
    	T.ItemId,
    	T.ItemName,
    	T.StartDate,
    	T.FinishDate,
    	T.IndicatorCurrent,
    	T.IndicatorMaximum,
    	T.MaximumExecutionTime,
    	T.Source,
    	T.Severity,
    	T.Completed,
    	T.NotifyOnComplete,
    	T.Status
    FROM BackgroundTasks AS T
    INNER JOIN BackgroundTaskStack AS TS
    	ON TS.TaskId = T.ID
    WHERE T.Guid = @Guid
    ORDER BY T.StartDate ASC
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetBlackBerryUsers]
    (
    	@ItemID int,
    	@SortColumn nvarchar(40),
    	@SortDirection nvarchar(20),
    	@Name nvarchar(400),
    	@Email nvarchar(400),
    	@StartRow int,
    	@Count int
    )
    AS

    IF (@Name IS NULL)
    BEGIN
    	SET @Name = '%'
    END

    IF (@Email IS NULL)
    BEGIN
    	SET @Email = '%'
    END

    CREATE TABLE #TempBlackBerryUsers
    (
    	[ID] [int] IDENTITY(1,1) NOT NULL,
    	[AccountID] [int],
    	[ItemID] [int] NOT NULL,
    	[AccountName] [nvarchar](300) NOT NULL,
    	[DisplayName] [nvarchar](300) NOT NULL,
    	[PrimaryEmailAddress] [nvarchar](300) NULL,
    	[SamAccountName] [nvarchar](100) NULL
    )

    IF (@SortColumn = 'DisplayName')
    BEGIN
    	INSERT INTO
    		#TempBlackBerryUsers
    	SELECT
    		ea.AccountID,
    		ea.ItemID,
    		ea.AccountName,
    		ea.DisplayName,
    		ea.PrimaryEmailAddress,
    		ea.SamAccountName
    	FROM
    		ExchangeAccounts ea
    	INNER JOIN
    		BlackBerryUsers bu
    	ON
    		ea.AccountID = bu.AccountID
    	WHERE
    		ea.ItemID = @ItemID AND ea.DisplayName LIKE @Name AND ea.PrimaryEmailAddress LIKE @Email
    	ORDER BY
    		ea.DisplayName
    END
    ELSE
    BEGIN
    	INSERT INTO
    		#TempBlackBerryUsers
    	SELECT
    		ea.AccountID,
    		ea.ItemID,
    		ea.AccountName,
    		ea.DisplayName,
    		ea.PrimaryEmailAddress,
    		ea.SamAccountName
    	FROM
    		ExchangeAccounts ea
    	INNER JOIN
    		BlackBerryUsers bu
    	ON
    		ea.AccountID = bu.AccountID
    	WHERE
    		ea.ItemID = @ItemID AND ea.DisplayName LIKE @Name AND ea.PrimaryEmailAddress LIKE @Email
    	ORDER BY
    		ea.PrimaryEmailAddress
    END

    DECLARE @RetCount int
    SELECT @RetCount = COUNT(ID) FROM #TempBlackBerryUsers

    IF (@SortDirection = 'ASC')
    BEGIN
    	SELECT * FROM #TempBlackBerryUsers
    	WHERE ID > @StartRow AND ID <= (@StartRow + @Count)
    END
    ELSE
    BEGIN
    	IF (@SortColumn = 'DisplayName')
    	BEGIN
    		SELECT * FROM #TempBlackBerryUsers
    			WHERE ID >@RetCount - @Count - @StartRow AND ID <= @RetCount- @StartRow  ORDER BY DisplayName DESC
    	END
    	ELSE
    	BEGIN
    		SELECT * FROM #TempBlackBerryUsers
    			WHERE ID >@RetCount - @Count - @StartRow AND ID <= @RetCount- @StartRow  ORDER BY PrimaryEmailAddress DESC
    	END

    END

    DROP TABLE #TempBlackBerryUsers

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetBlackBerryUsersCount]
    (
    	@ItemID int,
    	@Name nvarchar(400),
    	@Email nvarchar(400)

    )
    AS

    IF (@Name IS NULL)
    BEGIN
    	SET @Name = '%'
    END

    IF (@Email IS NULL)
    BEGIN
    	SET @Email = '%'
    END

    SELECT
    	COUNT(ea.AccountID)
    FROM
    	ExchangeAccounts ea
    INNER JOIN
    	BlackBerryUsers bu
    ON
    	ea.AccountID = bu.AccountID
    WHERE
    	ea.ItemID = @ItemID AND ea.DisplayName LIKE @Name AND ea.PrimaryEmailAddress LIKE @Email

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetCertificatesForSite]
    (
    	@ActorID int,
    	@PackageID int,
    	@websiteid int
    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    BEGIN
    	RAISERROR('You are not allowed to access this package', 16, 1)
    	RETURN
    END

    SELECT
    	[ID], [UserID], [SiteID], [FriendlyName], [Hostname], [DistinguishedName],
    	[CSR], [CSRLength], [ValidFrom], [ExpiryDate], [Installed], [IsRenewal],
    	[PreviousId], [SerialNumber]
    FROM
    	[dbo].[SSLCertificates]
    WHERE
    	[SiteID] = @websiteid
    RETURN

    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetClusters]
    (
    	@ActorID int
    )
    AS

    -- check rights
    DECLARE @IsAdmin bit
    SET @IsAdmin = dbo.CheckIsUserAdmin(@ActorID)

    -- get the list
    SELECT
    	ClusterID,
    	ClusterName
    FROM Clusters
    WHERE @IsAdmin = 1

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetComments]
    (
    	@ActorID int,
    	@UserID int,
    	@ItemTypeID varchar(50),
    	@ItemID int
    )
    AS

    -- check rights
    IF dbo.CheckActorUserRights(@ActorID, @UserID) = 0
    RAISERROR('You are not allowed to access this account', 16, 1)

    SELECT
    	C.CommentID,
    	C.ItemTypeID,
    	C.ItemID,
    	C.UserID,
    	C.CreatedDate,
    	C.CommentText,
    	C.SeverityID,

    	-- user
    	U.Username,
    	U.FirstName,
    	U.LastName,
    	U.FullName,
    	U.RoleID,
    	U.Email
    FROM Comments AS C
    INNER JOIN UsersDetailed AS U ON C.UserID = U.UserID
    WHERE
    	ItemTypeID = @ItemTypeID
    	AND ItemID = @ItemID
    	AND dbo.CheckUserParent(@UserID, C.UserID) = 1
    ORDER BY C.CreatedDate ASC
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetCRMOrganizationUsers]
    	@ItemID int
    AS
    BEGIN
    	SELECT
    		ea.AccountID,
    		ea.ItemID,
    		ea.AccountName,
    		ea.DisplayName,
    		ea.PrimaryEmailAddress,
    		ea.SamAccountName
    	FROM
    		ExchangeAccounts ea
    	INNER JOIN
    		CRMUsers cu
    	ON
    		ea.AccountID = cu.AccountID
    	WHERE
    		ea.ItemID = @ItemID
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetCRMUser]
    	@AccountID int
    AS
    BEGIN
    	SET NOCOUNT ON;
    SELECT
    	CRMUserGUID as CRMUserID,
    	BusinessUnitID
    FROM
    	CRMUsers
    WHERE
    	AccountID = @AccountID
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetCRMUsers]
    (
    	@ItemID int,
    	@SortColumn nvarchar(40),
    	@SortDirection nvarchar(20),
    	@Name nvarchar(400),
    	@Email nvarchar(400),
    	@StartRow int,
    	@Count int
    )
    AS

    IF (@Name IS NULL)
    BEGIN
    	SET @Name = '%'
    END

    IF (@Email IS NULL)
    BEGIN
    	SET @Email = '%'
    END

    CREATE TABLE #TempCRMUsers
    (
    	[ID] [int] IDENTITY(1,1) NOT NULL,
    	[AccountID] [int],
    	[ItemID] [int] NOT NULL,
    	[AccountName] [nvarchar](300) NOT NULL,
    	[DisplayName] [nvarchar](300) NOT NULL,
    	[PrimaryEmailAddress] [nvarchar](300) NULL,
    	[SamAccountName] [nvarchar](100) NULL
    )

    IF (@SortColumn = 'DisplayName')
    BEGIN
    	INSERT INTO
    		#TempCRMUsers
    	SELECT
    		ea.AccountID,
    		ea.ItemID,
    		ea.AccountName,
    		ea.DisplayName,
    		ea.PrimaryEmailAddress,
    		ea.SamAccountName
    	FROM
    		ExchangeAccounts ea
    	INNER JOIN
    		CRMUsers cu
    	ON
    		ea.AccountID = cu.AccountID
    	WHERE
    		ea.ItemID = @ItemID AND ea.DisplayName LIKE @Name AND ea.PrimaryEmailAddress LIKE @Email
    	ORDER BY
    		ea.DisplayName
    END
    ELSE
    BEGIN
    	INSERT INTO
    		#TempCRMUsers
    	SELECT
    		ea.AccountID,
    		ea.ItemID,
    		ea.AccountName,
    		ea.DisplayName,
    		ea.PrimaryEmailAddress,
    		ea.SamAccountName
    	FROM
    		ExchangeAccounts ea
    	INNER JOIN
    		CRMUsers cu
    	ON
    		ea.AccountID = cu.AccountID
    	WHERE
    		ea.ItemID = @ItemID AND ea.DisplayName LIKE @Name AND ea.PrimaryEmailAddress LIKE @Email
    	ORDER BY
    		ea.PrimaryEmailAddress
    END

    DECLARE @RetCount int
    SELECT @RetCount = COUNT(ID) FROM #TempCRMUsers

    IF (@SortDirection = 'ASC')
    BEGIN
    	SELECT * FROM #TempCRMUsers
    	WHERE ID > @StartRow AND ID <= (@StartRow + @Count)
    END
    ELSE
    BEGIN
    	IF (@SortColumn = 'DisplayName')
    	BEGIN
    		SELECT * FROM #TempCRMUsers
    			WHERE ID >@RetCount - @Count - @StartRow AND ID <= @RetCount- @StartRow  ORDER BY DisplayName DESC
    	END
    	ELSE
    	BEGIN
    		SELECT * FROM #TempCRMUsers
    			WHERE ID >@RetCount - @Count - @StartRow AND ID <= @RetCount- @StartRow  ORDER BY PrimaryEmailAddress DESC
    	END

    END

    DROP TABLE #TempCRMUsers

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetCRMUsersCount] 
    (
    	@ItemID int,
    	@Name nvarchar(400),
    	@Email nvarchar(400),
    	@CALType int
    )
    AS
    BEGIN

    IF (@Name IS NULL)
    BEGIN
    	SET @Name = '%'
    END

    IF (@Email IS NULL)
    BEGIN
    	SET @Email = '%'
    END

    SELECT 
    	COUNT(ea.AccountID)		
    FROM 
    	ExchangeAccounts ea 
    INNER JOIN 
    	CRMUsers cu 
    ON 
    	ea.AccountID = cu.AccountID
    WHERE 
    	ea.ItemID = @ItemID AND ea.DisplayName LIKE @Name AND ea.PrimaryEmailAddress LIKE @Email
    	AND ((cu.CALType = @CALType) OR (@CALType = -1))
    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetDnsRecord]
    (
    	@ActorID int,
    	@RecordID int
    )
    AS

    -- check rights
    DECLARE @ServiceID int, @ServerID int, @PackageID int
    SELECT
    	@ServiceID = ServiceID,
    	@ServerID = ServerID,
    	@PackageID = PackageID
    FROM GlobalDnsRecords
    WHERE
    	RecordID = @RecordID

    IF (@ServiceID > 0 OR @ServerID > 0) AND dbo.CheckIsUserAdmin(@ActorID) = 0
    RAISERROR('You are not allowed to perform this operation', 16, 1)

    IF (@PackageID > 0) AND dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    SELECT
    	NR.RecordID,
    	NR.ServiceID,
    	NR.ServerID,
    	NR.PackageID,
    	NR.RecordType,
    	NR.RecordName,
    	NR.RecordData,
    	NR.MXPriority,
    	NR.SrvPriority,
    	NR.SrvWeight,
    	NR.SrvPort,
    	NR.IPAddressID
    FROM
    	GlobalDnsRecords AS NR
    WHERE NR.RecordID = @RecordID
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetDnsRecordsByGroup]
    (
    	@GroupID int
    )
    AS
    SELECT
    	RGR.RecordID,
    	RGR.RecordOrder,
    	RGR.GroupID,
    	RGR.RecordType,
    	RGR.RecordName,
    	RGR.RecordData,
    	RGR.MXPriority
    FROM
    	ResourceGroupDnsRecords AS RGR
    WHERE RGR.GroupID = @GroupID
    ORDER BY RGR.RecordOrder
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetDnsRecordsByPackage]
    (
    	@ActorID int,
    	@PackageID int
    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    SELECT
    	NR.RecordID,
    	NR.ServiceID,
    	NR.ServerID,
    	NR.PackageID,
    	NR.RecordType,
    	NR.RecordName,
    	NR.RecordData,
    	NR.MXPriority,
    	NR.SrvPriority,
    	NR.SrvWeight,
    	NR.SrvPort,
    	NR.IPAddressID,
    	CASE
    		WHEN NR.RecordType = 'A' AND NR.RecordData = '' THEN dbo.GetFullIPAddress(IP.ExternalIP, IP.InternalIP)
    		WHEN NR.RecordType = 'MX' THEN CONVERT(varchar(3), NR.MXPriority) + ', ' + NR.RecordData
    		WHEN NR.RecordType = 'SRV' THEN CONVERT(varchar(3), NR.SrvPort) + ', ' + NR.RecordData
    		ELSE NR.RecordData
    	END AS FullRecordData,
    	dbo.GetFullIPAddress(IP.ExternalIP, IP.InternalIP) AS IPAddress,
    	IP.ExternalIP,
    	IP.InternalIP
    FROM
    	GlobalDnsRecords AS NR
    LEFT OUTER JOIN IPAddresses AS IP ON NR.IPAddressID = IP.AddressID
    WHERE NR.PackageID = @PackageID
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetDnsRecordsByServer]
    (
    	@ActorID int,
    	@ServerID int
    )
    AS

    SELECT
    	NR.RecordID,
    	NR.ServiceID,
    	NR.ServerID,
    	NR.PackageID,
    	NR.RecordType,
    	NR.RecordName,
    	NR.RecordData,
    	CASE
    		WHEN NR.RecordType = 'A' AND NR.RecordData = '' THEN dbo.GetFullIPAddress(IP.ExternalIP, IP.InternalIP)
    		WHEN NR.RecordType = 'MX' THEN CONVERT(varchar(3), NR.MXPriority) + ', ' + NR.RecordData
    		WHEN NR.RecordType = 'SRV' THEN CONVERT(varchar(3), NR.SrvPort) + ', ' + NR.RecordData
    		ELSE NR.RecordData
    	END AS FullRecordData,
    	NR.MXPriority,
    	NR.SrvPriority,
    	NR.SrvWeight,
    	NR.SrvPort,
    	NR.IPAddressID,
    	dbo.GetFullIPAddress(IP.ExternalIP, IP.InternalIP) AS IPAddress,
    	IP.ExternalIP,
    	IP.InternalIP
    FROM
    	GlobalDnsRecords AS NR
    LEFT OUTER JOIN IPAddresses AS IP ON NR.IPAddressID = IP.AddressID
    WHERE
    	NR.ServerID = @ServerID
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetDnsRecordsByService]
    (
    	@ActorID int,
    	@ServiceID int
    )
    AS

    SELECT
    	NR.RecordID,
    	NR.ServiceID,
    	NR.ServerID,
    	NR.PackageID,
    	NR.RecordType,
    	NR.RecordName,
    	CASE
    		WHEN NR.RecordType = 'A' AND NR.RecordData = '' THEN dbo.GetFullIPAddress(IP.ExternalIP, IP.InternalIP)
    		WHEN NR.RecordType = 'MX' THEN CONVERT(varchar(3), NR.MXPriority) + ', ' + NR.RecordData
    		WHEN NR.RecordType = 'SRV' THEN CONVERT(varchar(3), NR.SrvPort) + ', ' + NR.RecordData
    		ELSE NR.RecordData
    	END AS FullRecordData,
    	NR.RecordData,
    	NR.MXPriority,
    	NR.SrvPriority,
    	NR.SrvWeight,
    	NR.SrvPort,
    	NR.IPAddressID,
    	dbo.GetFullIPAddress(IP.ExternalIP, IP.InternalIP) AS IPAddress,
    	IP.ExternalIP,
    	IP.InternalIP
    FROM
    	GlobalDnsRecords AS NR
    LEFT OUTER JOIN IPAddresses AS IP ON NR.IPAddressID = IP.AddressID
    WHERE
    	NR.ServiceID = @ServiceID
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetDnsRecordsTotal]
    (
    	@ActorID int,
    	@PackageID int
    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    -- create temp table for DNS records
    DECLARE @Records TABLE
    (
    	RecordID int,
    	RecordType nvarchar(10),
    	RecordName nvarchar(50)
    )

    -- select PACKAGES DNS records
    DECLARE @ParentPackageID int, @TmpPackageID int
    SET @TmpPackageID = @PackageID

    WHILE 10 = 10
    BEGIN

    	-- get DNS records for the current package
    	INSERT INTO @Records (RecordID, RecordType, RecordName)
    	SELECT
    		GR.RecordID,
    		GR.RecordType,
    		GR.RecordName
    	FROM GlobalDNSRecords AS GR
    	WHERE GR.PackageID = @TmpPackageID
    	AND GR.RecordType + GR.RecordName NOT IN (SELECT RecordType + RecordName FROM @Records)

    	SET @ParentPackageID = NULL

    	-- get parent package
    	SELECT
    		@ParentPackageID = ParentPackageID
    	FROM Packages
    	WHERE PackageID = @TmpPackageID

    	IF @ParentPackageID IS NULL -- the last parent
    	BREAK

    	SET @TmpPackageID = @ParentPackageID
    END

    -- select VIRTUAL SERVER DNS records
    DECLARE @ServerID int
    SELECT @ServerID = ServerID FROM Packages
    WHERE PackageID = @PackageID

    INSERT INTO @Records (RecordID, RecordType, RecordName)
    SELECT
    	GR.RecordID,
    	GR.RecordType,
    	GR.RecordName
    FROM GlobalDNSRecords AS GR
    WHERE GR.ServerID = @ServerID
    AND GR.RecordType + GR.RecordName NOT IN (SELECT RecordType + RecordName FROM @Records)

    -- select SERVER DNS records
    INSERT INTO @Records (RecordID, RecordType, RecordName)
    SELECT
    	GR.RecordID,
    	GR.RecordType,
    	GR.RecordName
    FROM GlobalDNSRecords AS GR
    WHERE GR.ServerID IN (SELECT
    	SRV.ServerID
    FROM VirtualServices AS VS
    INNER JOIN Services AS S ON VS.ServiceID = S.ServiceID
    INNER JOIN Servers AS SRV ON S.ServerID = SRV.ServerID
    WHERE VS.ServerID = @ServerID)
    AND GR.RecordType + GR.RecordName NOT IN (SELECT RecordType + RecordName FROM @Records)

    -- select SERVICES DNS records
    -- re-distribute package services
    EXEC DistributePackageServices @ActorID, @PackageID

    --INSERT INTO @Records (RecordID, RecordType, RecordName)
    --SELECT
    --	GR.RecordID,
    --	GR.RecordType,
    	-- GR.RecordName
    -- FROM GlobalDNSRecords AS GR
    -- WHERE GR.ServiceID IN (SELECT ServiceID FROM PackageServices WHERE PackageID = @PackageID)
    -- AND GR.RecordType + GR.RecordName NOT IN (SELECT RecordType + RecordName FROM @Records)

    SELECT
    	NR.RecordID,
    	NR.ServiceID,
    	NR.ServerID,
    	NR.PackageID,
    	NR.RecordType,
    	NR.RecordName,
    	NR.RecordData,
    	NR.MXPriority,
    	NR.SrvPriority,
    	NR.SrvWeight,
    	NR.SrvPort,
    	NR.IPAddressID,
    	ISNULL(IP.ExternalIP, '') AS ExternalIP,
    	ISNULL(IP.InternalIP, '') AS InternalIP,
    	CASE
    		WHEN NR.RecordType = 'A' AND NR.RecordData = '' THEN dbo.GetFullIPAddress(IP.ExternalIP, IP.InternalIP)
    		WHEN NR.RecordType = 'MX' THEN CONVERT(varchar(3), NR.MXPriority) + ', ' + NR.RecordData
    		WHEN NR.RecordType = 'SRV' THEN CONVERT(varchar(3), NR.SrvPort) + ', ' + NR.RecordData
    		ELSE NR.RecordData
    	END AS FullRecordData,
    	dbo.GetFullIPAddress(IP.ExternalIP, IP.InternalIP) AS IPAddress
    FROM @Records AS TR
    INNER JOIN GlobalDnsRecords AS NR ON TR.RecordID = NR.RecordID
    LEFT OUTER JOIN IPAddresses AS IP ON NR.IPAddressID = IP.AddressID

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetDomain]
    (
    	@ActorID int,
    	@DomainID int
    )
    AS

    SELECT
    	D.DomainID,
    	D.PackageID,
    	D.ZoneItemID,
    	D.DomainItemID,
    	D.DomainName,
    	D.HostingAllowed,
    	ISNULL(WS.ItemID, 0) AS WebSiteID,
    	WS.ItemName AS WebSiteName,
    	ISNULL(MD.ItemID, 0) AS MailDomainID,
    	MD.ItemName AS MailDomainName,
    	Z.ItemName AS ZoneName,
    	D.IsSubDomain,
    	D.IsPreviewDomain,
    	D.IsDomainPointer
    FROM Domains AS D
    INNER JOIN Packages AS P ON D.PackageID = P.PackageID
    LEFT OUTER JOIN ServiceItems AS WS ON D.WebSiteID = WS.ItemID
    LEFT OUTER JOIN ServiceItems AS MD ON D.MailDomainID = MD.ItemID
    LEFT OUTER JOIN ServiceItems AS Z ON D.ZoneItemID = Z.ItemID
    WHERE
    	D.DomainID = @DomainID
    	AND dbo.CheckActorPackageRights(@ActorID, P.PackageID) = 1
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetDomainAllDnsRecords]
    (
    	@DomainId INT
    )
    AS
    SELECT
    	ID,
    	DomainId,
    	DnsServer,
    	RecordType,
    	Value,
    	Date
      FROM [dbo].[DomainDnsRecords]
      WHERE [DomainId]  = @DomainId 
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetDomainByName]
    (
    	@ActorID int,
    	@DomainName nvarchar(100),
    	@SearchOnDomainPointer bit,
    	@IsDomainPointer bit
    )
    AS

    IF (@SearchOnDomainPointer = 1)
    BEGIN
    	SELECT
    		D.DomainID,
    		D.PackageID,
    		D.ZoneItemID,
    		D.DomainItemID,
    		D.DomainName,
    		D.HostingAllowed,
    		ISNULL(D.WebSiteID, 0) AS WebSiteID,
    		WS.ItemName AS WebSiteName,
    		ISNULL(D.MailDomainID, 0) AS MailDomainID,
    		MD.ItemName AS MailDomainName,
    		Z.ItemName AS ZoneName,
    		D.IsSubDomain,
    		D.IsPreviewDomain,
    		D.IsDomainPointer
    	FROM Domains AS D
    	INNER JOIN Packages AS P ON D.PackageID = P.PackageID
    	LEFT OUTER JOIN ServiceItems AS WS ON D.WebSiteID = WS.ItemID
    	LEFT OUTER JOIN ServiceItems AS MD ON D.MailDomainID = MD.ItemID
    	LEFT OUTER JOIN ServiceItems AS Z ON D.ZoneItemID = Z.ItemID
    	WHERE
    		D.DomainName = @DomainName
    		AND D.IsDomainPointer = @IsDomainPointer
    		AND dbo.CheckActorPackageRights(@ActorID, P.PackageID) = 1
    	RETURN
    END
    ELSE
    BEGIN
    	SELECT
    		D.DomainID,
    		D.PackageID,
    		D.ZoneItemID,
    		D.DomainItemID,
    		D.DomainName,
    		D.HostingAllowed,
    		ISNULL(D.WebSiteID, 0) AS WebSiteID,
    		WS.ItemName AS WebSiteName,
    		ISNULL(D.MailDomainID, 0) AS MailDomainID,
    		MD.ItemName AS MailDomainName,
    		Z.ItemName AS ZoneName,
    		D.IsSubDomain,
    		D.IsPreviewDomain,
    		D.IsDomainPointer
    	FROM Domains AS D
    	INNER JOIN Packages AS P ON D.PackageID = P.PackageID
    	LEFT OUTER JOIN ServiceItems AS WS ON D.WebSiteID = WS.ItemID
    	LEFT OUTER JOIN ServiceItems AS MD ON D.MailDomainID = MD.ItemID
    	LEFT OUTER JOIN ServiceItems AS Z ON D.ZoneItemID = Z.ItemID
    	WHERE
    		D.DomainName = @DomainName
    		AND dbo.CheckActorPackageRights(@ActorID, P.PackageID) = 1
    	RETURN
    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetDomainDnsRecords]
    (
    	@DomainId INT,
    	@RecordType INT
    )
    AS
    SELECT
    	ID,
    	DomainId,
    	DnsServer,
    	RecordType,
    	Value,
    	Date
      FROM [dbo].[DomainDnsRecords]
      WHERE [DomainId]  = @DomainId AND [RecordType] = @RecordType
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetDomains]
    (
    	@ActorID int,
    	@PackageID int,
    	@Recursive bit = 1
    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    SELECT
    	D.DomainID,
    	D.PackageID,
    	D.ZoneItemID,
    	D.DomainItemID,
    	D.DomainName,
    	D.HostingAllowed,
    	ISNULL(WS.ItemID, 0) AS WebSiteID,
    	WS.ItemName AS WebSiteName,
    	ISNULL(MD.ItemID, 0) AS MailDomainID,
    	MD.ItemName AS MailDomainName,
    	Z.ItemName AS ZoneName,
    	D.IsSubDomain,
    	D.IsPreviewDomain,
    	D.CreationDate,
    	D.ExpirationDate,
    	D.LastUpdateDate,
    	D.IsDomainPointer,
    	D.RegistrarName
    FROM Domains AS D
    INNER JOIN PackagesTree(@PackageID, @Recursive) AS PT ON D.PackageID = PT.PackageID
    LEFT OUTER JOIN ServiceItems AS WS ON D.WebSiteID = WS.ItemID
    LEFT OUTER JOIN ServiceItems AS MD ON D.MailDomainID = MD.ItemID
    LEFT OUTER JOIN ServiceItems AS Z ON D.ZoneItemID = Z.ItemID
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetDomainsByDomainItemID]
    (
    	@ActorID int,
    	@DomainID int
    )
    AS

    SELECT
    	D.DomainID,
    	D.PackageID,
    	D.ZoneItemID,
    	D.DomainItemID,
    	D.DomainName,
    	D.HostingAllowed,
    	ISNULL(D.WebSiteID, 0) AS WebSiteID,
    	WS.ItemName AS WebSiteName,
    	ISNULL(D.MailDomainID, 0) AS MailDomainID,
    	MD.ItemName AS MailDomainName,
    	Z.ItemName AS ZoneName,
    	D.IsSubDomain,
    	D.IsPreviewDomain,
    	D.IsDomainPointer
    FROM Domains AS D
    INNER JOIN Packages AS P ON D.PackageID = P.PackageID
    LEFT OUTER JOIN ServiceItems AS WS ON D.WebSiteID = WS.ItemID
    LEFT OUTER JOIN ServiceItems AS MD ON D.MailDomainID = MD.ItemID
    LEFT OUTER JOIN ServiceItems AS Z ON D.ZoneItemID = Z.ItemID
    WHERE
    	D.DomainItemID = @DomainID
    	AND dbo.CheckActorPackageRights(@ActorID, P.PackageID) = 1
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetDomainsByZoneID]
    (
    	@ActorID int,
    	@ZoneID int
    )
    AS

    SELECT
    	D.DomainID,
    	D.PackageID,
    	D.ZoneItemID,
    	D.DomainItemID,
    	D.DomainName,
    	D.HostingAllowed,
    	ISNULL(D.WebSiteID, 0) AS WebSiteID,
    	WS.ItemName AS WebSiteName,
    	ISNULL(D.MailDomainID, 0) AS MailDomainID,
    	MD.ItemName AS MailDomainName,
    	Z.ItemName AS ZoneName,
    	D.IsSubDomain,
    	D.IsPreviewDomain,
    	D.IsDomainPointer
    FROM Domains AS D
    INNER JOIN Packages AS P ON D.PackageID = P.PackageID
    LEFT OUTER JOIN ServiceItems AS WS ON D.WebSiteID = WS.ItemID
    LEFT OUTER JOIN ServiceItems AS MD ON D.MailDomainID = MD.ItemID
    LEFT OUTER JOIN ServiceItems AS Z ON D.ZoneItemID = Z.ItemID
    WHERE
    	D.ZoneItemID = @ZoneID
    	AND dbo.CheckActorPackageRights(@ActorID, P.PackageID) = 1
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetDomainsPaged]
    (
    	@ActorID int,
    	@PackageID int,
    	@ServerID int,
    	@Recursive bit,
    	@FilterColumn nvarchar(50) = '',
    	@FilterValue nvarchar(50) = '',
    	@SortColumn nvarchar(50),
    	@StartRow int,
    	@MaximumRows int
    )
    AS
    SET NOCOUNT ON

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    -- build query and run it to the temporary table
    DECLARE @sql nvarchar(2500)

    IF @SortColumn = '' OR @SortColumn IS NULL
    SET @SortColumn = 'DomainName'

    SET @sql = '
    DECLARE @Domains TABLE
    (
    	ItemPosition int IDENTITY(1,1),
    	DomainID int
    )
    INSERT INTO @Domains (DomainID)
    SELECT
    	D.DomainID
    FROM Domains AS D
    INNER JOIN Packages AS P ON D.PackageID = P.PackageID
    INNER JOIN UsersDetailed AS U ON P.UserID = U.UserID
    LEFT OUTER JOIN ServiceItems AS Z ON D.ZoneItemID = Z.ItemID
    LEFT OUTER JOIN Services AS S ON Z.ServiceID = S.ServiceID
    LEFT OUTER JOIN Servers AS SRV ON S.ServerID = SRV.ServerID
    WHERE (D.IsPreviewDomain = 0 AND D.IsDomainPointer = 0) AND
    		((@Recursive = 0 AND D.PackageID = @PackageID)
    		OR (@Recursive = 1 AND dbo.CheckPackageParent(@PackageID, D.PackageID) = 1))
    AND (@ServerID = 0 OR (@ServerID > 0 AND S.ServerID = @ServerID))
    '

    IF @FilterValue <> ''
    BEGIN
    	IF @FilterColumn <> ''
    	BEGIN
    		SET @sql = @sql + ' AND ' + @FilterColumn + ' LIKE @FilterValue '
    	END
    	ELSE
    		SET @sql = @sql + '
    		AND (DomainName LIKE @FilterValue 
    		OR Username LIKE @FilterValue
    		OR ServerName LIKE @FilterValue
    		OR PackageName LIKE @FilterValue) '
    END

    IF @SortColumn <> '' AND @SortColumn IS NOT NULL
    SET @sql = @sql + ' ORDER BY ' + @SortColumn + ' '

    SET @sql = @sql + ' SELECT COUNT(DomainID) FROM @Domains;SELECT
    	D.DomainID,
    	D.PackageID,
    	D.ZoneItemID,
    	D.DomainItemID,
    	D.DomainName,
    	D.HostingAllowed,
    	ISNULL(WS.ItemID, 0) AS WebSiteID,
    	WS.ItemName AS WebSiteName,
    	ISNULL(MD.ItemID, 0) AS MailDomainID,
    	MD.ItemName AS MailDomainName,
    	D.IsSubDomain,
    	D.IsPreviewDomain,
    	D.IsDomainPointer,
    	D.ExpirationDate,
    	D.LastUpdateDate,
    	D.RegistrarName,
    	P.PackageName,
    	ISNULL(SRV.ServerID, 0) AS ServerID,
    	ISNULL(SRV.ServerName, '''') AS ServerName,
    	ISNULL(SRV.Comments, '''') AS ServerComments,
    	ISNULL(SRV.VirtualServer, 0) AS VirtualServer,
    	P.UserID,
    	U.Username,
    	U.FirstName,
    	U.LastName,
    	U.FullName,
    	U.RoleID,
    	U.Email
    FROM @Domains AS SD
    INNER JOIN Domains AS D ON SD.DomainID = D.DomainID
    INNER JOIN Packages AS P ON D.PackageID = P.PackageID
    INNER JOIN UsersDetailed AS U ON P.UserID = U.UserID
    LEFT OUTER JOIN ServiceItems AS WS ON D.WebSiteID = WS.ItemID
    LEFT OUTER JOIN ServiceItems AS MD ON D.MailDomainID = MD.ItemID
    LEFT OUTER JOIN ServiceItems AS Z ON D.ZoneItemID = Z.ItemID
    LEFT OUTER JOIN Services AS S ON Z.ServiceID = S.ServiceID
    LEFT OUTER JOIN Servers AS SRV ON S.ServerID = SRV.ServerID
    WHERE SD.ItemPosition BETWEEN @StartRow + 1 AND @StartRow + @MaximumRows'

    exec sp_executesql @sql, N'@StartRow int, @MaximumRows int, @PackageID int, @FilterValue nvarchar(50), @ServerID int, @Recursive bit', 
    @StartRow, @MaximumRows, @PackageID, @FilterValue, @ServerID, @Recursive

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetEnterpriseFolder]
    (
    	@ItemID INT,
    	@FolderName NVARCHAR(255)
    )
    AS

    SELECT TOP 1
    	ST.EnterpriseFolderID,
    	ST.ItemID,
    	ST.FolderName,
    	ST.FolderQuota,
    	ST.LocationDrive,
    	ST.HomeFolder,
    	ST.Domain,
    	ST.StorageSpaceFolderId,
    	ssf.Name,
    	ssf.StorageSpaceId,
    	ssf.Path,
    	ssf.UncPath,
    	ssf.IsShared,
    	ssf.FsrmQuotaType,
    	ssf.FsrmQuotaSizeBytes
    FROM EnterpriseFolders AS ST
    LEFT OUTER JOIN StorageSpaceFolders as ssf on ssf.Id = ST.StorageSpaceFolderId
    WHERE ItemID = @ItemID AND FolderName = @FolderName
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetEnterpriseFolderId]
    (
    	@ItemID INT,
    	@FolderName varchar(max)
    )
    AS
    SELECT TOP 1
    	EnterpriseFolderID
    	FROM EnterpriseFolders
    	WHERE ItemId = @ItemID AND FolderName = @FolderName
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetEnterpriseFolderOwaUsers]
    (
    	@ItemID INT,
    	@FolderID INT
    )
    AS
    SELECT 
    	EA.AccountID,
    	EA.ItemID,
    	EA.AccountType,
    	EA.AccountName,
    	EA.DisplayName,
    	EA.PrimaryEmailAddress,
    	EA.MailEnabledPublicFolder,
    	EA.MailboxPlanId,
    	EA.SubscriberNumber,
    	EA.UserPrincipalName 
    	FROM EnterpriseFoldersOwaPermissions AS EFOP
    	LEFT JOIN  ExchangeAccounts AS EA ON EA.AccountID = EFOP.AccountID
    	WHERE EFOP.ItemID = @ItemID AND EFOP.FolderID = @FolderID
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetEnterpriseFolders]
    (
    	@ItemID INT
    )
    AS

    SELECT DISTINCT LocationDrive, HomeFolder, Domain FROM EnterpriseFolders
    WHERE ItemID = @ItemID
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetEnterpriseFoldersPaged]
    (
    	@FilterColumn nvarchar(50) = '',
    	@FilterValue nvarchar(50) = '',
    	@ItemID int,
    	@SortColumn nvarchar(50),
    	@StartRow int,
    	@MaximumRows int
    )
    AS
    -- build query and run it to the temporary table
    DECLARE @sql nvarchar(2000)

    SET @sql = '
    DECLARE @EndRow int
    SET @EndRow = @StartRow + @MaximumRows

    DECLARE @Folders TABLE
    (
    	ItemPosition int IDENTITY(1,1),
    	Id int
    )
    INSERT INTO @Folders (Id)
    SELECT
    	S.EnterpriseFolderID
    FROM EnterpriseFolders AS S
    WHERE @ItemID = S.ItemID'

    IF @FilterColumn <> '' AND @FilterValue <> ''
    SET @sql = @sql + ' AND ' + @FilterColumn + ' LIKE @FilterValue '

    IF @SortColumn <> '' AND @SortColumn IS NOT NULL
    SET @sql = @sql + ' ORDER BY ' + @SortColumn + ' '

    SET @sql = @sql + ' SELECT COUNT(Id) FROM @Folders;
    SELECT
    	ST.EnterpriseFolderID,
    	ST.ItemID,
    	ST.FolderName,
    	ST.FolderQuota,
    	ST.LocationDrive,
    	ST.HomeFolder,
    	ST.Domain,
    	ST.StorageSpaceFolderId,
    	ssf.Name,
    	ssf.StorageSpaceId,
    	ssf.Path,
    	ssf.UncPath,
    	ssf.IsShared,
    	ssf.FsrmQuotaType,
    	ssf.FsrmQuotaSizeBytes
    FROM @Folders AS S
    INNER JOIN EnterpriseFolders AS ST ON S.Id = ST.EnterpriseFolderID
    LEFT OUTER JOIN StorageSpaceFolders as ssf on ssf.Id = ST.StorageSpaceFolderId
    WHERE S.ItemPosition BETWEEN @StartRow AND @EndRow'

    exec sp_executesql @sql, N'@StartRow int, @MaximumRows int,  @FilterValue nvarchar(50),  @ItemID int',
    @StartRow, @MaximumRows,  @FilterValue,  @ItemID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    -- Password column removed
    CREATE PROCEDURE [dbo].[GetExchangeAccount] 
    (
    	@ItemID int,
    	@AccountID int
    )
    AS
    SELECT
    	E.AccountID,
    	E.ItemID,
    	E.AccountType,
    	E.AccountName,
    	E.DisplayName,
    	E.PrimaryEmailAddress,
    	E.MailEnabledPublicFolder,
    	E.MailboxManagerActions,
    	E.SamAccountName,
    	E.MailboxPlanId,
    	P.MailboxPlan,
    	E.SubscriberNumber,
    	E.UserPrincipalName,
    	E.ArchivingMailboxPlanId, 
    	AP.MailboxPlan as 'ArchivingMailboxPlan',
    	E.EnableArchiving,
    	E.LevelID,
    	E.IsVIP
    FROM
    	ExchangeAccounts AS E
    LEFT OUTER JOIN ExchangeMailboxPlans AS P ON E.MailboxPlanId = P.MailboxPlanId	
    LEFT OUTER JOIN ExchangeMailboxPlans AS AP ON E.ArchivingMailboxPlanId = AP.MailboxPlanId
    WHERE
    	E.ItemID = @ItemID AND
    	E.AccountID = @AccountID
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    -- Password column removed
    CREATE PROCEDURE [dbo].[GetExchangeAccountByAccountName] 
    (
    	@ItemID int,
    	@AccountName nvarchar(300)
    )
    AS
    SELECT
    	E.AccountID,
    	E.ItemID,
    	E.AccountType,
    	E.AccountName,
    	E.DisplayName,
    	E.PrimaryEmailAddress,
    	E.MailEnabledPublicFolder,
    	E.MailboxManagerActions,
    	E.SamAccountName,
    	E.MailboxPlanId,
    	P.MailboxPlan,
    	E.SubscriberNumber,
    	E.UserPrincipalName,
    	E.ArchivingMailboxPlanId, 
    	AP.MailboxPlan as 'ArchivingMailboxPlan',
    	E.EnableArchiving
    FROM
    	ExchangeAccounts AS E
    LEFT OUTER JOIN ExchangeMailboxPlans AS P ON E.MailboxPlanId = P.MailboxPlanId	
    LEFT OUTER JOIN ExchangeMailboxPlans AS AP ON E.ArchivingMailboxPlanId = AP.MailboxPlanId
    WHERE
    	E.ItemID = @ItemID AND
    	E.AccountName = @AccountName
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetExchangeAccountByAccountNameWithoutItemId] 
    (
    	@UserPrincipalName nvarchar(300)
    )
    AS
    SELECT
    	E.AccountID,
    	E.ItemID,
    	E.AccountType,
    	E.AccountName,
    	E.DisplayName,
    	E.PrimaryEmailAddress,
    	E.MailEnabledPublicFolder,
    	E.MailboxManagerActions,
    	E.SamAccountName,
    	E.MailboxPlanId,
    	P.MailboxPlan,
    	E.SubscriberNumber,
    	E.UserPrincipalName,
    	E.ArchivingMailboxPlanId, 
    	AP.MailboxPlan as 'ArchivingMailboxPlan',
    	E.EnableArchiving
    FROM
    	ExchangeAccounts AS E
    LEFT OUTER JOIN ExchangeMailboxPlans AS P ON E.MailboxPlanId = P.MailboxPlanId	
    LEFT OUTER JOIN ExchangeMailboxPlans AS AP ON E.ArchivingMailboxPlanId = AP.MailboxPlanId
    WHERE
    	E.UserPrincipalName = @UserPrincipalName
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetExchangeAccountByMailboxPlanId] 
    (
    	@ItemID int,
    	@MailboxPlanId int
    )
    AS

    IF (@MailboxPlanId < 0)
    BEGIN
    SELECT
    	E.AccountID,
    	E.ItemID,
    	E.AccountType,
    	E.AccountName,
    	E.DisplayName,
    	E.PrimaryEmailAddress,
    	E.MailEnabledPublicFolder,
    	E.MailboxManagerActions,
    	E.SamAccountName,
    	E.MailboxPlanId,
    	P.MailboxPlan,
    	E.SubscriberNumber,
    	E.UserPrincipalName,
    	E.ArchivingMailboxPlanId, 
    	AP.MailboxPlan as 'ArchivingMailboxPlan',
    	E.EnableArchiving
    FROM
    	ExchangeAccounts AS E
    LEFT OUTER JOIN ExchangeMailboxPlans AS P ON E.MailboxPlanId = P.MailboxPlanId	
    LEFT OUTER JOIN ExchangeMailboxPlans AS AP ON E.ArchivingMailboxPlanId = AP.MailboxPlanId
    WHERE
    	E.ItemID = @ItemID AND
    	E.MailboxPlanId IS NULL AND
    	E.AccountType IN (1,5,6,10,12) 
    RETURN

    END
    ELSE
    IF (@ItemId = 0)
    BEGIN
    SELECT
    	E.AccountID,
    	E.ItemID,
    	E.AccountType,
    	E.AccountName,
    	E.DisplayName,
    	E.PrimaryEmailAddress,
    	E.MailEnabledPublicFolder,
    	E.MailboxManagerActions,
    	E.SamAccountName,
    	E.MailboxPlanId,
    	P.MailboxPlan,
    	E.SubscriberNumber,
    	E.UserPrincipalName,
    	E.ArchivingMailboxPlanId, 
    	AP.MailboxPlan as 'ArchivingMailboxPlan',
    	E.EnableArchiving
    FROM
    	ExchangeAccounts AS E
    LEFT OUTER JOIN ExchangeMailboxPlans AS P ON E.MailboxPlanId = P.MailboxPlanId	
    LEFT OUTER JOIN ExchangeMailboxPlans AS AP ON E.ArchivingMailboxPlanId = AP.MailboxPlanId
    WHERE
    	E.MailboxPlanId = @MailboxPlanId AND
    	E.AccountType IN (1,5,6,10,12) 
    END
    ELSE
    BEGIN
    SELECT
    	E.AccountID,
    	E.ItemID,
    	E.AccountType,
    	E.AccountName,
    	E.DisplayName,
    	E.PrimaryEmailAddress,
    	E.MailEnabledPublicFolder,
    	E.MailboxManagerActions,
    	E.SamAccountName,
    	E.MailboxPlanId,
    	P.MailboxPlan,
    	E.SubscriberNumber,
    	E.UserPrincipalName,
    	E.ArchivingMailboxPlanId, 
    	AP.MailboxPlan as 'ArchivingMailboxPlan',
    	E.EnableArchiving
    FROM
    	ExchangeAccounts AS E
    LEFT OUTER JOIN ExchangeMailboxPlans AS P ON E.MailboxPlanId = P.MailboxPlanId	
    LEFT OUTER JOIN ExchangeMailboxPlans AS AP ON E.ArchivingMailboxPlanId = AP.MailboxPlanId
    WHERE
    	E.ItemID = @ItemID AND
    	E.MailboxPlanId = @MailboxPlanId AND
    	E.AccountType IN (1,5,6,10,12) 
    RETURN
    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetExchangeAccountDisclaimerId] 
    (
    	@AccountID int
    )
    AS
    SELECT
    	ExchangeDisclaimerId
    FROM
    	ExchangeAccounts
    WHERE
    	AccountID= @AccountID
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetExchangeAccountEmailAddresses]
    (
    	@AccountID int
    )
    AS
    SELECT
    	AddressID,
    	AccountID,
    	EmailAddress
    FROM
    	ExchangeAccountEmailAddresses
    WHERE
    	AccountID = @AccountID
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetExchangeAccounts]
    (
    	@ItemID int,
    	@AccountType int
    )
    AS
    SELECT
    	E.AccountID,
    	E.ItemID,
    	E.AccountType,
    	E.AccountName,
    	E.DisplayName,
    	E.PrimaryEmailAddress,
    	E.MailEnabledPublicFolder,
    	E.MailboxPlanId,
    	P.MailboxPlan,
    	E.SubscriberNumber,
    	E.UserPrincipalName
    FROM
    	ExchangeAccounts  AS E
    LEFT OUTER JOIN ExchangeMailboxPlans AS P ON E.MailboxPlanId = P.MailboxPlanId
    WHERE
    	E.ItemID = @ItemID AND
    	(E.AccountType = @AccountType OR @AccountType = 0)
    ORDER BY DisplayName
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetExchangeAccountsPaged]
    (
    	@ActorID int,
    	@ItemID int,
    	@AccountTypes nvarchar(30),
    	@FilterColumn nvarchar(50) = '',
    	@FilterValue nvarchar(50) = '',
    	@SortColumn nvarchar(50),
    	@StartRow int,
    	@MaximumRows int,
    	@Archiving bit
    )
    AS

    DECLARE @PackageID int
    SELECT @PackageID = PackageID FROM ServiceItems
    WHERE ItemID = @ItemID

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    -- start
    DECLARE @condition nvarchar(700)
    SET @condition = '
    EA.AccountType IN (' + @AccountTypes + ')
    AND EA.ItemID = @ItemID
    '

    IF @FilterColumn <> '' AND @FilterColumn IS NOT NULL
    AND @FilterValue <> '' AND @FilterValue IS NOT NULL
    BEGIN
    	IF @FilterColumn = 'PrimaryEmailAddress' AND @AccountTypes <> '2'
    	BEGIN		
    		SET @condition = @condition + ' AND EA.AccountID IN (SELECT EAEA.AccountID FROM ExchangeAccountEmailAddresses EAEA WHERE EAEA.EmailAddress LIKE ''%' + @FilterValue + '%'')'
    	END
    	ELSE
    	BEGIN		
    		SET @condition = @condition + ' AND ' + @FilterColumn + ' LIKE ''%' + @FilterValue + '%'''
    	END
    END

    if @Archiving = 1
    BEGIN
    	SET @condition = @condition + ' AND (EA.ArchivingMailboxPlanId > 0) ' 
    END

    IF @SortColumn IS NULL OR @SortColumn = ''
    SET @SortColumn = 'EA.DisplayName ASC'

    DECLARE @joincondition nvarchar(700)
    	SET @joincondition = ',P.MailboxPlan FROM ExchangeAccounts AS EA
    	LEFT OUTER JOIN ExchangeMailboxPlans AS P ON EA.MailboxPlanId = P.MailboxPlanId'

    DECLARE @sql nvarchar(3500)

    set @sql = '
    SELECT COUNT(EA.AccountID) FROM ExchangeAccounts AS EA
    WHERE ' + @condition + ';

    WITH Accounts AS (
    	SELECT ROW_NUMBER() OVER (ORDER BY ' + @SortColumn + ') as Row,
    		EA.AccountID,
    		EA.ItemID,
    		EA.AccountType,
    		EA.AccountName,
    		EA.DisplayName,
    		EA.PrimaryEmailAddress,
    		EA.MailEnabledPublicFolder,
    		EA.MailboxPlanId,
    		EA.SubscriberNumber,
    		EA.UserPrincipalName,
    		EA.LevelID,
    		EA.IsVIP ' + @joincondition +
    	' WHERE ' + @condition + '
    )

    SELECT * FROM Accounts
    WHERE Row BETWEEN @StartRow + 1 and @StartRow + @MaximumRows
    '

    print @sql

    exec sp_executesql @sql, N'@ItemID int, @StartRow int, @MaximumRows int',
    @ItemID, @StartRow, @MaximumRows

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetExchangeDisclaimer] 
    (
    	@ExchangeDisclaimerId int
    )
    AS
    SELECT
    	ExchangeDisclaimerId,
    	ItemID,
    	DisclaimerName,
    	DisclaimerText
    FROM
    	ExchangeDisclaimers
    WHERE
    	ExchangeDisclaimerId = @ExchangeDisclaimerId
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetExchangeDisclaimers]
    (
    	@ItemID int
    )
    AS
    SELECT
    	ExchangeDisclaimerId,
    	ItemID,
    	DisclaimerName,
    	DisclaimerText
    FROM
    	ExchangeDisclaimers
    WHERE
    	ItemID = @ItemID 
    ORDER BY DisclaimerName
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetExchangeMailboxes]
    	@ItemID int
    AS
    BEGIN
    SELECT
    	AccountID,
    	ItemID,
    	AccountType,
    	AccountName,
    	DisplayName,
    	PrimaryEmailAddress,
    	MailEnabledPublicFolder,
    	SubscriberNumber,
    	UserPrincipalName
    FROM
    	ExchangeAccounts
    WHERE
    	ItemID = @ItemID AND
    	(AccountType =1  OR AccountType=5 OR AccountType=6)
    ORDER BY 1

    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetExchangeMailboxPlan] 
    (
    	@MailboxPlanId int
    )
    AS
    SELECT
    	MailboxPlanId,
    	ItemID,
    	MailboxPlan,
    	EnableActiveSync,
    	EnableIMAP,
    	EnableMAPI,
    	EnableOWA,
    	EnablePOP,
    	EnableAutoReply,
    	IsDefault,
    	IssueWarningPct,
    	KeepDeletedItemsDays,
    	MailboxSizeMB,
    	MaxReceiveMessageSizeKB,
    	MaxRecipients,
    	MaxSendMessageSizeKB,
    	ProhibitSendPct,
    	ProhibitSendReceivePct,
    	HideFromAddressBook,
    	MailboxPlanType,
    	AllowLitigationHold,
    	RecoverableItemsWarningPct,
    	RecoverableItemsSpace,
    	LitigationHoldUrl,
    	LitigationHoldMsg,
    	Archiving,
    	EnableArchiving,
    	ArchiveSizeMB,
    	ArchiveWarningPct,
    	EnableForceArchiveDeletion,
    	IsForJournaling
    FROM
    	ExchangeMailboxPlans
    WHERE
    	MailboxPlanId = @MailboxPlanId
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetExchangeMailboxPlanRetentionPolicyTags]
    (
    	@MailboxPlanId int
    )
    AS
    SELECT
    D.PlanTagID,
    D.TagID,
    D.MailboxPlanId,
    P.MailboxPlan,
    T.TagName
    FROM
    	ExchangeMailboxPlanRetentionPolicyTags AS D
    LEFT OUTER JOIN ExchangeMailboxPlans AS P ON P.MailboxPlanId = D.MailboxPlanId	
    LEFT OUTER JOIN ExchangeRetentionPolicyTags AS T ON T.TagID = D.TagID	
    WHERE
    	D.MailboxPlanId = @MailboxPlanId 
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetExchangeMailboxPlans]
    (
    	@ItemID int,
    	@Archiving bit
    )
    AS
    SELECT
    	MailboxPlanId,
    	ItemID,
    	MailboxPlan,
    	EnableActiveSync,
    	EnableIMAP,
    	EnableMAPI,
    	EnableOWA,
    	EnablePOP,
    	EnableAutoReply,
    	IsDefault,
    	IssueWarningPct,
    	KeepDeletedItemsDays,
    	MailboxSizeMB,
    	MaxReceiveMessageSizeKB,
    	MaxRecipients,
    	MaxSendMessageSizeKB,
    	ProhibitSendPct,
    	ProhibitSendReceivePct,
    	HideFromAddressBook,
    	MailboxPlanType,
    	Archiving,
    	EnableArchiving,
    	ArchiveSizeMB,
    	ArchiveWarningPct,
    	EnableForceArchiveDeletion,
    	IsForJournaling
    FROM
    	ExchangeMailboxPlans
    WHERE
    	ItemID = @ItemID 
    AND ((Archiving=@Archiving) OR ((@Archiving=0) AND (Archiving IS NULL)))
    ORDER BY MailboxPlan
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetExchangeOrganization]
    (
    	@ItemID int
    )
    AS
    SELECT
    	ItemID,
    	ExchangeMailboxPlanID,
    	LyncUserPlanID,
    	SfBUserPlanID
    FROM
    	ExchangeOrganizations
    WHERE
    	ItemID = @ItemID
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetExchangeOrganizationDomains]
    (
    	@ItemID int
    )
    AS
    SELECT
    	ED.DomainID,
    	D.DomainName,
    	ED.IsHost,
    	ED.DomainTypeID
    FROM
    	ExchangeOrganizationDomains AS ED
    INNER JOIN Domains AS D ON ED.DomainID = D.DomainID
    WHERE ED.ItemID = @ItemID
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetExchangeOrganizationSettings]
    (
    	@ItemId INT ,
    	@SettingsName nvarchar(100)
    )
    AS
    SELECT 
    	ItemId,
    	SettingsName,
    	Xml

    FROM ExchangeOrganizationSettings 
    Where ItemId = @ItemId AND SettingsName = @SettingsName
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    -- Exchange2013 Shared and resource mailboxes Organization statistics

    CREATE PROCEDURE [dbo].[GetExchangeOrganizationStatistics] 
    (
    	@ItemID int
    )
    AS

    DECLARE @ARCHIVESIZE INT
    IF -1 in (SELECT B.ArchiveSizeMB FROM ExchangeAccounts AS A INNER JOIN ExchangeMailboxPlans AS B ON A.MailboxPlanId = B.MailboxPlanId WHERE A.ItemID=@ItemID)
    BEGIN
    	SET @ARCHIVESIZE = -1
    END
    ELSE
    BEGIN
    	SET @ARCHIVESIZE = (SELECT SUM(B.ArchiveSizeMB) FROM ExchangeAccounts AS A INNER JOIN ExchangeMailboxPlans AS B ON A.MailboxPlanId = B.MailboxPlanId WHERE A.ItemID=@ItemID AND A.AccountType in (1, 5, 6, 10, 12) AND B.EnableArchiving = 1)
    END

    IF -1 IN (SELECT B.MailboxSizeMB FROM ExchangeAccounts AS A INNER JOIN ExchangeMailboxPlans AS B ON A.MailboxPlanId = B.MailboxPlanId WHERE A.ItemID=@ItemID)
    BEGIN
    SELECT
    	(SELECT COUNT(*) FROM ExchangeAccounts WHERE (AccountType = 1) AND ItemID = @ItemID) AS CreatedMailboxes,
    	(SELECT COUNT(*) FROM ExchangeAccounts WHERE (AccountType = 10) AND ItemID = @ItemID) AS CreatedSharedMailboxes,
    	(SELECT COUNT(*) FROM ExchangeAccounts WHERE (AccountType = 5 OR AccountType = 6) AND ItemID = @ItemID) AS CreatedResourceMailboxes,
    	(SELECT COUNT(*) FROM ExchangeAccounts WHERE AccountType = 2 AND ItemID = @ItemID) AS CreatedContacts,
    	(SELECT COUNT(*) FROM ExchangeAccounts WHERE AccountType = 3 AND ItemID = @ItemID) AS CreatedDistributionLists,
    	(SELECT COUNT(*) FROM ExchangeAccounts WHERE AccountType = 4 AND ItemID = @ItemID) AS CreatedPublicFolders,
    	(SELECT COUNT(*) FROM ExchangeAccounts WHERE AccountType = 12 AND ItemID = @ItemID) AS CreatedJournalingMailboxes,
    	(SELECT COUNT(*) FROM ExchangeOrganizationDomains WHERE ItemID = @ItemID) AS CreatedDomains,
    	(SELECT MIN(B.MailboxSizeMB) FROM ExchangeAccounts AS A INNER JOIN ExchangeMailboxPlans AS B ON A.MailboxPlanId = B.MailboxPlanId WHERE A.ItemID=@ItemID AND A.AccountType in (1, 5, 6, 10, 12)) AS UsedDiskSpace,
    	(SELECT MIN(B.RecoverableItemsSpace) FROM ExchangeAccounts AS A INNER JOIN ExchangeMailboxPlans AS B ON A.MailboxPlanId = B.MailboxPlanId WHERE A.ItemID=@ItemID AND A.AccountType in (1, 5, 6, 10, 12) AND B.AllowLitigationHold = 1) AS UsedLitigationHoldSpace,
    	@ARCHIVESIZE AS UsedArchingStorage
    END
    ELSE
    BEGIN
    SELECT
    	(SELECT COUNT(*) FROM ExchangeAccounts WHERE (AccountType = 1) AND ItemID = @ItemID) AS CreatedMailboxes,
    	(SELECT COUNT(*) FROM ExchangeAccounts WHERE (AccountType = 10) AND ItemID = @ItemID) AS CreatedSharedMailboxes,
    	(SELECT COUNT(*) FROM ExchangeAccounts WHERE (AccountType = 5 OR AccountType = 6) AND ItemID = @ItemID) AS CreatedResourceMailboxes,
    	(SELECT COUNT(*) FROM ExchangeAccounts WHERE AccountType = 2 AND ItemID = @ItemID) AS CreatedContacts,
    	(SELECT COUNT(*) FROM ExchangeAccounts WHERE AccountType = 3 AND ItemID = @ItemID) AS CreatedDistributionLists,
    	(SELECT COUNT(*) FROM ExchangeAccounts WHERE AccountType = 4 AND ItemID = @ItemID) AS CreatedPublicFolders,
    	(SELECT COUNT(*) FROM ExchangeAccounts WHERE AccountType = 12 AND ItemID = @ItemID) AS CreatedJournalingMailboxes,
    	(SELECT COUNT(*) FROM ExchangeOrganizationDomains WHERE ItemID = @ItemID) AS CreatedDomains,
    	(SELECT SUM(B.MailboxSizeMB) FROM ExchangeAccounts AS A INNER JOIN ExchangeMailboxPlans AS B ON A.MailboxPlanId = B.MailboxPlanId WHERE A.ItemID=@ItemID AND A.AccountType in (1, 5, 6, 10, 12)) AS UsedDiskSpace,
    	(SELECT SUM(B.RecoverableItemsSpace) FROM ExchangeAccounts AS A INNER JOIN ExchangeMailboxPlans AS B ON A.MailboxPlanId = B.MailboxPlanId WHERE A.ItemID=@ItemID AND A.AccountType in (1, 5, 6, 10, 12) AND B.AllowLitigationHold = 1) AS UsedLitigationHoldSpace,
    	@ARCHIVESIZE AS UsedArchingStorage
    END

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetExchangeRetentionPolicyTag] 
    (
    	@TagID int
    )
    AS
    SELECT
    	TagID,
    	ItemID,
    	TagName,
    	TagType,
    	AgeLimitForRetention,
    	RetentionAction
    FROM
    	ExchangeRetentionPolicyTags
    WHERE
    	TagID = @TagID
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetExchangeRetentionPolicyTags]
    (
    	@ItemID int
    )
    AS
    SELECT
    	TagID,
    	ItemID,
    	TagName,
    	TagType,
    	AgeLimitForRetention,
    	RetentionAction
    FROM
    	ExchangeRetentionPolicyTags
    WHERE
    	ItemID = @ItemID 
    ORDER BY TagName
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetFilterURL]
    (
     @ActorID int,
     @PackageID int,
     @GroupName nvarchar(100),
     @FilterUrl nvarchar(200) OUTPUT
    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    -- load group info
    DECLARE @GroupID int
    SELECT @GroupID = GroupID FROM ResourceGroups
    WHERE GroupName = @GroupName

    --print @GroupID 

    Declare @ServiceID int
    SELECT @ServiceID = PS.ServiceID FROM PackageServices AS PS
    INNER JOIN Services AS S ON PS.ServiceID = S.ServiceID
    INNER JOIN Providers AS P ON S.ProviderID = P.ProviderID
    WHERE PS.PackageID = @PackageID AND P.GroupID = @GroupID

    SELECT
     @FilterUrl = PropertyValue
     FROM ServiceProperties AS SP
     WHERE @ServiceID = SP.ServiceID AND PropertyName = 'apiurl'
    -- print  @FilterUrl
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetFilterURLByHostingPlan]
    (
     @ActorID int,
     @PlanID int,
     @GroupName nvarchar(100),
     @FilterUrl nvarchar(200) OUTPUT
    )
    AS 

    -- load ServerID info
    DECLARE @ServerID int
    select @ServerID = HostingPlans.ServerID from HostingPlans where PlanID = @PlanID
    --print @ServerID 

    --Check Server Type
    DECLARE @IsVirtualServer int
    select @IsVirtualServer = VirtualServer from Servers where ServerID = @ServerID

    -- load group info
    DECLARE @GroupID int
    SELECT @GroupID = GroupID FROM ResourceGroups
    WHERE GroupName = @GroupName
    --print @GroupID 

    -- load ProviderID info
    DECLARE @ProviderID int
    select @ProviderID = providerid from Providers 
    where GroupID = @GroupID  and ProviderName = 'MailCleaner'

    Declare @ServiceID int
    if  (@IsVirtualServer = 1)
    	select @ServiceID = Services.ServiceID from Services   
    	Join VirtualServices vs on vs.ServerID = @ServerID and vs.ServiceID = Services.ServiceID
    	where ProviderID = @ProviderID
    ELSE
     BEGIN
    	select  @ServiceID = Services.ServiceID from Services  
    	Where Services.ProviderID = @ProviderID and Services.ServerID = @ServerID
    END; 

    SELECT
     @FilterUrl = PropertyValue
     FROM ServiceProperties AS SP
     WHERE @ServiceID = SP.ServiceID AND PropertyName = 'apiurl'
     --print @FilterUrl
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetGroupProviders]
    (
    	@GroupID int
    )
    AS
    SELECT
    	PROV.ProviderID,
    	PROV.GroupID,
    	PROV.ProviderName,
    	PROV.DisplayName,
    	PROV.ProviderType,
    	RG.GroupName + ' - ' + PROV.DisplayName AS ProviderName
    FROM Providers AS PROV
    INNER JOIN ResourceGroups AS RG ON PROV.GroupID = RG.GroupID
    WHERE RG.GroupID = @GroupId
    ORDER BY RG.GroupOrder, PROV.DisplayName
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetHostingAddons]
    (
    	@ActorID int,
    	@UserID int
    )
    AS

    -- check rights
    IF dbo.CheckActorUserRights(@ActorID, @UserID) = 0
    RAISERROR('You are not allowed to access this account', 16, 1)

    SELECT
    	PlanID,
    	UserID,
    	PackageID,
    	PlanName,
    	PlanDescription,
    	Available,
    	SetupPrice,
    	RecurringPrice,
    	RecurrenceLength,
    	RecurrenceUnit,
    	IsAddon,
    	(SELECT COUNT(P.PackageID) FROM PackageAddons AS P WHERE P.PlanID = HP.PlanID) AS PackagesNumber
    FROM
    	HostingPlans AS HP
    WHERE
    	UserID = @UserID
    	AND IsAddon = 1
    ORDER BY PlanName
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetHostingPlan]
    (
    	@ActorID int,
    	@PlanID int
    )
    AS

    SELECT
    	PlanID,
    	UserID,
    	PackageID,
    	ServerID,
    	PlanName,
    	PlanDescription,
    	Available,
    	SetupPrice,
    	RecurringPrice,
    	RecurrenceLength,
    	RecurrenceUnit,
    	IsAddon
    FROM HostingPlans AS HP
    WHERE HP.PlanID = @PlanID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetHostingPlanQuotas]
    (
    	@ActorID int,
    	@PlanID int,
    	@PackageID int,
    	@ServerID int
    )
    AS

    -- check rights
    IF dbo.CheckActorParentPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    DECLARE @IsAddon bit

    IF @ServerID = 0
    SELECT @ServerID = ServerID FROM Packages
    WHERE PackageID = @PackageID

    -- get resource groups
    SELECT
    	RG.GroupID,
    	RG.GroupName,
    	CASE
    		WHEN HPR.CalculateDiskSpace IS NULL THEN CAST(0 as bit)
    		ELSE CAST(1 as bit)
    	END AS Enabled,
    	--dbo.GetPackageAllocatedResource(@PackageID, RG.GroupID, @ServerID) AS ParentEnabled,
    	CASE
    		WHEN RG.GroupName = 'Service Levels' THEN dbo.GetPackageServiceLevelResource(@PackageID, RG.GroupID, @ServerID)
    		ELSE dbo.GetPackageAllocatedResource(@PackageID, RG.GroupID, @ServerID)
    	END AS ParentEnabled,
    	ISNULL(HPR.CalculateDiskSpace, 1) AS CalculateDiskSpace,
    	ISNULL(HPR.CalculateBandwidth, 1) AS CalculateBandwidth
    FROM ResourceGroups AS RG 
    LEFT OUTER JOIN HostingPlanResources AS HPR ON RG.GroupID = HPR.GroupID AND HPR.PlanID = @PlanID
    WHERE (RG.ShowGroup = 1)
    ORDER BY RG.GroupOrder

    -- get quotas by groups
    SELECT
    	Q.QuotaID,
    	Q.GroupID,
    	Q.QuotaName,
    	Q.QuotaDescription,
    	Q.QuotaTypeID,
    	ISNULL(HPQ.QuotaValue, 0) AS QuotaValue,
    	dbo.GetPackageAllocatedQuota(@PackageID, Q.QuotaID) AS ParentQuotaValue
    FROM Quotas AS Q
    LEFT OUTER JOIN HostingPlanQuotas AS HPQ ON Q.QuotaID = HPQ.QuotaID AND HPQ.PlanID = @PlanID
    WHERE Q.HideQuota IS NULL OR Q.HideQuota = 0
    ORDER BY Q.QuotaOrder
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetHostingPlans]
    (
    	@ActorID int,
    	@UserID int
    )
    AS

    -- check rights
    IF dbo.CheckActorUserRights(@ActorID, @UserID) = 0
    RAISERROR('You are not allowed to access this account', 16, 1)

    SELECT
    	HP.PlanID,
    	HP.UserID,
    	HP.PackageID,
    	HP.PlanName,
    	HP.PlanDescription,
    	HP.Available,
    	HP.SetupPrice,
    	HP.RecurringPrice,
    	HP.RecurrenceLength,
    	HP.RecurrenceUnit,
    	HP.IsAddon,

    	(SELECT COUNT(P.PackageID) FROM Packages AS P WHERE P.PlanID = HP.PlanID) AS PackagesNumber,

    	-- server
    	ISNULL(HP.ServerID, 0) AS ServerID,
    	ISNULL(S.ServerName, 'None') AS ServerName,
    	ISNULL(S.Comments, '') AS ServerComments,
    	ISNULL(S.VirtualServer, 1) AS VirtualServer,

    	-- package
    	ISNULL(HP.PackageID, 0) AS PackageID,
    	ISNULL(P.PackageName, 'None') AS PackageName

    FROM HostingPlans AS HP
    LEFT OUTER JOIN Servers AS S ON HP.ServerID = S.ServerID
    LEFT OUTER JOIN Packages AS P ON HP.PackageID = P.PackageID
    WHERE
    	HP.UserID = @UserID
    	AND HP.IsAddon = 0
    ORDER BY HP.PlanName
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetInstanceID]
    	 @AccountID int
    AS
    BEGIN
    	SET NOCOUNT ON;

    	SELECT InstanceID FROM OCSUsers WHERE AccountID = @AccountID
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetIPAddress]
    (
     @AddressID int
    )
    AS
    BEGIN
     -- select
     SELECT
      AddressID,
      ServerID,
      ExternalIP,
      InternalIP,
      PoolID,
      SubnetMask,
      DefaultGateway,
      Comments,
      VLAN
     FROM IPAddresses
     WHERE
      AddressID = @AddressID
     RETURN
    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetIPAddresses]
    (
     @ActorID int,
     @PoolID int,
     @ServerID int
    )
    AS
    BEGIN

    -- check rights
    DECLARE @IsAdmin bit
    SET @IsAdmin = dbo.CheckIsUserAdmin(@ActorID)

    SELECT
     IP.AddressID,
     IP.PoolID,
     IP.ExternalIP,
     IP.InternalIP,
     IP.SubnetMask,
     IP.DefaultGateway,
     IP.Comments,
     IP.VLAN,
     IP.ServerID,
     S.ServerName,
     PA.ItemID,
     SI.ItemName,
     PA.PackageID,
     P.PackageName,
     P.UserID,
     U.UserName
    FROM dbo.IPAddresses AS IP
    LEFT JOIN Servers AS S ON IP.ServerID = S.ServerID
    LEFT JOIN PackageIPAddresses AS PA ON IP.AddressID = PA.AddressID
    LEFT JOIN ServiceItems SI ON PA.ItemId = SI.ItemID
    LEFT JOIN dbo.Packages P ON PA.PackageID = P.PackageID
    LEFT JOIN dbo.Users U ON U.UserID = P.UserID
    WHERE @IsAdmin = 1
    AND (@PoolID = 0 OR @PoolID <> 0 AND IP.PoolID = @PoolID)
    AND (@ServerID = 0 OR @ServerID <> 0 AND IP.ServerID = @ServerID)
    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetIPAddressesPaged]
    (
     @ActorID int,
     @PoolID int,
     @ServerID int,
     @FilterColumn nvarchar(50) = '',
     @FilterValue nvarchar(50) = '',
     @SortColumn nvarchar(50),
     @StartRow int,
     @MaximumRows int
    )
    AS
    BEGIN

    -- check rights
    DECLARE @IsAdmin bit
    SET @IsAdmin = dbo.CheckIsUserAdmin(@ActorID)

    -- start
    DECLARE @condition nvarchar(700)
    SET @condition = '
    @IsAdmin = 1
    AND (@PoolID = 0 OR @PoolID <> 0 AND IP.PoolID = @PoolID)
    AND (@ServerID = 0 OR @ServerID <> 0 AND IP.ServerID = @ServerID)
    '

    IF @FilterValue <> '' AND @FilterValue IS NOT NULL
    BEGIN
     IF @FilterColumn <> '' AND @FilterColumn IS NOT NULL
      SET @condition = @condition + ' AND ' + @FilterColumn + ' LIKE ''' + @FilterValue + ''''
     ELSE
      SET @condition = @condition + '
       AND (ExternalIP LIKE ''' + @FilterValue + '''
       OR InternalIP LIKE ''' + @FilterValue + '''
       OR DefaultGateway LIKE ''' + @FilterValue + '''
       OR ServerName LIKE ''' + @FilterValue + '''
       OR ItemName LIKE ''' + @FilterValue + '''
       OR Username LIKE ''' + @FilterValue + ''')'
    END

    IF @SortColumn IS NULL OR @SortColumn = ''
    SET @SortColumn = 'IP.ExternalIP ASC'

    DECLARE @sql nvarchar(3500)

    set @sql = '
    SELECT COUNT(IP.AddressID)
    FROM dbo.IPAddresses AS IP
    LEFT JOIN Servers AS S ON IP.ServerID = S.ServerID
    LEFT JOIN PackageIPAddresses AS PA ON IP.AddressID = PA.AddressID
    LEFT JOIN ServiceItems SI ON PA.ItemId = SI.ItemID
    LEFT JOIN dbo.Packages P ON PA.PackageID = P.PackageID
    LEFT JOIN dbo.Users U ON P.UserID = U.UserID
    WHERE ' + @condition + '

    DECLARE @Addresses AS TABLE
    (
     AddressID int
    );

    WITH TempItems AS (
     SELECT ROW_NUMBER() OVER (ORDER BY ' + @SortColumn + ') as Row,
      IP.AddressID
     FROM dbo.IPAddresses AS IP
     LEFT JOIN Servers AS S ON IP.ServerID = S.ServerID
     LEFT JOIN PackageIPAddresses AS PA ON IP.AddressID = PA.AddressID
     LEFT JOIN ServiceItems SI ON PA.ItemId = SI.ItemID
     LEFT JOIN dbo.Packages P ON PA.PackageID = P.PackageID
     LEFT JOIN dbo.Users U ON U.UserID = P.UserID
     WHERE ' + @condition + '
    )

    INSERT INTO @Addresses
    SELECT AddressID FROM TempItems
    WHERE TempItems.Row BETWEEN @StartRow + 1 and @StartRow + @MaximumRows

    SELECT
     IP.AddressID,
     IP.PoolID,
     IP.ExternalIP,
     IP.InternalIP,
     IP.SubnetMask,
     IP.DefaultGateway,
     IP.Comments,
     IP.VLAN,
     IP.ServerID,
     S.ServerName,
     PA.ItemID,
     SI.ItemName,
     PA.PackageID,
     P.PackageName,
     P.UserID,
     U.UserName
    FROM @Addresses AS TA
    INNER JOIN dbo.IPAddresses AS IP ON TA.AddressID = IP.AddressID
    LEFT JOIN Servers AS S ON IP.ServerID = S.ServerID
    LEFT JOIN PackageIPAddresses AS PA ON IP.AddressID = PA.AddressID
    LEFT JOIN ServiceItems SI ON PA.ItemId = SI.ItemID
    LEFT JOIN dbo.Packages P ON PA.PackageID = P.PackageID
    LEFT JOIN dbo.Users U ON U.UserID = P.UserID
    '

    exec sp_executesql @sql, N'@IsAdmin bit, @PoolID int, @ServerID int, @StartRow int, @MaximumRows int',
    @IsAdmin, @PoolID, @ServerID, @StartRow, @MaximumRows

    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetItemIdByOrganizationId]
    	@OrganizationId nvarchar(128)
    AS
    BEGIN
    	SET NOCOUNT ON;

    	SELECT
    		ItemID
    	FROM
    		dbo.ExchangeOrganizations
    	WHERE
    		OrganizationId = @OrganizationId
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetItemIPAddresses]
    (
    	@ActorID int,
    	@ItemID int,
    	@PoolID int
    )
    AS

    SELECT
    	PIP.PackageAddressID AS AddressID,
    	IP.ExternalIP AS IPAddress,
    	IP.InternalIP AS NATAddress,
    	IP.SubnetMask,
    	IP.DefaultGateway,
    	PIP.IsPrimary
    FROM PackageIPAddresses AS PIP
    INNER JOIN IPAddresses AS IP ON PIP.AddressID = IP.AddressID
    INNER JOIN ServiceItems AS SI ON PIP.ItemID = SI.ItemID
    WHERE PIP.ItemID = @ItemID
    AND dbo.CheckActorPackageRights(@ActorID, SI.PackageID) = 1
    AND (@PoolID = 0 OR @PoolID <> 0 AND IP.PoolID = @PoolID)
    ORDER BY PIP.IsPrimary DESC

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetItemPrivateIPAddresses]
    (
    	@ActorID int,
    	@ItemID int
    )
    AS

    SELECT
    	PIP.PrivateAddressID AS AddressID,
    	PIP.IPAddress,
    	PIP.IsPrimary
    FROM PrivateIPAddresses AS PIP
    INNER JOIN ServiceItems AS SI ON PIP.ItemID = SI.ItemID
    WHERE PIP.ItemID = @ItemID
    AND dbo.CheckActorPackageRights(@ActorID, SI.PackageID) = 1
    ORDER BY PIP.IsPrimary DESC

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetLevelResourceGroups]
    (
    	@LevelId INT
    )
    AS
    	SELECT 
    	G.[GroupID],
    	G.[GroupName],
    	G.[GroupOrder],
    	G.[GroupController],
    	G.[ShowGroup]
    	FROM [dbo].[StorageSpaceLevelResourceGroups] AS SG
    	INNER JOIN [dbo].[ResourceGroups] AS G
    	ON SG.GroupId = G.GroupId
    	WHERE SG.LevelId = @LevelId
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    --

    CREATE PROCEDURE [dbo].[GetLyncUserPlan] 
    (
    	@LyncUserPlanId int
    )
    AS
    SELECT
    	LyncUserPlanId,
    	ItemID,
    	LyncUserPlanName,
    	LyncUserPlanType,
    	IM,
    	Mobility,
    	MobilityEnableOutsideVoice,
    	Federation,
    	Conferencing,
    	EnterpriseVoice,
    	VoicePolicy,
    	IsDefault,

    	RemoteUserAccess,
    	PublicIMConnectivity,

    	AllowOrganizeMeetingsWithExternalAnonymous,

    	Telephony,

    	ServerURI,

    	ArchivePolicy,
    	TelephonyDialPlanPolicy,
    	TelephonyVoicePolicy

    FROM
    	LyncUserPlans
    WHERE
    	LyncUserPlanId = @LyncUserPlanId
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetLyncUserPlanByAccountId]
    (
    	@AccountID int
    )
    AS
    SELECT
    	LyncUserPlanId,
    	ItemID,
    	LyncUserPlanName,
    	LyncUserPlanType,
    	IM,
    	Mobility,
    	MobilityEnableOutsideVoice,
    	Federation,
    	Conferencing,
    	EnterpriseVoice,
    	VoicePolicy,
    	IsDefault
    FROM
    	LyncUserPlans
    WHERE
    	LyncUserPlanId IN (SELECT LyncUserPlanId FROM LyncUsers WHERE AccountID = @AccountID)
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetLyncUserPlans]
    (
    	@ItemID int
    )
    AS
    SELECT
    	LyncUserPlanId,
    	ItemID,
    	LyncUserPlanName,
    	LyncUserPlanType,
    	IM,
    	Mobility,
    	MobilityEnableOutsideVoice,
    	Federation,
    	Conferencing,
    	EnterpriseVoice,
    	VoicePolicy,
    	IsDefault
    FROM
    	LyncUserPlans
    WHERE
    	ItemID = @ItemID
    ORDER BY LyncUserPlanName
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetLyncUsers]
    (
    	@ItemID int,
    	@SortColumn nvarchar(40),
    	@SortDirection nvarchar(20),
    	@StartRow int,
    	@Count int	
    )
    AS

    CREATE TABLE #TempLyncUsers 
    (	
    	[ID] [int] IDENTITY(1,1) NOT NULL,
    	[AccountID] [int],	
    	[ItemID] [int] NOT NULL,
    	[AccountName] [nvarchar](300)  NOT NULL,
    	[DisplayName] [nvarchar](300)  NOT NULL,
    	[UserPrincipalName] [nvarchar](300) NULL,
    	[SipAddress] [nvarchar](300) NULL,
    	[SamAccountName] [nvarchar](100) NULL,
    	[LyncUserPlanId] [int] NOT NULL,		
    	[LyncUserPlanName] [nvarchar] (300) NOT NULL,		
    )

    DECLARE @condition nvarchar(700)
    SET @condition = ''

    IF (@SortColumn = 'DisplayName')
    BEGIN
    	SET @condition = 'ORDER BY ea.DisplayName'
    END

    IF (@SortColumn = 'UserPrincipalName')
    BEGIN
    	SET @condition = 'ORDER BY ea.UserPrincipalName'
    END

    IF (@SortColumn = 'SipAddress')
    BEGIN
    	SET @condition = 'ORDER BY ou.SipAddress'
    END

    IF (@SortColumn = 'LyncUserPlanName')
    BEGIN
    	SET @condition = 'ORDER BY lp.LyncUserPlanName'
    END

    DECLARE @sql nvarchar(3500)

    set @sql = '
    	INSERT INTO 
    		#TempLyncUsers 
    	SELECT 
    		ea.AccountID,
    		ea.ItemID,
    		ea.AccountName,
    		ea.DisplayName,
    		ea.UserPrincipalName,
    		ou.SipAddress,
    		ea.SamAccountName,
    		ou.LyncUserPlanId,
    		lp.LyncUserPlanName				
    	FROM 
    		ExchangeAccounts ea 
    	INNER JOIN 
    		LyncUsers ou
    	INNER JOIN
    		LyncUserPlans lp 
    	ON
    		ou.LyncUserPlanId = lp.LyncUserPlanId				
    	ON 
    		ea.AccountID = ou.AccountID
    	WHERE 
    		ea.ItemID = @ItemID ' + @condition

    exec sp_executesql @sql, N'@ItemID int',@ItemID

    DECLARE @RetCount int
    SELECT @RetCount = COUNT(ID) FROM #TempLyncUsers 

    IF (@SortDirection = 'ASC')
    BEGIN
    	SELECT * FROM #TempLyncUsers 
    	WHERE ID > @StartRow AND ID <= (@StartRow + @Count) 
    END
    ELSE
    BEGIN
    	IF @SortColumn <> '' AND @SortColumn IS NOT NULL
    	BEGIN
    		IF (@SortColumn = 'DisplayName')
    		BEGIN
    			SELECT * FROM #TempLyncUsers 
    				WHERE ID >@RetCount - @Count - @StartRow AND ID <= @RetCount- @StartRow  ORDER BY DisplayName DESC
    		END
    		IF (@SortColumn = 'UserPrincipalName')
    		BEGIN
    			SELECT * FROM #TempLyncUsers 
    				WHERE ID >@RetCount - @Count - @StartRow AND ID <= @RetCount- @StartRow  ORDER BY UserPrincipalName DESC
    		END

    		IF (@SortColumn = 'SipAddress')
    		BEGIN
    			SELECT * FROM #TempLyncUsers 
    				WHERE ID >@RetCount - @Count - @StartRow AND ID <= @RetCount- @StartRow  ORDER BY SipAddress DESC
    		END

    		IF (@SortColumn = 'LyncUserPlanName')
    		BEGIN
    			SELECT * FROM #TempLyncUsers 
    				WHERE ID >@RetCount - @Count - @StartRow AND ID <= @RetCount- @StartRow  ORDER BY LyncUserPlanName DESC
    		END
    	END
    	ELSE
    	BEGIN
            SELECT * FROM #TempLyncUsers 
    			WHERE ID >@RetCount - @Count - @StartRow AND ID <= @RetCount- @StartRow  ORDER BY UserPrincipalName DESC
    	END	
    END

    DROP TABLE #TempLyncUsers

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetLyncUsersByPlanId]
    (
    	@ItemID int,
    	@PlanId int
    )
    AS

    	SELECT
    		ea.AccountID,
    		ea.ItemID,
    		ea.AccountName,
    		ea.DisplayName,
    		ea.UserPrincipalName,
    		ea.SamAccountName,
    		ou.LyncUserPlanId,
    		lp.LyncUserPlanName
    	FROM
    		ExchangeAccounts ea
    	INNER JOIN
    		LyncUsers ou
    	INNER JOIN
    		LyncUserPlans lp
    	ON
    		ou.LyncUserPlanId = lp.LyncUserPlanId
    	ON
    		ea.AccountID = ou.AccountID
    	WHERE
    		ea.ItemID = @ItemID AND
    		ou.LyncUserPlanId = @PlanId

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetLyncUsersCount]
    (
    	@ItemID int
    )
    AS

    SELECT
    	COUNT(ea.AccountID)
    FROM
    	ExchangeAccounts ea
    INNER JOIN
    	LyncUsers ou
    ON
    	ea.AccountID = ou.AccountID
    WHERE
    	ea.ItemID = @ItemID

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetMyPackages]
    (
    	@ActorID int,
    	@UserID int
    )
    AS

    -- check rights
    IF dbo.CheckActorUserRights(@ActorID, @UserID) = 0
    RAISERROR('You are not allowed to access this account', 16, 1)

    SELECT
    	P.PackageID,
    	P.ParentPackageID,
    	P.PackageName,
    	P.StatusID,
    	P.PlanID,
    	P.PurchaseDate,
      	P.StatusIDchangeDate,

    	dbo.GetItemComments(P.PackageID, 'PACKAGE', @ActorID) AS Comments,

    	-- server
    	ISNULL(P.ServerID, 0) AS ServerID,
    	ISNULL(S.ServerName, 'None') AS ServerName,
    	ISNULL(S.Comments, '') AS ServerComments,
    	ISNULL(S.VirtualServer, 1) AS VirtualServer,

    	-- hosting plan
    	HP.PlanName,

    	-- user
    	P.UserID,
    	U.Username,
    	U.FirstName,
    	U.LastName,
    	U.FullName,
    	U.RoleID,
    	U.Email,

    	P.DefaultTopPackage
    FROM Packages AS P
    INNER JOIN UsersDetailed AS U ON P.UserID = U.UserID
    LEFT OUTER JOIN Servers AS S ON P.ServerID = S.ServerID
    LEFT OUTER JOIN HostingPlans AS HP ON P.PlanID = HP.PlanID
    WHERE P.UserID = @UserID
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetNestedPackagesPaged]
    (
    	@ActorID int,
    	@PackageID int,
    	@FilterColumn nvarchar(50) = '',
    	@FilterValue nvarchar(50) = '',
    	@StatusID int,
    	@PlanID int,
    	@ServerID int,
    	@SortColumn nvarchar(50),
    	@StartRow int,
    	@MaximumRows int
    )
    AS
    BEGIN

    -- build query and run it to the temporary table
    DECLARE @sql nvarchar(2000)

    SET @sql = '
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR(''You are not allowed to access this package'', 16, 1)

    DECLARE @EndRow int
    SET @EndRow = @StartRow + @MaximumRows
    DECLARE @Packages TABLE
    (
    	ItemPosition int IDENTITY(1,1),
    	PackageID int
    )
    INSERT INTO @Packages (PackageID)
    SELECT
    	P.PackageID
    FROM Packages AS P
    INNER JOIN UsersDetailed AS U ON P.UserID = U.UserID
    INNER JOIN Servers AS S ON P.ServerID = S.ServerID
    INNER JOIN HostingPlans AS HP ON P.PlanID = HP.PlanID
    WHERE
    	P.ParentPackageID = @PackageID
    	AND ((@StatusID = 0) OR (@StatusID > 0 AND P.StatusID = @StatusID))
    	AND ((@PlanID = 0) OR (@PlanID > 0 AND P.PlanID = @PlanID))
    	AND ((@ServerID = 0) OR (@ServerID > 0 AND P.ServerID = @ServerID)) '

    IF @FilterValue <> ''
    BEGIN
    	IF @FilterColumn <> ''
    		SET @sql = @sql + ' AND ' + @FilterColumn + ' LIKE @FilterValue '
    	ELSE
    		SET @sql = @sql + '
    			AND (Username LIKE @FilterValue
    			OR FullName LIKE @FilterValue
    			OR Email LIKE @FilterValue) '
    END

    IF @SortColumn <> '' AND @SortColumn IS NOT NULL
    SET @sql = @sql + ' ORDER BY ' + @SortColumn + ' '
    ELSE
    SET @sql = @sql + ' ORDER BY P.PackageName '

    SET @sql = @sql + ' SELECT COUNT(PackageID) FROM @Packages;
    SELECT
    	P.PackageID,
    	P.PackageName,
    	P.StatusID,
    	P.PurchaseDate,    
      	P.StatusIDchangeDate,

    	dbo.GetItemComments(P.PackageID, ''PACKAGE'', @ActorID) AS Comments,

    	-- server
    	P.ServerID,
    	ISNULL(S.ServerName, ''None'') AS ServerName,
    	ISNULL(S.Comments, '''') AS ServerComments,
    	ISNULL(S.VirtualServer, 1) AS VirtualServer,

    	-- hosting plan
    	P.PlanID,
    	HP.PlanName,

    	-- user
    	P.UserID,
    	U.Username,
    	U.FirstName,
    	U.LastName,
    	U.FullName,
    	U.RoleID,
    	U.Email
    FROM @Packages AS TP
    INNER JOIN Packages AS P ON TP.PackageID = P.PackageID
    INNER JOIN UsersDetailed AS U ON P.UserID = U.UserID
    INNER JOIN Servers AS S ON P.ServerID = S.ServerID
    INNER JOIN HostingPlans AS HP ON P.PlanID = HP.PlanID
    WHERE TP.ItemPosition BETWEEN @StartRow AND @EndRow'

    exec sp_executesql @sql, N'@StartRow int, @MaximumRows int, @PackageID int, @FilterValue nvarchar(50), @ActorID int, @StatusID int, @PlanID int, @ServerID int',
    @StartRow, @MaximumRows, @PackageID, @FilterValue, @ActorID, @StatusID, @PlanID, @ServerID

    RETURN
    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetNestedPackagesSummary]
    (
    	@ActorID int,
    	@PackageID int
    )
    AS
    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    -- ALL spaces
    SELECT COUNT(PackageID) AS PackagesNumber FROM Packages
    WHERE ParentPackageID = @PackageID

    -- BY STATUS spaces
    SELECT StatusID, COUNT(PackageID) AS PackagesNumber FROM Packages
    WHERE ParentPackageID = @PackageID AND StatusID > 0
    GROUP BY StatusID
    ORDER BY StatusID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetNextSchedule]
    AS

    -- find next schedule
    DECLARE @ScheduleID int
    DECLARE @TaskID nvarchar(100)
    SELECT TOP 1
    	@ScheduleID = ScheduleID,
    	@TaskID = TaskID
    FROM Schedule AS S
    WHERE Enabled = 1
    ORDER BY NextRun ASC

    -- select schedule
    SELECT TOP 1
    	S.ScheduleID,
    	S.TaskID,
    	S.PackageID,
    	S.ScheduleName,
    	S.ScheduleTypeID,
    	S.Interval,
    	S.FromTime,
    	S.ToTime,
    	S.StartTime,
    	S.LastRun,
    	S.NextRun,
    	S.Enabled,
    	S.HistoriesNumber,
    	S.PriorityID,
    	S.MaxExecutionTime,
    	S.WeekMonthDay,
    	1 AS StatusID
    FROM Schedule AS S
    WHERE S.ScheduleID = @ScheduleID
    ORDER BY NextRun ASC

    -- select task
    SELECT
    	TaskID,
    	TaskType,
    	RoleID
    FROM ScheduleTasks
    WHERE TaskID = @TaskID

    -- select schedule parameters
    SELECT
    	S.ScheduleID,
    	STP.ParameterID,
    	STP.DataTypeID,
    	ISNULL(SP.ParameterValue, STP.DefaultValue) AS ParameterValue
    FROM Schedule AS S
    INNER JOIN ScheduleTaskParameters AS STP ON S.TaskID = STP.TaskID
    LEFT OUTER JOIN ScheduleParameters AS SP ON STP.ParameterID = SP.ParameterID AND SP.ScheduleID = S.ScheduleID
    WHERE S.ScheduleID = @ScheduleID
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetOCSUsers]
    (
    	@ItemID int,
    	@SortColumn nvarchar(40),
    	@SortDirection nvarchar(20),
    	@Name nvarchar(400),
    	@Email nvarchar(400),
    	@StartRow int,
    	@Count int
    )
    AS

    IF (@Name IS NULL)
    BEGIN
    	SET @Name = '%'
    END

    IF (@Email IS NULL)
    BEGIN
    	SET @Email = '%'
    END

    CREATE TABLE #TempOCSUsers
    (
    	[ID] [int] IDENTITY(1,1) NOT NULL,
    	[AccountID] [int],
    	[ItemID] [int] NOT NULL,
    	[AccountName] [nvarchar](300)  NOT NULL,
    	[DisplayName] [nvarchar](300)  NOT NULL,
    	[InstanceID] [nvarchar](50)  NOT NULL,
    	[PrimaryEmailAddress] [nvarchar](300) NULL,
    	[SamAccountName] [nvarchar](100) NULL
    )

    IF (@SortColumn = 'DisplayName')
    BEGIN
    	INSERT INTO
    		#TempOCSUsers
    	SELECT
    		ea.AccountID,
    		ea.ItemID,
    		ea.AccountName,
    		ea.DisplayName,
    		ou.InstanceID,
    		ea.PrimaryEmailAddress,
    		ea.SamAccountName
    	FROM
    		ExchangeAccounts ea
    	INNER JOIN
    		OCSUsers ou
    	ON
    		ea.AccountID = ou.AccountID
    	WHERE
    		ea.ItemID = @ItemID AND ea.DisplayName LIKE @Name AND ea.PrimaryEmailAddress LIKE @Email
    	ORDER BY
    		ea.DisplayName
    END
    ELSE
    BEGIN
    	INSERT INTO
    		#TempOCSUsers
    	SELECT
    		ea.AccountID,
    		ea.ItemID,
    		ea.AccountName,
    		ea.DisplayName,
    		ou.InstanceID,
    		ea.PrimaryEmailAddress,
    		ea.SamAccountName
    	FROM
    		ExchangeAccounts ea
    	INNER JOIN
    		OCSUsers ou
    	ON
    		ea.AccountID = ou.AccountID
    	WHERE
    		ea.ItemID = @ItemID AND ea.DisplayName LIKE @Name AND ea.PrimaryEmailAddress LIKE @Email
    	ORDER BY
    		ea.PrimaryEmailAddress
    END

    DECLARE @RetCount int
    SELECT @RetCount = COUNT(ID) FROM #TempOCSUsers

    IF (@SortDirection = 'ASC')
    BEGIN
    	SELECT * FROM #TempOCSUsers
    	WHERE ID > @StartRow AND ID <= (@StartRow + @Count)
    END
    ELSE
    BEGIN
    	IF (@SortColumn = 'DisplayName')
    	BEGIN
    		SELECT * FROM #TempOCSUsers
    			WHERE ID >@RetCount - @Count - @StartRow AND ID <= @RetCount- @StartRow  ORDER BY DisplayName DESC
    	END
    	ELSE
    	BEGIN
    		SELECT * FROM #TempOCSUsers
    			WHERE ID >@RetCount - @Count - @StartRow AND ID <= @RetCount- @StartRow  ORDER BY PrimaryEmailAddress DESC
    	END

    END

    DROP TABLE #TempOCSUsers

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetOCSUsersCount]
    (
    	@ItemID int,
    	@Name nvarchar(400),
    	@Email nvarchar(400)

    )
    AS

    IF (@Name IS NULL)
    BEGIN
    	SET @Name = '%'
    END

    IF (@Email IS NULL)
    BEGIN
    	SET @Email = '%'
    END

    SELECT
    	COUNT(ea.AccountID)
    FROM
    	ExchangeAccounts ea
    INNER JOIN
    	OCSUsers ou
    ON
    	ea.AccountID = ou.AccountID
    WHERE
    	ea.ItemID = @ItemID AND ea.DisplayName LIKE @Name AND ea.PrimaryEmailAddress LIKE @Email

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetOrganizationCRMUserCount]
    	@ItemID int
    AS
    BEGIN
    SELECT
     COUNT(CRMUserID)
    FROM
    	CrmUsers CU
    INNER JOIN
    	ExchangeAccounts EA
    ON
    	CU.AccountID = EA.AccountID
    WHERE EA.ItemID = @ItemID
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetOrganizationDeletedUser]
    (
    	@AccountID int
    )
    AS
    SELECT
    	EDA.AccountID,
    	EDA.OriginAT,
    	EDA.StoragePath,
    	EDA.FolderName,
    	EDA.FileName,
    	EDA.ExpirationDate
    FROM
    	ExchangeDeletedAccounts AS EDA
    WHERE
    	EDA.AccountID = @AccountID
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetOrganizationGroupsByDisplayName]
    (
    	@ItemID int,
    	@DisplayName NVARCHAR(255)
    )
    AS
    SELECT
    	AccountID,
    	ItemID,
    	AccountType,
    	AccountName,
    	DisplayName,
    	UserPrincipalName
    FROM
    	ExchangeAccounts
    WHERE
    	ItemID = @ItemID AND DisplayName = @DisplayName AND (AccountType IN (8, 9))
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetOrganizationObjectsByDomain]
    (
            @ItemID int,
            @DomainName nvarchar(100)
    )
    AS
    SELECT
    	'ExchangeAccounts' as ObjectName,
            AccountID as ObjectID,
    	AccountType as ObjectType,
            DisplayName as DisplayName,
    	0 as OwnerID
    FROM
            ExchangeAccounts
    WHERE
    	UserPrincipalName LIKE '%@'+ @DomainName AND AccountType!=2
    UNION
    SELECT
    	'ExchangeAccountEmailAddresses' as ObjectName,
    	eam.AddressID as ObjectID,
    	ea.AccountType as ObjectType,
    	eam.EmailAddress as DisplayName,
    	eam.AccountID as OwnerID
    FROM
    	ExchangeAccountEmailAddresses as eam
    INNER JOIN 
    	ExchangeAccounts ea
    ON 
    	ea.AccountID = eam.AccountID
    WHERE
    	(ea.PrimaryEmailAddress != eam.EmailAddress)
    	AND (ea.UserPrincipalName != eam.EmailAddress)
    	AND (eam.EmailAddress LIKE '%@'+ @DomainName)
    UNION
    SELECT 
    	'SfBUsers' as ObjectName,
    	ea.AccountID as ObjectID,
    	ea.AccountType as ObjectType,
    	ea.DisplayName as DisplayName,
    	0 as OwnerID
    FROM 
    	ExchangeAccounts ea 
    INNER JOIN 
    	SfBUsers ou
    ON 
    	ea.AccountID = ou.AccountID
    WHERE 
    	ou.SipAddress LIKE '%@'+ @DomainName
    UNION
    SELECT 
    	'LyncUsers' as ObjectName,
    	ea.AccountID as ObjectID,
    	ea.AccountType as ObjectType,
    	ea.DisplayName as DisplayName,
    	0 as OwnerID
    FROM 
    	ExchangeAccounts ea 
    INNER JOIN 
    	LyncUsers ou
    ON 
    	ea.AccountID = ou.AccountID
    WHERE 
    	ou.SipAddress LIKE '%@'+ @DomainName
    ORDER BY 
    	DisplayName
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetOrganizationRdsCollectionsCount]
    (
    	@ItemID INT,
    	@TotalNumber int OUTPUT
    )
    AS
    SELECT
      @TotalNumber = Count([Id])
      FROM [dbo].[RDSCollections] WHERE [ItemId]  = @ItemId
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetOrganizationRdsServersCount]
    (
    	@ItemID INT,
    	@TotalNumber int OUTPUT
    )
    AS
    SELECT
      @TotalNumber = Count([Id])
      FROM [dbo].[RDSServers] WHERE [ItemId]  = @ItemId
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetOrganizationRdsUsersCount]
    (
    	@ItemID INT,
    	@TotalNumber int OUTPUT
    )
    AS
    SELECT
      @TotalNumber = Count(DISTINCT([AccountId]))
      FROM [dbo].[RDSCollectionUsers]
      WHERE [RDSCollectionId] in (SELECT [ID] FROM [RDSCollections] where [ItemId]  = @ItemId )
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetOrganizationStatistics]
    (
    	@ItemID int
    )
    AS
    SELECT
    	(SELECT COUNT(*) FROM ExchangeAccounts WHERE (AccountType = 7 OR AccountType = 1 OR AccountType = 6 OR AccountType = 5)  AND ItemID = @ItemID) AS CreatedUsers,
    	(SELECT COUNT(*) FROM ExchangeOrganizationDomains WHERE ItemID = @ItemID) AS CreatedDomains,
    	(SELECT COUNT(*) FROM ExchangeAccounts WHERE (AccountType = 8 OR AccountType = 9)  AND ItemID = @ItemID) AS CreatedGroups,
    	(SELECT COUNT(*) FROM ExchangeAccounts WHERE AccountType = 11  AND ItemID = @ItemID) AS DeletedUsers
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetOrganizationStoragSpaceFolders]
    (
    	@ItemId INT
    )
    AS
    	SELECT
    		SSF.Id,
    		SSF.Name,
    		SSF.StorageSpaceId,
    		SSF.Path,
    		SSF.UncPath,
    		SSF.IsShared,
    		SSF.FsrmQuotaType,
    		SSF.FsrmQuotaSizeBytes
    	FROM [ExchangeOrganizationSsFolders] AS OSSF
    	INNER JOIN [StorageSpaceFolders] AS SSF ON SSF.Id = OSSF.StorageSpaceFolderId
    	WHERE ItemId = @ItemId
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetOrganizationStoragSpacesFolderByType]
    (
    	@ItemId INT,
    	@Type varchar(100)
    )
    AS
    	SELECT
    		SSF.Id,
    		SSF.Name,
    		SSF.StorageSpaceId,
    		SSF.Path,
    		SSF.UncPath,
    		SSF.IsShared,
    		SSF.FsrmQuotaType,
    		SSF.FsrmQuotaSizeBytes
    	FROM [ExchangeOrganizationSsFolders] AS OSSF
    	INNER JOIN [StorageSpaceFolders] AS SSF ON SSF.Id = OSSF.StorageSpaceFolderId
    	WHERE ItemId = @ItemId AND Type = @Type
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetPackage]
    (
    	@PackageID int,
    	@ActorID int
    )
    AS

    -- Note: ActorID is not verified
    -- check both requested and parent package

    SELECT
    	P.PackageID,
    	P.ParentPackageID,
    	P.UserID,
    	P.PackageName,
    	P.PackageComments,
    	P.ServerID,
    	P.StatusID,
    	P.PlanID,
    	P.PurchaseDate,     
      	P.StatusIDchangeDate,
    	P.OverrideQuotas,
    	P.DefaultTopPackage
    FROM Packages AS P
    WHERE P.PackageID = @PackageID
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetPackageAddon]
    (
    	@ActorID int,
    	@PackageAddonID int
    )
    AS

    -- check rights
    DECLARE @PackageID int
    SELECT @PackageID = PackageID FROM PackageAddons
    WHERE PackageAddonID = @PackageAddonID

    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    SELECT
    	PackageAddonID,
    	PackageID,
    	PlanID,
    	PurchaseDate,
    	Quantity,
    	StatusID,
    	Comments
    FROM PackageAddons AS PA
    WHERE PA.PackageAddonID = @PackageAddonID
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetPackageAddons]
    (
    	@ActorID int,
    	@PackageID int
    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    SELECT
    	PA.PackageAddonID,
    	PA.PackageID,
    	PA.PlanID,
    	PA.Quantity,
    	PA.PurchaseDate,
    	PA.StatusID,
    	PA.Comments,
    	HP.PlanName,
    	HP.PlanDescription
    FROM PackageAddons AS PA
    INNER JOIN HostingPlans AS HP ON PA.PlanID = HP.PlanID
    WHERE PA.PackageID = @PackageID
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetPackageBandwidth]
    (
    	@ActorID int,
    	@PackageID int,
    	@StartDate datetime,
    	@EndDate datetime
    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    SELECT
    	RG.GroupID,
    	RG.GroupName,
    	ROUND(CONVERT(float, ISNULL(GB.BytesSent, 0)) / 1024 / 1024, 0) AS MegaBytesSent,
    	ROUND(CONVERT(float, ISNULL(GB.BytesReceived, 0)) / 1024 / 1024, 0) AS MegaBytesReceived,
    	ROUND(CONVERT(float, ISNULL(GB.BytesTotal, 0)) / 1024 / 1024, 0) AS MegaBytesTotal,
    	ISNULL(GB.BytesSent, 0) AS BytesSent,
    	ISNULL(GB.BytesReceived, 0) AS BytesReceived,
    	ISNULL(GB.BytesTotal, 0) AS BytesTotal
    FROM ResourceGroups AS RG
    LEFT OUTER JOIN
    (
    	SELECT
    		PB.GroupID,
    		SUM(ISNULL(PB.BytesSent, 0)) AS BytesSent,
    		SUM(ISNULL(PB.BytesReceived, 0)) AS BytesReceived,
    		SUM(ISNULL(PB.BytesSent, 0)) + SUM(ISNULL(PB.BytesReceived, 0)) AS BytesTotal
    	FROM PackagesTreeCache AS PT
    	INNER JOIN PackagesBandwidth AS PB ON PT.PackageID = PB.PackageID
    	INNER JOIN Packages AS P ON PB.PackageID = P.PackageID
    	INNER JOIN HostingPlanResources AS HPR ON PB.GroupID = HPR.GroupID AND HPR.PlanID = P.PlanID
    		AND HPR.CalculateBandwidth = 1
    	WHERE
    		PT.ParentPackageID = @PackageID
    		AND PB.LogDate BETWEEN @StartDate AND @EndDate
    	GROUP BY PB.GroupID
    ) AS GB ON RG.GroupID = GB.GroupID
    WHERE GB.BytesTotal > 0
    ORDER BY RG.GroupOrder

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetPackageBandwidthUpdate]
    (
    	@PackageID int,
    	@UpdateDate datetime OUTPUT
    )
    AS
    	SELECT @UpdateDate = BandwidthUpdated FROM Packages
    	WHERE PackageID = @PackageID
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetPackageDiskspace]
    (
    	@ActorID int,
    	@PackageID int
    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    SELECT
    	RG.GroupID,
    	RG.GroupName,
    	ROUND(CONVERT(float, ISNULL(GD.Diskspace, 0)) / 1024 / 1024, 0) AS Diskspace,
    	ISNULL(GD.Diskspace, 0) AS DiskspaceBytes
    FROM ResourceGroups AS RG
    LEFT OUTER JOIN
    (
    	SELECT
    		PD.GroupID,
    		SUM(ISNULL(PD.DiskSpace, 0)) AS Diskspace -- in megabytes
    	FROM PackagesTreeCache AS PT
    	INNER JOIN PackagesDiskspace AS PD ON PT.PackageID = PD.PackageID
    	INNER JOIN Packages AS P ON PT.PackageID = P.PackageID
    	INNER JOIN HostingPlanResources AS HPR ON PD.GroupID = HPR.GroupID
    		AND HPR.PlanID = P.PlanID AND HPR.CalculateDiskspace = 1
    	WHERE PT.ParentPackageID = @PackageID
    	GROUP BY PD.GroupID
    ) AS GD ON RG.GroupID = GD.GroupID
    WHERE GD.Diskspace <> 0
    ORDER BY RG.GroupOrder

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetPackageIPAddress]
     @PackageAddressID int
    AS
    BEGIN
    SELECT
     PA.PackageAddressID,
     PA.AddressID,
     IP.ExternalIP,
     IP.InternalIP,
     IP.SubnetMask,
     IP.DefaultGateway,
     IP.VLAN,
     PA.ItemID,
     SI.ItemName,
     PA.PackageID,
     P.PackageName,
     P.UserID,
     U.UserName,
     PA.IsPrimary
    FROM dbo.PackageIPAddresses AS PA
    INNER JOIN dbo.IPAddresses AS IP ON PA.AddressID = IP.AddressID
    INNER JOIN dbo.Packages P ON PA.PackageID = P.PackageID
    INNER JOIN dbo.Users U ON U.UserID = P.UserID
    LEFT JOIN ServiceItems SI ON PA.ItemId = SI.ItemID
    WHERE PA.PackageAddressID = @PackageAddressID
    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetPackageIPAddresses]
    (
     @PackageID int,
     @OrgID int,
     @FilterColumn nvarchar(50) = '',
     @FilterValue nvarchar(50) = '',
     @SortColumn nvarchar(50),
     @StartRow int,
     @MaximumRows int,
     @PoolID int = 0,
     @Recursive bit = 0
    )
    AS
    BEGIN
    -- start
    DECLARE @condition nvarchar(700)
    SET @condition = '
    ((@Recursive = 0 AND PA.PackageID = @PackageID)
    OR (@Recursive = 1 AND dbo.CheckPackageParent(@PackageID, PA.PackageID) = 1))
    AND (@PoolID = 0 OR @PoolID <> 0 AND IP.PoolID = @PoolID)
    AND (@OrgID = 0 OR @OrgID <> 0 AND PA.OrgID = @OrgID)
    '

    IF @FilterValue <> '' AND @FilterValue IS NOT NULL
    BEGIN
     IF @FilterColumn <> '' AND @FilterColumn IS NOT NULL
      SET @condition = @condition + ' AND ' + @FilterColumn + ' LIKE ''' + @FilterValue + ''''
     ELSE
      SET @condition = @condition + '
       AND (ExternalIP LIKE ''' + @FilterValue + '''
       OR InternalIP LIKE ''' + @FilterValue + '''
       OR DefaultGateway LIKE ''' + @FilterValue + '''
       OR ItemName LIKE ''' + @FilterValue + '''
       OR Username LIKE ''' + @FilterValue + ''')'
    END

    IF @SortColumn IS NULL OR @SortColumn = ''
    SET @SortColumn = 'IP.ExternalIP ASC'

    DECLARE @sql nvarchar(3500)

    set @sql = '
    SELECT COUNT(PA.PackageAddressID)
    FROM dbo.PackageIPAddresses PA
    INNER JOIN dbo.IPAddresses AS IP ON PA.AddressID = IP.AddressID
    INNER JOIN dbo.Packages P ON PA.PackageID = P.PackageID
    INNER JOIN dbo.Users U ON U.UserID = P.UserID
    LEFT JOIN ServiceItems SI ON PA.ItemId = SI.ItemID
    WHERE ' + @condition + '

    DECLARE @Addresses AS TABLE
    (
     PackageAddressID int
    );

    WITH TempItems AS (
     SELECT ROW_NUMBER() OVER (ORDER BY ' + @SortColumn + ') as Row,
      PA.PackageAddressID
     FROM dbo.PackageIPAddresses PA
     INNER JOIN dbo.IPAddresses AS IP ON PA.AddressID = IP.AddressID
     INNER JOIN dbo.Packages P ON PA.PackageID = P.PackageID
     INNER JOIN dbo.Users U ON U.UserID = P.UserID
     LEFT JOIN ServiceItems SI ON PA.ItemId = SI.ItemID
     WHERE ' + @condition + '
    )

    INSERT INTO @Addresses
    SELECT PackageAddressID FROM TempItems
    WHERE TempItems.Row BETWEEN @StartRow + 1 and @StartRow + @MaximumRows

    SELECT
     PA.PackageAddressID,
     PA.AddressID,
     IP.ExternalIP,
     IP.InternalIP,
     IP.SubnetMask,
     IP.DefaultGateway,
     IP.VLAN,
     PA.ItemID,
     SI.ItemName,
     PA.PackageID,
     P.PackageName,
     P.UserID,
     U.UserName,
     PA.IsPrimary
    FROM @Addresses AS TA
    INNER JOIN dbo.PackageIPAddresses AS PA ON TA.PackageAddressID = PA.PackageAddressID
    INNER JOIN dbo.IPAddresses AS IP ON PA.AddressID = IP.AddressID
    INNER JOIN dbo.Packages P ON PA.PackageID = P.PackageID
    INNER JOIN dbo.Users U ON U.UserID = P.UserID
    LEFT JOIN ServiceItems SI ON PA.ItemId = SI.ItemID
    '

    print @sql

    exec sp_executesql @sql, N'@PackageID int, @OrgID int, @StartRow int, @MaximumRows int, @Recursive bit, @PoolID int',
    @PackageID, @OrgID, @StartRow, @MaximumRows, @Recursive, @PoolID

    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetPackageIPAddressesCount]
    (
    	@PackageID int,
    	@OrgID int,
    	@PoolID int = 0
    )
    AS
    BEGIN

    SELECT 
    	COUNT(PA.PackageAddressID)
    FROM 
    	dbo.PackageIPAddresses PA
    INNER JOIN 
    	dbo.IPAddresses AS IP ON PA.AddressID = IP.AddressID
    INNER JOIN 
    	dbo.Packages P ON PA.PackageID = P.PackageID
    INNER JOIN 
    	dbo.Users U ON U.UserID = P.UserID
    LEFT JOIN 
    	ServiceItems SI ON PA.ItemId = SI.ItemID
    WHERE
    	(@PoolID = 0 OR @PoolID <> 0 AND IP.PoolID = @PoolID)
    AND (@OrgID = 0 OR @OrgID <> 0 AND PA.OrgID = @OrgID)

    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetPackagePackages]
    (
    	@ActorID int,
    	@PackageID int,
    	@Recursive bit
    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    SELECT
    	P.PackageID,
    	P.ParentPackageID,
    	P.PackageName,
    	P.StatusID,
    	P.PurchaseDate,

    	-- server
    	P.ServerID,
    	ISNULL(S.ServerName, 'None') AS ServerName,
    	ISNULL(S.Comments, '') AS ServerComments,
    	ISNULL(S.VirtualServer, 1) AS VirtualServer,

    	-- hosting plan
    	P.PlanID,
    	HP.PlanName,

    	-- user
    	P.UserID,
    	U.Username,
    	U.FirstName,
    	U.LastName,
    	U.RoleID,
    	U.Email
    FROM Packages AS P
    INNER JOIN Users AS U ON P.UserID = U.UserID
    INNER JOIN Servers AS S ON P.ServerID = S.ServerID
    INNER JOIN HostingPlans AS HP ON P.PlanID = HP.PlanID
    WHERE
    	((@Recursive = 1 AND dbo.CheckPackageParent(@PackageID, P.PackageID) = 1)
    		OR (@Recursive = 0 AND P.ParentPackageID = @PackageID))
    	AND P.PackageID <> @PackageID
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetPackagePrivateIPAddresses]
    	@PackageID int
    AS
    BEGIN

    	SELECT
    		PA.PrivateAddressID,
    		PA.IPAddress,
    		PA.ItemID,
    		SI.ItemName,
    		PA.IsPrimary
    	FROM PrivateIPAddresses AS PA
    	INNER JOIN ServiceItems AS SI ON PA.ItemID = SI.ItemID
    	WHERE SI.PackageID = @PackageID

    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetPackagePrivateIPAddressesPaged]
    	@PackageID int,
    	@FilterColumn nvarchar(50) = '',
    	@FilterValue nvarchar(50) = '',
    	@SortColumn nvarchar(50),
    	@StartRow int,
    	@MaximumRows int
    AS
    BEGIN

    -- start
    DECLARE @condition nvarchar(700)
    SET @condition = '
    SI.PackageID = @PackageID
    '

    IF @FilterValue <> '' AND @FilterValue IS NOT NULL
    BEGIN
    	IF @FilterColumn <> '' AND @FilterColumn IS NOT NULL
    		SET @condition = @condition + ' AND ' + @FilterColumn + ' LIKE ''' + @FilterValue + ''''
    	ELSE
    		SET @condition = @condition + '
    			AND (IPAddress LIKE ''' + @FilterValue + '''
    			OR ItemName LIKE ''' + @FilterValue + ''')'
    END

    IF @SortColumn IS NULL OR @SortColumn = ''
    SET @SortColumn = 'PA.IPAddress ASC'

    DECLARE @sql nvarchar(3500)

    set @sql = '
    SELECT COUNT(PA.PrivateAddressID)
    FROM dbo.PrivateIPAddresses AS PA
    INNER JOIN dbo.ServiceItems AS SI ON PA.ItemID = SI.ItemID
    WHERE ' + @condition + '

    DECLARE @Addresses AS TABLE
    (
    	PrivateAddressID int
    );

    WITH TempItems AS (
    	SELECT ROW_NUMBER() OVER (ORDER BY ' + @SortColumn + ') as Row,
    		PA.PrivateAddressID
    	FROM dbo.PrivateIPAddresses AS PA
    	INNER JOIN dbo.ServiceItems AS SI ON PA.ItemID = SI.ItemID
    	WHERE ' + @condition + '
    )

    INSERT INTO @Addresses
    SELECT PrivateAddressID FROM TempItems
    WHERE TempItems.Row BETWEEN @StartRow + 1 and @StartRow + @MaximumRows

    SELECT
    	PA.PrivateAddressID,
    	PA.IPAddress,
    	PA.ItemID,
    	SI.ItemName,
    	PA.IsPrimary
    FROM @Addresses AS TA
    INNER JOIN dbo.PrivateIPAddresses AS PA ON TA.PrivateAddressID = PA.PrivateAddressID
    INNER JOIN dbo.ServiceItems AS SI ON PA.ItemID = SI.ItemID
    '

    print @sql

    exec sp_executesql @sql, N'@PackageID int, @StartRow int, @MaximumRows int',
    @PackageID, @StartRow, @MaximumRows

    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetPackagePrivateNetworkVLANs]
    (
     @PackageID int,
     @SortColumn nvarchar(50),
     @StartRow int,
     @MaximumRows int
    )
    AS
    BEGIN
    -- start
    DECLARE @condition nvarchar(700)
    SET @condition = '
    dbo.CheckPackageParent(@PackageID, PA.PackageID) = 1
    '

    IF @SortColumn IS NULL OR @SortColumn = ''
    SET @SortColumn = 'V.Vlan ASC'

    DECLARE @sql nvarchar(3500)

    set @sql = '
    SELECT COUNT(PA.PackageVlanID)
    FROM dbo.PackageVLANs PA
    INNER JOIN dbo.PrivateNetworkVLANs AS V ON PA.VlanID = V.VlanID
    INNER JOIN dbo.Packages P ON PA.PackageID = P.PackageID
    INNER JOIN dbo.Users U ON U.UserID = P.UserID
    WHERE ' + @condition + '

    DECLARE @VLANs AS TABLE
    (
     PackageVlanID int
    );

    WITH TempItems AS (
     SELECT ROW_NUMBER() OVER (ORDER BY ' + @SortColumn + ') as Row,
      PA.PackageVlanID
     FROM dbo.PackageVLANs PA
     INNER JOIN dbo.PrivateNetworkVLANs AS V ON PA.VlanID = V.VlanID
     INNER JOIN dbo.Packages P ON PA.PackageID = P.PackageID
     INNER JOIN dbo.Users U ON U.UserID = P.UserID
     WHERE ' + @condition + '
    )

    INSERT INTO @VLANs
    SELECT PackageVlanID FROM TempItems
    WHERE TempItems.Row BETWEEN @StartRow + 1 and @StartRow + @MaximumRows

    SELECT
     PA.PackageVlanID,
     PA.VlanID,
     V.Vlan,
     PA.PackageID,
     P.PackageName,
     P.UserID,
     U.UserName
    FROM @VLANs AS TA
    INNER JOIN dbo.PackageVLANs AS PA ON TA.PackageVlanID = PA.PackageVlanID
    INNER JOIN dbo.PrivateNetworkVLANs AS V ON PA.VlanID = V.VlanID
    INNER JOIN dbo.Packages P ON PA.PackageID = P.PackageID
    INNER JOIN dbo.Users U ON U.UserID = P.UserID
    '

    print @sql

    exec sp_executesql @sql, N'@PackageID int, @StartRow int, @MaximumRows int',
    @PackageID, @StartRow, @MaximumRows

    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetPackageQuota]
    (
    	@ActorID int,
    	@PackageID int,
    	@QuotaName nvarchar(50)
    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    -- return quota
    DECLARE @OrgsCount INT
    SET @OrgsCount = dbo.GetPackageAllocatedQuota(@PackageID, 205) -- 205 - HostedSolution.Organizations
    SET @OrgsCount = CASE WHEN ISNULL(@OrgsCount, 0) < 1 THEN 1 ELSE @OrgsCount END

    SELECT
    	Q.QuotaID,
    	Q.QuotaName,
    	Q.QuotaDescription,
    	Q.QuotaTypeID,
    	QuotaAllocatedValue = CASE WHEN Q.PerOrganization = 1 AND ISNULL(dbo.GetPackageAllocatedQuota(@PackageId, Q.QuotaID), 0) <> -1 THEN 
    					ISNULL(dbo.GetPackageAllocatedQuota(@PackageId, Q.QuotaID), 0) * @OrgsCount 
    				 ELSE 
    					ISNULL(dbo.GetPackageAllocatedQuota(@PackageId, Q.QuotaID), 0)
    				 END,
    	QuotaAllocatedValuePerOrganization = ISNULL(dbo.GetPackageAllocatedQuota(@PackageId, Q.QuotaID), 0),
    	ISNULL(dbo.CalculateQuotaUsage(@PackageId, Q.QuotaID), 0) AS QuotaUsedValue
    FROM Quotas AS Q
    WHERE Q.QuotaName = @QuotaName

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetPackageQuotas]
    (
    	@ActorID int,
    	@PackageID int
    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    DECLARE @PlanID int, @ParentPackageID int
    SELECT @PlanID = PlanID, @ParentPackageID = ParentPackageID FROM Packages
    WHERE PackageID = @PackageID

    -- get resource groups
    SELECT
    	RG.GroupID,
    	RG.GroupName,
    	ISNULL(HPR.CalculateDiskSpace, 0) AS CalculateDiskSpace,
    	ISNULL(HPR.CalculateBandwidth, 0) AS CalculateBandwidth,
    	--dbo.GetPackageAllocatedResource(@ParentPackageID, RG.GroupID, 0) AS ParentEnabled
    	CASE
    		WHEN RG.GroupName = 'Service Levels' THEN dbo.GetPackageServiceLevelResource(@ParentPackageID, RG.GroupID, 0)
    		ELSE dbo.GetPackageAllocatedResource(@ParentPackageID, RG.GroupID, 0)
    	END AS ParentEnabled
    FROM ResourceGroups AS RG
    LEFT OUTER JOIN HostingPlanResources AS HPR ON RG.GroupID = HPR.GroupID AND HPR.PlanID = @PlanID
    --WHERE dbo.GetPackageAllocatedResource(@PackageID, RG.GroupID, 0) = 1
    WHERE (dbo.GetPackageAllocatedResource(@PackageID, RG.GroupID, 0) = 1 AND RG.GroupName <> 'Service Levels') OR
    	  (dbo.GetPackageServiceLevelResource(@PackageID, RG.GroupID, 0) = 1 AND RG.GroupName = 'Service Levels')
    ORDER BY RG.GroupOrder

    -- return quotas
    DECLARE @OrgsCount INT
    SET @OrgsCount = dbo.GetPackageAllocatedQuota(@PackageID, 205) -- 205 - HostedSolution.Organizations
    SET @OrgsCount = CASE WHEN ISNULL(@OrgsCount, 0) < 1 THEN 1 ELSE @OrgsCount END

    SELECT
    	Q.QuotaID,
    	Q.GroupID,
    	Q.QuotaName,
    	Q.QuotaDescription,
    	Q.QuotaTypeID,
    	QuotaValue = CASE WHEN Q.PerOrganization = 1 AND dbo.GetPackageAllocatedQuota(@PackageID, Q.QuotaID) <> -1 THEN 
    					dbo.GetPackageAllocatedQuota(@PackageID, Q.QuotaID) * @OrgsCount 
    				 ELSE 
    					dbo.GetPackageAllocatedQuota(@PackageID, Q.QuotaID) 
    				 END,
    	QuotaValuePerOrganization = dbo.GetPackageAllocatedQuota(@PackageID, Q.QuotaID),
    	dbo.GetPackageAllocatedQuota(@ParentPackageID, Q.QuotaID) AS ParentQuotaValue,
    	ISNULL(dbo.CalculateQuotaUsage(@PackageID, Q.QuotaID), 0) AS QuotaUsedValue,
    	Q.PerOrganization
    FROM Quotas AS Q
    WHERE Q.HideQuota IS NULL OR Q.HideQuota = 0
    ORDER BY Q.QuotaOrder

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetPackageQuotasForEdit]
    (
    	@ActorID int,
    	@PackageID int
    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    DECLARE @ServerID int, @ParentPackageID int, @PlanID int
    SELECT @ServerID = ServerID, @ParentPackageID = ParentPackageID, @PlanID = PlanID FROM Packages
    WHERE PackageID = @PackageID

    -- get resource groups
    SELECT
    	RG.GroupID,
    	RG.GroupName,
    	ISNULL(PR.CalculateDiskSpace, ISNULL(HPR.CalculateDiskSpace, 0)) AS CalculateDiskSpace,
    	ISNULL(PR.CalculateBandwidth, ISNULL(HPR.CalculateBandwidth, 0)) AS CalculateBandwidth,
    		--dbo.GetPackageAllocatedResource(@PackageID, RG.GroupID, @ServerID) AS Enabled,
    	CASE
    		WHEN RG.GroupName = 'Service Levels' THEN dbo.GetPackageServiceLevelResource(PackageID, RG.GroupID, @ServerID)
    		ELSE dbo.GetPackageAllocatedResource(PackageID, RG.GroupID, @ServerID)
    	END AS Enabled,
    	--dbo.GetPackageAllocatedResource(@ParentPackageID, RG.GroupID, @ServerID) AS ParentEnabled
    	CASE
    		WHEN RG.GroupName = 'Service Levels' THEN dbo.GetPackageServiceLevelResource(@ParentPackageID, RG.GroupID, @ServerID)
    		ELSE dbo.GetPackageAllocatedResource(@ParentPackageID, RG.GroupID, @ServerID)
    	END AS ParentEnabled
    FROM ResourceGroups AS RG
    LEFT OUTER JOIN PackageResources AS PR ON RG.GroupID = PR.GroupID AND PR.PackageID = @PackageID
    LEFT OUTER JOIN HostingPlanResources AS HPR ON RG.GroupID = HPR.GroupID AND HPR.PlanID = @PlanID
    ORDER BY RG.GroupOrder

    -- return quotas
    SELECT
    	Q.QuotaID,
    	Q.GroupID,
    	Q.QuotaName,
    	Q.QuotaDescription,
    	Q.QuotaTypeID,
    	CASE
    		WHEN PQ.QuotaValue IS NULL THEN dbo.GetPackageAllocatedQuota(@PackageID, Q.QuotaID)
    		ELSE PQ.QuotaValue
    	END QuotaValue,
    	dbo.GetPackageAllocatedQuota(@ParentPackageID, Q.QuotaID) AS ParentQuotaValue
    FROM Quotas AS Q
    LEFT OUTER JOIN PackageQuotas AS PQ ON PQ.QuotaID = Q.QuotaID AND PQ.PackageID = @PackageID
    ORDER BY Q.QuotaOrder

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetPackages]
    (
    	@ActorID int,
    	@UserID int
    )
    AS

    SELECT
    	P.PackageID,
    	P.ParentPackageID,
    	P.PackageName,
    	P.StatusID,
    	P.PurchaseDate,   
      	P.StatusIDchangeDate,

    	-- server
    	ISNULL(P.ServerID, 0) AS ServerID,
    	ISNULL(S.ServerName, 'None') AS ServerName,
    	ISNULL(S.Comments, '') AS ServerComments,
    	ISNULL(S.VirtualServer, 1) AS VirtualServer,

    	-- hosting plan
    	P.PlanID,
    	HP.PlanName,

    	-- user
    	P.UserID,
    	U.Username,
    	U.FirstName,
    	U.LastName,
    	U.RoleID,
    	U.Email,

    	P.DefaultTopPackage
    FROM Packages AS P
    INNER JOIN Users AS U ON P.UserID = U.UserID
    INNER JOIN Servers AS S ON P.ServerID = S.ServerID
    INNER JOIN HostingPlans AS HP ON P.PlanID = HP.PlanID
    WHERE
    	P.UserID = @UserID	
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetPackagesBandwidthPaged]
    (
    	@ActorID int,
    	@UserID int,
    	@PackageID int,
    	@StartDate datetime,
    	@EndDate datetime,
    	@SortColumn nvarchar(50),
    	@StartRow int,
    	@MaximumRows int
    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    DECLARE @sql nvarchar(4000)

    SET @sql = '
    DECLARE @EndRow int
    SET @EndRow = @StartRow + @MaximumRows

    DECLARE @Report TABLE
    (
    	ItemPosition int IDENTITY(0,1),
    	PackageID int,
    	QuotaValue int,
    	Bandwidth int,
    	UsagePercentage int,
    	PackagesNumber int
    )

    INSERT INTO @Report (PackageID, QuotaValue, Bandwidth, UsagePercentage, PackagesNumber)
    SELECT
    	P.PackageID,
    	PB.QuotaValue,
    	PB.Bandwidth,
    	UsagePercentage = 	CASE
    							WHEN PB.QuotaValue = -1 THEN 0
    							WHEN PB.QuotaValue <> 0 THEN PB.Bandwidth * 100 / PB.QuotaValue
    							ELSE 0
    						END,
    	(SELECT COUNT(NP.PackageID) FROM Packages AS NP WHERE NP.ParentPackageID = P.PackageID) AS PackagesNumber
    FROM Packages AS P
    LEFT OUTER JOIN
    (
    	SELECT
    		P.PackageID,
    		dbo.GetPackageAllocatedQuota(P.PackageID, 51) AS QuotaValue, -- bandwidth
    		ROUND(CONVERT(float, SUM(ISNULL(PB.BytesSent + PB.BytesReceived, 0))) / 1024 / 1024, 0) AS Bandwidth -- in megabytes
    	FROM Packages AS P
    	INNER JOIN PackagesTreeCache AS PT ON P.PackageID = PT.ParentPackageID
    	INNER JOIN Packages AS PC ON PT.PackageID = PC.PackageID
    	INNER JOIN PackagesBandwidth AS PB ON PT.PackageID = PB.PackageID
    	INNER JOIN HostingPlanResources AS HPR ON PB.GroupID = HPR.GroupID
    		AND HPR.PlanID = PC.PlanID
    	WHERE PB.LogDate BETWEEN @StartDate AND @EndDate
    		AND HPR.CalculateBandwidth = 1
    	GROUP BY P.PackageID
    ) AS PB ON P.PackageID = PB.PackageID
    WHERE (@PackageID = -1 AND P.UserID = @UserID) OR
    	(@PackageID <> -1 AND P.ParentPackageID = @PackageID) '

    IF @SortColumn = '' OR @SortColumn IS NULL
    SET @SortColumn = 'UsagePercentage DESC'

    SET @sql = @sql + ' ORDER BY ' + @SortColumn + ' '

    SET @sql = @sql + '
    SELECT COUNT(PackageID) FROM @Report

    SELECT
    	R.PackageID,
    	ISNULL(R.QuotaValue, 0) AS QuotaValue,
    	ISNULL(R.Bandwidth, 0) AS Bandwidth,
    	ISNULL(R.UsagePercentage, 0) AS UsagePercentage,

    	-- package
    	P.PackageName,
    	ISNULL(R.PackagesNumber, 0) AS PackagesNumber,
    	P.StatusID,

    	-- user
    	P.UserID,
    	U.Username,
    	U.FirstName,
    	U.LastName,
    	U.FullName,
    	U.RoleID,
    	U.Email,
    	dbo.GetItemComments(U.UserID, ''USER'', @ActorID) AS UserComments
    FROM @Report AS R
    INNER JOIN Packages AS P ON R.PackageID = P.PackageID
    INNER JOIN UsersDetailed AS U ON P.UserID = U.UserID
    WHERE R.ItemPosition BETWEEN @StartRow AND @EndRow
    '

    exec sp_executesql @sql, N'@ActorID int, @UserID int, @PackageID int, @StartDate datetime, @EndDate datetime, @StartRow int, @MaximumRows int',
    @ActorID, @UserID, @PackageID, @StartDate, @EndDate, @StartRow, @MaximumRows

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetPackagesDiskspacePaged]
    (
    	@ActorID int,
    	@UserID int,
    	@PackageID int,
    	@SortColumn nvarchar(50),
    	@StartRow int,
    	@MaximumRows int
    )
    AS

    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    DECLARE @sql nvarchar(4000)

    SET @sql = '
    DECLARE @EndRow int
    SET @EndRow = @StartRow + @MaximumRows

    DECLARE @Report TABLE
    (
    	ItemPosition int IDENTITY(0,1),
    	PackageID int,
    	QuotaValue int,
    	Diskspace int,
    	UsagePercentage int,
    	PackagesNumber int
    )

    INSERT INTO @Report (PackageID, QuotaValue, Diskspace, UsagePercentage, PackagesNumber)
    SELECT
    	P.PackageID,
    	PD.QuotaValue,
    	PD.Diskspace,
    	UsagePercentage = 	CASE
    							WHEN PD.QuotaValue = -1 THEN 0
    							WHEN PD.QuotaValue <> 0 THEN PD.Diskspace * 100 / PD.QuotaValue
    							ELSE 0
    						END,
    	(SELECT COUNT(NP.PackageID) FROM Packages AS NP WHERE NP.ParentPackageID = P.PackageID) AS PackagesNumber
    FROM Packages AS P
    LEFT OUTER JOIN
    (
    	SELECT
    		P.PackageID,
    		dbo.GetPackageAllocatedQuota(P.PackageID, 52) AS QuotaValue, -- diskspace
    		ROUND(CONVERT(float, SUM(ISNULL(PD.DiskSpace, 0))) / 1024 / 1024, 0) AS Diskspace -- in megabytes
    	FROM Packages AS P
    	INNER JOIN PackagesTreeCache AS PT ON P.PackageID = PT.ParentPackageID
    	INNER JOIN Packages AS PC ON PT.PackageID = PC.PackageID
    	INNER JOIN PackagesDiskspace AS PD ON PT.PackageID = PD.PackageID
    	INNER JOIN HostingPlanResources AS HPR ON PD.GroupID = HPR.GroupID
    		AND HPR.PlanID = PC.PlanID
    	WHERE HPR.CalculateDiskspace = 1
    	GROUP BY P.PackageID
    ) AS PD ON P.PackageID = PD.PackageID
    WHERE (@PackageID = -1 AND P.UserID = @UserID) OR
    	(@PackageID <> -1 AND P.ParentPackageID = @PackageID)
    '

    IF @SortColumn = '' OR @SortColumn IS NULL
    SET @SortColumn = 'UsagePercentage DESC'

    SET @sql = @sql + ' ORDER BY ' + @SortColumn + ' '

    SET @sql = @sql + '
    SELECT COUNT(PackageID) FROM @Report

    SELECT
    	R.PackageID,
    	ISNULL(R.QuotaValue, 0) AS QuotaValue,
    	ISNULL(R.Diskspace, 0) AS Diskspace,
    	ISNULL(R.UsagePercentage, 0) AS UsagePercentage,

    	-- package
    	P.PackageName,
    	ISNULL(R.PackagesNumber, 0) AS PackagesNumber,
    	P.StatusID,

    	-- user
    	P.UserID,
    	U.Username,
    	U.FirstName,
    	U.LastName,
    	U.FullName,
    	U.RoleID,
    	U.Email,
    	dbo.GetItemComments(U.UserID, ''USER'', @ActorID) AS UserComments
    FROM @Report AS R
    INNER JOIN Packages AS P ON R.PackageID = P.PackageID
    INNER JOIN UsersDetailed AS U ON P.UserID = U.UserID
    WHERE R.ItemPosition BETWEEN @StartRow AND @EndRow
    '

    exec sp_executesql @sql, N'@ActorID int, @UserID int, @PackageID int, @StartRow int, @MaximumRows int',
    @ActorID, @UserID, @PackageID, @StartRow, @MaximumRows

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE GetPackageServiceID
    (
    	@ActorID int,
    	@PackageID int,
    	@GroupName nvarchar(100),
    	@UpdatePackage bit,
    	@ServiceID int OUTPUT
    )
    AS
    BEGIN

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    SET @ServiceID = 0

    -- optimized run when we don't need any changes
    IF @UpdatePackage = 0
    BEGIN
    SELECT
    	@ServiceID = PS.ServiceID
    FROM PackageServices AS PS
    INNER JOIN Services AS S ON PS.ServiceID = S.ServiceID
    INNER JOIN Providers AS P ON S.ProviderID = P.ProviderID
    INNER JOIN ResourceGroups AS RG ON RG.GroupID = P.GroupID
    WHERE PS.PackageID = @PackageID AND RG.GroupName = @GroupName
    RETURN
    END

    -- load group info
    DECLARE @GroupID int
    SELECT @GroupID = GroupID FROM ResourceGroups
    WHERE GroupName = @GroupName

    -- check if user has this resource enabled
    IF dbo.GetPackageAllocatedResource(@PackageID, @GroupID, NULL) = 0
    BEGIN
    	-- remove all resource services from the space
    	DELETE FROM PackageServices FROM PackageServices AS PS
    	INNER JOIN Services AS S ON PS.ServiceID = S.ServiceID
    	INNER JOIN Providers AS P ON S.ProviderID = P.ProviderID
    	WHERE P.GroupID = @GroupID AND PS.PackageID = @PackageID
    	RETURN
    END

    -- check if the service is already distributed
    SELECT
    	@ServiceID = PS.ServiceID
    FROM PackageServices AS PS
    INNER JOIN Services AS S ON PS.ServiceID = S.ServiceID
    INNER JOIN Providers AS P ON S.ProviderID = P.ProviderID
    WHERE PS.PackageID = @PackageID AND P.GroupID = @GroupID

    IF @ServiceID <> 0
    RETURN

    -- distribute services
    EXEC DistributePackageServices @ActorID, @PackageID

    -- get distributed service again
    SELECT
    	@ServiceID = PS.ServiceID
    FROM PackageServices AS PS
    INNER JOIN Services AS S ON PS.ServiceID = S.ServiceID
    INNER JOIN Providers AS P ON S.ProviderID = P.ProviderID
    WHERE PS.PackageID = @PackageID AND P.GroupID = @GroupID

    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetPackageSettings]
    (
    	@ActorID int,
    	@PackageID int,
    	@SettingsName nvarchar(50)
    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    DECLARE @ParentPackageID int, @TmpPackageID int
    SET @TmpPackageID = @PackageID

    WHILE 10 = 10
    BEGIN
    	IF @TmpPackageID < 2 -- system package
    	BEGIN
    		SELECT
    			@TmpPackageID AS PackageID,
    			'Dump' AS PropertyName,
    			'' AS PropertyValue
    	END
    	ELSE
    	BEGIN
    		-- user package
    		IF EXISTS
    		(
    			SELECT PropertyName FROM PackageSettings
    			WHERE SettingsName = @SettingsName AND PackageID = @TmpPackageID
    		)
    		BEGIN
    			SELECT
    				PackageID,
    				PropertyName,
    				PropertyValue
    			FROM
    				PackageSettings
    			WHERE
    				PackageID = @TmpPackageID AND
    				SettingsName = @SettingsName

    			BREAK
    		END
    	END

    	SET @ParentPackageID = NULL --reset var

    	-- get owner
    	SELECT
    		@ParentPackageID = ParentPackageID
    	FROM Packages
    	WHERE PackageID = @TmpPackageID

    	IF @ParentPackageID IS NULL -- the last parent
    	BREAK

    	SET @TmpPackageID = @ParentPackageID
    END

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetPackagesPaged]
    (
    	@ActorID int,
    	@UserID int,
    	@FilterColumn nvarchar(50) = '',
    	@FilterValue nvarchar(50) = '',
    	@SortColumn nvarchar(50),
    	@StartRow int,
    	@MaximumRows int
    )
    AS

    -- build query and run it to the temporary table
    DECLARE @sql nvarchar(2000)

    SET @sql = '
    DECLARE @HasUserRights bit
    SET @HasUserRights = dbo.CheckActorUserRights(@ActorID, @UserID)

    DECLARE @EndRow int
    SET @EndRow = @StartRow + @MaximumRows
    DECLARE @Packages TABLE
    (
    	ItemPosition int IDENTITY(1,1),
    	PackageID int
    )
    INSERT INTO @Packages (PackageID)
    SELECT
    	P.PackageID
    FROM Packages AS P
    --INNER JOIN UsersTree(@UserID, 1) AS UT ON P.UserID = UT.UserID
    INNER JOIN UsersDetailed AS U ON P.UserID = U.UserID
    INNER JOIN Servers AS S ON P.ServerID = S.ServerID
    INNER JOIN HostingPlans AS HP ON P.PlanID = HP.PlanID
    WHERE
    	P.UserID <> @UserID AND dbo.CheckUserParent(@UserID, P.UserID) = 1
    	AND @HasUserRights = 1 '

    IF @FilterColumn <> '' AND @FilterValue <> ''
    SET @sql = @sql + ' AND ' + @FilterColumn + ' LIKE @FilterValue '

    IF @SortColumn <> '' AND @SortColumn IS NOT NULL
    SET @sql = @sql + ' ORDER BY ' + @SortColumn + ' '

    SET @sql = @sql + ' SELECT COUNT(PackageID) FROM @Packages;
    SELECT
    	P.PackageID,
    	P.PackageName,
    	P.StatusID,
    	P.PurchaseDate,

    	dbo.GetItemComments(P.PackageID, ''PACKAGE'', @ActorID) AS Comments,

    	-- server
    	P.ServerID,
    	ISNULL(S.ServerName, ''None'') AS ServerName,
    	ISNULL(S.Comments, '''') AS ServerComments,
    	ISNULL(S.VirtualServer, 1) AS VirtualServer,

    	-- hosting plan
    	P.PlanID,
    	HP.PlanName,

    	-- user
    	P.UserID,
    	U.Username,
    	U.FirstName,
    	U.LastName,
    	U.FullName,
    	U.RoleID,
    	U.Email
    FROM @Packages AS TP
    INNER JOIN Packages AS P ON TP.PackageID = P.PackageID
    INNER JOIN UsersDetailed AS U ON P.UserID = U.UserID
    INNER JOIN Servers AS S ON P.ServerID = S.ServerID
    INNER JOIN HostingPlans AS HP ON P.PlanID = HP.PlanID
    WHERE TP.ItemPosition BETWEEN @StartRow AND @EndRow'

    exec sp_executesql @sql, N'@StartRow int, @MaximumRows int, @UserID int, @FilterValue nvarchar(50), @ActorID int',
    @StartRow, @MaximumRows, @UserID, @FilterValue, @ActorID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetPackageUnassignedIPAddresses]
    (
     @ActorID int,
     @PackageID int,
     @OrgID int,
     @PoolID int = 0
    )
    AS
    BEGIN
     SELECT
      PIP.PackageAddressID,
      IP.AddressID,
      IP.ExternalIP,
      IP.InternalIP,
      IP.ServerID,
      IP.PoolID,
      PIP.IsPrimary,
      IP.SubnetMask,
      IP.DefaultGateway,
      IP.VLAN
     FROM PackageIPAddresses AS PIP
     INNER JOIN IPAddresses AS IP ON PIP.AddressID = IP.AddressID
     WHERE
      PIP.ItemID IS NULL
      AND PIP.PackageID = @PackageID
      AND (@PoolID = 0 OR @PoolID <> 0 AND IP.PoolID = @PoolID)
      AND (@OrgID = 0 OR @OrgID <> 0 AND PIP.OrgID = @OrgID)
      AND dbo.CheckActorPackageRights(@ActorID, PIP.PackageID) = 1
     ORDER BY IP.DefaultGateway, IP.ExternalIP
    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetParentPackageQuotas]
    (
    	@ActorID int,
    	@PackageID int
    )
    AS

    -- check rights
    IF dbo.CheckActorParentPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    DECLARE @PlanID int, @ParentPackageID int
    SELECT @PlanID = PlanID, @ParentPackageID = ParentPackageID FROM Packages
    WHERE PackageID = @PackageID

    -- get resource groups
    SELECT
    	RG.GroupID,
    	RG.GroupName,
    	ISNULL(HPR.CalculateDiskSpace, 0) AS CalculateDiskSpace,
    	ISNULL(HPR.CalculateBandwidth, 0) AS CalculateBandwidth,
    	--dbo.GetPackageAllocatedResource(@ParentPackageID, RG.GroupID, 0) AS ParentEnabled
    	CASE
    		WHEN RG.GroupName = 'Service Levels' THEN dbo.GetPackageServiceLevelResource(@ParentPackageID, RG.GroupID, 0)
    		ELSE dbo.GetPackageAllocatedResource(@ParentPackageID, RG.GroupID, 0)
    	END AS ParentEnabled
    FROM ResourceGroups AS RG
    LEFT OUTER JOIN HostingPlanResources AS HPR ON RG.GroupID = HPR.GroupID AND HPR.PlanID = @PlanID
    --WHERE dbo.GetPackageAllocatedResource(@PackageID, RG.GroupID, 0) = 1
    WHERE (dbo.GetPackageAllocatedResource(@PackageID, RG.GroupID, 0) = 1 AND RG.GroupName <> 'Service Levels') OR
    	  (dbo.GetPackageServiceLevelResource(@PackageID, RG.GroupID, 0) = 1 AND RG.GroupName = 'Service Levels')
    ORDER BY RG.GroupOrder

    -- return quotas
    DECLARE @OrgsCount INT
    SET @OrgsCount = dbo.GetPackageAllocatedQuota(@PackageID, 205) -- 205 - HostedSolution.Organizations
    SET @OrgsCount = CASE WHEN ISNULL(@OrgsCount, 0) < 1 THEN 1 ELSE @OrgsCount END

    SELECT
    	Q.QuotaID,
    	Q.GroupID,
    	Q.QuotaName,
    	Q.QuotaDescription,
    	Q.QuotaTypeID,
    	QuotaValue = CASE WHEN Q.PerOrganization = 1 AND dbo.GetPackageAllocatedQuota(@PackageID, Q.QuotaID) <> -1 THEN 
    					dbo.GetPackageAllocatedQuota(@PackageID, Q.QuotaID) * @OrgsCount 
    				 ELSE 
    					dbo.GetPackageAllocatedQuota(@PackageID, Q.QuotaID) 
    				 END,
    	QuotaValuePerOrganization = dbo.GetPackageAllocatedQuota(@PackageID, Q.QuotaID),
    	dbo.GetPackageAllocatedQuota(@ParentPackageID, Q.QuotaID) AS ParentQuotaValue,
    	ISNULL(dbo.CalculateQuotaUsage(@PackageID, Q.QuotaID), 0) AS QuotaUsedValue,
    	Q.PerOrganization
    FROM Quotas AS Q
    WHERE Q.HideQuota IS NULL OR Q.HideQuota = 0
    ORDER BY Q.QuotaOrder

    RETURN

    GOSSL
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetPendingSSLForWebsite]
    (
    	@ActorID int,
    	@PackageID int,
    	@websiteid int,
    	@Recursive bit = 1
    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    BEGIN
    	RAISERROR('You are not allowed to access this package', 16, 1)
    	RETURN
    END

    SELECT
    	[ID], [UserID], [SiteID], [Hostname], [CSR], [Certificate], [Hash], [Installed]
    FROM
    	[dbo].[SSLCertificates]
    WHERE
    	@websiteid = [SiteID] AND [Installed] = 0 AND [IsRenewal] = 0 -- bugfix Simon Egli, 27.6.2024

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetPrivateNetworVLAN]
    (
     @VlanID int
    )
    AS
    BEGIN
     -- select
     SELECT
      VlanID,
      Vlan,
      ServerID,
      Comments
     FROM PrivateNetworkVLANs
     WHERE
      VlanID = @VlanID
     RETURN
    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetPrivateNetworVLANsPaged]
    (
     @ActorID int,
     @ServerID int,
     @FilterColumn nvarchar(50) = '',
     @FilterValue nvarchar(50) = '',
     @SortColumn nvarchar(50),
     @StartRow int,
     @MaximumRows int
    )
    AS
    BEGIN

    -- check rights
    DECLARE @IsAdmin bit
    SET @IsAdmin = dbo.CheckIsUserAdmin(@ActorID)

    -- start
    DECLARE @condition nvarchar(700)
    SET @condition = '
    @IsAdmin = 1
    AND (@ServerID = 0 OR @ServerID <> 0 AND V.ServerID = @ServerID)
    '

    IF @FilterValue <> '' AND @FilterValue IS NOT NULL
    BEGIN
     IF @FilterColumn <> '' AND @FilterColumn IS NOT NULL
      SET @condition = @condition + ' AND ' + @FilterColumn + ' LIKE ''' + @FilterValue + ''''
     ELSE
      SET @condition = @condition + '
       AND (Vlan LIKE ''' + @FilterValue + '''
       OR ServerName LIKE ''' + @FilterValue + '''
       OR Username LIKE ''' + @FilterValue + ''')'
    END

    IF @SortColumn IS NULL OR @SortColumn = ''
    SET @SortColumn = 'V.Vlan ASC'

    DECLARE @sql nvarchar(3500)

    set @sql = '
    SELECT COUNT(V.VlanID)
    FROM dbo.PrivateNetworkVLANs AS V
    LEFT JOIN Servers AS S ON V.ServerID = S.ServerID
    LEFT JOIN PackageVLANs AS PA ON V.VlanID = PA.VlanID
    LEFT JOIN dbo.Packages P ON PA.PackageID = P.PackageID
    LEFT JOIN dbo.Users U ON P.UserID = U.UserID
    WHERE ' + @condition + '

    DECLARE @VLANs AS TABLE
    (
     VlanID int
    );

    WITH TempItems AS (
     SELECT ROW_NUMBER() OVER (ORDER BY ' + @SortColumn + ') as Row,
      V.VlanID
     FROM dbo.PrivateNetworkVLANs AS V
     LEFT JOIN Servers AS S ON V.ServerID = S.ServerID
     LEFT JOIN PackageVLANs AS PA ON V.VlanID = PA.VlanID
     LEFT JOIN dbo.Packages P ON PA.PackageID = P.PackageID
     LEFT JOIN dbo.Users U ON U.UserID = P.UserID
     WHERE ' + @condition + '
    )

    INSERT INTO @VLANs
    SELECT VlanID FROM TempItems
    WHERE TempItems.Row BETWEEN @StartRow + 1 and @StartRow + @MaximumRows

    SELECT
     V.VlanID,
     V.Vlan,
     V.Comments,
     V.ServerID,
     S.ServerName,
     PA.PackageID,
     P.PackageName,
     P.UserID,
     U.UserName
    FROM @VLANs AS TA
    INNER JOIN dbo.PrivateNetworkVLANs AS V ON TA.VlanID = V.VlanID
    LEFT JOIN Servers AS S ON V.ServerID = S.ServerID
    LEFT JOIN PackageVLANs AS PA ON V.VlanID = PA.VlanID
    LEFT JOIN dbo.Packages P ON PA.PackageID = P.PackageID
    LEFT JOIN dbo.Users U ON U.UserID = P.UserID
    '

    exec sp_executesql @sql, N'@IsAdmin bit, @ServerID int, @StartRow int, @MaximumRows int',
    @IsAdmin, @ServerID, @StartRow, @MaximumRows

    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetProcessBackgroundTasks]
    (	
    	@Status INT
    )
    AS

    SELECT
    	T.ID,
    	T.TaskID,
    	T.ScheduleId,
    	T.PackageId,
    	T.UserId,
    	T.EffectiveUserId,
    	T.TaskName,
    	T.ItemId,
    	T.ItemName,
    	T.StartDate,
    	T.FinishDate,
    	T.IndicatorCurrent,
    	T.IndicatorMaximum,
    	T.MaximumExecutionTime,
    	T.Source,
    	T.Severity,
    	T.Completed,
    	T.NotifyOnComplete,
    	T.Status
    FROM BackgroundTasks AS T
    WHERE T.Completed = 0 AND T.Status = @Status
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetProvider]
    (
    	@ProviderID int
    )
    AS
    SELECT
    	ProviderID,
    	GroupID,
    	ProviderName,
    	EditorControl,
    	DisplayName,
    	ProviderType
    FROM Providers
    WHERE
    	ProviderID = @ProviderID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetProviderByServiceID]
    (
    	@ServiceID int
    )
    AS
    SELECT
    	P.ProviderID,
    	P.GroupID,
    	P.DisplayName,
    	P.EditorControl,
    	P.ProviderType
    FROM Services AS S
    INNER JOIN Providers AS P ON S.ProviderID = P.ProviderID
    WHERE
    	S.ServiceID = @ServiceID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetProviders]
    AS
    SELECT
    	PROV.ProviderID,
    	PROV.GroupID,
    	PROV.ProviderName,
    	PROV.EditorControl,
    	PROV.DisplayName,
    	PROV.ProviderType,
    	RG.GroupName + ' - ' + PROV.DisplayName AS ProviderName,
    	PROV.DisableAutoDiscovery
    FROM Providers AS PROV
    INNER JOIN ResourceGroups AS RG ON PROV.GroupID = RG.GroupID
    ORDER BY RG.GroupOrder, PROV.DisplayName
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetProviderServiceQuota]
    (
    	@ProviderID int
    )
    AS

    SELECT TOP 1
    	Q.QuotaID,
    	Q.GroupID,
    	Q.QuotaName,
    	Q.QuotaDescription,
    	Q.QuotaTypeID,
    	Q.ServiceQuota
    FROM Providers AS P
    INNER JOIN Quotas AS Q ON P.GroupID = Q.GroupID
    WHERE P.ProviderID = @ProviderID AND Q.ServiceQuota = 1

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetQuotas]
    AS
    SELECT
    	Q.GroupID,
    	Q.QuotaID,
    	RG.GroupName,
    	Q.QuotaDescription,
    	Q.QuotaTypeID
    FROM Quotas AS Q
    INNER JOIN ResourceGroups AS RG ON Q.GroupID = RG.GroupID
    ORDER BY RG.GroupOrder, Q.QuotaOrder
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetRawServicesByServerID]
    (
    	@ActorID int,
    	@ServerID int
    )
    AS

    -- check rights
    DECLARE @IsAdmin bit
    SET @IsAdmin = dbo.CheckIsUserAdmin(@ActorID)

    -- resource groups
    SELECT
    	GroupID,
    	GroupName
    FROM ResourceGroups
    WHERE @IsAdmin = 1 AND (ShowGroup = 1)
    ORDER BY GroupOrder

    -- services
    SELECT
    	S.ServiceID,
    	S.ServerID,
    	S.ServiceName,
    	S.Comments,
    	RG.GroupID,
    	PROV.DisplayName AS ProviderName
    FROM Services AS S
    INNER JOIN Providers AS PROV ON S.ProviderID = PROV.ProviderID
    INNER JOIN ResourceGroups AS RG ON PROV.GroupID = RG.GroupID
    WHERE
    	S.ServerID = @ServerID
    	AND @IsAdmin = 1
    ORDER BY RG.GroupOrder

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetRDSCertificateByServiceId]
    (
    	@ServiceId INT
    )
    AS
    SELECT TOP 1
    	Id,
    	ServiceId,
    	Content, 
    	Hash,
    	FileName,
    	ValidFrom,
    	ExpiryDate
    	FROM RDSCertificates
    	WHERE ServiceId = @ServiceId
    	ORDER BY Id DESC
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetRDSCollectionById]
    (
    	@ID INT
    )
    AS

    SELECT TOP 1
    	Id,
    	ItemId,
    	Name, 
    	Description,
    	DisplayName 
    	FROM RDSCollections
    	WHERE ID = @ID
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetRDSCollectionByName]
    (
    	@Name NVARCHAR(255)
    )
    AS

    SELECT TOP 1
    	Id,
    	Name, 
    	ItemId,
    	Description,
    	DisplayName
    	FROM RDSCollections
    	WHERE DisplayName = @Name
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetRDSCollectionsByItemId]
    (
    	@ItemID INT
    )
    AS
    SELECT 
    	Id,
    	ItemId,
    	Name, 
    	Description,
    	DisplayName
    	FROM RDSCollections
    	WHERE ItemID = @ItemID
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetRDSCollectionSettingsByCollectionId]
    (
    	@RDSCollectionID INT
    )
    AS

    SELECT TOP 1
    	Id,
    	RDSCollectionId,
    	DisconnectedSessionLimitMin, 
    	ActiveSessionLimitMin,
    	IdleSessionLimitMin,
    	BrokenConnectionAction,
    	AutomaticReconnectionEnabled,
    	TemporaryFoldersDeletedOnExit,
    	TemporaryFoldersPerSession,
    	ClientDeviceRedirectionOptions,
    	ClientPrinterRedirected,
    	ClientPrinterAsDefault,
    	RDEasyPrintDriverEnabled,
    	MaxRedirectedMonitors,
    	SecurityLayer,
    	EncryptionLevel,
    	AuthenticateUsingNLA

    	FROM RDSCollectionSettings
    	WHERE RDSCollectionID = @RDSCollectionID
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetRDSCollectionsPaged]
    (
    	@FilterColumn nvarchar(50) = '',
    	@FilterValue nvarchar(50) = '',
    	@ItemID int,
    	@SortColumn nvarchar(50),
    	@StartRow int,
    	@MaximumRows int
    )
    AS
    -- build query and run it to the temporary table
    DECLARE @sql nvarchar(2000)

    SET @sql = '

    DECLARE @EndRow int
    SET @EndRow = @StartRow + @MaximumRows
    DECLARE @RDSCollections TABLE
    (
    	ItemPosition int IDENTITY(0,1),
    	RDSCollectionId int
    )
    INSERT INTO @RDSCollections (RDSCollectionId)
    SELECT
    	S.ID
    FROM RDSCollections AS S
    WHERE 
    	((@ItemID is Null AND S.ItemID is null)
    		or (@ItemID is not Null AND S.ItemID = @ItemID))'

    IF @FilterColumn <> '' AND @FilterValue <> ''
    SET @sql = @sql + ' AND ' + @FilterColumn + ' LIKE ''%' + @FilterValue + '%'' '

    IF @SortColumn <> '' AND @SortColumn IS NOT NULL
    SET @sql = @sql + ' ORDER BY ' + @SortColumn + ' '

    SET @sql = @sql + ' SELECT COUNT(RDSCollectionId) FROM @RDSCollections;
    SELECT
    	CR.ID,
    	CR.ItemID,
    	CR.Name,
    	CR.Description,
    	CR.DisplayName
    FROM @RDSCollections AS C
    INNER JOIN RDSCollections AS CR ON C.RDSCollectionId = CR.ID
    WHERE C.ItemPosition BETWEEN @StartRow AND @EndRow'

    exec sp_executesql @sql, N'@StartRow int, @MaximumRows int,  @FilterValue nvarchar(50),  @ItemID int',
    @StartRow, @MaximumRows,  @FilterValue,  @ItemID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetRDSCollectionUsersByRDSCollectionId]
    (
    	@ID INT
    )
    AS
    SELECT 
    	  [AccountID],
    	  [ItemID],
    	  [AccountType],
    	  [AccountName],
    	  [DisplayName],
    	  [PrimaryEmailAddress],
    	  [MailEnabledPublicFolder],
    	  [MailboxManagerActions],
    	  [SamAccountName],
    	  [CreatedDate],
    	  [MailboxPlanId],
    	  [SubscriberNumber],
    	  [UserPrincipalName],
    	  [ExchangeDisclaimerId],
    	  [ArchivingMailboxPlanId],
    	  [EnableArchiving],
    	  [LevelID],
    	  [IsVIP]
    	FROM ExchangeAccounts
    	WHERE AccountID IN (Select AccountId from RDSCollectionUsers where RDSCollectionId = @Id)
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetRDSControllerServiceIDbyFQDN]
    (
    	@RdsfqdnName NVARCHAR(255),
    	@Controller int OUTPUT
    )
    AS

    SELECT @Controller = Controller
    	FROM RDSServers
    	WHERE FqdName = @RdsfqdnName

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetRDSMessages]
    (
    	@RDSCollectionId INT
    )
    AS
    SELECT Id, RDSCollectionId, MessageText, UserName, [Date] FROM [dbo].[RDSMessages] WHERE RDSCollectionId = @RDSCollectionId
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetRDSServerById]
    (
    	@ID INT
    )
    AS
    SELECT TOP 1
    	RS.Id,
    	RS.ItemID,
    	RS.Name, 
    	RS.FqdName,
    	RS.Description,
    	RS.RdsCollectionId,
    	RS.ConnectionEnabled,
    	SI.ItemName,
    	RC.Name AS "CollectionName"
    	FROM RDSServers AS RS
    	LEFT OUTER JOIN  ServiceItems AS SI ON SI.ItemId = RS.ItemId
    	LEFT OUTER JOIN  RDSCollections AS RC ON RC.ID = RdsCollectionId
    	WHERE RS.Id = @Id

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetRDSServers]
    AS
    SELECT 
    	RS.Id,
    	RS.ItemID,
    	RS.Name, 
    	RS.FqdName,
    	RS.Description,
    	RS.RdsCollectionId,
    	SI.ItemName
    	FROM RDSServers AS RS
    	LEFT OUTER JOIN  ServiceItems AS SI ON SI.ItemId = RS.ItemId
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetRDSServersByCollectionId]
    (
    	@RdsCollectionId INT
    )
    AS
    SELECT 
    	RS.Id,
    	RS.ItemID,
    	RS.Name, 
    	RS.FqdName,
    	RS.Description,
    	RS.RdsCollectionId,
    	SI.ItemName
    	FROM RDSServers AS RS
    	LEFT OUTER JOIN  ServiceItems AS SI ON SI.ItemId = RS.ItemId
    	WHERE RdsCollectionId = @RdsCollectionId
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetRDSServersByItemId]
    (
    	@ItemID INT
    )
    AS
    SELECT 
    	RS.Id,
    	RS.ItemID,
    	RS.Name, 
    	RS.FqdName,
    	RS.Description,
    	RS.RdsCollectionId,
    	SI.ItemName
    	FROM RDSServers AS RS
    	LEFT OUTER JOIN  ServiceItems AS SI ON SI.ItemId = RS.ItemId
    	WHERE RS.ItemID = @ItemID
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetRDSServerSettings]
    (
    	@ServerId int,
    	@SettingsName nvarchar(50)
    )
    AS
    	SELECT RDSServerId, PropertyName, PropertyValue, ApplyUsers, ApplyAdministrators
    	FROM RDSServerSettings
    	WHERE RDSServerId = @ServerId AND SettingsName = @SettingsName			
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetRDSServersPaged]
    (
    	@FilterColumn nvarchar(50) = '',
    	@FilterValue nvarchar(50) = '',
    	@ItemID int,
    	@IgnoreItemId bit,
    	@RdsCollectionId int,
    	@IgnoreRdsCollectionId bit,
    	@SortColumn nvarchar(50),
    	@StartRow int,
    	@MaximumRows int,
    	@Controller int,
    	@ControllerName nvarchar(50) = ''
    )
    AS
    -- build query and run it to the temporary table
    DECLARE @sql nvarchar(2000)

    SET @sql = '

    DECLARE @EndRow int
    SET @EndRow = @StartRow + @MaximumRows

    DECLARE @RDSServer TABLE
    (
    	ItemPosition int IDENTITY(0,1),
    	RDSServerId int
    )
    INSERT INTO @RDSServer (RDSServerId)
    SELECT
    	S.ID
    FROM RDSServers AS S
    LEFT OUTER JOIN  ServiceItems AS SI ON SI.ItemId = S.ItemId
    LEFT OUTER JOIN  Services AS SE ON SE.ServiceID = S.Controller
    LEFT OUTER JOIN  RDSCollections AS RC ON RC.ID = S.RdsCollectionId
    WHERE 
    	((((@ItemID is Null AND S.ItemID is null ) or (@IgnoreItemId = 1 ))
    		or (@ItemID is not Null AND S.ItemID = @ItemID ))
    	and
    	(((@RdsCollectionId is Null AND S.RDSCollectionId is null) or @IgnoreRdsCollectionId = 1)
    		or (@RdsCollectionId is not Null AND S.RDSCollectionId = @RdsCollectionId)))'

    IF @FilterColumn <> '' AND @FilterValue <> ''
    SET @sql = @sql + ' AND ' + @FilterColumn + ' LIKE ''%' + @FilterValue + '%'''

    IF @Controller <> ''
    SET @sql = @sql + ' AND Controller = @Controller '

    IF @SortColumn <> '' AND @SortColumn IS NOT NULL
    SET @sql = @sql + ' ORDER BY ' + @SortColumn + ' '

    SET @sql = @sql + ' SELECT COUNT(RDSServerId) FROM @RDSServer;
    SELECT
    	ST.ID,
    	ST.ItemID,
    	ST.Name, 
    	ST.FqdName,
    	ST.Description,
    	ST.RdsCollectionId,
    	SI.ItemName,
    	ST.ConnectionEnabled,
    	ST.Controller,
    	SE.ServiceName as ControllerName,
    	RC.Name as CollectionName
    FROM @RDSServer AS S
    INNER JOIN RDSServers AS ST ON S.RDSServerId = ST.ID
    LEFT OUTER JOIN  ServiceItems AS SI ON SI.ItemId = ST.ItemId
    LEFT OUTER JOIN  Services AS SE ON SE.ServiceID = ST.Controller
    LEFT OUTER JOIN  RDSCollections AS RC ON RC.ID = ST.RdsCollectionId
    WHERE S.ItemPosition BETWEEN @StartRow AND @EndRow'

    exec sp_executesql @sql, N'@StartRow int, @MaximumRows int,  @FilterValue nvarchar(50),  @ItemID int, @RdsCollectionId int, @IgnoreItemId bit, @IgnoreRdsCollectionId bit, @Controller int, @ControllerName nvarchar(50)',
    @StartRow, @MaximumRows,  @FilterValue,  @ItemID, @RdsCollectionId, @IgnoreItemId , @IgnoreRdsCollectionId, @Controller, @ControllerName

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetResellerDomains]
    (
    	@ActorID int,
    	@PackageID int
    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    -- load parent package
    DECLARE @ParentPackageID int
    SELECT @ParentPackageID = ParentPackageID FROM Packages
    WHERE PackageID = @PackageID

    SELECT
    	D.DomainID,
    	D.PackageID,
    	D.ZoneItemID,
    	D.DomainName,
    	D.HostingAllowed,
    	D.WebSiteID,
    	WS.ItemName,
    	D.MailDomainID,
    	MD.ItemName
    FROM Domains AS D
    INNER JOIN PackagesTree(@ParentPackageID, 0) AS PT ON D.PackageID = PT.PackageID
    LEFT OUTER JOIN ServiceItems AS WS ON D.WebSiteID = WS.ItemID
    LEFT OUTER JOIN ServiceItems AS MD ON D.MailDomainID = MD.ItemID
    WHERE HostingAllowed = 1
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetResourceGroup]
    (
    	@GroupID int
    )
    AS
    SELECT
    	RG.GroupID,
    	RG.GroupOrder,
    	RG.GroupName,
    	RG.GroupController
    FROM ResourceGroups AS RG
    WHERE RG.GroupID = @GroupID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetResourceGroupByName]
    (
    	@GroupName nvarchar(100)
    )
    AS
    SELECT
    	RG.GroupID,
    	RG.GroupOrder,
    	RG.GroupName,
    	RG.GroupController
    FROM ResourceGroups AS RG
    WHERE RG.GroupName = @GroupName

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetResourceGroups]
    AS
    SELECT
    	GroupID,
    	GroupName,
    	GroupController
    FROM ResourceGroups
    ORDER BY GroupOrder
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetSchedule]
    (
    	@ActorID int,
    	@ScheduleID int
    )
    AS

    -- select schedule
    SELECT TOP 1
    	S.ScheduleID,
    	S.TaskID,
    	S.PackageID,
    	S.ScheduleName,
    	S.ScheduleTypeID,
    	S.Interval,
    	S.FromTime,
    	S.ToTime,
    	S.StartTime,
    	S.LastRun,
    	S.NextRun,
    	S.Enabled,
    	S.HistoriesNumber,
    	S.PriorityID,
    	S.MaxExecutionTime,
    	S.WeekMonthDay,
    	1 AS StatusID
    FROM Schedule AS S
    WHERE
    	S.ScheduleID = @ScheduleID
    	AND dbo.CheckActorPackageRights(@ActorID, S.PackageID) = 1

    -- select task
    SELECT
    	ST.TaskID,
    	ST.TaskType,
    	ST.RoleID
    FROM Schedule AS S
    INNER JOIN ScheduleTasks AS ST ON S.TaskID = ST.TaskID
    WHERE
    	S.ScheduleID = @ScheduleID
    	AND dbo.CheckActorPackageRights(@ActorID, S.PackageID) = 1

    -- select schedule parameters
    SELECT
    	S.ScheduleID,
    	STP.ParameterID,
    	STP.DataTypeID,
    	ISNULL(SP.ParameterValue, STP.DefaultValue) AS ParameterValue
    FROM Schedule AS S
    INNER JOIN ScheduleTaskParameters AS STP ON S.TaskID = STP.TaskID
    LEFT OUTER JOIN ScheduleParameters AS SP ON STP.ParameterID = SP.ParameterID AND SP.ScheduleID = S.ScheduleID
    WHERE
    	S.ScheduleID = @ScheduleID
    	AND dbo.CheckActorPackageRights(@ActorID, S.PackageID) = 1

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetScheduleBackgroundTasks]
    (
    	@ScheduleID INT
    )
    AS

    SELECT
    	T.ID,
    	T.Guid,
    	T.TaskID,
    	T.ScheduleId,
    	T.PackageId,
    	T.UserId,
    	T.EffectiveUserId,
    	T.TaskName,
    	T.ItemId,
    	T.ItemName,
    	T.StartDate,
    	T.FinishDate,
    	T.IndicatorCurrent,
    	T.IndicatorMaximum,
    	T.MaximumExecutionTime,
    	T.Source,
    	T.Severity,
    	T.Completed,
    	T.NotifyOnComplete,
    	T.Status
    FROM BackgroundTasks AS T
    WHERE T.Guid = (
    	SELECT Guid FROM BackgroundTasks
    	WHERE ScheduleID = @ScheduleID
    		AND Completed = 0 AND Status IN (1, 3))
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetScheduleInternal]
    (
    	@ScheduleID int
    )
    AS

    -- select schedule
    SELECT
    	S.ScheduleID,
    	S.TaskID,
    	ST.TaskType,
    	ST.RoleID,
    	S.PackageID,
    	S.ScheduleName,
    	S.ScheduleTypeID,
    	S.Interval,
    	S.FromTime,
    	S.ToTime,
    	S.StartTime,
    	S.LastRun,
    	S.NextRun,
    	S.Enabled,
    	1 AS StatusID,
    	S.PriorityID,
    	S.HistoriesNumber,
    	S.MaxExecutionTime,
    	S.WeekMonthDay
    FROM Schedule AS S
    INNER JOIN ScheduleTasks AS ST ON S.TaskID = ST.TaskID
    WHERE ScheduleID = @ScheduleID
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetScheduleParameters]
    (
    	@ActorID int,
    	@TaskID nvarchar(100),
    	@ScheduleID int
    )
    AS

    -- check rights
    DECLARE @PackageID int
    SELECT @PackageID = PackageID FROM Schedule
    WHERE ScheduleID = @ScheduleID

    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    SELECT
    	@ScheduleID AS ScheduleID,
    	STP.ParameterID,
    	STP.DataTypeID,
    	SP.ParameterValue,
    	STP.DefaultValue
    FROM ScheduleTaskParameters AS STP
    LEFT OUTER JOIN ScheduleParameters AS SP ON STP.ParameterID = SP.ParameterID AND SP.ScheduleID = @ScheduleID
    WHERE STP.TaskID = @TaskID
    ORDER BY STP.ParameterOrder

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetSchedules]
    (
    	@ActorID int,
    	@PackageID int,
    	@Recursive bit
    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    DECLARE @Schedules TABLE
    (
    	ScheduleID int
    )

    INSERT INTO @Schedules (ScheduleID)
    SELECT
    	S.ScheduleID
    FROM Schedule AS S
    INNER JOIN PackagesTree(@PackageID, @Recursive) AS PT ON S.PackageID = PT.PackageID
    ORDER BY S.Enabled DESC, S.NextRun

    -- select schedules
    SELECT
    	S.ScheduleID,
    	S.TaskID,
    	ST.TaskType,
    	ST.RoleID,
    	S.PackageID,
    	S.ScheduleName,
    	S.ScheduleTypeID,
    	S.Interval,
    	S.FromTime,
    	S.ToTime,
    	S.StartTime,
    	S.LastRun,
    	S.NextRun,
    	S.Enabled,
    	1 AS StatusID,
    	S.PriorityID,
    	S.MaxExecutionTime,
    	S.WeekMonthDay,
    	-- bug ISNULL(0, ...) always is not NULL
    	-- ISNULL(0, (SELECT TOP 1 SeverityID FROM AuditLog WHERE ItemID = S.ScheduleID AND SourceName = ''SCHEDULER'' ORDER BY StartDate DESC)) AS LastResult,
    	ISNULL((SELECT TOP 1 SeverityID FROM AuditLog WHERE ItemID = S.ScheduleID AND SourceName = 'SCHEDULER' ORDER BY StartDate DESC), 0) AS LastResult,

    	U.Username,
    	U.FirstName,
    	U.LastName,
    	U.FullName,
    	U.RoleID,
    	U.Email
    FROM @Schedules AS STEMP
    INNER JOIN Schedule AS S ON STEMP.ScheduleID = S.ScheduleID
    INNER JOIN Packages AS P ON S.PackageID = P.PackageID
    INNER JOIN ScheduleTasks AS ST ON S.TaskID = ST.TaskID
    INNER JOIN UsersDetailed AS U ON P.UserID = U.UserID

    -- select schedule parameters
    SELECT
    	S.ScheduleID,
    	STP.ParameterID,
    	STP.DataTypeID,
    	ISNULL(SP.ParameterValue, STP.DefaultValue) AS ParameterValue
    FROM @Schedules AS STEMP
    INNER JOIN Schedule AS S ON STEMP.ScheduleID = S.ScheduleID
    INNER JOIN ScheduleTaskParameters AS STP ON S.TaskID = STP.TaskID
    LEFT OUTER JOIN ScheduleParameters AS SP ON STP.ParameterID = SP.ParameterID AND SP.ScheduleID = S.ScheduleID
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetSchedulesPaged]
    (
    	@ActorID int,
    	@PackageID int,
    	@Recursive bit,
    	@FilterColumn nvarchar(50) = '',
    	@FilterValue nvarchar(50) = '',
    	@SortColumn nvarchar(50),
    	@StartRow int,
    	@MaximumRows int
    )
    AS
    BEGIN

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    DECLARE @condition nvarchar(400)
    SET @condition = ' 1 = 1 '

    IF @FilterValue <> '' AND @FilterValue IS NOT NULL
    BEGIN
    	IF @FilterColumn <> '' AND @FilterColumn IS NOT NULL
    		SET @condition = @condition + ' AND ' + @FilterColumn + ' LIKE ''' + @FilterValue + ''''
    	ELSE
    		SET @condition = @condition + '
    			AND (ScheduleName LIKE ''' + @FilterValue + '''
    			OR Username LIKE ''' + @FilterValue + '''
    			OR FullName LIKE ''' + @FilterValue + '''
    			OR Email LIKE ''' + @FilterValue + ''')'
    END

    IF @SortColumn IS NULL OR @SortColumn = ''
    SET @SortColumn = 'S.ScheduleName ASC'

    DECLARE @sql nvarchar(3500)

    set @sql = '
    SELECT COUNT(S.ScheduleID) FROM Schedule AS S
    INNER JOIN PackagesTree(@PackageID, @Recursive) AS PT ON S.PackageID = PT.PackageID
    INNER JOIN Packages AS P ON S.PackageID = P.PackageID
    INNER JOIN UsersDetailed AS U ON P.UserID = U.UserID
    WHERE ' + @condition + '

    DECLARE @Schedules AS TABLE
    (
    	ScheduleID int
    );

    WITH TempSchedules AS (
    	SELECT ROW_NUMBER() OVER (ORDER BY ' + @SortColumn + ') as Row,
    		S.ScheduleID
    	FROM Schedule AS S
    	INNER JOIN Packages AS P ON S.PackageID = P.PackageID
    	INNER JOIN PackagesTree(@PackageID, @Recursive) AS PT ON S.PackageID = PT.PackageID
    	INNER JOIN UsersDetailed AS U ON P.UserID = U.UserID
    	WHERE ' + @condition + '
    )

    INSERT INTO @Schedules
    SELECT ScheduleID FROM TempSchedules
    WHERE TempSchedules.Row BETWEEN @StartRow + 1 and @StartRow + @MaximumRows

    SELECT
    	S.ScheduleID,
    	S.TaskID,
    	ST.TaskType,
    	ST.RoleID,
    	S.ScheduleName,
    	S.ScheduleTypeID,
    	S.Interval,
    	S.FromTime,
    	S.ToTime,
    	S.StartTime,
    	S.LastRun,
    	S.NextRun,
    	S.Enabled,
    	1 AS StatusID,
    	S.PriorityID,
    	S.MaxExecutionTime,
    	S.WeekMonthDay,
    	-- bug ISNULL(0, ...) always is not NULL
    	-- ISNULL(0, (SELECT TOP 1 SeverityID FROM AuditLog WHERE ItemID = S.ScheduleID AND SourceName = ''SCHEDULER'' ORDER BY StartDate DESC)) AS LastResult,
    	ISNULL((SELECT TOP 1 SeverityID FROM AuditLog WHERE ItemID = S.ScheduleID AND SourceName = ''SCHEDULER'' ORDER BY StartDate DESC), 0) AS LastResult,

    	-- packages
    	P.PackageID,
    	P.PackageName,

    	-- user
    	P.UserID,
    	U.Username,
    	U.FirstName,
    	U.LastName,
    	U.FullName,
    	U.RoleID,
    	U.Email
    FROM @Schedules AS STEMP
    INNER JOIN Schedule AS S ON STEMP.ScheduleID = S.ScheduleID
    INNER JOIN ScheduleTasks AS ST ON S.TaskID = ST.TaskID
    INNER JOIN Packages AS P ON S.PackageID = P.PackageID
    INNER JOIN UsersDetailed AS U ON P.UserID = U.UserID'

    exec sp_executesql @sql, N'@PackageID int, @StartRow int, @MaximumRows int, @Recursive bit',
    @PackageID, @StartRow, @MaximumRows, @Recursive

    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetScheduleTask]
    (
    	@ActorID int,
    	@TaskID nvarchar(100)
    )
    AS

    -- get user role
    DECLARE @RoleID int
    SELECT @RoleID = RoleID FROM Users
    WHERE UserID = @ActorID

    SELECT
    	TaskID,
    	TaskType,
    	RoleID
    FROM ScheduleTasks
    WHERE
    	TaskID = @TaskID
    	AND @RoleID <= RoleID -- was >= but this seems like a bug, since lower RoleID is more privileged, and in GetScheduleTasks it is also <=.
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetScheduleTaskEmailTemplate]
    (
    	@TaskID [nvarchar](100) 
    )
    AS
    SELECT
    	[TaskID],
    	[From] ,
    	[Subject] ,
    	[Template]
      FROM [dbo].[ScheduleTasksEmailTemplates] where [TaskID] = @TaskID 
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetScheduleTasks]
    (
    	@ActorID int
    )
    AS

    -- get user role
    DECLARE @RoleID int
    SELECT @RoleID = RoleID FROM Users
    WHERE UserID = @ActorID

    SELECT
    	TaskID,
    	TaskType,
    	RoleID
    FROM ScheduleTasks
    WHERE @RoleID <= RoleID
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    /****** Object:  StoredProcedure [dbo].[GetScheduleTaskViewConfigurations]    Script Date: 09/10/2007 17:53:56 ******/

    CREATE PROCEDURE [dbo].[GetScheduleTaskViewConfigurations]
    (
    	@TaskID nvarchar(100)
    )
    AS

    SELECT
    	@TaskID AS TaskID,
    	STVC.ConfigurationID,
    	STVC.Environment,
    	STVC.Description
    FROM ScheduleTaskViewConfiguration AS STVC
    WHERE STVC.TaskID = @TaskID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetSearchableServiceItemTypes]

    AS
    SELECT
    	ItemTypeID,
    	DisplayName
    FROM
    	ServiceItemTypes
    WHERE Searchable = 1
    ORDER BY TypeOrder
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetSearchObject]
    (
    	@ActorID int,
    	@UserID int,
    	@FilterColumn nvarchar(50) = '',
    	@FilterValue nvarchar(50) = '',
    	@StatusID int,
    	@RoleID int,
    	@SortColumn nvarchar(50),
    	@StartRow int,
    	@MaximumRows int = 0,
    	@Recursive bit,
    	@ColType nvarchar(500) = '',
    	@FullType nvarchar(50) = '',
    	@OnlyFind bit
    )
    AS

    IF @ColType IS NULL
    	SET @ColType = ''

    DECLARE @HasUserRights bit
    SET @HasUserRights = dbo.CheckActorUserRights(@ActorID, @UserID)

    IF @HasUserRights = 0
    RAISERROR('You are not allowed to access this account', 16, 1)

    DECLARE @curAll CURSOR
    DECLARE @curUsers CURSOR
    DECLARE @ItemID int
    DECLARE @TextSearch nvarchar(500)
    DECLARE @ColumnType nvarchar(50)
    DECLARE @FullTypeAll nvarchar(50)
    DECLARE @PackageID int
    DECLARE @AccountID int
    DECLARE @Username nvarchar(50)
    DECLARE @Fullname nvarchar(50)
    DECLARE @ItemsAll TABLE
     (
      ItemID int,
      TextSearch nvarchar(500),
      ColumnType nvarchar(50),
      FullType nvarchar(50),
      PackageID int,
      AccountID int,
      Username nvarchar(100),
      Fullname nvarchar(100)
     )
    DECLARE @sql nvarchar(max)

    /*------------------------------------------------Users---------------------------------------------------------------*/
    DECLARE @columnUsername nvarchar(20)  
    SET @columnUsername = 'Username'

    DECLARE @columnEmail nvarchar(20)  
    SET @columnEmail = 'Email'

    DECLARE @columnCompanyName nvarchar(20)  
    SET @columnCompanyName = 'CompanyName'

    DECLARE @columnFullName nvarchar(20)  
    SET @columnFullName = 'FullName'

    IF @FilterColumn = '' AND @FilterValue <> ''
    SET @FilterColumn = 'TextSearch'

    SET @sql = '
    DECLARE @Users TABLE
    (
     ItemPosition int IDENTITY(0,1),
     UserID int,
     Username nvarchar(100),
     Fullname nvarchar(100)
    )
    INSERT INTO @Users (UserID, Username, Fullname)
    SELECT 
     U.UserID,
     U.Username,
     U.FirstName + '' '' + U.LastName as Fullname
    FROM UsersDetailed AS U
    WHERE 
     U.UserID <> @UserID AND U.IsPeer = 0 AND
     (
      (@Recursive = 0 AND OwnerID = @UserID) OR
      (@Recursive = 1 AND dbo.CheckUserParent(@UserID, U.UserID) = 1)
     )
     AND ((@StatusID = 0) OR (@StatusID > 0 AND U.StatusID = @StatusID))
     AND ((@RoleID = 0) OR (@RoleID > 0 AND U.RoleID = @RoleID))
     AND ' + CAST((@HasUserRights) AS varchar(12)) + ' = 1
     SET @curValue = cursor local for
    SELECT '

    IF @OnlyFind = 1
    	SET @sql = @sql + 'TOP ' + CAST(@MaximumRows AS varchar(12)) + ' '

    SET @sql = @sql + 'U.ItemID,
     U.TextSearch,
     U.ColumnType,
     ''AccountHome'' as FullType,
     0 as PackageID,
     0 as AccountID,
     TU.Username,
     TU.Fullname
    FROM @Users AS TU
    INNER JOIN 
    (
    SELECT ItemID, TextSearch, ColumnType
    FROM(
    SELECT U0.UserID as ItemID, U0.Username as TextSearch, @columnUsername as ColumnType
    FROM dbo.Users AS U0
    UNION
    SELECT U1.UserID as ItemID, U1.Email as TextSearch, @columnEmail as ColumnType                      
    FROM dbo.Users AS U1
    UNION
    SELECT U2.UserID as ItemID, U2.CompanyName as TextSearch, @columnCompanyName as ColumnType 
    FROM dbo.Users AS U2
    UNION
    SELECT U3.UserID as ItemID, U3.FirstName + '' '' + U3.LastName as TextSearch, @columnFullName as ColumnType 
    FROM dbo.Users AS U3) as U
    WHERE TextSearch<>'' '' OR ISNULL(TextSearch, 0) > 0
    )
     AS U ON TU.UserID = U.ItemID'
    IF @FilterValue <> ''
     SET @sql = @sql + ' WHERE TextSearch LIKE ''' + @FilterValue + ''''
    SET @sql = @sql + ' ORDER BY TextSearch'

    SET @sql = @sql + ';open @curValue'

    exec sp_executesql @sql, N'@UserID int, @FilterValue nvarchar(50), @Recursive bit, @StatusID int, @RoleID int, @columnUsername nvarchar(20), @columnEmail nvarchar(20), @columnCompanyName nvarchar(20), @columnFullName nvarchar(20), @curValue cursor output',
    @UserID, @FilterValue, @Recursive, @StatusID, @RoleID, @columnUsername, @columnEmail, @columnCompanyName, @columnFullName, @curUsers output

    /*--------------------------------------------Space----------------------------------------------------------*/
    DECLARE @sqlNameAccountType nvarchar(4000)
    SET @sqlNameAccountType = '
    WHEN 1 THEN ''Mailbox''
    WHEN 2 THEN ''Contact''
    WHEN 3 THEN ''DistributionList''
    WHEN 4 THEN ''PublicFolder''
    WHEN 5 THEN ''Room''
    WHEN 6 THEN ''Equipment''
    WHEN 7 THEN ''User''
    WHEN 8 THEN ''SecurityGroup''
    WHEN 9 THEN ''DefaultSecurityGroup''
    WHEN 10 THEN ''SharedMailbox''
    WHEN 11 THEN ''DeletedUser''
    WHEN 12 THEN ''JournalingMailbox''
    '

    SET @sql = '
     DECLARE @ItemsService TABLE
     (
      ItemID int,
      ItemTypeID int,
      Username nvarchar(100),
      Fullname nvarchar(100)
     )
     INSERT INTO @ItemsService (ItemID, ItemTypeID, Username, Fullname)
     SELECT
      SI.ItemID,
      SI.ItemTypeID,
      U.Username,
      U.FirstName + '' '' + U.LastName as Fullname
     FROM ServiceItems AS SI
     INNER JOIN Packages AS P ON P.PackageID = SI.PackageID
     INNER JOIN UsersDetailed AS U ON P.UserID = U.UserID
     WHERE
      dbo.CheckUserParent(@UserID, P.UserID) = 1
     DECLARE @ItemsDomain TABLE
     (
      ItemID int,
      Username nvarchar(100),
      Fullname nvarchar(100)
     )
     INSERT INTO @ItemsDomain (ItemID, Username, Fullname)
     SELECT
      D.DomainID,
      U.Username,
      U.FirstName + '' '' + U.LastName as Fullname
     FROM Domains AS D
     INNER JOIN Packages AS P ON P.PackageID = D.PackageID
     INNER JOIN UsersDetailed AS U ON P.UserID = U.UserID
     WHERE
      dbo.CheckUserParent(@UserID, P.UserID) = 1

     SET @curValue = cursor local for
     SELECT '

    IF @OnlyFind = 1
    SET @sql = @sql + 'TOP ' + CAST(@MaximumRows AS varchar(12)) + ' '

    SET @sql = @sql + '
      SI.ItemID as ItemID,
      SI.ItemName as TextSearch,
      STYPE.DisplayName as ColumnType,
      STYPE.DisplayName as FullType,
      SI.PackageID as PackageID,
      0 as AccountID,
      I.Username,
      I.Fullname
     FROM @ItemsService AS I
     INNER JOIN ServiceItems AS SI ON I.ItemID = SI.ItemID
     INNER JOIN ServiceItemTypes AS STYPE ON SI.ItemTypeID = STYPE.ItemTypeID
     WHERE (STYPE.Searchable = 1
     AND STYPE.ItemTypeID <> 200 AND STYPE.ItemTypeID <> 201)'
    IF @FilterValue <> ''
     SET @sql = @sql + ' AND (SI.ItemName LIKE ''' + @FilterValue + ''')'
    SET @sql = @sql + '
     UNION (
     SELECT '

    IF @OnlyFind = 1
    SET @sql = @sql + 'TOP ' + CAST(@MaximumRows AS varchar(12)) + ' '

    SET @sql = @sql + '
      D.DomainID AS ItemID,
      D.DomainName as TextSearch,
      ''Domain'' as ColumnType,
      ''Domains'' as FullType,
      D.PackageID as PackageID,
      0 as AccountID,
      I.Username,
      I.Fullname
     FROM @ItemsDomain AS I
     INNER JOIN Domains AS D ON I.ItemID = D.DomainID
     WHERE (D.IsDomainPointer=0)'
    IF @FilterValue <> ''
     SET @sql = @sql + ' AND (D.DomainName LIKE ''' + @FilterValue + ''')'
    SET @sql = @sql + '
     UNION
     SELECT '

    IF @OnlyFind = 1
    SET @sql = @sql + 'TOP ' + CAST(@MaximumRows AS varchar(12)) + ' '

    SET @sql = @sql + '
      EA.ItemID AS ItemID,
      EA.DisplayName as TextSearch,
      ''ExchangeAccount'' as ColumnType,
      FullType = CASE EA.AccountType ' + @sqlNameAccountType + ' ELSE CAST(EA.AccountType AS varchar(12)) END,
      SI2.PackageID as PackageID,
      EA.AccountID as AccountID,
      I2.Username,
      I2.Fullname
     FROM @ItemsService AS I2
     INNER JOIN ServiceItems AS SI2 ON I2.ItemID = SI2.ItemID
     INNER JOIN ExchangeAccounts AS EA ON I2.ItemID = EA.ItemID'
    IF @FilterValue <> ''
     SET @sql = @sql + ' WHERE (EA.DisplayName LIKE ''' + @FilterValue + ''')'
    SET @sql = @sql + '
     UNION
     SELECT '

    IF @OnlyFind = 1
    SET @sql = @sql + 'TOP ' + CAST(@MaximumRows AS varchar(12)) + ' '

    SET @sql = @sql + '
      EA4.ItemID AS ItemID,
      EA4.PrimaryEmailAddress as TextSearch,
      ''ExchangeAccount'' as ColumnType,
      FullType = CASE EA4.AccountType ' + @sqlNameAccountType + ' ELSE CAST(EA4.AccountType AS varchar(12)) END,
      SI4.PackageID as PackageID,
      EA4.AccountID as AccountID,
      I4.Username,
      I4.Fullname
     FROM @ItemsService AS I4
     INNER JOIN ServiceItems AS SI4 ON I4.ItemID = SI4.ItemID
     INNER JOIN ExchangeAccounts AS EA4 ON I4.ItemID = EA4.ItemID'
    IF @FilterValue <> ''
     SET @sql = @sql + ' WHERE (EA4.PrimaryEmailAddress LIKE ''' + @FilterValue + ''')'
    SET @sql = @sql + '
     UNION
     SELECT '

    IF @OnlyFind = 1
    SET @sql = @sql + 'TOP ' + CAST(@MaximumRows AS varchar(12)) + ' '

    SET @sql = @sql + '
      I3.ItemID AS ItemID,
      EAEA.EmailAddress as TextSearch,
      ''ExchangeAccount'' as ColumnType,
      FullType = CASE EA.AccountType ' + @sqlNameAccountType + ' ELSE CAST(EA.AccountType AS varchar(12)) END,
      SI3.PackageID as PackageID,
      EAEA.AccountID as AccountID,
      I3.Username,
      I3.Fullname
     FROM @ItemsService AS I3
     INNER JOIN ServiceItems AS SI3 ON I3.ItemID = SI3.ItemID
     INNER JOIN ExchangeAccounts AS EA ON I3.ItemID = EA.ItemID
     INNER JOIN ExchangeAccountEmailAddresses AS EAEA ON EA.AccountID = EAEA.AccountID
     WHERE I3.ItemTypeID = 29'
    IF @FilterValue <> ''
     SET @sql = @sql + ' AND (EAEA.EmailAddress LIKE ''' + @FilterValue + ''')'
     SET @sql = @sql + ')'
    IF @OnlyFind = 1
    	SET @sql = @sql + ' ORDER BY TextSearch';

    SET @sql = @sql + ';open @curValue'

    exec sp_executesql @sql, N'@UserID int, @FilterValue nvarchar(50), @curValue cursor output',
    @UserID, @FilterValue, @curAll output

    FETCH NEXT FROM @curAll INTO @ItemID, @TextSearch, @ColumnType, @FullTypeAll, @PackageID, @AccountID, @Username, @Fullname
    WHILE @@FETCH_STATUS = 0
    BEGIN
    INSERT INTO @ItemsAll(ItemID, TextSearch, ColumnType, FullType, PackageID, AccountID, Username, Fullname)
    VALUES(@ItemID, @TextSearch, @ColumnType, @FullTypeAll, @PackageID, @AccountID, @Username, @Fullname)
    FETCH NEXT FROM @curAll INTO @ItemID, @TextSearch, @ColumnType, @FullTypeAll, @PackageID, @AccountID, @Username, @Fullname
    END

    /*-------------------------------------------Lync-----------------------------------------------------*/
    DECLARE @IsAdmin bit
    SET @IsAdmin = dbo.CheckIsUserAdmin(@ActorID)

    SET @sql = '
    SET @curValue = cursor local for
     SELECT '

    IF @OnlyFind = 1
    SET @sql = @sql + 'TOP ' + CAST(@MaximumRows AS varchar(12)) + ' '

    SET @sql = @sql + '
      SI.ItemID as ItemID,
      ea.AccountName as TextSearch,
      ''LyncAccount'' as ColumnType,
      ''LyncUsers'' as FullType,
      SI.PackageID as PackageID,
      ea.AccountID as AccountID,
      U.Username,
      U.FirstName + '' '' + U.LastName as Fullname
     FROM 
      ExchangeAccounts as ea 
     INNER JOIN 
      LyncUsers as LU
     INNER JOIN
      LyncUserPlans as lp
      ON
      LU.LyncUserPlanId = lp.LyncUserPlanId    
     ON 
      ea.AccountID = LU.AccountID
     INNER JOIN
      ServiceItems AS SI ON ea.ItemID = SI.ItemID
     INNER JOIN
      Packages AS P ON SI.PackageID = P.PackageID
     INNER JOIN
      Users AS U ON U.UserID = P.UserID
    WHERE ' + CAST((@HasUserRights) AS varchar(12)) + ' = 1 
      AND (' + CAST((@IsAdmin) AS varchar(12)) + ' = 1 OR P.UserID = @UserID)'
    IF @FilterValue <> ''
     SET @sql = @sql + ' AND ea.AccountName LIKE ''' + @FilterValue + ''''
    IF @OnlyFind = 1
    	SET @sql = @sql + ' ORDER BY TextSearch'
    SET @sql = @sql + ' ;open @curValue'

    CLOSE @curAll
    DEALLOCATE @curAll
    exec sp_executesql @sql, N'@UserID int, @curValue cursor output', @UserID, @curAll output

    FETCH NEXT FROM @curAll INTO @ItemID, @TextSearch, @ColumnType, @FullTypeAll, @PackageID, @AccountID, @Username, @Fullname
    WHILE @@FETCH_STATUS = 0
    BEGIN
    INSERT INTO @ItemsAll(ItemID, TextSearch, ColumnType, FullType, PackageID, AccountID, Username, Fullname)
    VALUES(@ItemID, @TextSearch, @ColumnType, @FullTypeAll, @PackageID, @AccountID, @Username, @Fullname)
    FETCH NEXT FROM @curAll INTO @ItemID, @TextSearch, @ColumnType, @FullTypeAll, @PackageID, @AccountID, @Username, @Fullname
    END

    /*-------------------------------------------SfB-----------------------------------------------------*/

    SET @sql = '
    SET @curValue = cursor local for
     SELECT '

    IF @OnlyFind = 1
    SET @sql = @sql + 'TOP ' + CAST(@MaximumRows AS varchar(12)) + ' '

    SET @sql = @sql + '
      SI.ItemID as ItemID,
      ea.AccountName as TextSearch,
      ''SfBAccount'' as ColumnType,
      ''SfBUsers'' as FullType,
      SI.PackageID as PackageID,
      ea.AccountID as AccountID,
      U.Username,
      U.FirstName + '' '' + U.LastName as Fullname
     FROM 
      ExchangeAccounts as ea 
     INNER JOIN 
      SfBUsers as LU
     INNER JOIN
      SfBUserPlans as lp
      ON
      LU.SfBUserPlanId = lp.SfBUserPlanId    
     ON 
      ea.AccountID = LU.AccountID
     INNER JOIN
      ServiceItems AS SI ON ea.ItemID = SI.ItemID
     INNER JOIN
      Packages AS P ON SI.PackageID = P.PackageID
     INNER JOIN
      Users AS U ON U.UserID = P.UserID
    WHERE ' + CAST((@HasUserRights) AS varchar(12)) + ' = 1 
      AND (' + CAST((@IsAdmin) AS varchar(12)) + ' = 1 OR P.UserID = @UserID)'
    IF @FilterValue <> ''
     SET @sql = @sql + ' AND ea.AccountName LIKE ''' + @FilterValue + ''''
    IF @OnlyFind = 1
    	SET @sql = @sql + ' ORDER BY TextSearch'
    SET @sql = @sql + ' ;open @curValue'

    CLOSE @curAll
    DEALLOCATE @curAll
    exec sp_executesql @sql, N'@UserID int, @curValue cursor output', @UserID, @curAll output

    FETCH NEXT FROM @curAll INTO @ItemID, @TextSearch, @ColumnType, @FullTypeAll, @PackageID, @AccountID, @Username, @Fullname
    WHILE @@FETCH_STATUS = 0
    BEGIN
    INSERT INTO @ItemsAll(ItemID, TextSearch, ColumnType, FullType, PackageID, AccountID, Username, Fullname)
    VALUES(@ItemID, @TextSearch, @ColumnType, @FullTypeAll, @PackageID, @AccountID, @Username, @Fullname)
    FETCH NEXT FROM @curAll INTO @ItemID, @TextSearch, @ColumnType, @FullTypeAll, @PackageID, @AccountID, @Username, @Fullname
    END

    /*------------------------------------RDS------------------------------------------------*/
    IF @IsAdmin = 1
    BEGIN
    	SET @sql = '
    	SET @curValue = cursor local for
    	 SELECT '

    	IF @OnlyFind = 1
    	SET @sql = @sql + 'TOP ' + CAST(@MaximumRows AS varchar(12)) + ' '

    	SET @sql = @sql + '
    	  RDSCol.ItemID as ItemID,
    	  RDSCol.Name as TextSearch,
    	  ''RDSCollection'' as ColumnType,
    	  ''RDSCollections'' as FullType,
    	  P.PackageID as PackageID,
    	  RDSCol.ID as AccountID,
    	  U.Username,
    	  U.FirstName + '' '' + U.LastName as Fullname
    	 FROM
    	  RDSCollections AS RDSCol
    	 INNER JOIN
    	  ServiceItems AS SI ON RDSCol.ItemID = SI.ItemID
    	 INNER JOIN
    	  Packages AS P ON SI.PackageID = P.PackageID
    	 INNER JOIN
    	  Users AS U ON U.UserID = P.UserID
    	 WHERE ' + CAST((@HasUserRights) AS varchar(12)) + ' = 1
    	 AND (' + CAST((@IsAdmin) AS varchar(12)) + ' = 1 OR P.UserID = @UserID)'
    	IF @FilterValue <> ''
    		SET @sql = @sql + ' AND RDSCol.Name LIKE ''' + @FilterValue + ''''
    	IF @OnlyFind = 1
    		SET @sql = @sql + ' ORDER BY TextSearch'
    	SET @sql = @sql + ' ;open @curValue'

    	CLOSE @curAll
    	DEALLOCATE @curAll
    	exec sp_executesql @sql, N'@UserID int, @curValue cursor output', @UserID, @curAll output

    	FETCH NEXT FROM @curAll INTO @ItemID, @TextSearch, @ColumnType, @FullTypeAll, @PackageID, @AccountID, @Username, @Fullname
    	WHILE @@FETCH_STATUS = 0
    	BEGIN
    	INSERT INTO @ItemsAll(ItemID, TextSearch, ColumnType, FullType, PackageID, AccountID, Username, Fullname)
    	VALUES(@ItemID, @TextSearch, @ColumnType, @FullTypeAll, @PackageID, @AccountID, @Username, @Fullname)
    	FETCH NEXT FROM @curAll INTO @ItemID, @TextSearch, @ColumnType, @FullTypeAll, @PackageID, @AccountID, @Username, @Fullname
    	END
    END

    /*------------------------------------CRM------------------------------------------------*/
    SET @sql = '
    SET @curValue = cursor local for
     SELECT '

    IF @OnlyFind = 1
    SET @sql = @sql + 'TOP ' + CAST(@MaximumRows AS varchar(12)) + ' '

    SET @sql = @sql + '
      @UserID as ItemID,
      ea.AccountName as TextSearch,
      ''CRMSite'' as ColumnType,
      ''CRMSites'' as FullType,
      SI.PackageID as PackageID,
      ea.AccountID as AccountID,
      U.Username,
      U.FirstName + '' '' + U.LastName as Fullname
     FROM 
      ExchangeAccounts as ea 
     INNER JOIN 
      CRMUsers AS CRMU ON ea.AccountID = CRMU.AccountID
     INNER JOIN
      ServiceItems AS SI ON ea.ItemID = SI.ItemID
     INNER JOIN
      Packages AS P ON SI.PackageID = P.PackageID
     INNER JOIN
      Users AS U ON U.UserID = P.UserID
     WHERE ' + CAST((@HasUserRights) AS varchar(12)) + ' = 1
      AND (' + CAST((@IsAdmin) AS varchar(12)) + ' = 1 OR P.UserID = @UserID)'
    IF @FilterValue <> ''
    	SET @sql = @sql + ' AND ea.AccountName LIKE ''' + @FilterValue + ''''
    IF @OnlyFind = 1
    	SET @sql = @sql + ' ORDER BY TextSearch'
    SET @sql = @sql + ' ;open @curValue'

    CLOSE @curAll
    DEALLOCATE @curAll
    exec sp_executesql @sql, N'@UserID int, @curValue cursor output', @UserID, @curAll output

    FETCH NEXT FROM @curAll INTO @ItemID, @TextSearch, @ColumnType, @FullTypeAll, @PackageID, @AccountID, @Username, @Fullname
    WHILE @@FETCH_STATUS = 0
    BEGIN
    INSERT INTO @ItemsAll(ItemID, TextSearch, ColumnType, FullType, PackageID, AccountID, Username, Fullname)
    VALUES(@ItemID, @TextSearch, @ColumnType, @FullTypeAll, @PackageID, @AccountID, @Username, @Fullname)
    FETCH NEXT FROM @curAll INTO @ItemID, @TextSearch, @ColumnType, @FullTypeAll, @PackageID, @AccountID, @Username, @Fullname
    END

    /*------------------------------------VirtualServer------------------------------------------------*/
    IF @IsAdmin = 1
    BEGIN
    	SET @sql = '
    	SET @curValue = cursor local for
    	 SELECT '

    	IF @OnlyFind = 1
    	SET @sql = @sql + 'TOP ' + CAST(@MaximumRows AS varchar(12)) + ' '

    	SET @sql = @sql + '
    	  @UserID as ItemID,
    	  S.ServerName as TextSearch,
    	  ''VirtualServer'' as ColumnType,
    	  ''VirtualServers'' as FullType,
    	  (SELECT MIN(PackageID) FROM Packages WHERE UserID = @UserID) as PackageID,
    	  0 as AccountID,
    	  U.Username,
    	  U.FirstName + '' '' + U.LastName as Fullname
    	 FROM 
    	  Servers AS S
    	 INNER JOIN
          Packages AS P ON P.ServerID = S.ServerID
         INNER JOIN
          Users AS U ON U.UserID = P.UserID
    	 WHERE
    	  VirtualServer = 1'
    	IF @FilterValue <> ''
    		SET @sql = @sql + ' AND S.ServerName LIKE ''' + @FilterValue + ''''
    	IF @OnlyFind = 1
    		SET @sql = @sql + ' ORDER BY TextSearch'
    	SET @sql = @sql + ' ;open @curValue'

    	CLOSE @curAll
    	DEALLOCATE @curAll
    	exec sp_executesql @sql, N'@UserID int, @curValue cursor output', @UserID, @curAll output

    	FETCH NEXT FROM @curAll INTO @ItemID, @TextSearch, @ColumnType, @FullTypeAll, @PackageID, @AccountID, @Username, @Fullname
    	WHILE @@FETCH_STATUS = 0
    	BEGIN
    	INSERT INTO @ItemsAll(ItemID, TextSearch, ColumnType, FullType, PackageID, AccountID, Username, Fullname)
    	VALUES(@ItemID, @TextSearch, @ColumnType, @FullTypeAll, @PackageID, @AccountID, @Username, @Fullname)
    	FETCH NEXT FROM @curAll INTO @ItemID, @TextSearch, @ColumnType, @FullTypeAll, @PackageID, @AccountID, @Username, @Fullname
    	END
    END

    /*------------------------------------WebDAVFolder------------------------------------------------*/
    SET @sql = '
    SET @curValue = cursor local for
     SELECT '

    IF @OnlyFind = 1
    SET @sql = @sql + 'TOP ' + CAST(@MaximumRows AS varchar(12)) + ' '

    SET @sql = @sql + '
      EF.ItemID as ItemID,
      EF.FolderName as TextSearch,
      ''WebDAVFolder'' as ColumnType,
      ''Folders'' as FullType,
      P.PackageID as PackageID,
      EF.EnterpriseFolderID as AccountID,
      U.Username,
      U.FirstName + '' '' + U.LastName as Fullname
     FROM 
      EnterpriseFolders as EF
     INNER JOIN
      ServiceItems AS SI ON EF.ItemID = SI.ItemID
     INNER JOIN
      Packages AS P ON SI.PackageID = P.PackageID
     INNER JOIN
      Users AS U ON U.UserID = P.UserID
     WHERE ' + CAST((@HasUserRights) AS varchar(12)) + ' = 1
      AND (' + CAST((@IsAdmin) AS varchar(12)) + ' = 1 OR P.UserID = @UserID)'
    IF @FilterValue <> ''
    	SET @sql = @sql + ' AND EF.FolderName LIKE ''' + @FilterValue + ''''
    IF @OnlyFind = 1
    	SET @sql = @sql + ' ORDER BY TextSearch'
    SET @sql = @sql + ';open @curValue'

    CLOSE @curAll
    DEALLOCATE @curAll
    exec sp_executesql @sql, N'@UserID int, @curValue cursor output', @UserID, @curAll output

    FETCH NEXT FROM @curAll INTO @ItemID, @TextSearch, @ColumnType, @FullTypeAll, @PackageID, @AccountID, @Username, @Fullname
    WHILE @@FETCH_STATUS = 0
    BEGIN
    INSERT INTO @ItemsAll(ItemID, TextSearch, ColumnType, FullType, PackageID, AccountID, Username, Fullname)
    VALUES(@ItemID, @TextSearch, @ColumnType, @FullTypeAll, @PackageID, @AccountID, @Username, @Fullname)
    FETCH NEXT FROM @curAll INTO @ItemID, @TextSearch, @ColumnType, @FullTypeAll, @PackageID, @AccountID, @Username, @Fullname
    END

    /*------------------------------------VPS-IP------------------------------------------------*/
    SET @sql = '
    SET @curValue = cursor local for
     SELECT '

    IF @OnlyFind = 1
    SET @sql = @sql + 'TOP ' + CAST(@MaximumRows AS varchar(12)) + ' '

    SET @sql = @sql + '
      SI.ItemID as ItemID,
      SI.ItemName as TextSearch,
      SIT.DisplayName as ColumnType,
      SIT.DisplayName as FullType,
      P.PackageID as PackageID,
      0 as AccountID,
      U.Username,
      U.FirstName + '' '' + U.LastName as Fullname
     FROM ServiceItems AS SI
     INNER JOIN ServiceItemTypes AS SIT ON SI.ItemTypeID = SIT.ItemTypeID
     INNER JOIN Packages AS P ON SI.PackageID = P.PackageID
     INNER JOIN Users AS U ON U.UserID = P.UserID
     LEFT JOIN PrivateIPAddresses AS PIP ON PIP.ItemID = SI.ItemID
     LEFT JOIN PackageIPAddresses AS PACIP ON PACIP.ItemID = SI.ItemID
     LEFT JOIN IPAddresses AS IPS ON IPS.AddressID = PACIP.AddressID
     WHERE SIT.DisplayName = ''VirtualMachine''
      AND ' + CAST((@HasUserRights) AS varchar(12)) + ' = 1
      AND dbo.CheckUserParent(@UserID, P.UserID) = 1
      AND (''' + @FilterValue + ''' LIKE ''%.%'' OR ''' + @FilterValue + ''' LIKE ''%:%'')
      AND (PIP.IPAddress LIKE ''' + @FilterValue + ''' OR IPS.ExternalIP LIKE ''' + @FilterValue + ''')'
    IF @OnlyFind = 1
    	SET @sql = @sql + ' ORDER BY TextSearch'
    SET @sql = @sql + ';open @curValue'

    CLOSE @curAll
    DEALLOCATE @curAll
    exec sp_executesql @sql, N'@UserID int, @curValue cursor output', @UserID, @curAll output

    FETCH NEXT FROM @curAll INTO @ItemID, @TextSearch, @ColumnType, @FullTypeAll, @PackageID, @AccountID, @Username, @Fullname
    WHILE @@FETCH_STATUS = 0
    BEGIN
    INSERT INTO @ItemsAll(ItemID, TextSearch, ColumnType, FullType, PackageID, AccountID, Username, Fullname)
    VALUES(@ItemID, @TextSearch, @ColumnType, @FullTypeAll, @PackageID, @AccountID, @Username, @Fullname)
    FETCH NEXT FROM @curAll INTO @ItemID, @TextSearch, @ColumnType, @FullTypeAll, @PackageID, @AccountID, @Username, @Fullname
    END

    /*------------------------------------SharePoint------------------------------------------------*/
    SET @sql = '
    SET @curValue = cursor local for
     SELECT '

    IF @OnlyFind = 1
    SET @sql = @sql + 'TOP ' + CAST(@MaximumRows AS varchar(12)) + ' '

    SET @sql = @sql + '
      SIP.PropertyValue as ItemID,
      T.PropertyValue as TextSearch,
      SIT.DisplayName as ColumnType,
      ''SharePointSiteCollections'' as FullType,
      P.PackageID as PackageID,
      SI.ItemID as AccountID,
      U.Username,
      U.FirstName + '' '' + U.LastName as Fullname
    FROM ServiceItems AS SI
    INNER JOIN ServiceItemTypes AS SIT ON SI.ItemTypeID = SIT.ItemTypeID
    INNER JOIN Packages AS P ON SI.PackageID = P.PackageID
    INNER JOIN Users AS U ON U.UserID = P.UserID
    INNER JOIN ServiceItemProperties AS SIP ON SIP.ItemID = SI.ItemID
    RIGHT JOIN ServiceItemProperties AS T ON T.ItemID = SIP.ItemID
    WHERE ' + CAST((@HasUserRights) AS varchar(12)) + ' = 1
    AND (' + CAST((@IsAdmin) AS varchar(12)) + ' = 1 OR P.UserID = @UserID)
    AND (SIT.DisplayName = ''SharePointFoundationSiteCollection''
    	OR SIT.DisplayName = ''SharePointEnterpriseSiteCollection'')
    AND SIP.PropertyName = ''OrganizationId''
    AND T.PropertyName = ''PhysicalAddress'''
    IF @FilterValue <> ''
    	SET @sql = @sql + ' AND T.PropertyValue LIKE ''' + @FilterValue + ''''
    IF @OnlyFind = 1
    	SET @sql = @sql + ' ORDER BY TextSearch'
    SET @sql = @sql + ';open @curValue'

    CLOSE @curAll
    DEALLOCATE @curAll
    exec sp_executesql @sql, N'@UserID int, @curValue cursor output', @UserID, @curAll output

    FETCH NEXT FROM @curAll INTO @ItemID, @TextSearch, @ColumnType, @FullTypeAll, @PackageID, @AccountID, @Username, @Fullname
    WHILE @@FETCH_STATUS = 0
    BEGIN
    INSERT INTO @ItemsAll(ItemID, TextSearch, ColumnType, FullType, PackageID, AccountID, Username, Fullname)
    VALUES(@ItemID, @TextSearch, @ColumnType, @FullTypeAll, @PackageID, @AccountID, @Username, @Fullname)
    FETCH NEXT FROM @curAll INTO @ItemID, @TextSearch, @ColumnType, @FullTypeAll, @PackageID, @AccountID, @Username, @Fullname
    END

    /*-------------------------------------------@curAll-------------------------------------------------------*/
    CLOSE @curAll
    DEALLOCATE @curAll
    SET @curAll = CURSOR LOCAL FOR
     SELECT 
    	ItemID,
    	TextSearch,
    	ColumnType,
    	FullType,
    	PackageID,
    	AccountID,
    	Username,
    	Fullname
     FROM @ItemsAll
    OPEN @curAll

    /*-------------------------------------------Return-------------------------------------------------------*/
    IF @SortColumn = ''
    	SET @SortColumn = 'TextSearch'

    SET @sql = '
    DECLARE @ItemID int
    DECLARE @TextSearch nvarchar(500)
    DECLARE @ColumnType nvarchar(50)
    DECLARE @FullType nvarchar(50)
    DECLARE @PackageID int
    DECLARE @AccountID int
    DECLARE @EndRow int
    DECLARE @Username nvarchar(100)
    DECLARE @Fullname nvarchar(100)
    SET @EndRow = @StartRow + @MaximumRows'

    IF (@ColType = '' OR @ColType IN ('AccountHome'))
    BEGIN
    	SET @sql = @sql + '
    	DECLARE @ItemsUser TABLE
    	(
    		ItemID int,
    		TextSearch nvarchar(500),
    		ColumnType nvarchar(50),
    		FullType nvarchar(50),
    		PackageID int,
    		AccountID int,
    		Username nvarchar(100),
    		Fullname nvarchar(100)
    	)

    	FETCH NEXT FROM @curUsersValue INTO @ItemID, @TextSearch, @ColumnType, @FullType, @PackageID, @AccountID, @Username, @Fullname
    	WHILE @@FETCH_STATUS = 0
    	BEGIN
    		IF (1 = 1)'

    	IF @FullType <> ''
    		SET @sql = @sql + ' AND @FullType = ''' + @FullType + '''';

    	SET @sql = @sql + '
    		BEGIN
    			INSERT INTO @ItemsUser(ItemID, TextSearch, ColumnType, FullType, PackageID, AccountID, Username, Fullname)
    			VALUES(@ItemID, @TextSearch, @ColumnType, @FullType, @PackageID, @AccountID, @Username, @Fullname)
    		END
    		FETCH NEXT FROM @curUsersValue INTO @ItemID, @TextSearch, @ColumnType, @FullType, @PackageID, @AccountID, @Username, @Fullname
    	END'
    END

    SET @sql = @sql + '
    DECLARE @ItemsFilter TABLE
     (
      ItemID int,
      TextSearch nvarchar(500),
      ColumnType nvarchar(50),
      FullType nvarchar(50),
      PackageID int,
      AccountID int,
      Username nvarchar(100),
      Fullname nvarchar(100)
     )

    FETCH NEXT FROM @curAllValue INTO @ItemID, @TextSearch, @ColumnType, @FullType, @PackageID, @AccountID, @Username, @Fullname
    WHILE @@FETCH_STATUS = 0
    BEGIN
    	IF (1 = 1)'

    IF @ColType <> ''
    SET @sql = @sql + ' AND @ColumnType in ( ' + @ColType + ' ) ';

    IF @FullType <> ''
    SET @sql = @sql + ' AND @FullType = ''' + @FullType + '''';

    SET @sql = @sql + '
    	BEGIN
    		INSERT INTO @ItemsFilter(ItemID, TextSearch, ColumnType, FullType, PackageID, AccountID, Username, Fullname)
    		VALUES(@ItemID, @TextSearch, @ColumnType, @FullType, @PackageID, @AccountID, @Username, @Fullname)
    	END
    	FETCH NEXT FROM @curAllValue INTO @ItemID, @TextSearch, @ColumnType, @FullType, @PackageID, @AccountID, @Username, @Fullname
    END

    DECLARE @ItemsReturn TABLE
     (
      ItemPosition int IDENTITY(1,1),
      ItemID int,
      TextSearch nvarchar(500),
      ColumnType nvarchar(50),
      FullType nvarchar(50),
      PackageID int,
      AccountID int,
      Username nvarchar(100),
      Fullname nvarchar(100)
     )'

    IF (@ColType = '' OR @ColType IN ('AccountHome'))
    BEGIN
    	SET @sql = @sql + '
    		INSERT INTO '
    	IF @SortColumn = 'TextSearch'
    		SET @sql = @sql + '@ItemsReturn'
    	ELSE
    		SET @sql = @sql + '@ItemsFilter'
    	SET @sql = @sql + ' (ItemID, TextSearch, ColumnType, FullType, PackageID, AccountID, Username, Fullname)
    		SELECT ItemID, TextSearch, ColumnType, FullType, PackageID, AccountID, Username, Fullname
    		FROM @ItemsUser'
    END

    SET @sql = @sql + '
    INSERT INTO @ItemsReturn(ItemID, TextSearch, ColumnType, FullType, PackageID, AccountID, Username, Fullname)
    SELECT 
    	ItemID,
    	TextSearch,
    	ColumnType,
    	FullType,
    	PackageID,
    	AccountID,
    	Username,
    	Fullname
    FROM @ItemsFilter'
    SET @sql = @sql + ' ORDER BY ' +  @SortColumn

    SET @sql = @sql + ';
    SELECT COUNT(ItemID) FROM @ItemsReturn;
    SELECT DISTINCT(ColumnType) FROM @ItemsReturn';
    IF @FullType <> ''
    	SET @sql = @sql + ' WHERE FullType = ''' + @FullType + '''';

    SET @sql = @sql + ';
    SELECT ItemPosition, ItemID, TextSearch, ColumnType, FullType, PackageID, AccountID, Username, Fullname
    FROM @ItemsReturn AS IR'

    IF  @MaximumRows > 0
    	SET @sql = @sql + ' WHERE IR.ItemPosition BETWEEN @StartRow AND @EndRow';

    exec sp_executesql @sql, N'@StartRow int, @MaximumRows int, @FilterValue nvarchar(50), @curUsersValue cursor, @curAllValue cursor',
    	@StartRow, @MaximumRows, @FilterValue, @curUsers, @curAll

    CLOSE @curAll
    DEALLOCATE @curAll

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetSearchTableByColumns]
    (
    	@PagedStored nvarchar(50) = '',
    	@FilterValue nvarchar(50) = '',
    	@MaximumRows int,

    	@Recursive bit,
    	@PoolID int,
    	@ServerID int,
    	@ActorID int,
    	@StatusID int,
    	@PlanID int,
    	@OrgID int,
    	@ItemTypeName nvarchar(200),
    	@GroupName nvarchar(100) = NULL,
    	@PackageID int,
    	@VPSType nvarchar(100) = NULL,
    	@UserID int,
    	@RoleID int,
    	@FilterColumns nvarchar(200)
    )
    AS

    DECLARE @VPSTypeID int
    IF @VPSType <> '' AND @VPSType IS NOT NULL
    BEGIN
    	SET @VPSTypeID = CASE @VPSType
    		WHEN 'VPS' THEN 33
    		WHEN 'VPS2012' THEN 41
    		WHEN 'Proxmox' THEN 143
    		WHEN 'VPSForPC' THEN 35
    		ELSE 33
    		END
    END

    DECLARE @sql nvarchar(3000)
    SET @sql = CASE @PagedStored
    WHEN 'Domains' THEN '
    	DECLARE @Domains TABLE
    	(
    		DomainID int,
    		DomainName nvarchar(100),
    		Username nvarchar(100),
    		FullName nvarchar(100),
    		Email nvarchar(100)
    	)
    	INSERT INTO @Domains (DomainID, DomainName, Username, FullName, Email)
    	SELECT
    		D.DomainID,
    		D.DomainName,
    		U.Username,
    		U.FullName,
    		U.Email
    	FROM Domains AS D
    	INNER JOIN Packages AS P ON D.PackageID = P.PackageID
    	INNER JOIN UsersDetailed AS U ON P.UserID = U.UserID
    	LEFT OUTER JOIN ServiceItems AS Z ON D.ZoneItemID = Z.ItemID
    	LEFT OUTER JOIN Services AS S ON Z.ServiceID = S.ServiceID
    	LEFT OUTER JOIN Servers AS SRV ON S.ServerID = SRV.ServerID
    	WHERE
    		(D.IsPreviewDomain = 0 AND D.IsDomainPointer = 0)
    		AND ((@Recursive = 0 AND D.PackageID = @PackageID)
    		OR (@Recursive = 1 AND dbo.CheckPackageParent(@PackageID, D.PackageID) = 1))
    		AND (@ServerID = 0 OR (@ServerID > 0 AND S.ServerID = @ServerID))
    	'
    WHEN 'IPAddresses' THEN '
    	DECLARE @IPAddresses TABLE
    	(
    		AddressesID int,
    		ExternalIP nvarchar(100),
    		InternalIP nvarchar(100),
    		DefaultGateway nvarchar(100),
    		ServerName nvarchar(100),
    		UserName nvarchar(100),
    		ItemName nvarchar(100)
    	)
    	DECLARE @IsAdmin bit
    	SET @IsAdmin = dbo.CheckIsUserAdmin(@ActorID)
    	INSERT INTO @IPAddresses (AddressesID, ExternalIP, InternalIP, DefaultGateway, ServerName, UserName, ItemName)
    	SELECT
    		IP.AddressID,
    		IP.ExternalIP,
    		IP.InternalIP,
    		IP.DefaultGateway,
    		S.ServerName,
    		U.UserName,
    		SI.ItemName
    	FROM dbo.IPAddresses AS IP
    	LEFT JOIN Servers AS S ON IP.ServerID = S.ServerID
    	LEFT JOIN PackageIPAddresses AS PA ON IP.AddressID = PA.AddressID
    	LEFT JOIN ServiceItems SI ON PA.ItemId = SI.ItemID
    	LEFT JOIN dbo.Packages P ON PA.PackageID = P.PackageID
    	LEFT JOIN dbo.Users U ON P.UserID = U.UserID
    	WHERE
    		@IsAdmin = 1
    		AND (@PoolID = 0 OR @PoolID <> 0 AND IP.PoolID = @PoolID)
    		AND (@ServerID = 0 OR @ServerID <> 0 AND IP.ServerID = @ServerID)
    	'
    WHEN 'Schedules' THEN '
    	DECLARE @Schedules TABLE
    	(
    		ScheduleID int,
    		ScheduleName nvarchar(100),
    		Username nvarchar(100),
    		FullName nvarchar(100),
    		Email nvarchar(100)
    	)
    	INSERT INTO @Schedules (ScheduleID, ScheduleName, Username, FullName, Email)
    	SELECT
    		S.ScheduleID,
    		S.ScheduleName,
    		U.Username,
    		U.FullName,
    		U.Email
    	FROM Schedule AS S
    	INNER JOIN Packages AS P ON S.PackageID = P.PackageID
    	INNER JOIN PackagesTree(@PackageID, @Recursive) AS PT ON S.PackageID = PT.PackageID
    	INNER JOIN UsersDetailed AS U ON P.UserID = U.UserID
    	'
    WHEN 'NestedPackages' THEN '
    	DECLARE @NestedPackages TABLE
    	(
    		PackageID int,
    		PackageName nvarchar(100),
    		Username nvarchar(100),
    		FullName nvarchar(100),
    		Email nvarchar(100)
    	)
    	INSERT INTO @NestedPackages (PackageID, PackageName, Username, FullName, Email)
    	SELECT
    		P.PackageID,
    		P.PackageName,
    		U.Username,
    		U.FullName,
    		U.Email
    	FROM Packages AS P
    	INNER JOIN UsersDetailed AS U ON P.UserID = U.UserID
    	INNER JOIN Servers AS S ON P.ServerID = S.ServerID
    	INNER JOIN HostingPlans AS HP ON P.PlanID = HP.PlanID
    	WHERE
    		P.ParentPackageID = @PackageID
    		AND ((@StatusID = 0) OR (@StatusID > 0 AND P.StatusID = @StatusID))
    		AND ((@PlanID = 0) OR (@PlanID > 0 AND P.PlanID = @PlanID))
    		AND ((@ServerID = 0) OR (@ServerID > 0 AND P.ServerID = @ServerID))
    	'
    WHEN 'PackageIPAddresses' THEN '
    	DECLARE @PackageIPAddresses TABLE
    	(
    		PackageAddressID int,
    		ExternalIP nvarchar(100),
    		InternalIP nvarchar(100),
    		DefaultGateway nvarchar(100),
    		ItemName nvarchar(100),
    		UserName nvarchar(100)
    	)
    	INSERT INTO @PackageIPAddresses (PackageAddressID, ExternalIP, InternalIP, DefaultGateway, ItemName, UserName)
    	SELECT
    		PA.PackageAddressID,
    		IP.ExternalIP,
    		IP.InternalIP,
    		IP.DefaultGateway,
    		SI.ItemName,
    		U.UserName
    	FROM dbo.PackageIPAddresses PA
    	INNER JOIN dbo.IPAddresses AS IP ON PA.AddressID = IP.AddressID
    	INNER JOIN dbo.Packages P ON PA.PackageID = P.PackageID
    	INNER JOIN dbo.Users U ON U.UserID = P.UserID
    	LEFT JOIN ServiceItems SI ON PA.ItemId = SI.ItemID
    	WHERE
    		((@Recursive = 0 AND PA.PackageID = @PackageID)
    		OR (@Recursive = 1 AND dbo.CheckPackageParent(@PackageID, PA.PackageID) = 1))
    		AND (@PoolID = 0 OR @PoolID <> 0 AND IP.PoolID = @PoolID)
    		AND (@OrgID = 0 OR @OrgID <> 0 AND PA.OrgID = @OrgID)
    	'
    WHEN 'ServiceItems' THEN '
    	IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    	RAISERROR(''You are not allowed to access this package'', 16, 1)
    	DECLARE @ServiceItems TABLE
    	(
    		ItemID int,
    		ItemName nvarchar(100),
    		Username nvarchar(100),
    		FullName nvarchar(100),
    		Email nvarchar(100)
    	)
    	DECLARE @GroupID int
    	SELECT @GroupID = GroupID FROM ResourceGroups
    	WHERE GroupName = @GroupName
    	DECLARE @ItemTypeID int
    	SELECT @ItemTypeID = ItemTypeID FROM ServiceItemTypes
    	WHERE TypeName = @ItemTypeName
    	AND ((@GroupID IS NULL) OR (@GroupID IS NOT NULL AND GroupID = @GroupID))
    	INSERT INTO @ServiceItems (ItemID, ItemName, Username, FullName, Email)
    	SELECT
    		SI.ItemID,
    		SI.ItemName,
    		U.Username,
    		U.FirstName,
    		U.Email
    	FROM Packages AS P
    	INNER JOIN ServiceItems AS SI ON P.PackageID = SI.PackageID
    	INNER JOIN UsersDetailed AS U ON P.UserID = U.UserID
    	INNER JOIN ServiceItemTypes AS IT ON SI.ItemTypeID = IT.ItemTypeID
    	INNER JOIN Services AS S ON SI.ServiceID = S.ServiceID
    	INNER JOIN Servers AS SRV ON S.ServerID = SRV.ServerID
    	WHERE
    		SI.ItemTypeID = @ItemTypeID
    		AND ((@Recursive = 0 AND P.PackageID = @PackageID)
    			OR (@Recursive = 1 AND dbo.CheckPackageParent(@PackageID, P.PackageID) = 1))
    		AND ((@GroupID IS NULL) OR (@GroupID IS NOT NULL AND IT.GroupID = @GroupID))
    		AND (@ServerID = 0 OR (@ServerID > 0 AND S.ServerID = @ServerID))
    	'
    WHEN 'Users' THEN '
    	DECLARE @Users TABLE
    	(
    		UserID int,
    		Username nvarchar(100),
    		FullName nvarchar(100),
    		Email nvarchar(100),
    		CompanyName nvarchar(100)
    	)
    	DECLARE @HasUserRights bit
    	SET @HasUserRights = dbo.CheckActorUserRights(@ActorID, @UserID)
    	INSERT INTO @Users (UserID, Username, FullName, Email, CompanyName)
    	SELECT
    		U.UserID,
    		U.Username,
    		U.FullName,
    		U.Email,
    		U.CompanyName
    	FROM UsersDetailed AS U
    	WHERE 
    		U.UserID <> @UserID AND U.IsPeer = 0 AND
    		(
    			(@Recursive = 0 AND OwnerID = @UserID) OR
    			(@Recursive = 1 AND dbo.CheckUserParent(@UserID, U.UserID) = 1)
    		)
    		AND ((@StatusID = 0) OR (@StatusID > 0 AND U.StatusID = @StatusID))
    		AND ((@RoleID = 0) OR (@RoleID > 0 AND U.RoleID = @RoleID))
    		AND @HasUserRights = 1 
    	'
    WHEN 'VirtualMachines' THEN '
    	IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    	RAISERROR(''You are not allowed to access this package'', 16, 1)
    	DECLARE @VirtualMachines TABLE
    	(
    		ItemID int,
    		ItemName nvarchar(100),
    		Username nvarchar(100),
    		ExternalIP nvarchar(100),
    		IPAddress nvarchar(100)
    	)
    	INSERT INTO @VirtualMachines (ItemID, ItemName, Username, ExternalIP, IPAddress)
    	SELECT
    		SI.ItemID,
    		SI.ItemName,
    		U.Username,
    		EIP.ExternalIP,
    		PIP.IPAddress
    	FROM Packages AS P
    	INNER JOIN ServiceItems AS SI ON P.PackageID = SI.PackageID
    	INNER JOIN Users AS U ON P.UserID = U.UserID
    	LEFT OUTER JOIN (
    		SELECT PIP.ItemID, IP.ExternalIP FROM PackageIPAddresses AS PIP
    		INNER JOIN IPAddresses AS IP ON PIP.AddressID = IP.AddressID
    		WHERE PIP.IsPrimary = 1 AND IP.PoolID = 3 -- external IP addresses
    	) AS EIP ON SI.ItemID = EIP.ItemID
    	LEFT OUTER JOIN PrivateIPAddresses AS PIP ON PIP.ItemID = SI.ItemID AND PIP.IsPrimary = 1
    	WHERE
    		SI.ItemTypeID = ' + CAST(@VPSTypeID AS nvarchar(12)) + '
    		AND ((@Recursive = 0 AND P.PackageID = @PackageID)
    		OR (@Recursive = 1 AND dbo.CheckPackageParent(@PackageID, P.PackageID) = 1))
    	'
    WHEN 'PackagePrivateIPAddresses' THEN '
    	DECLARE @PackagePrivateIPAddresses TABLE
    	(
    		PrivateAddressID int,
    		IPAddress nvarchar(100),
    		ItemName nvarchar(100)
    	)
    	INSERT INTO @PackagePrivateIPAddresses (PrivateAddressID, IPAddress, ItemName)
    	SELECT
    		PA.PrivateAddressID,
    		PA.IPAddress,
    		SI.ItemName
    	FROM dbo.PrivateIPAddresses AS PA
    	INNER JOIN dbo.ServiceItems AS SI ON PA.ItemID = SI.ItemID
    	WHERE SI.PackageID = @PackageID
    	'
    ELSE ''
    END + 'SELECT TOP ' + CAST(@MaximumRows AS nvarchar(12)) + ' MIN(ItemID) as [ItemID], TextSearch, ColumnType, COUNT(*) AS [Count]' + CASE @PagedStored
    WHEN 'Domains' THEN '
    	FROM(
    	SELECT D0.DomainID AS ItemID, D0.DomainName AS TextSearch, ''DomainName'' AS ColumnType
    	FROM @Domains AS D0
    	UNION
    	SELECT D1.DomainID AS ItemID, D1.Username AS TextSearch, ''Username'' AS ColumnType
    	FROM @Domains AS D1
    	UNION
    	SELECT D2.DomainID as ItemID, D2.FullName AS TextSearch, ''FullName'' AS ColumnType
    	FROM @Domains AS D2
    	UNION
    	SELECT D3.DomainID as ItemID, D3.Email AS TextSearch, ''Email'' AS ColumnType
    	FROM @Domains AS D3) AS D'
    WHEN 'IPAddresses' THEN '
    	FROM(
    	SELECT D0.AddressesID AS ItemID, D0.ExternalIP AS TextSearch, ''ExternalIP'' AS ColumnType
    	FROM @IPAddresses AS D0
    	UNION
    	SELECT D1.AddressesID AS ItemID, D1.InternalIP AS TextSearch, ''InternalIP'' AS ColumnType
    	FROM @IPAddresses AS D1
    	UNION
    	SELECT D2.AddressesID AS ItemID, D2.DefaultGateway AS TextSearch, ''DefaultGateway'' AS ColumnType
    	FROM @IPAddresses AS D2
    	UNION
    	SELECT D3.AddressesID AS ItemID, D3.ServerName AS TextSearch, ''ServerName'' AS ColumnType
    	FROM @IPAddresses AS D3
    	UNION
    	SELECT D4.AddressesID AS ItemID, D4.UserName AS TextSearch, ''UserName'' AS ColumnType
    	FROM @IPAddresses AS D4
    	UNION
    	SELECT D6.AddressesID AS ItemID, D6.ItemName AS TextSearch, ''ItemName'' AS ColumnType
    	FROM @IPAddresses AS D6) AS D'
    WHEN 'Schedules' THEN '
    	FROM(
    	SELECT D0.ScheduleID AS ItemID, D0.ScheduleName AS TextSearch, ''ScheduleName'' AS ColumnType
    	FROM @Schedules AS D0
    	UNION
    	SELECT D1.ScheduleID AS ItemID, D1.Username AS TextSearch, ''Username'' AS ColumnType
    	FROM @Schedules AS D1
    	UNION
    	SELECT D2.ScheduleID AS ItemID, D2.FullName AS TextSearch, ''FullName'' AS ColumnType
    	FROM @Schedules AS D2
    	UNION
    	SELECT D3.ScheduleID AS ItemID, D3.Email AS TextSearch, ''Email'' AS ColumnType
    	FROM @Schedules AS D3) AS D'
    WHEN 'NestedPackages' THEN '
    	FROM(
    	SELECT D0.PackageID AS ItemID, D0.PackageName AS TextSearch, ''PackageName'' AS ColumnType
    	FROM @NestedPackages AS D0
    	UNION
    	SELECT D1.PackageID AS ItemID, D1.Username AS TextSearch, ''Username'' AS ColumnType
    	FROM @NestedPackages AS D1
    	UNION
    	SELECT D2.PackageID as ItemID, D2.FullName AS TextSearch, ''FullName'' AS ColumnType
    	FROM @NestedPackages AS D2
    	UNION
    	SELECT D3.PackageID as ItemID, D3.Email AS TextSearch, ''Email'' AS ColumnType
    	FROM @NestedPackages AS D3) AS D'
    WHEN 'PackageIPAddresses' THEN '
    	FROM(
    	SELECT D0.PackageAddressID AS ItemID, D0.ExternalIP AS TextSearch, ''ExternalIP'' AS ColumnType
    	FROM @PackageIPAddresses AS D0
    	UNION
    	SELECT D1.PackageAddressID AS ItemID, D1.InternalIP AS TextSearch, ''InternalIP'' AS ColumnType
    	FROM @PackageIPAddresses AS D1
    	UNION
    	SELECT D2.PackageAddressID as ItemID, D2.DefaultGateway AS TextSearch, ''DefaultGateway'' AS ColumnType
    	FROM @PackageIPAddresses AS D2
    	UNION
    	SELECT D3.PackageAddressID as ItemID, D3.ItemName AS TextSearch, ''ItemName'' AS ColumnType
    	FROM @PackageIPAddresses AS D3
    	UNION
    	SELECT D5.PackageAddressID as ItemID, D5.UserName AS TextSearch, ''UserName'' AS ColumnType
    	FROM @PackageIPAddresses AS D5) AS D'
    WHEN 'ServiceItems' THEN '
    	FROM(
    	SELECT D0.ItemID AS ItemID, D0.ItemName AS TextSearch, ''ItemName'' AS ColumnType
    	FROM @ServiceItems AS D0
    	UNION
    	SELECT D1.ItemID AS ItemID, D1.Username AS TextSearch, ''Username'' AS ColumnType
    	FROM @ServiceItems AS D1
    	UNION
    	SELECT D2.ItemID as ItemID, D2.FullName AS TextSearch, ''FullName'' AS ColumnType
    	FROM @ServiceItems AS D2
    	UNION
    	SELECT D3.ItemID as ItemID, D3.Email AS TextSearch, ''Email'' AS ColumnType
    	FROM @ServiceItems AS D3) AS D'
    WHEN 'Users' THEN '
    	FROM(
    	SELECT D0.UserID AS ItemID, D0.Username AS TextSearch, ''Username'' AS ColumnType
    	FROM @Users AS D0
    	UNION
    	SELECT D1.UserID AS ItemID, D1.FullName AS TextSearch, ''FullName'' AS ColumnType
    	FROM @Users AS D1
    	UNION
    	SELECT D2.UserID as ItemID, D2.Email AS TextSearch, ''Email'' AS ColumnType
    	FROM @Users AS D2
    	UNION
    	SELECT D3.UserID as ItemID, D3.CompanyName AS TextSearch, ''CompanyName'' AS ColumnType
    	FROM @Users AS D3) AS D'
    WHEN 'VirtualMachines' THEN '
    	FROM(
    	SELECT D0.ItemID AS ItemID, D0.ItemName AS TextSearch, ''ItemName'' AS ColumnType
    	FROM @VirtualMachines AS D0
    	UNION
    	SELECT D1.ItemID AS ItemID, D1.ExternalIP AS TextSearch, ''ExternalIP'' AS ColumnType
    	FROM @VirtualMachines AS D1
    	UNION
    	SELECT D2.ItemID as ItemID, D2.Username AS TextSearch, ''Username'' AS ColumnType
    	FROM @VirtualMachines AS D2
    	UNION
    	SELECT D3.ItemID as ItemID, D3.IPAddress AS TextSearch, ''IPAddress'' AS ColumnType
    	FROM @VirtualMachines AS D3) AS D'
    WHEN 'PackagePrivateIPAddresses' THEN '
    	FROM(
    	SELECT D0.PrivateAddressID AS ItemID, D0.IPAddress AS TextSearch, ''IPAddress'' AS ColumnType
    	FROM @PackagePrivateIPAddresses AS D0
    	UNION
    	SELECT D1.PrivateAddressID AS ItemID, D1.ItemName AS TextSearch, ''ItemName'' AS ColumnType
    	FROM @PackagePrivateIPAddresses AS D1) AS D'
    END + '
    	WHERE (TextSearch LIKE @FilterValue)'
    IF @FilterColumns <> '' AND @FilterColumns IS NOT NULL
    	SET @sql = @sql + '
    		AND (ColumnType IN (' + @FilterColumns + '))'
    SET @sql = @sql + '
    	GROUP BY TextSearch, ColumnType
    	ORDER BY TextSearch'

    exec sp_executesql @sql, N'@FilterValue nvarchar(50), @Recursive bit, @PoolID int, @ServerID int, @ActorID int, @StatusID int, @PlanID int, @OrgID int, @ItemTypeName nvarchar(200), @GroupName nvarchar(100), @PackageID int, @VPSTypeID int, @UserID int, @RoleID int', 
    @FilterValue, @Recursive, @PoolID, @ServerID, @ActorID, @StatusID, @PlanID, @OrgID, @ItemTypeName, @GroupName, @PackageID, @VPSTypeID, @UserID, @RoleID

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetServer]
    (
    	@ActorID int,
    	@ServerID int,
    	@forAutodiscover bit
    )
    AS
    -- check rights
    DECLARE @IsAdmin bit
    SET @IsAdmin = dbo.CheckIsUserAdmin(@ActorID)

    SELECT
    	ServerID,
    	ServerName,
    	ServerUrl,
    	Password,
    	Comments,
    	VirtualServer,
    	InstantDomainAlias,
    	PrimaryGroupID,
    	ADEnabled,
    	ADRootDomain,
    	ADUsername,
    	ADPassword,
    	ADAuthenticationType,
    	ADParentDomain,
    	ADParentDomainController,
    	OSPlatform,
    	IsCore,
    	PasswordIsSHA256

    FROM Servers
    WHERE
    	ServerID = @ServerID
    	AND (@IsAdmin = 1 OR @forAutodiscover = 1)

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetServerByName]
    (
    	@ActorID int,
    	@ServerName nvarchar(100)
    )
    AS
    -- check rights
    DECLARE @IsAdmin bit
    SET @IsAdmin = dbo.CheckIsUserAdmin(@ActorID)

    SELECT
    	ServerID,
    	ServerName,
    	ServerUrl,
    	Password,
    	Comments,
    	VirtualServer,
    	InstantDomainAlias,
    	PrimaryGroupID,
    	ADRootDomain,
    	ADUsername,
    	ADPassword,
    	ADAuthenticationType,
    	ADParentDomain,
    	ADParentDomainController,
    	OSPlatform,
    	IsCore,
    	PasswordIsSHA256
    FROM Servers
    WHERE
    	ServerName = @ServerName
    	AND @IsAdmin = 1

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetServerInternal]
    (
    	@ServerID int
    )
    AS
    SELECT
    	ServerID,
    	ServerName,
    	ServerUrl,
    	Password,
    	Comments,
    	VirtualServer,
    	InstantDomainAlias,
    	PrimaryGroupID,
    	ADEnabled,
    	ADRootDomain,
    	ADUsername,
    	ADPassword,
    	ADAuthenticationType,
    	ADParentDomain,
    	ADParentDomainController,
    	OSPlatform,
    	IsCore,
    	PasswordIsSHA256
    FROM Servers
    WHERE
    	ServerID = @ServerID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetServers]
    (
    	@ActorID int
    )
    AS
    -- check rights
    DECLARE @IsAdmin bit
    SET @IsAdmin = dbo.CheckIsUserAdmin(@ActorID)

    SELECT
    	S.ServerID,
    	S.ServerName,
    	S.ServerUrl,
    	(SELECT COUNT(SRV.ServiceID) FROM Services AS SRV WHERE S.ServerID = SRV.ServerID) AS ServicesNumber,
    	S.Comments,
    	PrimaryGroupID,
    	S.ADEnabled
    FROM Servers AS S
    WHERE VirtualServer = 0
    AND @IsAdmin = 1
    ORDER BY S.ServerName

    -- services
    SELECT
    	S.ServiceID,
    	S.ServerID,
    	S.ProviderID,
    	S.ServiceName,
    	S.Comments
    FROM Services AS S
    INNER JOIN Providers AS P ON S.ProviderID = P.ProviderID
    INNER JOIN ResourceGroups AS RG ON P.GroupID = RG.GroupID
    WHERE @IsAdmin = 1
    ORDER BY RG.GroupOrder

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetServerShortDetails]
    (
    	@ServerID int
    )
    AS

    SELECT
    	ServerID,
    	ServerName,
    	Comments,
    	VirtualServer,
    	InstantDomainAlias
    FROM Servers
    WHERE
    	ServerID = @ServerID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetService]
    (
    	@ActorID int,
    	@ServiceID int
    )
    AS

    SELECT
    	ServiceID,
    	Services.ServerID,
    	ProviderID,
    	ServiceName,
    	ServiceQuotaValue,
    	ClusterID,
    	Services.Comments,
    	Servers.ServerName
    FROM Services INNER JOIN Servers ON Services.ServerID = Servers.ServerID
    WHERE
    	ServiceID = @ServiceID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetServiceItem]
    (
    	@ActorID int,
    	@ItemID int
    )
    AS

    DECLARE @Items TABLE
    (
    	ItemID int
    )

    -- find service items
    INSERT INTO @Items
    SELECT
    	SI.ItemID
    FROM ServiceItems AS SI
    INNER JOIN Packages AS P ON SI.PackageID = P.PackageID
    WHERE
    	SI.ItemID = @ItemID
    	AND dbo.CheckActorPackageRights(@ActorID, SI.PackageID) = 1

    -- select service items
    SELECT
    	SI.ItemID,
    	SI.ItemName,
    	SI.ItemTypeID,
    	SIT.TypeName,
    	SI.ServiceID,
    	SI.PackageID,
    	P.PackageName,
    	S.ServiceID,
    	S.ServiceName,
    	SRV.ServerID,
    	SRV.ServerName,
    	RG.GroupName,
    	U.UserID,
    	U.Username,
    	U.FullName AS UserFullName,
    	SI.CreatedDate
    FROM @Items AS FI
    INNER JOIN ServiceItems AS SI ON FI.ItemID = SI.ItemID
    INNER JOIN ServiceItemTypes AS SIT ON SI.ItemTypeID = SIT.ItemTypeID
    INNER JOIN Packages AS P ON SI.PackageID = P.PackageID
    INNER JOIN Services AS S ON SI.ServiceID = S.ServiceID
    INNER JOIN Servers AS SRV ON S.ServerID = SRV.ServerID
    INNER JOIN Providers AS PROV ON S.ProviderID = PROV.ProviderID
    INNER JOIN ResourceGroups AS RG ON PROV.GroupID = RG.GroupID
    INNER JOIN UsersDetailed AS U ON P.UserID = U.UserID

    -- select item properties
    -- get corresponding item properties
    SELECT
    	IP.ItemID,
    	IP.PropertyName,
    	IP.PropertyValue
    FROM ServiceItemProperties AS IP
    INNER JOIN @Items AS FI ON IP.ItemID = FI.ItemID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetServiceItemByName]
    (
    	@ActorID int,
    	@PackageID int,
    	@ItemName nvarchar(500),
    	@GroupName nvarchar(100) = NULL,
    	@ItemTypeName nvarchar(200)
    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    DECLARE @Items TABLE
    (
    	ItemID int
    )

    -- find service items
    INSERT INTO @Items
    SELECT
    	SI.ItemID
    FROM ServiceItems AS SI
    INNER JOIN ServiceItemTypes AS SIT ON SI.ItemTypeID = SIT.ItemTypeID
    INNER JOIN ResourceGroups AS RG ON SIT.GroupID = RG.GroupID
    WHERE SI.PackageID = @PackageID AND SIT.TypeName = @ItemTypeName
    AND SI.ItemName = @ItemName
    AND ((@GroupName IS NULL) OR (@GroupName IS NOT NULL AND RG.GroupName = @GroupName))

    -- select service items
    SELECT
    	SI.ItemID,
    	SI.ItemName,
    	SI.ItemTypeID,
    	SIT.TypeName,
    	SI.ServiceID,
    	SI.PackageID,
    	P.PackageName,
    	S.ServiceID,
    	S.ServiceName,
    	SRV.ServerID,
    	SRV.ServerName,
    	RG.GroupName,
    	U.UserID,
    	U.Username,
    	U.FullName AS UserFullName,
    	SI.CreatedDate
    FROM @Items AS FI
    INNER JOIN ServiceItems AS SI ON FI.ItemID = SI.ItemID
    INNER JOIN ServiceItemTypes AS SIT ON SI.ItemTypeID = SIT.ItemTypeID
    INNER JOIN Packages AS P ON SI.PackageID = P.PackageID
    INNER JOIN Services AS S ON SI.ServiceID = S.ServiceID
    INNER JOIN Servers AS SRV ON S.ServerID = SRV.ServerID
    INNER JOIN Providers AS PROV ON S.ProviderID = PROV.ProviderID
    INNER JOIN ResourceGroups AS RG ON PROV.GroupID = RG.GroupID
    INNER JOIN UsersDetailed AS U ON P.UserID = U.UserID

    -- select item properties
    -- get corresponding item properties
    SELECT
    	IP.ItemID,
    	IP.PropertyName,
    	IP.PropertyValue
    FROM ServiceItemProperties AS IP
    INNER JOIN @Items AS FI ON IP.ItemID = FI.ItemID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetServiceItems]
    (
    	@ActorID int,
    	@PackageID int,
    	@ItemTypeName nvarchar(200),
    	@GroupName nvarchar(100) = NULL,
    	@Recursive bit
    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    DECLARE @Items TABLE
    (
    	ItemID int
    )

    -- find service items
    INSERT INTO @Items
    SELECT
    	SI.ItemID
    FROM ServiceItems AS SI
    INNER JOIN PackagesTree(@PackageID, @Recursive) AS PT ON SI.PackageID = PT.PackageID
    INNER JOIN ServiceItemTypes AS IT ON SI.ItemTypeID = IT.ItemTypeID
    INNER JOIN ResourceGroups AS RG ON IT.GroupID = RG.GroupID
    WHERE IT.TypeName = @ItemTypeName
    AND ((@GroupName IS NULL) OR (@GroupName IS NOT NULL AND RG.GroupName = @GroupName))

    -- select service items
    SELECT
    	SI.ItemID,
    	SI.ItemName,
    	SI.ItemTypeID,
    	SIT.TypeName,
    	SI.ServiceID,
    	SI.PackageID,
    	P.PackageName,
    	S.ServiceID,
    	S.ServiceName,
    	SRV.ServerID,
    	SRV.ServerName,
    	RG.GroupName,
    	U.UserID,
    	U.Username,
    	(U.FirstName + U.LastName) AS UserFullName,
    	SI.CreatedDate
    FROM @Items AS FI
    INNER JOIN ServiceItems AS SI ON FI.ItemID = SI.ItemID
    INNER JOIN ServiceItemTypes AS SIT ON SI.ItemTypeID = SIT.ItemTypeID
    INNER JOIN Packages AS P ON SI.PackageID = P.PackageID
    INNER JOIN Services AS S ON SI.ServiceID = S.ServiceID
    INNER JOIN Servers AS SRV ON S.ServerID = SRV.ServerID
    INNER JOIN ResourceGroups AS RG ON SIT.GroupID = RG.GroupID
    INNER JOIN Users AS U ON P.UserID = U.UserID

    -- select item properties
    -- get corresponding item properties
    SELECT
    	IP.ItemID,
    	IP.PropertyName,
    	IP.PropertyValue
    FROM ServiceItemProperties AS IP
    INNER JOIN @Items AS FI ON IP.ItemID = FI.ItemID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetServiceItemsByName]
    (
    	@ActorID int,
    	@PackageID int,
    	@ItemName nvarchar(500)
    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    DECLARE @Items TABLE
    (
    	ItemID int
    )

    -- find service items
    INSERT INTO @Items
    SELECT
    	SI.ItemID
    FROM ServiceItems AS SI
    INNER JOIN ServiceItemTypes AS SIT ON SI.ItemTypeID = SIT.ItemTypeID
    WHERE SI.PackageID = @PackageID
    AND SI.ItemName LIKE @ItemName

    -- select service items
    SELECT
    	SI.ItemID,
    	SI.ItemName,
    	SI.ItemTypeID,
    	SIT.TypeName,
    	SI.ServiceID,
    	SI.PackageID,
    	P.PackageName,
    	S.ServiceID,
    	S.ServiceName,
    	SRV.ServerID,
    	SRV.ServerName,
    	RG.GroupName,
    	U.UserID,
    	U.Username,
    	U.FullName AS UserFullName,
    	SI.CreatedDate
    FROM @Items AS FI
    INNER JOIN ServiceItems AS SI ON FI.ItemID = SI.ItemID
    INNER JOIN ServiceItemTypes AS SIT ON SI.ItemTypeID = SIT.ItemTypeID
    INNER JOIN Packages AS P ON SI.PackageID = P.PackageID
    INNER JOIN Services AS S ON SI.ServiceID = S.ServiceID
    INNER JOIN Servers AS SRV ON S.ServerID = SRV.ServerID
    INNER JOIN ResourceGroups AS RG ON SIT.GroupID = RG.GroupID
    INNER JOIN UsersDetailed AS U ON P.UserID = U.UserID

    -- select item properties
    -- get corresponding item properties
    SELECT
    	IP.ItemID,
    	IP.PropertyName,
    	IP.PropertyValue
    FROM ServiceItemProperties AS IP
    INNER JOIN @Items AS FI ON IP.ItemID = FI.ItemID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetServiceItemsByPackage]
    (
    	@ActorID int,
    	@PackageID int
    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    DECLARE @Items TABLE
    (
    	ItemID int
    )

    -- find service items
    INSERT INTO @Items
    SELECT
    	SI.ItemID
    FROM ServiceItems AS SI
    WHERE SI.PackageID = @PackageID

    -- select service items
    SELECT
    	SI.ItemID,
    	SI.ItemName,
    	SI.ItemTypeID,
    	SIT.TypeName,
    	SIT.DisplayName,
    	SI.ServiceID,
    	SI.PackageID,
    	P.PackageName,
    	S.ServiceID,
    	S.ServiceName,
    	SRV.ServerID,
    	SRV.ServerName,
    	RG.GroupName,
    	U.UserID,
    	U.Username,
    	(U.FirstName + U.LastName) AS UserFullName,
    	SI.CreatedDate
    FROM @Items AS FI
    INNER JOIN ServiceItems AS SI ON FI.ItemID = SI.ItemID
    INNER JOIN ServiceItemTypes AS SIT ON SI.ItemTypeID = SIT.ItemTypeID
    INNER JOIN Packages AS P ON SI.PackageID = P.PackageID
    INNER JOIN Services AS S ON SI.ServiceID = S.ServiceID
    INNER JOIN Servers AS SRV ON S.ServerID = SRV.ServerID
    INNER JOIN ResourceGroups AS RG ON SIT.GroupID = RG.GroupID
    INNER JOIN Users AS U ON P.UserID = U.UserID

    -- select item properties
    -- get corresponding item properties
    SELECT
    	IP.ItemID,
    	IP.PropertyName,
    	IP.PropertyValue
    FROM ServiceItemProperties AS IP
    INNER JOIN @Items AS FI ON IP.ItemID = FI.ItemID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetServiceItemsByService]
    (
    	@ActorID int,
    	@ServiceID int
    )
    AS

    -- check rights
    DECLARE @IsAdmin bit
    SET @IsAdmin = dbo.CheckIsUserAdmin(@ActorID)

    DECLARE @Items TABLE
    (
    	ItemID int
    )

    -- find service items
    INSERT INTO @Items
    SELECT
    	SI.ItemID
    FROM ServiceItems AS SI
    WHERE SI.ServiceID = @ServiceID

    -- select service items
    SELECT
    	SI.ItemID,
    	SI.ItemName,
    	SI.ItemTypeID,
    	SIT.TypeName,
    	SI.ServiceID,
    	SI.PackageID,
    	P.PackageName,
    	S.ServiceID,
    	S.ServiceName,
    	SRV.ServerID,
    	SRV.ServerName,
    	RG.GroupName,
    	U.UserID,
    	U.Username,
    	(U.FirstName + U.LastName) AS UserFullName,
    	SI.CreatedDate
    FROM @Items AS FI
    INNER JOIN ServiceItems AS SI ON FI.ItemID = SI.ItemID
    INNER JOIN ServiceItemTypes AS SIT ON SI.ItemTypeID = SIT.ItemTypeID
    INNER JOIN Packages AS P ON SI.PackageID = P.PackageID
    INNER JOIN Services AS S ON SI.ServiceID = S.ServiceID
    INNER JOIN Servers AS SRV ON S.ServerID = SRV.ServerID
    INNER JOIN ResourceGroups AS RG ON SIT.GroupID = RG.GroupID
    INNER JOIN Users AS U ON P.UserID = U.UserID
    WHERE @IsAdmin = 1

    -- select item properties
    -- get corresponding item properties
    SELECT
    	IP.ItemID,
    	IP.PropertyName,
    	IP.PropertyValue
    FROM ServiceItemProperties AS IP
    INNER JOIN @Items AS FI ON IP.ItemID = FI.ItemID
    WHERE @IsAdmin = 1

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetServiceItemsCount]
    (
    	@ItemTypeName nvarchar(200),
    	@GroupName nvarchar(100) = NULL,
    	@ServiceID int = 0,
    	@TotalNumber int OUTPUT
    )
    AS

    SET @TotalNumber = 0

    -- find service items
    SELECT
    	@TotalNumber = COUNT(SI.ItemID)
    FROM ServiceItems AS SI
    INNER JOIN ServiceItemTypes AS IT ON SI.ItemTypeID = IT.ItemTypeID
    INNER JOIN ResourceGroups AS RG ON IT.GroupID = RG.GroupID
    WHERE IT.TypeName = @ItemTypeName
    AND ((@GroupName IS NULL) OR (@GroupName IS NOT NULL AND RG.GroupName = @GroupName))
    AND ((@ServiceID = 0) OR (@ServiceID > 0 AND SI.ServiceID = @ServiceID))

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetServiceItemsCountByNameAndServiceId]
    (
    	@ActorID int,
    	@ServiceId int,
    	@ItemName nvarchar(500),
    	@GroupName nvarchar(100) = NULL,
    	@ItemTypeName nvarchar(200)
    )
    AS
    SELECT Count(*)
    FROM ServiceItems AS SI
    INNER JOIN ServiceItemTypes AS SIT ON SI.ItemTypeID = SIT.ItemTypeID
    INNER JOIN ResourceGroups AS RG ON SIT.GroupID = RG.GroupID
    INNER JOIN Services AS S ON SI.ServiceID = S.ServiceID
    WHERE S.ServiceID = @ServiceId 
    AND SIT.TypeName = @ItemTypeName
    AND SI.ItemName = @ItemName
    AND ((@GroupName IS NULL) OR (@GroupName IS NOT NULL AND RG.GroupName = @GroupName))
    RETURN 
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetServiceItemsForStatistics]
    (
    	@ActorID int,
    	@ServiceID int,
    	@PackageID int,
    	@CalculateDiskspace bit,
    	@CalculateBandwidth bit,
    	@Suspendable bit,
    	@Disposable bit
    )
    AS
    DECLARE @Items TABLE
    (
    	ItemID int
    )

    -- find service items
    INSERT INTO @Items
    SELECT
    	SI.ItemID
    FROM ServiceItems AS SI
    INNER JOIN ServiceItemTypes AS SIT ON SI.ItemTypeID = SIT.ItemTypeID
    WHERE
    	((@ServiceID = 0) OR (@ServiceID > 0 AND SI.ServiceID = @ServiceID))
    	AND ((@PackageID = 0) OR (@PackageID > 0 AND SI.PackageID = @PackageID))
    	AND ((@CalculateDiskspace = 0) OR (@CalculateDiskspace = 1 AND SIT.CalculateDiskspace = @CalculateDiskspace))
    	AND ((@CalculateBandwidth = 0) OR (@CalculateBandwidth = 1 AND SIT.CalculateBandwidth = @CalculateBandwidth))
    	AND ((@Suspendable = 0) OR (@Suspendable = 1 AND SIT.Suspendable = @Suspendable))
    	AND ((@Disposable = 0) OR (@Disposable = 1 AND SIT.Disposable = @Disposable))

    -- select service items
    SELECT
    	SI.ItemID,
    	SI.ItemName,
    	SI.ItemTypeID,
    	RG.GroupName,
    	SIT.TypeName,
    	SI.ServiceID,
    	SI.PackageID,
    	SI.CreatedDate
    FROM @Items AS FI
    INNER JOIN ServiceItems AS SI ON FI.ItemID = SI.ItemID
    INNER JOIN ServiceItemTypes AS SIT ON SI.ItemTypeID = SIT.ItemTypeID
    INNER JOIN ResourceGroups AS RG ON SIT.GroupID = RG.GroupID
    ORDER BY RG.GroupOrder DESC, SI.ItemName

    -- select item properties
    -- get corresponding item properties
    SELECT
    	IP.ItemID,
    	IP.PropertyName,
    	IP.PropertyValue
    FROM ServiceItemProperties AS IP
    INNER JOIN @Items AS FI ON IP.ItemID = FI.ItemID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetServiceItemsPaged]
    (
    	@ActorID int,
    	@PackageID int,
    	@ItemTypeName nvarchar(200),
    	@GroupName nvarchar(100) = NULL,
    	@ServerID int,
    	@Recursive bit,
    	@FilterColumn nvarchar(50) = '',
    	@FilterValue nvarchar(50) = '',
    	@SortColumn nvarchar(50),
    	@StartRow int,
    	@MaximumRows int
    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    -- start
    DECLARE @GroupID int
    SELECT @GroupID = GroupID FROM ResourceGroups
    WHERE GroupName = @GroupName

    DECLARE @ItemTypeID int
    SELECT @ItemTypeID = ItemTypeID FROM ServiceItemTypes
    WHERE TypeName = @ItemTypeName
    AND ((@GroupID IS NULL) OR (@GroupID IS NOT NULL AND GroupID = @GroupID))

    DECLARE @condition nvarchar(700)
    SET @condition = 'SI.ItemTypeID = @ItemTypeID
    AND ((@Recursive = 0 AND P.PackageID = @PackageID)
    		OR (@Recursive = 1 AND dbo.CheckPackageParent(@PackageID, P.PackageID) = 1))
    AND ((@GroupID IS NULL) OR (@GroupID IS NOT NULL AND IT.GroupID = @GroupID))
    AND (@ServerID = 0 OR (@ServerID > 0 AND S.ServerID = @ServerID))
    '

    IF @FilterValue <> '' AND @FilterValue IS NOT NULL
    BEGIN
    	IF @FilterColumn <> '' AND @FilterColumn IS NOT NULL
    		SET @condition = @condition + ' AND ' + @FilterColumn + ' LIKE ''' + @FilterValue + ''''
    	ELSE
    		SET @condition = @condition + '
    			AND (ItemName LIKE ''' + @FilterValue + '''
    			OR Username LIKE ''' + @FilterValue + '''
    			OR FullName LIKE ''' + @FilterValue + '''
    			OR Email LIKE ''' + @FilterValue + ''')'
    END

    IF @SortColumn IS NULL OR @SortColumn = ''
    SET @SortColumn = 'SI.ItemName ASC'

    DECLARE @sql nvarchar(3500)

    set @sql = '
    SELECT COUNT(SI.ItemID) FROM Packages AS P
    INNER JOIN ServiceItems AS SI ON P.PackageID = SI.PackageID
    INNER JOIN UsersDetailed AS U ON P.UserID = U.UserID
    INNER JOIN ServiceItemTypes AS IT ON SI.ItemTypeID = IT.ItemTypeID
    INNER JOIN Services AS S ON SI.ServiceID = S.ServiceID
    WHERE ' + @condition + '

    DECLARE @Items AS TABLE
    (
    	ItemID int
    );

    WITH TempItems AS (
    	SELECT ROW_NUMBER() OVER (ORDER BY ' + @SortColumn + ') as Row,
    		SI.ItemID
    	FROM Packages AS P
    	INNER JOIN ServiceItems AS SI ON P.PackageID = SI.PackageID
    	INNER JOIN UsersDetailed AS U ON P.UserID = U.UserID
    	INNER JOIN ServiceItemTypes AS IT ON SI.ItemTypeID = IT.ItemTypeID
    	INNER JOIN Services AS S ON SI.ServiceID = S.ServiceID
    	INNER JOIN Servers AS SRV ON S.ServerID = SRV.ServerID
    	WHERE ' + @condition + '
    )

    INSERT INTO @Items
    SELECT ItemID FROM TempItems
    WHERE TempItems.Row BETWEEN @StartRow + 1 and @StartRow + @MaximumRows

    SELECT
    	SI.ItemID,
    	SI.ItemName,
    	SI.ItemTypeID,
    	IT.TypeName,
    	SI.ServiceID,
    	SI.PackageID,
    	SI.CreatedDate,
    	RG.GroupName,

    	-- packages
    	P.PackageName,

    	-- server
    	ISNULL(SRV.ServerID, 0) AS ServerID,
    	ISNULL(SRV.ServerName, '''') AS ServerName,
    	ISNULL(SRV.Comments, '''') AS ServerComments,
    	ISNULL(SRV.VirtualServer, 0) AS VirtualServer,

    	-- user
    	P.UserID,
    	U.Username,
    	U.FirstName,
    	U.LastName,
    	U.FullName,
    	U.RoleID,
    	U.Email
    FROM @Items AS TSI
    INNER JOIN ServiceItems AS SI ON TSI.ItemID = SI.ItemID
    INNER JOIN ServiceItemTypes AS IT ON SI.ItemTypeID = IT.ItemTypeID
    INNER JOIN Packages AS P ON SI.PackageID = P.PackageID
    INNER JOIN UsersDetailed AS U ON P.UserID = U.UserID
    INNER JOIN Services AS S ON SI.ServiceID = S.ServiceID
    INNER JOIN Servers AS SRV ON S.ServerID = SRV.ServerID
    INNER JOIN ResourceGroups AS RG ON IT.GroupID = RG.GroupID

    SELECT
    	IP.ItemID,
    	IP.PropertyName,
    	IP.PropertyValue
    FROM ServiceItemProperties AS IP
    INNER JOIN @Items AS TSI ON IP.ItemID = TSI.ItemID'

    --print @sql

    exec sp_executesql @sql, N'@ItemTypeID int, @PackageID int, @GroupID int, @StartRow int, @MaximumRows int, @Recursive bit, @ServerID int',
    @ItemTypeID, @PackageID, @GroupID, @StartRow, @MaximumRows, @Recursive, @ServerID

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetServiceItemType]
    (
    	@ItemTypeID int
    )
    AS
    SELECT
    	[ItemTypeID],
    	[GroupID],
    	[DisplayName],
    	[TypeName],
    	[TypeOrder],
    	[CalculateDiskspace],
    	[CalculateBandwidth],
    	[Suspendable],
    	[Disposable],
    	[Searchable],
    	[Importable],
    	[Backupable]
    FROM
    	[ServiceItemTypes]
    WHERE
    	[ItemTypeID] = @ItemTypeID

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetServiceItemTypes]
    AS
    SELECT
    	[ItemTypeID],
    	[GroupID],
    	[DisplayName],
    	[TypeName],
    	[TypeOrder],
    	[CalculateDiskspace],
    	[CalculateBandwidth],
    	[Suspendable],
    	[Disposable],
    	[Searchable],
    	[Importable],
    	[Backupable]
    FROM
    	[ServiceItemTypes]
    ORDER BY TypeOrder

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetServiceProperties]
    (
    	@ActorID int,
    	@ServiceID int
    )
    AS

    SELECT ServiceID, PropertyName, PropertyValue
    FROM ServiceProperties
    WHERE
    	ServiceID = @ServiceID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetServicesByGroupID]
    (
    	@ActorID int,
    	@GroupID int
    )
    AS
    -- check rights
    DECLARE @IsAdmin bit
    SET @IsAdmin = dbo.CheckIsUserAdmin(@ActorID)

    SELECT
    	S.ServiceID,
    	S.ServiceName,
    	S.ServerID,
    	S.ServiceQuotaValue,
    	SRV.ServerName,
    	S.ProviderID,
    	S.ServiceName+' on '+SRV.ServerName AS FullServiceName
    FROM Services AS S
    INNER JOIN Providers AS PROV ON S.ProviderID = PROV.ProviderID
    INNER JOIN Servers AS SRV ON S.ServerID = SRV.ServerID
    WHERE
    	PROV.GroupID = @GroupID
    	AND @IsAdmin = 1
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetServicesByGroupName]
    (
    	@ActorID int,
    	@GroupName nvarchar(100),
    	@forAutodiscover bit
    )
    AS
    -- check rights
    DECLARE @IsAdmin bit
    SET @IsAdmin = dbo.CheckIsUserAdmin(@ActorID)

    SELECT
    	S.ServiceID,
    	S.ServiceName,
    	S.ServerID,
    	S.ServiceQuotaValue,
    	SRV.ServerName,
    	S.ProviderID,
        PROV.ProviderName,
    	S.ServiceName + ' on ' + SRV.ServerName AS FullServiceName
    FROM Services AS S
    INNER JOIN Providers AS PROV ON S.ProviderID = PROV.ProviderID
    INNER JOIN Servers AS SRV ON S.ServerID = SRV.ServerID
    INNER JOIN ResourceGroups AS RG ON PROV.GroupID = RG.GroupID
    WHERE
    	RG.GroupName = @GroupName
    	AND (@IsAdmin = 1 OR @forAutodiscover = 1)
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetServicesByServerID]
    (
    	@ActorID int,
    	@ServerID int
    )
    AS

    -- check rights
    DECLARE @IsAdmin bit
    SET @IsAdmin = dbo.CheckIsUserAdmin(@ActorID)

    SELECT
    	S.ServiceID,
    	S.ServerID,
    	S.ServiceName,
    	S.Comments,
    	S.ServiceQuotaValue,
    	RG.GroupName,
    	S.ProviderID,
    	PROV.DisplayName AS ProviderName
    FROM Services AS S
    INNER JOIN Providers AS PROV ON S.ProviderID = PROV.ProviderID
    INNER JOIN ResourceGroups AS RG ON PROV.GroupID = RG.GroupID
    WHERE
    	S.ServerID = @ServerID
    	AND @IsAdmin = 1
    ORDER BY RG.GroupOrder

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetServicesByServerIDGroupName]
    (
    	@ActorID int,
    	@ServerID int,
    	@GroupName nvarchar(50)
    )
    AS

    -- check rights
    DECLARE @IsAdmin bit
    SET @IsAdmin = dbo.CheckIsUserAdmin(@ActorID)

    SELECT
    	S.ServiceID,
    	S.ServerID,
    	S.ServiceName,
    	S.Comments,
    	S.ServiceQuotaValue,
    	RG.GroupName,
    	PROV.DisplayName AS ProviderName
    FROM Services AS S
    INNER JOIN Providers AS PROV ON S.ProviderID = PROV.ProviderID
    INNER JOIN ResourceGroups AS RG ON PROV.GroupID = RG.GroupID
    WHERE
    	S.ServerID = @ServerID AND RG.GroupName = @GroupName
    	AND @IsAdmin = 1
    ORDER BY RG.GroupOrder

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetSfBUserPlan] 
    (
    	@SfBUserPlanId int
    )
    AS
    SELECT
    	SfBUserPlanId,
    	ItemID,
    	SfBUserPlanName,
    	SfBUserPlanType,
    	IM,
    	Mobility,
    	MobilityEnableOutsideVoice,
    	Federation,
    	Conferencing,
    	EnterpriseVoice,
    	VoicePolicy,
    	IsDefault,
    	RemoteUserAccess,
    	PublicIMConnectivity,
    	AllowOrganizeMeetingsWithExternalAnonymous,
    	Telephony,
    	ServerURI,
    	ArchivePolicy,
    	TelephonyDialPlanPolicy,
    	TelephonyVoicePolicy

    FROM
    	SfBUserPlans
    WHERE
    	SfBUserPlanId = @SfBUserPlanId
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetSfBUserPlanByAccountId]
    (
    	@AccountID int
    )
    AS
    SELECT
    	SfBUserPlanId,
    	ItemID,
    	SfBUserPlanName,
    	SfBUserPlanType,
    	IM,
    	Mobility,
    	MobilityEnableOutsideVoice,
    	Federation,
    	Conferencing,
    	EnterpriseVoice,
    	VoicePolicy,
    	IsDefault
    FROM
    	SfBUserPlans
    WHERE
    	SfBUserPlanId IN (SELECT SfBUserPlanId FROM SfBUsers WHERE AccountID = @AccountID)
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetSfBUserPlans]
    (
    	@ItemID int
    )
    AS
    SELECT
    	SfBUserPlanId,
    	ItemID,
    	SfBUserPlanName,
    	SfBUserPlanType,
    	IM,
    	Mobility,
    	MobilityEnableOutsideVoice,
    	Federation,
    	Conferencing,
    	EnterpriseVoice,
    	VoicePolicy,
    	IsDefault
    FROM
    	SfBUserPlans
    WHERE
    	ItemID = @ItemID
    ORDER BY SfBUserPlanName
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetSfBUsers]
    (
    	@ItemID int,
    	@SortColumn nvarchar(40),
    	@SortDirection nvarchar(20),
    	@StartRow int,
    	@Count int	
    )
    AS
    BEGIN
    	CREATE TABLE #TempSfBUsers 
    	(	
    		[ID] [int] IDENTITY(1,1) NOT NULL,
    		[AccountID] [int],	
    		[ItemID] [int] NOT NULL,
    		[AccountName] [nvarchar](300)  NOT NULL,
    		[DisplayName] [nvarchar](300)  NOT NULL,
    		[UserPrincipalName] [nvarchar](300) NULL,
    		[SipAddress] [nvarchar](300) NULL,
    		[SamAccountName] [nvarchar](100) NULL,
    		[SfBUserPlanId] [int] NOT NULL,		
    		[SfBUserPlanName] [nvarchar] (300) NOT NULL,		
    	)

    	DECLARE @condition nvarchar(700)
    	SET @condition = ''

    	IF (@SortColumn = 'DisplayName')
    	BEGIN
    		SET @condition = 'ORDER BY ea.DisplayName'
    	END

    	IF (@SortColumn = 'UserPrincipalName')
    	BEGIN
    		SET @condition = 'ORDER BY ea.UserPrincipalName'
    	END

    	IF (@SortColumn = 'SipAddress')
    	BEGIN
    		SET @condition = 'ORDER BY ou.SipAddress'
    	END

    	IF (@SortColumn = 'SfBUserPlanName')
    	BEGIN
    		SET @condition = 'ORDER BY lp.SfBUserPlanName'
    	END

    	DECLARE @sql nvarchar(3500)

    	set @sql = '
    		INSERT INTO 
    			#TempSfBUsers 
    		SELECT 
    			ea.AccountID,
    			ea.ItemID,
    			ea.AccountName,
    			ea.DisplayName,
    			ea.UserPrincipalName,
    			ou.SipAddress,
    			ea.SamAccountName,
    			ou.SfBUserPlanId,
    			lp.SfBUserPlanName				
    		FROM 
    			ExchangeAccounts ea 
    		INNER JOIN 
    			SfBUsers ou
    		INNER JOIN
    			SfBUserPlans lp 
    		ON
    			ou.SfBUserPlanId = lp.SfBUserPlanId				
    		ON 
    			ea.AccountID = ou.AccountID
    		WHERE 
    			ea.ItemID = @ItemID ' + @condition

    	exec sp_executesql @sql, N'@ItemID int',@ItemID

    	DECLARE @RetCount int
    	SELECT @RetCount = COUNT(ID) FROM #TempSfBUsers 

    	IF (@SortDirection = 'ASC')
    	BEGIN
    		SELECT * FROM #TempSfBUsers 
    		WHERE ID > @StartRow AND ID <= (@StartRow + @Count) 
    	END
    	ELSE
    	BEGIN
    		IF @SortColumn <> '' AND @SortColumn IS NOT NULL
    		BEGIN
    			IF (@SortColumn = 'DisplayName')
    			BEGIN
    				SELECT * FROM #TempSfBUsers 
    					WHERE ID >@RetCount - @Count - @StartRow AND ID <= @RetCount- @StartRow  ORDER BY DisplayName DESC
    			END
    			IF (@SortColumn = 'UserPrincipalName')
    			BEGIN
    				SELECT * FROM #TempSfBUsers 
    					WHERE ID >@RetCount - @Count - @StartRow AND ID <= @RetCount- @StartRow  ORDER BY UserPrincipalName DESC
    			END

    			IF (@SortColumn = 'SipAddress')
    			BEGIN
    				SELECT * FROM #TempSfBUsers 
    					WHERE ID >@RetCount - @Count - @StartRow AND ID <= @RetCount- @StartRow  ORDER BY SipAddress DESC
    			END

    			IF (@SortColumn = 'SfBUserPlanName')
    			BEGIN
    				SELECT * FROM #TempSfBUsers 
    					WHERE ID >@RetCount - @Count - @StartRow AND ID <= @RetCount- @StartRow  ORDER BY SfBUserPlanName DESC
    			END
    		END
    		ELSE
    		BEGIN
    			SELECT * FROM #TempSfBUsers 
    				WHERE ID >@RetCount - @Count - @StartRow AND ID <= @RetCount- @StartRow  ORDER BY UserPrincipalName DESC
    		END	
    	END
    	DROP TABLE #TempSfBUsers
    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetSfBUsersByPlanId]
    (
    	@ItemID int,
    	@PlanId int
    )
    AS

    	SELECT
    		ea.AccountID,
    		ea.ItemID,
    		ea.AccountName,
    		ea.DisplayName,
    		ea.UserPrincipalName,
    		ea.SamAccountName,
    		ou.SfBUserPlanId,
    		lp.SfBUserPlanName
    	FROM
    		ExchangeAccounts ea
    	INNER JOIN
    		SfBUsers ou
    	INNER JOIN
    		SfBUserPlans lp
    	ON
    		ou.SfBUserPlanId = lp.SfBUserPlanId
    	ON
    		ea.AccountID = ou.AccountID
    	WHERE
    		ea.ItemID = @ItemID AND
    		ou.SfBUserPlanId = @PlanId
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetSfBUsersCount]
    (
    	@ItemID int
    )
    AS

    SELECT
    	COUNT(ea.AccountID)
    FROM
    	ExchangeAccounts ea
    INNER JOIN
    	SfBUsers ou
    ON
    	ea.AccountID = ou.AccountID
    WHERE
    	ea.ItemID = @ItemID

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetSiteCert]
    (
    	@ActorID int,
    	@ID int
    )
    AS

    SELECT
    	[UserID], [SiteID], [Hostname], [CSR], [Certificate], [Hash], [Installed], [IsRenewal]
    FROM
    	[dbo].[SSLCertificates]
    INNER JOIN
    	[dbo].[ServiceItems] AS [SI] ON [SSLCertificates].[SiteID] = [SI].[ItemID]
    WHERE
    	[SiteID] = @ID AND [Installed] = 1 AND [dbo].CheckActorPackageRights(@ActorID, [SI].[PackageID]) = 1
    RETURN

    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetSSLCertificateByID]
    (
    	@ActorID int,
    	@ID int
    )
    AS

    SELECT
    	[ID], [UserID], [SiteID], [Hostname], [FriendlyName], [CSR], [Certificate], [Hash], [Installed], [IsRenewal], [PreviousId]
    FROM
    	[dbo].[SSLCertificates]
    INNER JOIN
    	[dbo].[ServiceItems] AS [SI] ON [SSLCertificates].[SiteID] = [SI].[ItemID]
    WHERE
    	[ID] = @ID AND [dbo].CheckActorPackageRights(@ActorID, [SI].[PackageID]) = 1

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetStorageSpaceById]
    (
    	@Id INT
    )
    AS
    	SELECT TOP 1
    		SS.Id,
    		SS.Name ,
    		SS.ServiceId ,
    		SS.ServerId ,
    		SS.LevelId,
    		SS.Path,
    		SS.FsrmQuotaType,
    		SS.FsrmQuotaSizeBytes,
    		SS.IsShared,
    		SS.UncPath,
    		SS.IsDisabled,
    		ISNULL((SELECT SUM(SSF.FsrmQuotaSizeBytes) FROM StorageSpaceFolders AS SSF WHERE SSF.StorageSpaceId = SS.Id), 0) UsedSizeBytes
    	FROM [dbo].[StorageSpaces] AS SS
    	WHERE SS.Id = @Id
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetStorageSpaceByServiceAndPath] 
    (
    	@ServerId INT,
    	@Path varchar(max)
    )
    AS
    SELECT TOP 1
    		SS.Id,
    		SS.Name ,
    		SS.ServiceId ,
    		SS.ServerId ,
    		SS.LevelId,
    		SS.Path,
    		SS.FsrmQuotaType,
    		SS.FsrmQuotaSizeBytes,
    		SS.IsShared,
    		SS.UncPath,
    		SS.IsDisabled,
    		ISNULL((SELECT SUM(SSF.FsrmQuotaSizeBytes) FROM StorageSpaceFolders AS SSF WHERE SSF.StorageSpaceId = SS.Id), 0) UsedSizeBytes
    FROM StorageSpaces AS SS
    WHERE SS.ServerId = @ServerId AND SS.Path = @Path
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetStorageSpaceFolderById]
    (
    	@ID INT
    )
    AS
    SELECT TOP 1
    	Id,
    	Name,
    	StorageSpaceId,
    	Path,
    	UncPath,
    	IsShared,
    	FsrmQuotaType,
    	FsrmQuotaSizeBytes
    FROM StorageSpaceFolders
    WHERE Id = @ID
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetStorageSpaceFoldersByStorageSpaceId]
    (
    	@StorageSpaceId INT
    )
    AS
    SELECT 
    	Id,
    	Name,
    	StorageSpaceId,
    	Path,
    	UncPath,
    	IsShared,
    	FsrmQuotaType,
    	FsrmQuotaSizeBytes
    FROM StorageSpaceFolders
    WHERE StorageSpaceId = @StorageSpaceId
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetStorageSpaceLevelById] 
    (
    @ID INT
    )
    AS
    SELECT TOP 1
    	SL.Id,
    	Sl.Name,
    	SL.Description
    FROM StorageSpaceLevels AS SL
    WHERE SL.Id = @ID
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetStorageSpaceLevelsPaged]
    (
    	@FilterColumn nvarchar(50) = '',
    	@FilterValue nvarchar(50) = '',
    	@SortColumn nvarchar(50),
    	@StartRow int,
    	@MaximumRows int
    )
    AS
    -- build query and run it to the temporary table
    DECLARE @sql nvarchar(2000)

    SET @sql = '

    DECLARE @EndRow int
    SET @EndRow = @StartRow + @MaximumRows
    DECLARE @SSLevels TABLE
    (
    	ItemPosition int IDENTITY(0,1),
    	SSLevelId int
    )
    INSERT INTO @SSLevels (SSLevelId)
    SELECT
    	S.ID
    FROM StorageSpaceLevels AS S'

    IF @FilterColumn <> '' AND @FilterValue <> ''
    SET @sql = @sql + ' WHERE ' + @FilterColumn + ' LIKE @FilterValue '

    IF @SortColumn <> '' AND @SortColumn IS NOT NULL
    SET @sql = @sql + ' ORDER BY ' + @SortColumn + ' '

    SET @sql = @sql + ' SELECT COUNT(SSLevelId) FROM @SSLevels;
    SELECT
    	CR.ID,
    	CR.Name,
    	CR.Description
    FROM @SSLevels AS C
    INNER JOIN StorageSpaceLevels AS CR ON C.SSLevelId = CR.ID
    WHERE C.ItemPosition BETWEEN @StartRow AND @EndRow'

    exec sp_executesql @sql, N'@StartRow int, @MaximumRows int,  @FilterValue nvarchar(50)',
    @StartRow, @MaximumRows,  @FilterValue

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetStorageSpacesByLevelId] 
    (
    	@LevelId INT
    )
    AS
    SELECT
    		SS.Id,
    		SS.Name ,
    		SS.ServiceId ,
    		SS.ServerId ,
    		SS.LevelId,
    		SS.Path,
    		SS.FsrmQuotaType,
    		SS.FsrmQuotaSizeBytes,
    		SS.IsShared,
    		SS.UncPath,
    		SS.IsDisabled,
    		ISNULL((SELECT SUM(SSF.FsrmQuotaSizeBytes) FROM StorageSpaceFolders AS SSF WHERE SSF.StorageSpaceId = SS.Id), 0) UsedSizeBytes
    FROM StorageSpaces AS SS
    INNER JOIN StorageSpaceLevels AS SSL
    ON SSL.Id = SS.LevelId
    WHERE SS.LevelId = @LevelId
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetStorageSpacesByResourceGroupName] 
    (
    	@ResourceGroupName varchar(max)
    )
    AS
    SELECT
    		SS.Id,
    		SS.Name ,
    		SS.ServiceId ,
    		SS.ServerId ,
    		SS.LevelId,
    		SS.Path,
    		SS.FsrmQuotaType,
    		SS.FsrmQuotaSizeBytes,
    		SS.IsShared,
    		SS.UncPath,
    		SS.IsDisabled,
    		ISNULL((SELECT SUM(SSF.FsrmQuotaSizeBytes) FROM StorageSpaceFolders AS SSF WHERE SSF.StorageSpaceId = SS.Id), 0) UsedSizeBytes
    FROM StorageSpaces AS SS
    INNER JOIN StorageSpaceLevelResourceGroups AS SSLRG ON SSLRG.LevelId = SS.LevelId
    INNER JOIN ResourceGroups AS RG ON SSLRG.GroupID = RG.GroupID
    WHERE RG.GroupName = @ResourceGroupName
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetStorageSpacesPaged]
    (
    	@FilterColumn nvarchar(50) = '',
    	@FilterValue nvarchar(50) = '',
    	@SortColumn nvarchar(50),
    	@StartRow int,
    	@MaximumRows int
    )
    AS
    -- build query and run it to the temporary table
    DECLARE @sql nvarchar(2500)

    SET @sql = '

    DECLARE @EndRow int
    SET @EndRow = @StartRow + @MaximumRows
    DECLARE @Spaces TABLE
    (
    	ItemPosition int IDENTITY(0,1),
    	SpaceId int
    )
    INSERT INTO @Spaces (SpaceId)
    SELECT
    	S.Id
    FROM StorageSpaces AS S'

    IF @FilterColumn <> '' AND @FilterValue <> ''
    SET @sql = @sql + ' WHERE ' + @FilterColumn + ' LIKE @FilterValue '

    IF @SortColumn <> '' AND @SortColumn IS NOT NULL
    SET @sql = @sql + ' ORDER BY ' + @SortColumn + ' '

    SET @sql = @sql + ' SELECT COUNT(SpaceId) FROM @Spaces;
    SELECT
    		CR.Id,
    		CR.Name ,
    		CR.ServiceId ,
    		CR.ServerId ,
    		CR.LevelId,
    		CR.Path,
    		CR.FsrmQuotaType,
    		CR.FsrmQuotaSizeBytes,
    		CR.IsShared,
    		CR.IsDisabled,
    		CR.UncPath,
    		ISNULL((SELECT SUM(SSF.FsrmQuotaSizeBytes) FROM StorageSpaceFolders AS SSF WHERE SSF.StorageSpaceId = CR.Id), 0) UsedSizeBytes
    FROM @Spaces AS C
    INNER JOIN StorageSpaces AS CR ON C.SpaceId = CR.Id
    WHERE C.ItemPosition BETWEEN @StartRow AND @EndRow'

    exec sp_executesql @sql, N'@StartRow int, @MaximumRows int,  @FilterValue nvarchar(50)',
    @StartRow, @MaximumRows,  @FilterValue

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetSupportServiceLevel]
    (
    	@LevelID int
    )
    AS
    SELECT *
    FROM SupportServiceLevels
    WHERE LevelID = @LevelID
    RETURN 
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetSupportServiceLevels]
    AS
    SELECT *
    FROM SupportServiceLevels
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetSystemSettings]
    	@SettingsName nvarchar(50)
    AS
    BEGIN

    	SET NOCOUNT ON;

        SELECT
    		[PropertyName],
    		[PropertyValue]
    	FROM
    		[dbo].[SystemSettings]
    	WHERE
    		[SettingsName] = @SettingsName;

    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetThemes]
    AS
    BEGIN
    	SET NOCOUNT ON;
        SELECT
    		ThemeID,
    		DisplayName,
    		LTRName,
    		RTLName,
    		DisplayOrder
    	FROM
    		Themes
    	WHERE
    		Enabled = '1'
    	ORDER BY 
    		DisplayOrder;
    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetThemeSetting]
    (
    	@ThemeID int,
    	@SettingsName NVARCHAR(255)
    )
    AS
    BEGIN
    	SET NOCOUNT ON;
        SELECT
    		ThemeID,
    		SettingsName,
    		PropertyName,
    		PropertyValue
    	FROM
    		ThemeSettings
    	WHERE
    		ThemeID = @ThemeID
    		AND SettingsName = @SettingsName;
    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetThemeSettings]
    (
    	@ThemeID int
    )
    AS
    BEGIN
    	SET NOCOUNT ON;
        SELECT
    		ThemeID,
    		SettingsName,
    		PropertyName,
    		PropertyValue
    	FROM
    		ThemeSettings
    	WHERE
    		ThemeID = @ThemeID;
    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetThreadBackgroundTasks]
    (
    	@Guid UNIQUEIDENTIFIER
    )
    AS

    SELECT
    	T.ID,
    	T.Guid,
    	T.TaskID,
    	T.ScheduleId,
    	T.PackageId,
    	T.UserId,
    	T.EffectiveUserId,
    	T.TaskName,
    	T.ItemId,
    	T.ItemName,
    	T.StartDate,
    	T.FinishDate,
    	T.IndicatorCurrent,
    	T.IndicatorMaximum,
    	T.MaximumExecutionTime,
    	T.Source,
    	T.Severity,
    	T.Completed,
    	T.NotifyOnComplete,
    	T.Status
    FROM BackgroundTasks AS T
    INNER JOIN BackgroundTaskStack AS TS
    	ON TS.TaskId = T.ID
    WHERE T.Guid = @Guid
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetUnallottedIPAddresses]
     @PackageID int,
     @ServiceID int,
     @PoolID int = 0
    AS
    BEGIN
     DECLARE @ParentPackageID int
     DECLARE @ServerID int
    IF (@PackageID = -1) -- NO PackageID defined, use ServerID from ServiceID (VPS Import)
    BEGIN
     SELECT
      @ServerID = ServerID,
      @ParentPackageID = 1
     FROM Services
     WHERE ServiceID = @ServiceID
    END
    ELSE
    BEGIN
     SELECT
      @ParentPackageID = ParentPackageID,
      @ServerID = ServerID
     FROM Packages
     WHERE PackageID = @PackageId
    END

    IF (@ParentPackageID = 1 OR @PoolID = 4 /* management network */) -- "System" space
    BEGIN
      -- check if server is physical
      IF EXISTS(SELECT * FROM Servers WHERE ServerID = @ServerID AND VirtualServer = 0)
      BEGIN
       -- physical server
       SELECT
        IP.AddressID,
        IP.ExternalIP,
        IP.InternalIP,
        IP.ServerID,
        IP.PoolID,
        IP.SubnetMask,
        IP.DefaultGateway,
        IP.VLAN
       FROM dbo.IPAddresses AS IP
       WHERE
        (IP.ServerID = @ServerID OR IP.ServerID IS NULL)
        AND IP.AddressID NOT IN (SELECT PIP.AddressID FROM dbo.PackageIPAddresses AS PIP)
        AND (@PoolID = 0 OR @PoolID <> 0 AND IP.PoolID = @PoolID)
       ORDER BY IP.ServerID DESC, IP.DefaultGateway, IP.ExternalIP
      END
      ELSE
      BEGIN
       -- virtual server
       -- get resource group by service
       DECLARE @GroupID int
       SELECT @GroupID = P.GroupID FROM Services AS S
       INNER JOIN Providers AS P ON S.ProviderID = P.ProviderID
       WHERE S.ServiceID = @ServiceID
       SELECT
        IP.AddressID,
        IP.ExternalIP,
        IP.InternalIP,
        IP.ServerID,
        IP.PoolID,
        IP.SubnetMask,
        IP.DefaultGateway,
        IP.VLAN
       FROM dbo.IPAddresses AS IP
       WHERE
        (IP.ServerID IN (
         SELECT SVC.ServerID FROM [dbo].[Services] AS SVC
         INNER JOIN [dbo].[Providers] AS P ON SVC.ProviderID = P.ProviderID
         WHERE [SVC].[ServiceID] = @ServiceId AND P.GroupID = @GroupID
        ) OR IP.ServerID IS NULL)
        AND IP.AddressID NOT IN (SELECT PIP.AddressID FROM dbo.PackageIPAddresses AS PIP)
        AND (@PoolID = 0 OR @PoolID <> 0 AND IP.PoolID = @PoolID)
       ORDER BY IP.ServerID DESC, IP.DefaultGateway, IP.ExternalIP
      END
     END
     ELSE -- 2rd level space and below
     BEGIN
      -- get service location
      SELECT @ServerID = S.ServerID FROM Services AS S
      WHERE S.ServiceID = @ServiceID
      SELECT
       IP.AddressID,
       IP.ExternalIP,
       IP.InternalIP,
       IP.ServerID,
       IP.PoolID,
       IP.SubnetMask,
       IP.DefaultGateway,
       IP.VLAN
      FROM dbo.PackageIPAddresses AS PIP
      INNER JOIN IPAddresses AS IP ON PIP.AddressID = IP.AddressID
      WHERE
       PIP.PackageID = @ParentPackageID
       AND PIP.ItemID IS NULL
       AND (@PoolID = 0 OR @PoolID <> 0 AND IP.PoolID = @PoolID)
       AND (IP.ServerID = @ServerID OR IP.ServerID IS NULL)
      ORDER BY IP.ServerID DESC, IP.DefaultGateway, IP.ExternalIP
     END
    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetUnallottedVLANs]
     @PackageID int,
     @ServiceID int
    AS
    BEGIN
     DECLARE @ParentPackageID int
     DECLARE @ServerID int
    IF (@PackageID = -1) -- NO PackageID defined, use ServerID from ServiceID (VPS Import)
    BEGIN
     SELECT
      @ServerID = ServerID,
      @ParentPackageID = 1
     FROM Services
     WHERE ServiceID = @ServiceID
    END
    ELSE
    BEGIN
     SELECT
      @ParentPackageID = ParentPackageID,
      @ServerID = ServerID
     FROM Packages
     WHERE PackageID = @PackageId
    END

    IF @ParentPackageID = 1 -- "System" space
    BEGIN
      -- check if server is physical
      IF EXISTS(SELECT * FROM Servers WHERE ServerID = @ServerID AND VirtualServer = 0)
      BEGIN
       -- physical server
       SELECT
        V.VlanID,
        V.Vlan,
        V.ServerID
       FROM dbo.PrivateNetworkVLANs AS V
       WHERE
        (V.ServerID = @ServerID OR V.ServerID IS NULL)
        AND V.VlanID NOT IN (SELECT PV.VlanID FROM dbo.PackageVLANs AS PV)
       ORDER BY V.ServerID DESC, V.Vlan
      END
      ELSE
      BEGIN
       -- virtual server
       -- get resource group by service
       DECLARE @GroupID int
       SELECT @GroupID = P.GroupID FROM Services AS S
       INNER JOIN Providers AS P ON S.ProviderID = P.ProviderID
       WHERE S.ServiceID = @ServiceID
       SELECT
        V.VlanID,
        V.Vlan,
        V.ServerID
       FROM dbo.PrivateNetworkVLANs AS V
       WHERE
        (V.ServerID IN (
         SELECT SVC.ServerID FROM [dbo].[Services] AS SVC
         INNER JOIN [dbo].[Providers] AS P ON SVC.ProviderID = P.ProviderID
         WHERE [SVC].[ServiceID] = @ServiceId AND P.GroupID = @GroupID
        ) OR V.ServerID IS NULL)
        AND V.VlanID NOT IN (SELECT PV.VlanID FROM dbo.PackageVLANs AS PV)
       ORDER BY V.ServerID DESC, V.Vlan
      END
     END
     ELSE -- 2rd level space and below
     BEGIN
      -- get service location
      SELECT @ServerID = S.ServerID FROM Services AS S
      WHERE S.ServiceID = @ServiceID
      SELECT
       V.VlanID,
       V.Vlan,
       V.ServerID
      FROM dbo.PackageVLANs AS PV
      INNER JOIN PrivateNetworkVLANs AS V ON PV.VlanID = V.VlanID
      WHERE
       PV.PackageID = @ParentPackageID
       AND (V.ServerID = @ServerID OR V.ServerID IS NULL)
      ORDER BY V.ServerID DESC, V.Vlan
     END
    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetUserAvailableHostingAddons]
    (
    	@ActorID int,
    	@UserID int
    )
    AS

    -- user should see the plans only of his reseller
    -- also user can create packages based on his own plans (admins and resellers)

    DECLARE @Plans TABLE
    (
    	PlanID int
    )

    -- check rights
    IF dbo.CheckActorUserRights(@ActorID, @UserID) = 0
    RAISERROR('You are not allowed to access this account', 16, 1)

    DECLARE @OwnerID int
    SELECT @OwnerID = OwnerID FROM Users
    WHERE UserID = @UserID

    SELECT
    	HP.PlanID,
    	HP.PackageID,
    	HP.PlanName,
    	HP.PlanDescription,
    	HP.Available,
    	HP.ServerID,
    	HP.SetupPrice,
    	HP.RecurringPrice,
    	HP.RecurrenceLength,
    	HP.RecurrenceUnit,
    	HP.IsAddon
    FROM
    	HostingPlans AS HP
    WHERE HP.UserID = @OwnerID
    AND HP.IsAddon = 1
    ORDER BY PlanName
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetUserAvailableHostingPlans]
    (
    	@ActorID int,
    	@UserID int
    )
    AS

    -- user should see the plans only of his reseller
    -- also user can create packages based on his own plans (admins and resellers)

    DECLARE @Plans TABLE
    (
    	PlanID int
    )

    -- check rights
    IF dbo.CheckActorUserRights(@ActorID, @UserID) = 0
    RAISERROR('You are not allowed to access this account', 16, 1)

    DECLARE @OwnerID int
    SELECT @OwnerID = OwnerID FROM Users
    WHERE UserID = @UserID

    SELECT
    	HP.PlanID,
    	HP.PackageID,
    	HP.PlanName,
    	HP.PlanDescription,
    	HP.Available,
    	HP.ServerID,
    	HP.SetupPrice,
    	HP.RecurringPrice,
    	HP.RecurrenceLength,
    	HP.RecurrenceUnit,
    	HP.IsAddon
    FROM
    	HostingPlans AS HP
    WHERE HP.UserID = @OwnerID
    AND HP.IsAddon = 0
    ORDER BY PlanName
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetUserByExchangeOrganizationIdInternally]
    (
    	@ItemID int
    )
    AS
    	SELECT
    		U.UserID,
    		U.RoleID,
    		U.StatusID,
    		U.SubscriberNumber,
    		U.LoginStatusId,
    		U.FailedLogins,
    		U.OwnerID,
    		U.Created,
    		U.Changed,
    		U.IsDemo,
    		U.Comments,
    		U.IsPeer,
    		U.Username,
    		U.Password,
    		U.FirstName,
    		U.LastName,
    		U.Email,
    		U.SecondaryEmail,
    		U.Address,
    		U.City,
    		U.State,
    		U.Country,
    		U.Zip,
    		U.PrimaryPhone,
    		U.SecondaryPhone,
    		U.Fax,
    		U.InstantMessenger,
    		U.HtmlMail,
    		U.CompanyName,
    		U.EcommerceEnabled,
    		U.[AdditionalParams]
    	FROM Users AS U
    	WHERE U.UserID IN (SELECT UserID FROM Packages WHERE PackageID IN (
    	SELECT PackageID FROM ServiceItems WHERE ItemID = @ItemID))

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetUserById]
    (
    	@ActorID int,
    	@UserID int
    )
    AS
    	-- user can retrieve his own account, his users accounts
    	-- and his reseller account (without password)
    	SELECT
    		U.UserID,
    		U.RoleID,
    		U.StatusID,
    		U.SubscriberNumber,
    		U.LoginStatusId,
    		U.FailedLogins,
    		U.OwnerID,
    		U.Created,
    		U.Changed,
    		U.IsDemo,
    		U.Comments,
    		U.IsPeer,
    		U.Username,
    		CASE WHEN dbo.CanGetUserPassword(@ActorID, @UserID) = 1 THEN U.Password
    		ELSE '' END AS Password,
    		U.FirstName,
    		U.LastName,
    		U.Email,
    		U.SecondaryEmail,
    		U.Address,
    		U.City,
    		U.State,
    		U.Country,
    		U.Zip,
    		U.PrimaryPhone,
    		U.SecondaryPhone,
    		U.Fax,
    		U.InstantMessenger,
    		U.HtmlMail,
    		U.CompanyName,
    		U.EcommerceEnabled,
    		U.[AdditionalParams],
    		U.MfaMode,
    		CASE WHEN dbo.CanGetUserPassword(@ActorID, @UserID) = 1 THEN U.PinSecret
    		ELSE '' END AS PinSecret
    	FROM Users AS U
    	WHERE U.UserID = @UserID
    	AND dbo.CanGetUserDetails(@ActorID, @UserID) = 1 -- actor user rights

    	RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetUserByIdInternally]
    (
    	@UserID int
    )
    AS
    	SELECT
    		U.UserID,
    		U.RoleID,
    		U.StatusID,
    		U.SubscriberNumber,
    		U.LoginStatusId,
    		U.FailedLogins,
    		U.OwnerID,
    		U.Created,
    		U.Changed,
    		U.IsDemo,
    		U.Comments,
    		U.IsPeer,
    		U.Username,
    		U.Password,
    		U.FirstName,
    		U.LastName,
    		U.Email,
    		U.SecondaryEmail,
    		U.Address,
    		U.City,
    		U.State,
    		U.Country,
    		U.Zip,
    		U.PrimaryPhone,
    		U.SecondaryPhone,
    		U.Fax,
    		U.InstantMessenger,
    		U.HtmlMail,
    		U.CompanyName,
    		U.EcommerceEnabled,
    		U.[AdditionalParams],
    		U.OneTimePasswordState,
    		U.MfaMode,
    		U.PinSecret
    	FROM Users AS U
    	WHERE U.UserID = @UserID

    	RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetUserByUsername]
    (
    	@ActorID int,
    	@Username nvarchar(50)
    )
    AS

    	SELECT
    		U.UserID,
    		U.RoleID,
    		U.StatusID,
    		U.SubscriberNumber,
    		U.LoginStatusId,
    		U.FailedLogins,
    		U.OwnerID,
    		U.Created,
    		U.Changed,
    		U.IsDemo,
    		U.Comments,
    		U.IsPeer,
    		U.Username,
    		CASE WHEN dbo.CanGetUserPassword(@ActorID, UserID) = 1 THEN U.Password
    		ELSE '' END AS Password,
    		U.FirstName,
    		U.LastName,
    		U.Email,
    		U.SecondaryEmail,
    		U.Address,
    		U.City,
    		U.State,
    		U.Country,
    		U.Zip,
    		U.PrimaryPhone,
    		U.SecondaryPhone,
    		U.Fax,
    		U.InstantMessenger,
    		U.HtmlMail,
    		U.CompanyName,
    		U.EcommerceEnabled,
    		U.[AdditionalParams],
    		U.MfaMode,
    		CASE WHEN dbo.CanGetUserPassword(@ActorID, UserID) = 1 THEN U.PinSecret
    		ELSE '' END AS PinSecret
    	FROM Users AS U
    	WHERE U.Username = @Username
    	AND dbo.CanGetUserDetails(@ActorID, UserID) = 1 -- actor user rights

    	RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetUserByUsernameInternally]
    (
    	@Username nvarchar(50)
    )
    AS
    	SELECT
    		U.UserID,
    		U.RoleID,
    		U.StatusID,
    		U.SubscriberNumber,
    		U.LoginStatusId,
    		U.FailedLogins,
    		U.OwnerID,
    		U.Created,
    		U.Changed,
    		U.IsDemo,
    		U.Comments,
    		U.IsPeer,
    		U.Username,
    		U.Password,
    		U.FirstName,
    		U.LastName,
    		U.Email,
    		U.SecondaryEmail,
    		U.Address,
    		U.City,
    		U.State,
    		U.Country,
    		U.Zip,
    		U.PrimaryPhone,
    		U.SecondaryPhone,
    		U.Fax,
    		U.InstantMessenger,
    		U.HtmlMail,
    		U.CompanyName,
    		U.EcommerceEnabled,
    		U.[AdditionalParams],
    		U.OneTimePasswordState,
    		U.MfaMode,
    		U.PinSecret

    	FROM Users AS U
    	WHERE U.Username = @Username

    	RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetUserDomainsPaged]
    (
    	@ActorID int,
    	@UserID int,
    	@FilterColumn nvarchar(50) = '',
    	@FilterValue nvarchar(50) = '',
    	@SortColumn nvarchar(50),
    	@StartRow int,
    	@MaximumRows int
    )
    AS
    -- build query and run it to the temporary table
    DECLARE @sql nvarchar(2000)

    SET @sql = '
    DECLARE @HasUserRights bit
    SET @HasUserRights = dbo.CheckActorUserRights(@ActorID, @UserID)

    DECLARE @EndRow int
    SET @EndRow = @StartRow + @MaximumRows
    DECLARE @Users TABLE
    (
    	ItemPosition int IDENTITY(1,1),
    	UserID int,
    	DomainID int
    )
    INSERT INTO @Users (UserID, DomainID)
    SELECT
    	U.UserID,
    	D.DomainID
    FROM Users AS U
    INNER JOIN UsersTree(@UserID, 1) AS UT ON U.UserID = UT.UserID
    LEFT OUTER JOIN Packages AS P ON U.UserID = P.UserID
    LEFT OUTER JOIN Domains AS D ON P.PackageID = D.PackageID
    WHERE
    	U.UserID <> @UserID AND U.IsPeer = 0
    	AND @HasUserRights = 1 '

    IF @FilterColumn <> '' AND @FilterValue <> ''
    SET @sql = @sql + ' AND ' + @FilterColumn + ' LIKE @FilterValue '

    IF @SortColumn <> '' AND @SortColumn IS NOT NULL
    SET @sql = @sql + ' ORDER BY ' + @SortColumn + ' '

    SET @sql = @sql + ' SELECT COUNT(UserID) FROM @Users;
    SELECT
    	U.UserID,
    	U.RoleID,
    	U.StatusID,
    	U.SubscriberNumber,
    	U.LoginStatusId,
    	U.FailedLogins,
    	U.OwnerID,
    	U.Created,
    	U.Changed,
    	U.IsDemo,
    	U.Comments,
    	U.IsPeer,
    	U.Username,
    	U.FirstName,
    	U.LastName,
    	U.Email,
    	D.DomainName
    FROM @Users AS TU
    INNER JOIN Users AS U ON TU.UserID = U.UserID
    LEFT OUTER JOIN Domains AS D ON TU.DomainID = D.DomainID
    WHERE TU.ItemPosition BETWEEN @StartRow AND @EndRow'

    exec sp_executesql @sql, N'@StartRow int, @MaximumRows int, @UserID int, @FilterValue nvarchar(50), @ActorID int',
    @StartRow, @MaximumRows, @UserID, @FilterValue, @ActorID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetUserEnterpriseFolderWithOwaEditPermission]
    (
    	@ItemID INT,
    	@AccountID INT
    )
    AS
    SELECT 
    	EF.FolderName
    	FROM EnterpriseFoldersOwaPermissions AS EFOP
    	LEFT JOIN  [dbo].[EnterpriseFolders] AS EF ON EF.EnterpriseFolderID = EFOP.FolderID
    	WHERE EFOP.ItemID = @ItemID AND EFOP.AccountID = @AccountID
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetUserPackagesServerUrls]
    (
    	@UserId INT
    )
    AS
    	SELECT DISTINCT Servers.ServerUrl
    	FROM Servers
    	INNER JOIN Packages
    	ON Servers.ServerId = Packages.ServerId
    	WHERE Packages.UserID = @UserId
    	RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetUserParents]
    (
    	@ActorID int,
    	@UserID int
    )
    AS

    -- check rights
    IF dbo.CheckActorUserRights(@ActorID, @UserID) = 0
    RAISERROR('You are not allowed to access this account', 16, 1)

    SELECT
    	U.UserID,
    	U.RoleID,
    	U.StatusID,
    	U.SubscriberNumber,
    	U.LoginStatusId,
    	U.FailedLogins,
    	U.OwnerID,
    	U.Created,
    	U.Changed,
    	U.IsDemo,
    	U.Comments,
    	U.IsPeer,
    	U.Username,
    	U.FirstName,
    	U.LastName,
    	U.Email,
    	U.CompanyName,
    	U.EcommerceEnabled
    FROM UserParents(@ActorID, @UserID) AS UP
    INNER JOIN Users AS U ON UP.UserID = U.UserID
    ORDER BY UP.UserOrder DESC
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetUserPeers]
    (
    	@ActorID int,
    	@UserID int
    )
    AS

    DECLARE @CanGetDetails bit
    SET @CanGetDetails = dbo.CanGetUserDetails(@ActorID, @UserID)

    SELECT
    	U.UserID,
    	U.RoleID,
    	U.StatusID,
    	U.LoginStatusId,
    	U.FailedLogins,
    	U.OwnerID,
    	U.Created,
    	U.Changed,
    	U.IsDemo,
    	U.Comments,
    	U.IsPeer,
    	U.Username,
    	U.FirstName,
    	U.LastName,
    	U.Email,
    	U.FullName,
    	(U.FirstName + ' ' + U.LastName) AS FullName,
    	U.CompanyName,
    	U.EcommerceEnabled
    FROM UsersDetailed AS U
    WHERE U.OwnerID = @UserID AND IsPeer = 1
    AND @CanGetDetails = 1 -- actor rights

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetUsers]
    (
    	@ActorID int,
    	@OwnerID int,
    	@Recursive bit = 0
    )
    AS

    DECLARE @CanGetDetails bit
    SET @CanGetDetails = dbo.CanGetUserDetails(@ActorID, @OwnerID)

    SELECT
    	U.UserID,
    	U.RoleID,
    	U.StatusID,
    	U.SubscriberNumber,
    	U.LoginStatusId,
    	U.FailedLogins,
    	U.OwnerID,
    	U.Created,
    	U.Changed,
    	U.IsDemo,
    	U.Comments,
    	U.IsPeer,
    	U.Username,
    	U.FirstName,
    	U.LastName,
    	U.Email,
    	U.FullName,
    	U.OwnerUsername,
    	U.OwnerFirstName,
    	U.OwnerLastName,
    	U.OwnerRoleID,
    	U.OwnerFullName,
    	U.PackagesNumber,
    	U.CompanyName,
    	U.EcommerceEnabled
    FROM UsersDetailed AS U
    WHERE U.UserID <> @OwnerID AND
    ((@Recursive = 1 AND dbo.CheckUserParent(@OwnerID, U.UserID) = 1) OR
    (@Recursive = 0 AND U.OwnerID = @OwnerID))
    AND U.IsPeer = 0
    AND @CanGetDetails = 1 -- actor user rights

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    /*
    Algorythm:
    	0. Get the primary distribution resource from hosting plan
    	1. Check whether user has Resource of requested type in his user plans/add-ons
    		EXCEPTION "The requested service is not available for the user. The resource of the requested type {type} should be assigned to him through hosting plan or add-on"
    		1.1 If the number of returned reources is greater than 1
    			EXCEPTION "User has several resources assigned of the requested type"

    	2. If the requested resource has 0 services
    		EXCEPTION "The resource {name} of type {type} should contain atleast one service
    	3. If the requested resource has one service
    		remember the ID of this single service
    	4. If the requested resource has several services DO distribution:

    		4.1. If the resource is NOT BOUNDED or is PRIMARY DISTRIBUTION RESOURCE
    			if PRIMARY DISTRIBUTION RESOURCE and exists in UserServices
    				return serviceId from UserServices table

    			remember any service from that resource according to distribution type ("BALANCED" or "RANDOM") - get the number of ServiceItems for each service

    		4.2. If the resource is BOUNDED to primary distribution resource
    			- If the primary distribution resource is NULL
    			EXCEPTION "Requested resource marked as bound to primary distribution resource, but there is no any resources in hosting plan marked as primary"

    			- Get the service id of the primary distribution resource
    			GetServiceId(userId, primaryResourceId)

    		Get from user assigned hosting plan

    	5. If it is PRIMARY DISTRIBUTION RESOURCE
    		Save it's ID to UserServices table

    	6. return serviceId

    ERROR CODES:
    	-1 - there are several hosting plans with PDR assigned to that user
    	-2 - The requested service is not available for the user. The resource of the
    		requested type {type} should be assigned to him through hosting plan or add-on
    	-3 - several resources of the same type was assigned through hosting plan or add-on
    	-4 - The resource {name} of type {type} should contain atleast one service
    	-5 - Requested resource marked as bound to primary distribution resource,
    		but there is no any resources in hosting plan marked as primary
    	-6 - the server where PDR is located doesn't contain the service of requested resource type
    */
    CREATE PROCEDURE [dbo].[GetUserServiceID]
    (
    	@UserID int,
    	@TypeName nvarchar(1000),
    	@ServiceID int OUTPUT
    )
    AS
    	DECLARE @PrimaryResourceID int -- primary distribution resource assigned through hosting plan

    	----------------------------------------
    	-- Get the primary distribution resource
    	----------------------------------------
    	IF (SELECT COUNT (HP.PrimaryResourceID) FROM PurchasedHostingPlans AS PHP
    	INNER JOIN HostingPlans AS HP ON PHP.PlanID = HP.PlanID
    	WHERE PHP.UserID = @UserID AND HP.PrimaryResourceID IS NOT NULL AND HP.PrimaryResourceID <> 0) > 1
    	BEGIN
    		SET @ServiceID = -1
    		RETURN
    	END

    	SELECT @PrimaryResourceID = HP.PrimaryResourceID FROM PurchasedHostingPlans AS PHP
    	INNER JOIN HostingPlans AS HP ON PHP.PlanID = HP.PlanID
    	WHERE PHP.UserID = @UserID AND HP.PrimaryResourceID IS NOT NULL AND HP.PrimaryResourceID <> 0

    	----------------------------------------------
    	-- Check whether user has a resource
    	-- of this type in his hosting plans or addons
    	----------------------------------------------
    	DECLARE @UserResourcesTable TABLE
    	(
    		ResourceID int
    	)
    	INSERT INTO @UserResourcesTable
    	SELECT DISTINCT HPR.ResourceID FROM PurchasedHostingPlans AS PHP
    		INNER JOIN HostingPlans AS HP ON PHP.PlanID = HP.PlanID
    		INNER JOIN HostingPlanResources AS HPR ON HP.PlanID = HPR.PlanID
    		INNER JOIN Resources AS R ON HPR.ResourceID = R.ResourceID
    		INNER JOIN ServiceTypes AS ST ON R.ServiceTypeID = ST.ServiceTypeID
    		WHERE PHP.UserID = @UserID AND (ST.ImplementedTypeNames LIKE @TypeName OR ST.TypeName LIKE @TypeName)

    	----------------------------------------
    	-- Check resources number
    	----------------------------------------
    	DECLARE @ResourcesCount int
    	SET @ResourcesCount = @@ROWCOUNT
    	IF @ResourcesCount = 0
    	BEGIN
    		SET @ServiceID = -2 -- user doesn't have requested service assigned
    		RETURN
    	END
    	IF @ResourcesCount > 1
    	BEGIN
    		SET @ServiceID = -3 -- several resources of the same type was assigned
    		RETURN
    	END

    	----------------------------------------
    	-- Check services number
    	----------------------------------------
    	DECLARE @ResourceID int
    	SET @ResourceID = (SELECT TOP 1 ResourceID FROM @UserResourcesTable)

    	DECLARE @UserServicesTable TABLE
    	(
    		ServiceID int,
    		ServerID int,
    		ItemsNumber int,
    		Randomizer float
    	)
    	INSERT INTO @UserServicesTable
    	SELECT
    		RS.ServiceID,
    		S.ServerID,
    		(SELECT COUNT(ItemID) FROM ServiceItems AS SI WHERE SI.ServiceID = RS.ServiceID),
    		RAND()
    	FROM ResourceServices AS RS
    	INNER JOIN Services AS S ON RS.ServiceID = S.ServiceID
    	WHERE RS.ResourceID = @ResourceID

    	DECLARE @ServicesCount int
    	SET @ServicesCount = @@ROWCOUNT
    	IF @ServicesCount = 0
    	BEGIN
    		SET @ServiceID = -4 -- The resource {name} of type {type} should contain atleast one service
    		RETURN
    	END

    	-- try to return from UserServices
    	-- if it is a PDR
    	IF @ResourceID = @PrimaryResourceID
    	BEGIN
    		-- check in UserServices table
    		SELECT @ServiceID = US.ServiceID FROM ResourceServices AS RS
    		INNER JOIN UserServices AS US ON RS.ServiceID = US.ServiceID
    		WHERE RS.ResourceID = @ResourceID AND US.UserID = @UserID

    		-- check validness of the current primary service id
    		IF @ServiceID IS NOT NULL
    		BEGIN
    			IF EXISTS(SELECT ResourceServiceID FROM ResourceServices
    			WHERE ResourceID = @ResourceID AND ServiceID = @ServiceID)
    				RETURN
    			ELSE -- invalidate service
    				DELETE FROM UserServices WHERE UserID = @UserID
    		END
    	END

    	IF @ServicesCount = 1
    	BEGIN
    		-- nothing to distribute
    		-- just remember this single service id
    		SET @ServiceID = (SELECT TOP 1 ServiceID FROM @UserServicesTable)
    	END
    	ELSE
    	BEGIN
    		-- the service should be distributed
    		DECLARE @DistributionTypeID int
    		DECLARE @BoundToPrimaryResource bit
    		SELECT @DistributionTypeID = R.DistributionTypeID, @BoundToPrimaryResource = R.BoundToPrimaryResource
    		FROM Resources AS R WHERE R.ResourceID = @ResourceID

    		IF @BoundToPrimaryResource = 0 OR @ResourceID = @PrimaryResourceID
    		BEGIN
    			IF @ResourceID = @PrimaryResourceID -- it's PDR itself
    			BEGIN
    				-- check in UserServices table
    				SELECT @ServiceID = US.ServiceID FROM ResourceServices AS RS
    				INNER JOIN UserServices AS US ON RS.ServiceID = US.ServiceID
    				WHERE RS.ResourceID = @ResourceID AND US.UserID = @UserID

    				-- check validness of the current primary service id
    				IF @ServiceID IS NOT NULL
    				BEGIN
    					IF EXISTS(SELECT ResourceServiceID FROM ResourceServices
    					WHERE ResourceID = @ResourceID AND ServiceID = @ServiceID)
    						RETURN
    					ELSE -- invalidate service
    						DELETE FROM UserServices WHERE UserID = @UserID
    				END
    			END

    			-- distribute
    			IF @DistributionTypeID = 1 -- BALANCED distribution
    				SELECT @ServiceID = ServiceID FROM @UserServicesTable
    				ORDER BY ItemsNumber ASC
    			ELSE -- RANDOM distribution
    				SELECT @ServiceID = ServiceID FROM @UserServicesTable
    				ORDER BY Randomizer
    		END
    		ELSE -- BOUND to PDR resource
    		BEGIN
    			IF @PrimaryResourceID IS NULL
    			BEGIN
    				SET @ServiceID = -5 -- Requested resource marked as bound to primary distribution resource,
    									-- but there is no any resources in hosting plan marked as primary
    				RETURN
    			END

    			-- get the type of primary resource
    			DECLARE @PrimaryTypeName nvarchar(200)
    			SELECT @PrimaryTypeName = ST.TypeName FROM  Resources AS R
    			INNER JOIN ServiceTypes AS ST ON R.ServiceTypeID = ST.ServiceTypeID
    			WHERE R.ResourceID = @PrimaryResourceID

    			DECLARE @PrimaryServiceID int
    			EXEC GetUserServiceID @UserID, @PrimaryTypeName, @PrimaryServiceID OUTPUT

    			IF @PrimaryServiceID < 0
    			BEGIN
    				SET @ServiceID = @PrimaryServiceID
    				RETURN
    			END

    			DECLARE @ServerID int
    			SET @ServerID = (SELECT ServerID FROM Services WHERE ServiceID = @PrimaryServiceID)

    			-- try to get the service of the requested type on PDR server
    			SET @ServiceID = (SELECT ServiceID FROM @UserServicesTable WHERE ServerID = @ServerID)

    			IF @ServiceID IS NULL
    			BEGIN
    				SET @ServiceID = -6 -- the server where PDR is located doesn't contain the service of requested resource type
    			END
    		END
    	END

    	IF @ResourceID = @PrimaryResourceID -- it's PDR
    	BEGIN
    		DELETE FROM UserServices WHERE UserID = @UserID

    		INSERT INTO UserServices (UserID, ServiceID)
    		VALUES (@UserID, @ServiceID)
    	END

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetUserSettings]
    (
    	@ActorID int,
    	@UserID int,
    	@SettingsName nvarchar(50)
    )
    AS

    -- check rights
    IF dbo.CheckActorUserRights(@ActorID, @UserID) = 0
    RAISERROR('You are not allowed to access this account', 16, 1)

    -- find which parent package has overriden NS
    DECLARE @ParentUserID int, @TmpUserID int
    SET @TmpUserID = @UserID

    WHILE 10 = 10
    BEGIN

    	IF EXISTS
    	(
    		SELECT PropertyName FROM UserSettings
    		WHERE SettingsName = @SettingsName AND UserID = @TmpUserID
    	)
    	BEGIN
    		SELECT
    			UserID,
    			PropertyName,
    			PropertyValue
    		FROM
    			UserSettings
    		WHERE
    			UserID = @TmpUserID AND
    			SettingsName = @SettingsName

    		BREAK
    	END

    	SET @ParentUserID = NULL --reset var

    	-- get owner
    	SELECT
    		@ParentUserID = OwnerID
    	FROM Users
    	WHERE UserID = @TmpUserID

    	IF @ParentUserID IS NULL -- the last parent
    	BREAK

    	SET @TmpUserID = @ParentUserID
    END

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetUsersPaged]
    (
    	@ActorID int,
    	@UserID int,
    	@FilterColumn nvarchar(50) = '',
    	@FilterValue nvarchar(50) = '',
    	@StatusID int,
    	@RoleID int,
    	@SortColumn nvarchar(50),
    	@StartRow int,
    	@MaximumRows int,
    	@Recursive bit
    )
    AS
    -- build query and run it to the temporary table
    DECLARE @sql nvarchar(2000)

    SET @sql = '

    DECLARE @HasUserRights bit
    SET @HasUserRights = dbo.CheckActorUserRights(@ActorID, @UserID)

    DECLARE @EndRow int
    SET @EndRow = @StartRow + @MaximumRows
    DECLARE @Users TABLE
    (
    	ItemPosition int IDENTITY(0,1),
    	UserID int
    )
    INSERT INTO @Users (UserID)
    SELECT
    	U.UserID
    FROM UsersDetailed AS U
    WHERE 
    	U.UserID <> @UserID AND U.IsPeer = 0 AND
    	(
    		(@Recursive = 0 AND OwnerID = @UserID) OR
    		(@Recursive = 1 AND dbo.CheckUserParent(@UserID, U.UserID) = 1)
    	)
    	AND ((@StatusID = 0) OR (@StatusID > 0 AND U.StatusID = @StatusID))
    	AND ((@RoleID = 0) OR (@RoleID > 0 AND U.RoleID = @RoleID))
    	AND @HasUserRights = 1 '

    IF @FilterValue <> ''
    BEGIN
    	IF @FilterColumn <> ''
    		SET @sql = @sql + ' AND ' + @FilterColumn + ' LIKE @FilterValue '
    	ELSE
    		SET @sql = @sql + '
    			AND (Username LIKE @FilterValue
    			OR FullName LIKE @FilterValue
    			OR Email LIKE @FilterValue) '
    END

    IF @SortColumn <> '' AND @SortColumn IS NOT NULL
    SET @sql = @sql + ' ORDER BY ' + @SortColumn + ' '

    SET @sql = @sql + ' SELECT COUNT(UserID) FROM @Users;
    SELECT
    	U.UserID,
    	U.RoleID,
    	U.StatusID,
    	U.SubscriberNumber,
    	U.LoginStatusId,
    	U.FailedLogins,
    	U.OwnerID,
    	U.Created,
    	U.Changed,
    	U.IsDemo,
    	dbo.GetItemComments(U.UserID, ''USER'', @ActorID) AS Comments,
    	U.IsPeer,
    	U.Username,
    	U.FirstName,
    	U.LastName,
    	U.Email,
    	U.FullName,
    	U.OwnerUsername,
    	U.OwnerFirstName,
    	U.OwnerLastName,
    	U.OwnerRoleID,
    	U.OwnerFullName,
    	U.OwnerEmail,
    	U.PackagesNumber,
    	U.CompanyName,
    	U.EcommerceEnabled
    FROM @Users AS TU
    INNER JOIN UsersDetailed AS U ON TU.UserID = U.UserID
    WHERE TU.ItemPosition BETWEEN @StartRow AND @EndRow'

    exec sp_executesql @sql, N'@StartRow int, @MaximumRows int, @UserID int, @FilterValue nvarchar(50), @ActorID int, @Recursive bit, @StatusID int, @RoleID int',
    @StartRow, @MaximumRows, @UserID, @FilterValue, @ActorID, @Recursive, @StatusID, @RoleID

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetUsersSummary]
    (
    	@ActorID int,
    	@UserID int
    )
    AS
    -- check rights
    IF dbo.CheckActorUserRights(@ActorID, @UserID) = 0
    RAISERROR('You are not allowed to access this account', 16, 1)

    -- ALL users
    SELECT COUNT(UserID) AS UsersNumber FROM Users
    WHERE OwnerID = @UserID AND IsPeer = 0

    -- BY STATUS users
    SELECT StatusID, COUNT(UserID) AS UsersNumber FROM Users
    WHERE OwnerID = @UserID AND IsPeer = 0
    GROUP BY StatusID
    ORDER BY StatusID

    -- BY ROLE users
    SELECT RoleID, COUNT(UserID) AS UsersNumber FROM Users
    WHERE OwnerID = @UserID AND IsPeer = 0
    GROUP BY RoleID
    ORDER BY RoleID DESC

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetVirtualMachinesPaged]
    (
    	@ActorID int,
    	@PackageID int,
    	@FilterColumn nvarchar(50) = '',
    	@FilterValue nvarchar(50) = '',
    	@SortColumn nvarchar(50),
    	@StartRow int,
    	@MaximumRows int,
    	@Recursive bit
    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    -- start
    DECLARE @condition nvarchar(700)
    SET @condition = '
    SI.ItemTypeID = 33 -- VPS
    AND ((@Recursive = 0 AND P.PackageID = @PackageID)
    OR (@Recursive = 1 AND dbo.CheckPackageParent(@PackageID, P.PackageID) = 1))
    '

    IF @FilterValue <> '' AND @FilterValue IS NOT NULL
    BEGIN
    	IF @FilterColumn <> '' AND @FilterColumn IS NOT NULL
    		SET @condition = @condition + ' AND ' + @FilterColumn + ' LIKE ''' + @FilterValue + ''''
    	ELSE
    		SET @condition = @condition + '
    			AND (ItemName LIKE ''' + @FilterValue + '''
    			OR Username LIKE ''' + @FilterValue + '''
    			OR ExternalIP LIKE ''' + @FilterValue + '''
    			OR IPAddress LIKE ''' + @FilterValue + ''')'
    END

    IF @SortColumn IS NULL OR @SortColumn = ''
    SET @SortColumn = 'SI.ItemName ASC'

    DECLARE @sql nvarchar(3500)

    set @sql = '
    SELECT COUNT(SI.ItemID) FROM Packages AS P
    INNER JOIN ServiceItems AS SI ON P.PackageID = SI.PackageID
    INNER JOIN Users AS U ON P.UserID = U.UserID
    LEFT OUTER JOIN (
    	SELECT PIP.ItemID, IP.ExternalIP FROM PackageIPAddresses AS PIP
    	INNER JOIN IPAddresses AS IP ON PIP.AddressID = IP.AddressID
    	WHERE PIP.IsPrimary = 1 AND IP.PoolID = 3 -- external IP addresses
    ) AS EIP ON SI.ItemID = EIP.ItemID
    LEFT OUTER JOIN PrivateIPAddresses AS PIP ON PIP.ItemID = SI.ItemID AND PIP.IsPrimary = 1
    WHERE ' + @condition + '

    DECLARE @Items AS TABLE
    (
    	ItemID int
    );

    WITH TempItems AS (
    	SELECT ROW_NUMBER() OVER (ORDER BY ' + @SortColumn + ') as Row,
    		SI.ItemID
    	FROM Packages AS P
    	INNER JOIN ServiceItems AS SI ON P.PackageID = SI.PackageID
    	INNER JOIN Users AS U ON P.UserID = U.UserID
    	LEFT OUTER JOIN (
    		SELECT PIP.ItemID, IP.ExternalIP FROM PackageIPAddresses AS PIP
    		INNER JOIN IPAddresses AS IP ON PIP.AddressID = IP.AddressID
    		WHERE PIP.IsPrimary = 1 AND IP.PoolID = 3 -- external IP addresses
    	) AS EIP ON SI.ItemID = EIP.ItemID
    	LEFT OUTER JOIN PrivateIPAddresses AS PIP ON PIP.ItemID = SI.ItemID AND PIP.IsPrimary = 1
    	WHERE ' + @condition + '
    )

    INSERT INTO @Items
    SELECT ItemID FROM TempItems
    WHERE TempItems.Row BETWEEN @StartRow + 1 and @StartRow + @MaximumRows

    SELECT
    	SI.ItemID,
    	SI.ItemName,
    	SI.PackageID,
    	P.PackageName,
    	P.UserID,
    	U.Username,

    	EIP.ExternalIP,
    	PIP.IPAddress
    FROM @Items AS TSI
    INNER JOIN ServiceItems AS SI ON TSI.ItemID = SI.ItemID
    INNER JOIN Packages AS P ON SI.PackageID = P.PackageID
    INNER JOIN Users AS U ON P.UserID = U.UserID
    LEFT OUTER JOIN (
    	SELECT PIP.ItemID, IP.ExternalIP FROM PackageIPAddresses AS PIP
    	INNER JOIN IPAddresses AS IP ON PIP.AddressID = IP.AddressID
    	WHERE PIP.IsPrimary = 1 AND IP.PoolID = 3 -- external IP addresses
    ) AS EIP ON SI.ItemID = EIP.ItemID
    LEFT OUTER JOIN PrivateIPAddresses AS PIP ON PIP.ItemID = SI.ItemID AND PIP.IsPrimary = 1
    '

    --print @sql

    exec sp_executesql @sql, N'@PackageID int, @StartRow int, @MaximumRows int, @Recursive bit',
    @PackageID, @StartRow, @MaximumRows, @Recursive

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetVirtualMachinesPaged2012]
    (
    	@ActorID int,
    	@PackageID int,
    	@FilterColumn nvarchar(50) = '',
    	@FilterValue nvarchar(50) = '',
    	@SortColumn nvarchar(50),
    	@StartRow int,
    	@MaximumRows int,
    	@Recursive bit
    )
    AS
    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    -- start
    DECLARE @condition nvarchar(700)
    SET @condition = '
    SI.ItemTypeID = 41 -- VPS2012
    AND ((@Recursive = 0 AND P.PackageID = @PackageID)
    OR (@Recursive = 1 AND dbo.CheckPackageParent(@PackageID, P.PackageID) = 1))
    '

    IF @FilterValue <> '' AND @FilterValue IS NOT NULL
    BEGIN
    	IF @FilterColumn <> '' AND @FilterColumn IS NOT NULL
    		SET @condition = @condition + ' AND ' + @FilterColumn + ' LIKE ''' + @FilterValue + ''''
    	ELSE
    		SET @condition = @condition + '
    			AND (ItemName LIKE ''' + @FilterValue + '''
    			OR Username LIKE ''' + @FilterValue + '''
    			OR ExternalIP LIKE ''' + @FilterValue + '''
    			OR IPAddress LIKE ''' + @FilterValue + ''')'
    END

    IF @SortColumn IS NULL OR @SortColumn = ''
    SET @SortColumn = 'SI.ItemName ASC'

    DECLARE @sql nvarchar(3500)

    set @sql = '
    SELECT COUNT(SI.ItemID) FROM Packages AS P
    INNER JOIN ServiceItems AS SI ON P.PackageID = SI.PackageID
    INNER JOIN Users AS U ON P.UserID = U.UserID
    LEFT OUTER JOIN (
    	SELECT PIP.ItemID, IP.ExternalIP FROM PackageIPAddresses AS PIP
    	INNER JOIN IPAddresses AS IP ON PIP.AddressID = IP.AddressID
    	WHERE PIP.IsPrimary = 1 AND IP.PoolID = 3 -- external IP addresses
    ) AS EIP ON SI.ItemID = EIP.ItemID
    LEFT OUTER JOIN PrivateIPAddresses AS PIP ON PIP.ItemID = SI.ItemID AND PIP.IsPrimary = 1
    WHERE ' + @condition + '

    DECLARE @Items AS TABLE
    (
    	ItemID int
    );

    WITH TempItems AS (
    	SELECT ROW_NUMBER() OVER (ORDER BY ' + @SortColumn + ') as Row,
    		SI.ItemID
    	FROM Packages AS P
    	INNER JOIN ServiceItems AS SI ON P.PackageID = SI.PackageID
    	INNER JOIN Users AS U ON P.UserID = U.UserID
    	LEFT OUTER JOIN (
    		SELECT PIP.ItemID, IP.ExternalIP FROM PackageIPAddresses AS PIP
    		INNER JOIN IPAddresses AS IP ON PIP.AddressID = IP.AddressID
    		WHERE PIP.IsPrimary = 1 AND IP.PoolID = 3 -- external IP addresses
    	) AS EIP ON SI.ItemID = EIP.ItemID
    	LEFT OUTER JOIN PrivateIPAddresses AS PIP ON PIP.ItemID = SI.ItemID AND PIP.IsPrimary = 1
    	WHERE ' + @condition + '
    )

    INSERT INTO @Items
    SELECT ItemID FROM TempItems
    WHERE TempItems.Row BETWEEN @StartRow + 1 and @StartRow + @MaximumRows

    SELECT
    	SI.ItemID,
    	SI.ItemName,
    	SI.PackageID,
    	P.PackageName,
    	P.UserID,
    	U.Username,

    	EIP.ExternalIP,
    	PIP.IPAddress
    FROM @Items AS TSI
    INNER JOIN ServiceItems AS SI ON TSI.ItemID = SI.ItemID
    INNER JOIN Packages AS P ON SI.PackageID = P.PackageID
    INNER JOIN Users AS U ON P.UserID = U.UserID
    LEFT OUTER JOIN (
    	SELECT PIP.ItemID, IP.ExternalIP FROM PackageIPAddresses AS PIP
    	INNER JOIN IPAddresses AS IP ON PIP.AddressID = IP.AddressID
    	WHERE PIP.IsPrimary = 1 AND IP.PoolID = 3 -- external IP addresses
    ) AS EIP ON SI.ItemID = EIP.ItemID
    LEFT OUTER JOIN PrivateIPAddresses AS PIP ON PIP.ItemID = SI.ItemID AND PIP.IsPrimary = 1
    '

    --print @sql

    exec sp_executesql @sql, N'@PackageID int, @StartRow int, @MaximumRows int, @Recursive bit',
    @PackageID, @StartRow, @MaximumRows, @Recursive

    RETURN 
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetVirtualMachinesPagedForPC]
    (
    	@ActorID int,
    	@PackageID int,
    	@FilterColumn nvarchar(50) = '',
    	@FilterValue nvarchar(50) = '',
    	@SortColumn nvarchar(50),
    	@StartRow int,
    	@MaximumRows int,
    	@Recursive bit
    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    BEGIN
    	RAISERROR('You are not allowed to access this package', 16, 1)
    	RETURN
    END

    -- start
    DECLARE @condition nvarchar(700)
    SET @condition = '
    SI.ItemTypeID = 35 -- VPS
    AND ((@Recursive = 0 AND P.PackageID = @PackageID)
    OR (@Recursive = 1 AND dbo.CheckPackageParent(@PackageID, P.PackageID) = 1))
    '

    IF @FilterValue <> '' AND @FilterValue IS NOT NULL
    BEGIN
    	IF @FilterColumn <> '' AND @FilterColumn IS NOT NULL
    		SET @condition = @condition + ' AND ' + @FilterColumn + ' LIKE ''' + @FilterValue + ''''
    	ELSE
    		SET @condition = @condition + '
    			AND (ItemName LIKE ''' + @FilterValue + '''
    			OR Username LIKE ''' + @FilterValue + '''
    			OR ExternalIP LIKE ''' + @FilterValue + '''
    			OR IPAddress LIKE ''' + @FilterValue + ''')'
    END

    IF @SortColumn IS NULL OR @SortColumn = ''
    SET @SortColumn = 'SI.ItemName ASC'

    DECLARE @sql nvarchar(3500)

    set @sql = '
    SELECT COUNT(SI.ItemID) FROM Packages AS P
    INNER JOIN ServiceItems AS SI ON P.PackageID = SI.PackageID
    INNER JOIN Users AS U ON P.UserID = U.UserID
    LEFT OUTER JOIN (
    	SELECT PIP.ItemID, IP.ExternalIP FROM PackageIPAddresses AS PIP
    	INNER JOIN IPAddresses AS IP ON PIP.AddressID = IP.AddressID
    	WHERE PIP.IsPrimary = 1 AND IP.PoolID = 3 -- external IP addresses
    ) AS EIP ON SI.ItemID = EIP.ItemID
    LEFT OUTER JOIN PrivateIPAddresses AS PIP ON PIP.ItemID = SI.ItemID AND PIP.IsPrimary = 1
    WHERE ' + @condition + '

    DECLARE @Items AS TABLE
    (
    	ItemID int
    );

    WITH TempItems AS (
    	SELECT ROW_NUMBER() OVER (ORDER BY ' + @SortColumn + ') as Row,
    		SI.ItemID
    	FROM Packages AS P
    	INNER JOIN ServiceItems AS SI ON P.PackageID = SI.PackageID
    	INNER JOIN Users AS U ON P.UserID = U.UserID
    	LEFT OUTER JOIN (
    		SELECT PIP.ItemID, IP.ExternalIP FROM PackageIPAddresses AS PIP
    		INNER JOIN IPAddresses AS IP ON PIP.AddressID = IP.AddressID
    		WHERE PIP.IsPrimary = 1 AND IP.PoolID = 3 -- external IP addresses
    	) AS EIP ON SI.ItemID = EIP.ItemID
    	LEFT OUTER JOIN PrivateIPAddresses AS PIP ON PIP.ItemID = SI.ItemID AND PIP.IsPrimary = 1
    	WHERE ' + @condition + '
    )

    INSERT INTO @Items
    SELECT ItemID FROM TempItems
    WHERE TempItems.Row BETWEEN @StartRow + 1 and @StartRow + @MaximumRows

    SELECT
    	SI.ItemID,
    	SI.ItemName,
    	SI.PackageID,
    	P.PackageName,
    	P.UserID,
    	U.Username,

    	EIP.ExternalIP,
    	PIP.IPAddress
    FROM @Items AS TSI
    INNER JOIN ServiceItems AS SI ON TSI.ItemID = SI.ItemID
    INNER JOIN Packages AS P ON SI.PackageID = P.PackageID
    INNER JOIN Users AS U ON P.UserID = U.UserID
    LEFT OUTER JOIN (
    	SELECT PIP.ItemID, IP.ExternalIP FROM PackageIPAddresses AS PIP
    	INNER JOIN IPAddresses AS IP ON PIP.AddressID = IP.AddressID
    	WHERE PIP.IsPrimary = 1 AND IP.PoolID = 3 -- external IP addresses
    ) AS EIP ON SI.ItemID = EIP.ItemID
    LEFT OUTER JOIN PrivateIPAddresses AS PIP ON PIP.ItemID = SI.ItemID AND PIP.IsPrimary = 1
    '

    --print @sql

    exec sp_executesql @sql, N'@PackageID int, @StartRow int, @MaximumRows int, @Recursive bit',
    @PackageID, @StartRow, @MaximumRows, @Recursive

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetVirtualMachinesPagedProxmox]
    (
    	@ActorID int,
    	@PackageID int,
    	@FilterColumn nvarchar(50) = '',
    	@FilterValue nvarchar(50) = '',
    	@SortColumn nvarchar(50),
    	@StartRow int,
    	@MaximumRows int,
    	@Recursive bit
    )
    AS
    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    -- start
    DECLARE @condition nvarchar(700)
    SET @condition = '
    SI.ItemTypeID = 143 -- Proxmox
    AND ((@Recursive = 0 AND P.PackageID = @PackageID)
    OR (@Recursive = 1 AND dbo.CheckPackageParent(@PackageID, P.PackageID) = 1))
    '

    IF @FilterValue <> '' AND @FilterValue IS NOT NULL
    BEGIN
    	IF @FilterColumn <> '' AND @FilterColumn IS NOT NULL
    		SET @condition = @condition + ' AND ' + @FilterColumn + ' LIKE ''' + @FilterValue + ''''
    	ELSE
    		SET @condition = @condition + '
    			AND (ItemName LIKE ''' + @FilterValue + '''
    			OR Username LIKE ''' + @FilterValue + '''
    			OR ExternalIP LIKE ''' + @FilterValue + '''
    			OR IPAddress LIKE ''' + @FilterValue + ''')'
    END

    IF @SortColumn IS NULL OR @SortColumn = ''
    SET @SortColumn = 'SI.ItemName ASC'

    DECLARE @sql nvarchar(3500)

    set @sql = '
    SELECT COUNT(SI.ItemID) FROM Packages AS P
    INNER JOIN ServiceItems AS SI ON P.PackageID = SI.PackageID
    INNER JOIN Users AS U ON P.UserID = U.UserID
    LEFT OUTER JOIN (
    	SELECT PIP.ItemID, IP.ExternalIP FROM PackageIPAddresses AS PIP
    	INNER JOIN IPAddresses AS IP ON PIP.AddressID = IP.AddressID
    	WHERE PIP.IsPrimary = 1 AND IP.PoolID = 3 -- external IP addresses
    ) AS EIP ON SI.ItemID = EIP.ItemID
    LEFT OUTER JOIN PrivateIPAddresses AS PIP ON PIP.ItemID = SI.ItemID AND PIP.IsPrimary = 1
    WHERE ' + @condition + '

    DECLARE @Items AS TABLE
    (
    	ItemID int
    );

    WITH TempItems AS (
    	SELECT ROW_NUMBER() OVER (ORDER BY ' + @SortColumn + ') as Row,
    		SI.ItemID
    	FROM Packages AS P
    	INNER JOIN ServiceItems AS SI ON P.PackageID = SI.PackageID
    	INNER JOIN Users AS U ON P.UserID = U.UserID
    	LEFT OUTER JOIN (
    		SELECT PIP.ItemID, IP.ExternalIP FROM PackageIPAddresses AS PIP
    		INNER JOIN IPAddresses AS IP ON PIP.AddressID = IP.AddressID
    		WHERE PIP.IsPrimary = 1 AND IP.PoolID = 3 -- external IP addresses
    	) AS EIP ON SI.ItemID = EIP.ItemID
    	LEFT OUTER JOIN PrivateIPAddresses AS PIP ON PIP.ItemID = SI.ItemID AND PIP.IsPrimary = 1
    	WHERE ' + @condition + '
    )

    INSERT INTO @Items
    SELECT ItemID FROM TempItems
    WHERE TempItems.Row BETWEEN @StartRow + 1 and @StartRow + @MaximumRows

    SELECT
    	SI.ItemID,
    	SI.ItemName,
    	SI.PackageID,
    	P.PackageName,
    	P.UserID,
    	U.Username,

    	EIP.ExternalIP,
    	PIP.IPAddress
    FROM @Items AS TSI
    INNER JOIN ServiceItems AS SI ON TSI.ItemID = SI.ItemID
    INNER JOIN Packages AS P ON SI.PackageID = P.PackageID
    INNER JOIN Users AS U ON P.UserID = U.UserID
    LEFT OUTER JOIN (
    	SELECT PIP.ItemID, IP.ExternalIP FROM PackageIPAddresses AS PIP
    	INNER JOIN IPAddresses AS IP ON PIP.AddressID = IP.AddressID
    	WHERE PIP.IsPrimary = 1 AND IP.PoolID = 3 -- external IP addresses
    ) AS EIP ON SI.ItemID = EIP.ItemID
    LEFT OUTER JOIN PrivateIPAddresses AS PIP ON PIP.ItemID = SI.ItemID AND PIP.IsPrimary = 1
    '

    --print @sql

    exec sp_executesql @sql, N'@PackageID int, @StartRow int, @MaximumRows int, @Recursive bit',
    @PackageID, @StartRow, @MaximumRows, @Recursive

    RETURN 
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetVirtualServers]
    (
    	@ActorID int
    )
    AS

    -- check rights
    DECLARE @IsAdmin bit
    SET @IsAdmin = dbo.CheckIsUserAdmin(@ActorID)

    SELECT
    	S.ServerID,
    	S.ServerName,
    	S.ServerUrl,
    	(SELECT COUNT(SRV.ServiceID) FROM VirtualServices AS SRV WHERE S.ServerID = SRV.ServerID) AS ServicesNumber,
    	S.Comments,
    	PrimaryGroupID
    FROM Servers AS S
    WHERE
    	VirtualServer = 1
    	AND @IsAdmin = 1
    ORDER BY S.ServerName

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetVirtualServices]
    (
    	@ActorID int,
    	@ServerID int,
    	@forAutodiscover bit
    )
    AS

    -- check rights
    DECLARE @IsAdmin bit
    SET @IsAdmin = dbo.CheckIsUserAdmin(@ActorID)

    -- virtual groups
    SELECT
    	VRG.VirtualGroupID,
    	RG.GroupID,
    	RG.GroupName,
    	ISNULL(VRG.DistributionType, 1) AS DistributionType,
    	ISNULL(VRG.BindDistributionToPrimary, 1) AS BindDistributionToPrimary
    FROM ResourceGroups AS RG
    LEFT OUTER JOIN VirtualGroups AS VRG ON RG.GroupID = VRG.GroupID AND VRG.ServerID = @ServerID
    WHERE
    	(@IsAdmin = 1 OR @forAutodiscover = 1) AND (ShowGroup = 1)
    ORDER BY RG.GroupOrder

    -- services
    SELECT
    	VS.ServiceID,
    	S.ServiceName,
    	S.Comments,
    	P.GroupID,
    	P.DisplayName,
    	SRV.ServerName
    FROM VirtualServices AS VS
    INNER JOIN Services AS S ON VS.ServiceID = S.ServiceID
    INNER JOIN Servers AS SRV ON S.ServerID = SRV.ServerID
    INNER JOIN Providers AS P ON S.ProviderID = P.ProviderID
    WHERE
    	VS.ServerID = @ServerID
    	AND (@IsAdmin = 1 OR @forAutodiscover = 1)

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetWebDavAccessTokenByAccessToken]
    (
    	@AccessToken UNIQUEIDENTIFIER
    )
    AS
    SELECT 
    	ID ,
    	FilePath ,
    	AuthData ,
    	AccessToken,
    	ExpirationDate,
    	AccountID,
    	ItemId
    	FROM WebDavAccessTokens 
    	Where AccessToken = @AccessToken AND ExpirationDate > getdate()
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetWebDavAccessTokenById]
    (
    	@Id int
    )
    AS
    SELECT 
    	ID ,
    	FilePath ,
    	AuthData ,
    	AccessToken,
    	ExpirationDate,
    	AccountID,
    	ItemId
    	FROM WebDavAccessTokens 
    	Where ID = @Id AND ExpirationDate > getdate()
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetWebDavPortalUsersSettingsByAccountId]
    (
    	@AccountId INT
    )
    AS
    SELECT TOP 1
    	US.Id,
    	US.AccountId,
    	US.Settings
    	FROM WebDavPortalUsersSettings AS US
    	WHERE AccountId = @AccountId
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[InsertCRMUser] 
    (
    	@ItemID int,
    	@CrmUserID uniqueidentifier,
    	@BusinessUnitID uniqueidentifier,
    	@CALType int
    )
    AS
    BEGIN
    	SET NOCOUNT ON;

    INSERT INTO
    	CRMUsers
    (
    	AccountID,
    	CRMUserGuid,
    	BusinessUnitID,
    	CALType
    )
    VALUES 
    (
    	@ItemID, 
    	@CrmUserID,
    	@BusinessUnitID,
    	@CALType
    )

    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[InsertStorageSpace]
    (
    	@ID INT OUTPUT,
    	@Name nvarchar(300),
    	@ServiceId INT ,
    	@ServerId INT,
    	@LevelId INT,
    	@Path varchar(max),
    	@FsrmQuotaType INT,
    	@FsrmQuotaSizeBytes BIGINT,
    	@IsShared BIT,
    	@IsDisabled BIT,
    	@UncPath varchar(max)
    )
    AS

    INSERT INTO StorageSpaces 
    (
    	Name,
    	ServiceId,
    	ServerId,
    	LevelId,
    	Path,
    	FsrmQuotaType,
    	FsrmQuotaSizeBytes,
    	IsShared,
    	UncPath,
    	IsDisabled
    )
    VALUES 
    (
    	@Name,
    	@ServiceId,
    	@ServerId,
    	@LevelId,
    	@Path,
    	@FsrmQuotaType,
    	@FsrmQuotaSizeBytes,
    	@IsShared,
    	@UncPath,
    	@IsDisabled
    )

    SET @ID = SCOPE_IDENTITY()

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[InsertStorageSpaceLevel]
    (
    	@ID INT OUTPUT,
    	@Name nvarchar(300),
    	@Description nvarchar(max)
    )
    AS

    INSERT INTO StorageSpaceLevels 
    (
    	Name, 
    	Description
    )
    VALUES 
    (
    	@Name,
    	@Description
    )

    SET @ID = SCOPE_IDENTITY()

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[LyncUserExists]
    (
    	@AccountID int,
    	@SipAddress nvarchar(300),
    	@Exists bit OUTPUT
    )
    AS

    	SET @Exists = 0
    	IF EXISTS(SELECT * FROM [dbo].[ExchangeAccountEmailAddresses] WHERE [EmailAddress] = @SipAddress AND [AccountID] <> @AccountID)
    		BEGIN
    			SET @Exists = 1
    		END
    	ELSE IF EXISTS(SELECT * FROM [dbo].[ExchangeAccounts] WHERE [PrimaryEmailAddress] = @SipAddress AND [AccountID] <> @AccountID)
    		BEGIN
    			SET @Exists = 1
    		END
    	ELSE IF EXISTS(SELECT * FROM [dbo].[ExchangeAccounts] WHERE [UserPrincipalName] = @SipAddress AND [AccountID] <> @AccountID)
    		BEGIN
    			SET @Exists = 1
    		END
    	ELSE IF EXISTS(SELECT * FROM [dbo].[ExchangeAccounts] WHERE [AccountName] = @SipAddress AND [AccountID] <> @AccountID)
    		BEGIN
    			SET @Exists = 1
    		END
    	ELSE IF EXISTS(SELECT * FROM [dbo].[LyncUsers] WHERE [SipAddress] = @SipAddress)
    		BEGIN
    			SET @Exists = 1
    		END

    	RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[MoveServiceItem]
    (
    	@ActorID int,
    	@ItemID int,
    	@DestinationServiceID int,
    	@forAutodiscover bit
    )
    AS

    -- check rights
    DECLARE @PackageID int
    SELECT @PackageID = PackageID FROM ServiceItems
    WHERE ItemID = @ItemID

    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0 AND @forAutodiscover = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    BEGIN TRAN

    UPDATE ServiceItems
    SET ServiceID = @DestinationServiceID
    WHERE ItemID = @ItemID

    COMMIT TRAN

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[OrganizationExists]
    (
    	@OrganizationID nvarchar(10),
    	@Exists bit OUTPUT
    )
    AS
    SET @Exists = 0
    IF EXISTS(SELECT * FROM Organizations WHERE OrganizationID = @OrganizationID)
    BEGIN
    	SET @Exists = 1
    END

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[OrganizationUserExists]
    (
    	@LoginName nvarchar(20),
    	@Exists bit OUTPUT
    )
    AS
    SET @Exists = 0
    IF EXISTS(SELECT * FROM ExchangeAccounts WHERE AccountName = @LoginName)
    BEGIN
    	SET @Exists = 1
    END

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[RemoveRDSServerFromCollection]
    (
    	@Id  INT
    )
    AS

    UPDATE RDSServers
    SET
    	RDSCollectionId = NULL
    WHERE ID = @Id
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[RemoveRDSServerFromOrganization]
    (
    	@Id  INT
    )
    AS

    UPDATE RDSServers
    SET
    	ItemID = NULL
    WHERE ID = @Id
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[RemoveRDSUserFromRDSCollection]
    (
    	@AccountId  INT,
    	@RDSCollectionId INT
    )
    AS

    DELETE FROM RDSCollectionUsers
    WHERE AccountId = @AccountId AND RDSCollectionId = @RDSCollectionId
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[RemoveStorageSpace]
    (
    	@ID INT
    )
    AS
    	DELETE FROM StorageSpaces WHERE ID = @ID
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[RemoveStorageSpaceFolder]
    (
    	@ID INT
    )
    AS
    DELETE
    FROM StorageSpaceFolders
    WHERE ID=@ID
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[RemoveStorageSpaceLevel]
    (
    	@ID INT
    )
    AS
    	DELETE FROM StorageSpaceLevels WHERE ID = @ID
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[SearchExchangeAccount]
    (
          @ActorID int,
          @AccountType int,
          @PrimaryEmailAddress nvarchar(300)
    )
    AS

    DECLARE @PackageID int
    DECLARE @ItemID int
    DECLARE @AccountID int

    SELECT
          @AccountID = AccountID,
          @ItemID = ItemID
    FROM ExchangeAccounts
    WHERE PrimaryEmailAddress = @PrimaryEmailAddress
    AND AccountType = @AccountType

    -- check space rights
    SELECT @PackageID = PackageID FROM ServiceItems
    WHERE ItemID = @ItemID

    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    SELECT
    	AccountID,
    	ItemID,
    	@PackageID AS PackageID,
    	AccountType,
    	AccountName,
    	DisplayName,
    	PrimaryEmailAddress,
    	MailEnabledPublicFolder,
    	MailboxManagerActions,
    	SamAccountName,
    	SubscriberNumber,
    	UserPrincipalName
    FROM ExchangeAccounts
    WHERE AccountID = @AccountID

    RETURN 

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[SearchExchangeAccounts]
    (
    	@ActorID int,
    	@ItemID int,
    	@IncludeMailboxes bit,
    	@IncludeContacts bit,
    	@IncludeDistributionLists bit,
    	@IncludeRooms bit,
    	@IncludeEquipment bit,
    	@IncludeSharedMailbox bit,
    	@IncludeSecurityGroups bit,
    	@FilterColumn nvarchar(50) = '',
    	@FilterValue nvarchar(50) = '',
    	@SortColumn nvarchar(50)
    )
    AS
    DECLARE @PackageID int
    SELECT @PackageID = PackageID FROM ServiceItems
    WHERE ItemID = @ItemID

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    -- start
    DECLARE @condition nvarchar(700)
    SET @condition = '
    ((@IncludeMailboxes = 1 AND EA.AccountType = 1)
    OR (@IncludeContacts = 1 AND EA.AccountType = 2)
    OR (@IncludeDistributionLists = 1 AND EA.AccountType = 3)
    OR (@IncludeRooms = 1 AND EA.AccountType = 5)
    OR (@IncludeEquipment = 1 AND EA.AccountType = 6)
    OR (@IncludeSharedMailbox = 1 AND EA.AccountType = 10)
    OR (@IncludeSecurityGroups = 1 AND EA.AccountType = 8))
    AND EA.ItemID = @ItemID
    '

    IF @FilterColumn <> '' AND @FilterColumn IS NOT NULL
    AND @FilterValue <> '' AND @FilterValue IS NOT NULL
    SET @condition = @condition + ' AND ' + @FilterColumn + ' LIKE ''' + @FilterValue + ''''

    IF @SortColumn IS NULL OR @SortColumn = ''
    SET @SortColumn = 'EA.DisplayName ASC'

    DECLARE @sql nvarchar(3500)

    set @sql = '
    SELECT
    	EA.AccountID,
    	EA.ItemID,
    	EA.AccountType,
    	EA.AccountName,
    	EA.DisplayName,
    	EA.PrimaryEmailAddress,
    	EA.MailEnabledPublicFolder,
    	EA.SubscriberNumber,
    	EA.UserPrincipalName
    FROM ExchangeAccounts AS EA
    WHERE ' + @condition

    print @sql

    exec sp_executesql @sql, N'@ItemID int, @IncludeMailboxes int, @IncludeContacts int,
        @IncludeDistributionLists int, @IncludeRooms bit, @IncludeEquipment bit, @IncludeSharedMailbox bit, @IncludeSecurityGroups bit',
    @ItemID, @IncludeMailboxes, @IncludeContacts, @IncludeDistributionLists, @IncludeRooms, @IncludeEquipment, @IncludeSharedMailbox, @IncludeSecurityGroups

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[SearchExchangeAccountsByTypes]
    (
    	@ActorID int,
    	@ItemID int,
    	@AccountTypes nvarchar(30),
    	@FilterColumn nvarchar(50) = '',
    	@FilterValue nvarchar(50) = '',
    	@SortColumn nvarchar(50)
    )
    AS

    DECLARE @PackageID int
    SELECT @PackageID = PackageID FROM ServiceItems
    WHERE ItemID = @ItemID

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    DECLARE @condition nvarchar(700)
    SET @condition = 'EA.ItemID = @ItemID AND EA.AccountType IN (' + @AccountTypes + ')'

    IF @FilterColumn <> '' AND @FilterColumn IS NOT NULL
    AND @FilterValue <> '' AND @FilterValue IS NOT NULL
    BEGIN
    	IF @FilterColumn = 'PrimaryEmailAddress' AND @AccountTypes <> '2'
    	BEGIN		
    		SET @condition = @condition + ' AND EA.AccountID IN (SELECT EAEA.AccountID FROM ExchangeAccountEmailAddresses EAEA WHERE EAEA.EmailAddress LIKE ''' + @FilterValue + ''')'
    	END
    	ELSE
    	BEGIN		
    		SET @condition = @condition + ' AND ' + @FilterColumn + ' LIKE ''' + @FilterValue + ''''
    	END
    END

    IF @SortColumn IS NULL OR @SortColumn = ''
    SET @SortColumn = 'EA.DisplayName ASC'

    DECLARE @sql nvarchar(3500)
    SET @sql = '
    SELECT
    	EA.AccountID,
    	EA.ItemID,
    	EA.AccountType,
    	EA.AccountName,
    	EA.DisplayName,
    	EA.PrimaryEmailAddress,
    	EA.MailEnabledPublicFolder,
    	EA.MailboxPlanId,
    	P.MailboxPlan, 
    	EA.SubscriberNumber,
    	EA.UserPrincipalName
    FROM
    	ExchangeAccounts  AS EA
    LEFT OUTER JOIN ExchangeMailboxPlans AS P ON EA.MailboxPlanId = P.MailboxPlanId
    	WHERE ' + @condition
    	+ ' ORDER BY ' + @SortColumn

    EXEC sp_executesql @sql, N'@ItemID int', @ItemID

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[SearchOrganizationAccounts]
    (
    	@ActorID int,
    	@ItemID int,
    	@FilterColumn nvarchar(50) = '',
    	@FilterValue nvarchar(50) = '',
    	@SortColumn nvarchar(50),
    	@IncludeMailboxes bit
    )
    AS
    DECLARE @PackageID int
    SELECT @PackageID = PackageID FROM ServiceItems
    WHERE ItemID = @ItemID

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    -- start
    DECLARE @condition nvarchar(700)
    SET @condition = '
    (EA.AccountType = 7 OR (EA.AccountType = 1 AND @IncludeMailboxes = 1)  )
    AND EA.ItemID = @ItemID
    '

    IF @FilterColumn <> '' AND @FilterColumn IS NOT NULL
    AND @FilterValue <> '' AND @FilterValue IS NOT NULL
    SET @condition = @condition + ' AND ' + @FilterColumn + ' LIKE ''' + @FilterValue + ''''

    IF @SortColumn IS NULL OR @SortColumn = ''
    SET @SortColumn = 'EA.DisplayName ASC'

    DECLARE @sql nvarchar(3500)

    set @sql = '
    SELECT
     EA.AccountID,
     EA.ItemID,
     EA.AccountType,
     EA.AccountName,
     EA.DisplayName,
     EA.PrimaryEmailAddress,
     EA.SubscriberNumber,
     EA.UserPrincipalName,
     EA.LevelID,
     EA.IsVIP,
     (CASE WHEN LU.AccountID IS NULL THEN ''false'' ELSE ''true'' END) as IsLyncUser,
     (CASE WHEN SfB.AccountID IS NULL THEN ''false'' ELSE ''true'' END) as IsSfBUser
    FROM ExchangeAccounts AS EA
    LEFT JOIN LyncUsers AS LU
    ON LU.AccountID = EA.AccountID
    LEFT JOIN SfBUsers AS SfB  
    ON SfB.AccountID = EA.AccountID
    WHERE ' + @condition + '
    ORDER BY ' + @sortColumn

    print @sql

    exec sp_executesql @sql, N'@ItemID int, @IncludeMailboxes bit', 
    @ItemID, @IncludeMailboxes

    RETURN 

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[SearchServiceItemsPaged]
    (
    	@ActorID int,
    	@UserID int,
    	@ItemTypeID int,
    	@FilterValue nvarchar(50) = '',
    	@SortColumn nvarchar(50),
    	@StartRow int,
    	@MaximumRows int
    )
    AS

    -- check rights
    IF dbo.CheckActorUserRights(@ActorID, @UserID) = 0
    RAISERROR('You are not allowed to access this account', 16, 1)

    -- build query and run it to the temporary table
    DECLARE @sql nvarchar(2000)

    IF @ItemTypeID <> 13
    BEGIN
    	SET @sql = '
    	DECLARE @EndRow int
    	SET @EndRow = @StartRow + @MaximumRows
    	DECLARE @Items TABLE
    	(
    		ItemPosition int IDENTITY(1,1),
    		ItemID int
    	)
    	INSERT INTO @Items (ItemID)
    	SELECT
    		SI.ItemID
    	FROM ServiceItems AS SI
    	INNER JOIN Packages AS P ON P.PackageID = SI.PackageID
    	INNER JOIN UsersDetailed AS U ON P.UserID = U.UserID
    	WHERE
    		dbo.CheckUserParent(@UserID, P.UserID) = 1
    		AND SI.ItemTypeID = @ItemTypeID
    	'

    	IF @FilterValue <> ''
    	SET @sql = @sql + ' AND SI.ItemName LIKE @FilterValue '

    	IF @SortColumn = '' OR @SortColumn IS NULL
    	SET @SortColumn = 'ItemName'

    	SET @sql = @sql + ' ORDER BY ' + @SortColumn + ' '

    	SET @sql = @sql + ' SELECT COUNT(ItemID) FROM @Items;
    	SELECT

    		SI.ItemID,
    		SI.ItemName,

    		P.PackageID,
    		P.PackageName,
    		P.StatusID,
    		P.PurchaseDate,

    		-- user
    		P.UserID,
    		U.Username,
    		U.FirstName,
    		U.LastName,
    		U.FullName,
    		U.RoleID,
    		U.Email
    	FROM @Items AS I
    	INNER JOIN ServiceItems AS SI ON I.ItemID = SI.ItemID
    	INNER JOIN Packages AS P ON SI.PackageID = P.PackageID
    	INNER JOIN UsersDetailed AS U ON P.UserID = U.UserID
    	WHERE I.ItemPosition BETWEEN @StartRow AND @EndRow'
    END
    ELSE
    BEGIN

    	SET @SortColumn = REPLACE(@SortColumn, 'ItemName', 'DomainName')

    	SET @sql = '
    	DECLARE @EndRow int
    	SET @EndRow = @StartRow + @MaximumRows
    	DECLARE @Items TABLE
    	(
    		ItemPosition int IDENTITY(1,1),
    		ItemID int
    	)
    	INSERT INTO @Items (ItemID)
    	SELECT
    		D.DomainID
    	FROM Domains AS D
    	INNER JOIN Packages AS P ON P.PackageID = D.PackageID
    	INNER JOIN UsersDetailed AS U ON P.UserID = U.UserID
    	WHERE
    		dbo.CheckUserParent(@UserID, P.UserID) = 1
    	'

    	IF @FilterValue <> ''
    	SET @sql = @sql + ' AND D.DomainName LIKE @FilterValue '

    	IF @SortColumn = '' OR @SortColumn IS NULL
    	SET @SortColumn = 'DomainName'

    	SET @sql = @sql + ' ORDER BY ' + @SortColumn + ' '

    	SET @sql = @sql + ' SELECT COUNT(ItemID) FROM @Items;
    	SELECT

    		D.DomainID AS ItemID,
    		D.DomainName AS ItemName,

    		P.PackageID,
    		P.PackageName,
    		P.StatusID,
    		P.PurchaseDate,

    		-- user
    		P.UserID,
    		U.Username,
    		U.FirstName,
    		U.LastName,
    		U.FullName,
    		U.RoleID,
    		U.Email
    	FROM @Items AS I
    	INNER JOIN Domains AS D ON I.ItemID = D.DomainID
    	INNER JOIN Packages AS P ON D.PackageID = P.PackageID
    	INNER JOIN UsersDetailed AS U ON P.UserID = U.UserID
    	WHERE I.ItemPosition BETWEEN @StartRow AND @EndRow AND D.IsDomainPointer=0'
    END

    exec sp_executesql @sql, N'@StartRow int, @MaximumRows int, @UserID int, @FilterValue nvarchar(50), @ItemTypeID int, @ActorID int',
    @StartRow, @MaximumRows, @UserID, @FilterValue, @ItemTypeID, @ActorID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[SetAccessTokenSmsResponse]
    (
    	@AccessToken UNIQUEIDENTIFIER,
    	@SmsResponse varchar(100)
    )
    AS
    UPDATE [dbo].[AccessTokens] SET [SmsResponse] = @SmsResponse WHERE [AccessTokenGuid] = @AccessToken
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
     CREATE PROCEDURE [dbo].[SetExchangeAccountDisclaimerId] 
    (
    	@AccountID int,
    	@ExchangeDisclaimerId int
    )
    AS
    UPDATE ExchangeAccounts SET
    	ExchangeDisclaimerId = @ExchangeDisclaimerId
    WHERE AccountID = @AccountID

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[SetExchangeAccountMailboxplan] 
    (
    	@AccountID int,
    	@MailboxPlanId int,
    	@ArchivingMailboxPlanId int,
    	@EnableArchiving bit
    )
    AS

    UPDATE ExchangeAccounts SET
    	MailboxPlanId = @MailboxPlanId,
    	ArchivingMailboxPlanId = @ArchivingMailboxPlanId,
    	EnableArchiving = @EnableArchiving
    WHERE
    	AccountID = @AccountID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[SetItemPrimaryIPAddress]
    (
    	@ActorID int,
    	@ItemID int,
    	@PackageAddressID int
    )
    AS
    BEGIN

    	-- read item pool
    	DECLARE @PoolID int
    	SELECT @PoolID = IP.PoolID FROM PackageIPAddresses AS PIP
    	INNER JOIN IPAddresses AS IP ON PIP.AddressID = IP.AddressID
    	WHERE PIP.PackageAddressID = @PackageAddressID

    	-- update all IP addresses of the specified pool
    	UPDATE PackageIPAddresses
    	SET IsPrimary = CASE PIP.PackageAddressID WHEN @PackageAddressID THEN 1 ELSE 0 END
    	FROM PackageIPAddresses AS PIP
    	INNER JOIN IPAddresses AS IP ON PIP.AddressID = IP.AddressID
    	WHERE PIP.ItemID = @ItemID
    	AND IP.PoolID = @PoolID
    	AND dbo.CheckActorPackageRights(@ActorID, PIP.PackageID) = 1
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[SetItemPrivatePrimaryIPAddress]
    (
    	@ActorID int,
    	@ItemID int,
    	@PrivateAddressID int
    )
    AS
    BEGIN
    	UPDATE PrivateIPAddresses
    	SET IsPrimary = CASE PIP.PrivateAddressID WHEN @PrivateAddressID THEN 1 ELSE 0 END
    	FROM PrivateIPAddresses AS PIP
    	INNER JOIN ServiceItems AS SI ON PIP.ItemID = SI.ItemID
    	WHERE PIP.ItemID = @ItemID
    	AND dbo.CheckActorPackageRights(@ActorID, SI.PackageID) = 1
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[SetLyncUserLyncUserPlan]
    (
    	@AccountID int,
    	@LyncUserPlanId int
    )
    AS

    UPDATE LyncUsers SET
    	LyncUserPlanId = @LyncUserPlanId
    WHERE
    	AccountID = @AccountID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[SetOrganizationDefaultExchangeMailboxPlan]
    (
    	@ItemID int,
    	@MailboxPlanId int
    )
    AS

    UPDATE ExchangeOrganizations SET
    	ExchangeMailboxPlanID = @MailboxPlanId
    WHERE
    	ItemID = @ItemID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[SetOrganizationDefaultLyncUserPlan]
    (
    	@ItemID int,
    	@LyncUserPlanId int
    )
    AS

    UPDATE ExchangeOrganizations SET
    	LyncUserPlanID = @LyncUserPlanId
    WHERE
    	ItemID = @ItemID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[SetOrganizationDefaultSfBUserPlan]
    (
    	@ItemID int,
    	@SfBUserPlanId int
    )
    AS

    UPDATE ExchangeOrganizations SET
    	SfBUserPlanID = @SfBUserPlanId
    WHERE
    	ItemID = @ItemID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[SetSfBUserSfBUserPlan]
    (
    	@AccountID int,
    	@SfBUserPlanId int
    )
    AS

    UPDATE SfBUsers SET
    	SfBUserPlanId = @SfBUserPlanId
    WHERE
    	AccountID = @AccountID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[SetSystemSettings]
    	@SettingsName nvarchar(50),
    	@Xml ntext
    AS
    BEGIN
    /*
    XML Format:
    <properties>
    	<property name="" value=""/>
    </properties>
    */
    	SET NOCOUNT ON;

    	BEGIN TRAN
    		DECLARE @idoc int;
    		--Create an internal representation of the XML document.
    		EXEC sp_xml_preparedocument @idoc OUTPUT, @xml;

    		DELETE FROM [dbo].[SystemSettings] WHERE [SettingsName] = @SettingsName;

    		INSERT INTO [dbo].[SystemSettings]
    		(
    			[SettingsName],
    			[PropertyName],
    			[PropertyValue]
    		)
    		SELECT
    			@SettingsName,
    			[XML].[PropertyName],
    			[XML].[PropertyValue]
    		FROM OPENXML(@idoc, '/properties/property',1) WITH
    		(
    			[PropertyName] nvarchar(50) '@name',
    			[PropertyValue] ntext '@value'
    		) AS XML;

    		-- remove document
    		EXEC sp_xml_removedocument @idoc;

    	COMMIT TRAN;

    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[SetUserOneTimePassword]
    (
    	@UserID int,
    	@Password nvarchar(200),
    	@OneTimePasswordState int
    )
    AS
    UPDATE Users
    SET Password = @Password, OneTimePasswordState = @OneTimePasswordState
    WHERE UserID = @UserID
    RETURN 
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[SfBUserExists]
    (
    	@AccountID int,
    	@SipAddress nvarchar(300),
    	@Exists bit OUTPUT
    )
    AS

    	SET @Exists = 0
    	IF EXISTS(SELECT * FROM [dbo].[ExchangeAccountEmailAddresses] WHERE [EmailAddress] = @SipAddress AND [AccountID] <> @AccountID)
    		BEGIN
    			SET @Exists = 1
    		END
    	ELSE IF EXISTS(SELECT * FROM [dbo].[ExchangeAccounts] WHERE [PrimaryEmailAddress] = @SipAddress AND [AccountID] <> @AccountID)
    		BEGIN
    			SET @Exists = 1
    		END
    	ELSE IF EXISTS(SELECT * FROM [dbo].[ExchangeAccounts] WHERE [UserPrincipalName] = @SipAddress AND [AccountID] <> @AccountID)
    		BEGIN
    			SET @Exists = 1
    		END
    	ELSE IF EXISTS(SELECT * FROM [dbo].[ExchangeAccounts] WHERE [AccountName] = @SipAddress AND [AccountID] <> @AccountID)
    		BEGIN
    			SET @Exists = 1
    		END
    	ELSE IF EXISTS(SELECT * FROM [dbo].[SfBUsers] WHERE [SipAddress] = @SipAddress)
    		BEGIN
    			SET @Exists = 1
    		END

    	RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdateAdditionalGroup]
    (
    	@GroupID INT,
    	@GroupName NVARCHAR(255)
    )
    AS

    UPDATE AdditionalGroups SET
    	GroupName = @GroupName
    WHERE ID = @GroupID
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdateBackgroundTask]
    (
    	@Guid UNIQUEIDENTIFIER,
    	@TaskID INT,
    	@ScheduleID INT,
    	@PackageID INT,
    	@TaskName NVARCHAR(255),
    	@ItemID INT,
    	@ItemName NVARCHAR(255),
    	@FinishDate DATETIME,
    	@IndicatorCurrent INT,
    	@IndicatorMaximum INT,
    	@MaximumExecutionTime INT,
    	@Source NVARCHAR(MAX),
    	@Severity INT,
    	@Completed BIT,
    	@NotifyOnComplete BIT,
    	@Status INT
    )
    AS

    UPDATE BackgroundTasks
    SET
    	Guid = @Guid,
    	ScheduleID = @ScheduleID,
    	PackageID = @PackageID,
    	TaskName = @TaskName,
    	ItemID = @ItemID,
    	ItemName = @ItemName,
    	FinishDate = @FinishDate,
    	IndicatorCurrent = @IndicatorCurrent,
    	IndicatorMaximum = @IndicatorMaximum,
    	MaximumExecutionTime = @MaximumExecutionTime,
    	Source = @Source,
    	Severity = @Severity,
    	Completed = @Completed,
    	NotifyOnComplete = @NotifyOnComplete,
    	Status = @Status
    WHERE ID = @TaskID
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdateCRMUser]
    (
    	@ItemID int,
    	@CALType int
    )
    AS
    BEGIN
    	SET NOCOUNT ON;

    UPDATE [dbo].[CRMUsers]
       SET 
          CALType = @CALType
     WHERE AccountID = @ItemID

    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdateDnsRecord]
    (
    	@ActorID int,
    	@RecordID int,
    	@RecordType nvarchar(10),
    	@RecordName nvarchar(50),
    	@RecordData nvarchar(500),
    	@MXPriority int,
    	@SrvPriority int,
    	@SrvWeight int,
    	@SrvPort int,
    	@IPAddressID int
    )
    AS

    IF @IPAddressID = 0 SET @IPAddressID = NULL

    -- check rights
    DECLARE @ServiceID int, @ServerID int, @PackageID int
    SELECT
    	@ServiceID = ServiceID,
    	@ServerID = ServerID,
    	@PackageID = PackageID
    FROM GlobalDnsRecords
    WHERE
    	RecordID = @RecordID

    IF (@ServiceID > 0 OR @ServerID > 0) AND dbo.CheckIsUserAdmin(@ActorID) = 0
    RAISERROR('You are not allowed to perform this operation', 16, 1)

    IF (@PackageID > 0) AND dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    -- update record
    UPDATE GlobalDnsRecords
    SET
    	RecordType = @RecordType,
    	RecordName = @RecordName,
    	RecordData = @RecordData,
    	MXPriority = @MXPriority,
    	SrvPriority = @SrvPriority,
    	SrvWeight = @SrvWeight,
    	SrvPort = @SrvPort,
    	IPAddressID = @IPAddressID
    WHERE
    	RecordID = @RecordID
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdateDomain]
    (
    	@DomainID int,
    	@ActorID int,
    	@ZoneItemID int,
    	@HostingAllowed bit,
    	@WebSiteID int,
    	@MailDomainID int,
    	@DomainItemID int
    )
    AS

    -- check rights
    DECLARE @PackageID int
    SELECT @PackageID = PackageID FROM Domains
    WHERE DomainID = @DomainID

    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    IF @ZoneItemID = 0 SET @ZoneItemID = NULL
    IF @WebSiteID = 0 SET @WebSiteID = NULL
    IF @MailDomainID = 0 SET @MailDomainID = NULL

    -- update record
    UPDATE Domains
    SET
    	ZoneItemID = @ZoneItemID,
    	HostingAllowed = @HostingAllowed,
    	WebSiteID = @WebSiteID,
    	MailDomainID = @MailDomainID,
    	DomainItemID = @DomainItemID
    WHERE
    	DomainID = @DomainID
    	RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[UpdateDomainCreationDate]
    (
    	@DomainId INT,
    	@Date DateTime
    )
    AS
    UPDATE [dbo].[Domains] SET [CreationDate] = @Date WHERE [DomainID] = @DomainId
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[UpdateDomainDates]
    (
    	@DomainId INT,
    	@DomainCreationDate DateTime,
    	@DomainExpirationDate DateTime,
    	@DomainLastUpdateDate DateTime 
    )
    AS
    UPDATE [dbo].[Domains] SET [CreationDate] = @DomainCreationDate, [ExpirationDate] = @DomainExpirationDate, [LastUpdateDate] = @DomainLastUpdateDate WHERE [DomainID] = @DomainId
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[UpdateDomainExpirationDate]
    (
    	@DomainId INT,
    	@Date DateTime
    )
    AS
    UPDATE [dbo].[Domains] SET [ExpirationDate] = @Date WHERE [DomainID] = @DomainId
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[UpdateDomainLastUpdateDate]
    (
    	@DomainId INT,
    	@Date DateTime
    )
    AS
    UPDATE [dbo].[Domains] SET [LastUpdateDate] = @Date WHERE [DomainID] = @DomainId
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdateEntepriseFolderStorageSpaceFolder]
    (
    	@ItemID INT,
    	@FolderName NVARCHAR(255),
    	@StorageSpaceFolderId INT
    )
    AS

    UPDATE EnterpriseFolders
    SET StorageSpaceFolderId = @StorageSpaceFolderId
    WHERE ItemID = @ItemID AND FolderName = @FolderName
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdateEnterpriseFolder]
    (
    	@ItemID INT,
    	@FolderID NVARCHAR(255),
    	@FolderName NVARCHAR(255),
    	@FolderQuota INT
    )
    AS

    UPDATE EnterpriseFolders SET
    	FolderName = @FolderName,
    	FolderQuota = @FolderQuota
    WHERE ItemID = @ItemID AND FolderName = @FolderID
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    -- Password column removed
    CREATE PROCEDURE [dbo].[UpdateExchangeAccount] 
    (
    	@AccountID int,
    	@AccountName nvarchar(300),
    	@DisplayName nvarchar(300),
    	@PrimaryEmailAddress nvarchar(300),
    	@AccountType int,
    	@SamAccountName nvarchar(100),
    	@MailEnabledPublicFolder bit,
    	@MailboxManagerActions varchar(200),
    	@MailboxPlanId int,
    	@ArchivingMailboxPlanId int,
    	@SubscriberNumber varchar(32),
    	@EnableArchiving bit
    )
    AS

    BEGIN TRAN	

    IF (@MailboxPlanId = -1) 
    BEGIN
    	SET @MailboxPlanId = NULL
    END

    UPDATE ExchangeAccounts SET
    	AccountName = @AccountName,
    	DisplayName = @DisplayName,
    	PrimaryEmailAddress = @PrimaryEmailAddress,
    	MailEnabledPublicFolder = @MailEnabledPublicFolder,
    	MailboxManagerActions = @MailboxManagerActions,	
    	AccountType =@AccountType,
    	SamAccountName = @SamAccountName,
    	MailboxPlanId = @MailboxPlanId,
    	SubscriberNumber = @SubscriberNumber,
    	ArchivingMailboxPlanId = @ArchivingMailboxPlanId,
    	EnableArchiving = @EnableArchiving

    WHERE
    	AccountID = @AccountID

    IF (@@ERROR <> 0 )
    	BEGIN
    		ROLLBACK TRANSACTION
    		RETURN -1
    	END

    COMMIT TRAN
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdateExchangeAccountSLSettings]
    (
    	@AccountID int,
    	@LevelID int,
    	@IsVIP bit
    )
    AS

    BEGIN TRAN	

    	IF (@LevelID = -1) 
    	BEGIN
    		SET @LevelID = NULL
    	END

    	UPDATE ExchangeAccounts SET
    		LevelID = @LevelID,
    		IsVIP = @IsVIP
    	WHERE
    		AccountID = @AccountID

    	IF (@@ERROR <> 0 )
    		BEGIN
    			ROLLBACK TRANSACTION
    			RETURN -1
    		END
    COMMIT TRAN
    RETURN 
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
     CREATE PROCEDURE [dbo].[UpdateExchangeAccountUserPrincipalName]
    (
    	@AccountID int,
    	@UserPrincipalName nvarchar(300)
    )
    AS

    UPDATE ExchangeAccounts SET
    	UserPrincipalName = @UserPrincipalName
    WHERE
    	AccountID = @AccountID

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
     CREATE PROCEDURE [dbo].[UpdateExchangeDisclaimer] 
    (
    	@ExchangeDisclaimerId int,
    	@DisclaimerName nvarchar(300),
    	@DisclaimerText nvarchar(MAX)
    )
    AS

    UPDATE ExchangeDisclaimers SET
    	DisclaimerName = @DisclaimerName,
    	DisclaimerText = @DisclaimerText

    WHERE ExchangeDisclaimerId = @ExchangeDisclaimerId

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdateExchangeMailboxPlan] 
    (
    	@MailboxPlanId int,
    	@MailboxPlan	nvarchar(300),
    	@EnableActiveSync bit,
    	@EnableIMAP bit,
    	@EnableMAPI bit,
    	@EnableOWA bit,
    	@EnablePOP bit,
    	@EnableAutoReply bit,
    	@IsDefault bit,
    	@IssueWarningPct int,
    	@KeepDeletedItemsDays int,
    	@MailboxSizeMB int,
    	@MaxReceiveMessageSizeKB int,
    	@MaxRecipients int,
    	@MaxSendMessageSizeKB int,
    	@ProhibitSendPct int,
    	@ProhibitSendReceivePct int	,
    	@HideFromAddressBook bit,
    	@MailboxPlanType int,
    	@AllowLitigationHold bit,
    	@RecoverableItemsWarningPct int,
    	@RecoverableItemsSpace int,
    	@LitigationHoldUrl nvarchar(256),
    	@LitigationHoldMsg nvarchar(512),
    	@Archiving bit,
    	@EnableArchiving bit,
    	@ArchiveSizeMB int,
    	@ArchiveWarningPct int,
    	@EnableForceArchiveDeletion bit,
    	@IsForJournaling bit
    )
    AS

    UPDATE ExchangeMailboxPlans SET
    	MailboxPlan = @MailboxPlan,
    	EnableActiveSync = @EnableActiveSync,
    	EnableIMAP = @EnableIMAP,
    	EnableMAPI = @EnableMAPI,
    	EnableOWA = @EnableOWA,
    	EnablePOP = @EnablePOP,
    	EnableAutoReply = @EnableAutoReply,
    	IsDefault = @IsDefault,
    	IssueWarningPct= @IssueWarningPct,
    	KeepDeletedItemsDays = @KeepDeletedItemsDays,
    	MailboxSizeMB= @MailboxSizeMB,
    	MaxReceiveMessageSizeKB= @MaxReceiveMessageSizeKB,
    	MaxRecipients= @MaxRecipients,
    	MaxSendMessageSizeKB= @MaxSendMessageSizeKB,
    	ProhibitSendPct= @ProhibitSendPct,
    	ProhibitSendReceivePct = @ProhibitSendReceivePct,
    	HideFromAddressBook = @HideFromAddressBook,
    	MailboxPlanType = @MailboxPlanType,
    	AllowLitigationHold = @AllowLitigationHold,
    	RecoverableItemsWarningPct = @RecoverableItemsWarningPct,
    	RecoverableItemsSpace = @RecoverableItemsSpace, 
    	LitigationHoldUrl = @LitigationHoldUrl,
    	LitigationHoldMsg = @LitigationHoldMsg,
    	Archiving = @Archiving,
    	EnableArchiving = @EnableArchiving,
    	ArchiveSizeMB = @ArchiveSizeMB,
    	ArchiveWarningPct = @ArchiveWarningPct,
    	EnableForceArchiveDeletion = @EnableForceArchiveDeletion,
    	IsForJournaling = @IsForJournaling
    WHERE MailboxPlanId = @MailboxPlanId

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[UpdateExchangeOrganizationSettings]
    (
    	@ItemId INT ,
    	@SettingsName nvarchar(100) ,
    	@Xml nvarchar(max)
    )
    AS
    IF NOT EXISTS (SELECT * FROM [dbo].[ExchangeOrganizationSettings] WHERE [ItemId] = @ItemId AND [SettingsName]= @SettingsName )
    BEGIN
    INSERT [dbo].[ExchangeOrganizationSettings] ([ItemId], [SettingsName], [Xml]) VALUES (@ItemId, @SettingsName, @Xml)
    END
    ELSE
    UPDATE [dbo].[ExchangeOrganizationSettings] SET [Xml] = @Xml WHERE [ItemId] = @ItemId AND [SettingsName]= @SettingsName
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdateExchangeRetentionPolicyTag] 
    (
    	@TagID int,
    	@ItemID int,
    	@TagName nvarchar(255),
    	@TagType int,
    	@AgeLimitForRetention int,
    	@RetentionAction int
    )
    AS

    UPDATE ExchangeRetentionPolicyTags SET
    	ItemID = @ItemID,
    	TagName = @TagName,
    	TagType = @TagType,
    	AgeLimitForRetention = @AgeLimitForRetention,
    	RetentionAction = @RetentionAction
    WHERE TagID = @TagID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdateHostingPlan]
    (
    	@ActorID int,
    	@PlanID int,
    	@PackageID int,
    	@ServerID int,
    	@PlanName nvarchar(200),
    	@PlanDescription ntext,
    	@Available bit,
    	@SetupPrice money,
    	@RecurringPrice money,
    	@RecurrenceLength int,
    	@RecurrenceUnit int,
    	@QuotasXml ntext
    )
    AS

    -- check rights
    DECLARE @UserID int
    SELECT @UserID = UserID FROM HostingPlans
    WHERE PlanID = @PlanID

    -- check rights
    IF dbo.CheckActorUserRights(@ActorID, @UserID) = 0
    RAISERROR('You are not allowed to access this account', 16, 1)

    IF @ServerID = 0
    SELECT @ServerID = ServerID FROM Packages
    WHERE PackageID = @PackageID

    IF @PackageID = 0 SET @PackageID = NULL
    IF @ServerID = 0 SET @ServerID = NULL

    -- update record
    UPDATE HostingPlans SET
    	PackageID = @PackageID,
    	ServerID = @ServerID,
    	PlanName = @PlanName,
    	PlanDescription = @PlanDescription,
    	Available = @Available,
    	SetupPrice = @SetupPrice,
    	RecurringPrice = @RecurringPrice,
    	RecurrenceLength = @RecurrenceLength,
    	RecurrenceUnit = @RecurrenceUnit
    WHERE PlanID = @PlanID

    BEGIN TRAN

    -- update quotas
    EXEC UpdateHostingPlanQuotas @ActorID, @PlanID, @QuotasXml

    DECLARE @ExceedingQuotas AS TABLE (QuotaID int, QuotaName nvarchar(50), QuotaValue int)
    INSERT INTO @ExceedingQuotas
    SELECT * FROM dbo.GetPackageExceedingQuotas(@PackageID) WHERE QuotaValue > 0

    SELECT * FROM @ExceedingQuotas

    IF EXISTS(SELECT * FROM @ExceedingQuotas)
    BEGIN
    	ROLLBACK TRAN
    	RETURN
    END

    COMMIT TRAN

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdateHostingPlanQuotas]
    (
    	@ActorID int,
    	@PlanID int,
    	@Xml ntext
    )
    AS

    /*
    XML Format:

    <plan>
    	<groups>
    		<group id="16" enabled="1" calculateDiskSpace="1" calculateBandwidth="1"/>
    	</groups>
    	<quotas>
    		<quota id="2" value="2"/>
    	</quotas>
    </plan>

    */

    -- check rights
    DECLARE @UserID int
    SELECT @UserID = UserID FROM HostingPlans
    WHERE PlanID = @PlanID

    -- check rights
    IF dbo.CheckActorUserRights(@ActorID, @UserID) = 0
    RAISERROR('You are not allowed to access this account', 16, 1)

    DECLARE @idoc int
    --Create an internal representation of the XML document.
    EXEC sp_xml_preparedocument @idoc OUTPUT, @xml

    -- delete old HP resources
    DELETE FROM HostingPlanResources
    WHERE PlanID = @PlanID

    -- delete old HP quotas
    DELETE FROM HostingPlanQuotas
    WHERE PlanID = @PlanID

    -- update HP resources
    INSERT INTO HostingPlanResources
    (
    	PlanID,
    	GroupID,
    	CalculateDiskSpace,
    	CalculateBandwidth
    )
    SELECT
    	@PlanID,
    	GroupID,
    	CalculateDiskSpace,
    	CalculateBandwidth
    FROM OPENXML(@idoc, '/plan/groups/group',1) WITH
    (
    	GroupID int '@id',
    	CalculateDiskSpace bit '@calculateDiskSpace',
    	CalculateBandwidth bit '@calculateBandwidth'
    ) as XRG

    -- update HP quotas
    INSERT INTO HostingPlanQuotas
    (
    	PlanID,
    	QuotaID,
    	QuotaValue
    )
    SELECT
    	@PlanID,
    	QuotaID,
    	QuotaValue
    FROM OPENXML(@idoc, '/plan/quotas/quota',1) WITH
    (
    	QuotaID int '@id',
    	QuotaValue int '@value'
    ) as PV

    -- remove document
    exec sp_xml_removedocument @idoc

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdateIPAddress]
    (
     @AddressID int,
     @ServerID int,
     @ExternalIP varchar(24),
     @InternalIP varchar(24),
     @PoolID int,
     @SubnetMask varchar(15),
     @DefaultGateway varchar(15),
     @Comments ntext,
     @VLAN int
    )
    AS
    BEGIN
     IF @ServerID = 0
     SET @ServerID = NULL

     UPDATE IPAddresses SET
      ExternalIP = @ExternalIP,
      InternalIP = @InternalIP,
      ServerID = @ServerID,
      PoolID = @PoolID,
      SubnetMask = @SubnetMask,
      DefaultGateway = @DefaultGateway,
      Comments = @Comments,
      VLAN = @VLAN
     WHERE AddressID = @AddressID
     RETURN
    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdateIPAddresses]
    (
     @xml ntext,
     @PoolID int,
     @ServerID int,
     @SubnetMask varchar(15),
     @DefaultGateway varchar(15),
     @Comments ntext,
     @VLAN int
    )
    AS
    BEGIN
     SET NOCOUNT ON;
     IF @ServerID = 0
     SET @ServerID = NULL
     DECLARE @idoc int
     --Create an internal representation of the XML document.
     EXEC sp_xml_preparedocument @idoc OUTPUT, @xml
     -- update
     UPDATE IPAddresses SET
      ServerID = @ServerID,
      PoolID = @PoolID,
      SubnetMask = @SubnetMask,
      DefaultGateway = @DefaultGateway,
      Comments = @Comments,
      VLAN = @VLAN
     FROM IPAddresses AS IP
     INNER JOIN OPENXML(@idoc, '/items/item', 1) WITH
     (
      AddressID int '@id'
     ) as PV ON IP.AddressID = PV.AddressID
     -- remove document
     exec sp_xml_removedocument @idoc
    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[UpdateLyncUser]
    (
    	@AccountID int,
    	@SipAddress nvarchar(300)
    )
    AS

    UPDATE LyncUsers SET
    	SipAddress = @SipAddress
    WHERE
    	AccountID = @AccountID

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
     CREATE PROCEDURE [dbo].[UpdateLyncUserPlan] 
    (
    	@LyncUserPlanId int,
    	@LyncUserPlanName	nvarchar(300),
    	@LyncUserPlanType int,
    	@IM bit,
    	@Mobility bit,
    	@MobilityEnableOutsideVoice bit,
    	@Federation bit,
    	@Conferencing bit,
    	@EnterpriseVoice bit,
    	@VoicePolicy int,
    	@IsDefault bit,

    	@RemoteUserAccess bit,
    	@PublicIMConnectivity bit,

    	@AllowOrganizeMeetingsWithExternalAnonymous bit,

    	@Telephony int,

    	@ServerURI nvarchar(300),

    	@ArchivePolicy nvarchar(300),

    	@TelephonyDialPlanPolicy nvarchar(300),
    	@TelephonyVoicePolicy nvarchar(300)
    )
    AS

    UPDATE LyncUserPlans SET
    	LyncUserPlanName = @LyncUserPlanName,
    	LyncUserPlanType = @LyncUserPlanType,
    	IM = @IM,
    	Mobility = @Mobility,
    	MobilityEnableOutsideVoice = @MobilityEnableOutsideVoice,
    	Federation = @Federation,
    	Conferencing =@Conferencing,
    	EnterpriseVoice = @EnterpriseVoice,
    	VoicePolicy = @VoicePolicy,
    	IsDefault = @IsDefault,

    	RemoteUserAccess = @RemoteUserAccess,
    	PublicIMConnectivity = @PublicIMConnectivity,

    	AllowOrganizeMeetingsWithExternalAnonymous = @AllowOrganizeMeetingsWithExternalAnonymous,

    	Telephony = @Telephony,

    	ServerURI = @ServerURI,

    	ArchivePolicy = @ArchivePolicy,
    	TelephonyDialPlanPolicy = @TelephonyDialPlanPolicy,
    	TelephonyVoicePolicy = @TelephonyVoicePolicy

    WHERE LyncUserPlanId = @LyncUserPlanId

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[UpdatePackage]
    (
    	@ActorID int,
    	@PackageID int,
    	@PackageName nvarchar(300),
    	@PackageComments ntext,
    	@StatusID int,
    	@PlanID int,
    	@PurchaseDate datetime,
    	@OverrideQuotas bit,
    	@QuotasXml ntext,
    	@DefaultTopPackage bit
    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    BEGIN TRAN

    DECLARE @ParentPackageID int
    DECLARE @OldPlanID int

    SELECT @ParentPackageID = ParentPackageID, @OldPlanID = PlanID FROM Packages
    WHERE PackageID = @PackageID

    -- update package
    UPDATE Packages SET
    	PackageName = @PackageName,
    	PackageComments = @PackageComments,
    	StatusID = @StatusID,
    	PlanID = @PlanID,
    	PurchaseDate = @PurchaseDate,
    	OverrideQuotas = @OverrideQuotas,
    	DefaultTopPackage = @DefaultTopPackage
    WHERE
    	PackageID = @PackageID

    -- update quotas (if required)
    EXEC UpdatePackageQuotas @ActorID, @PackageID, @QuotasXml

    -- check resulting quotas
    DECLARE @ExceedingQuotas AS TABLE (QuotaID int, QuotaName nvarchar(50), QuotaValue int)

    -- check exceeding quotas if plan has been changed
    IF (@OldPlanID <> @PlanID) OR (@OverrideQuotas = 1)
    BEGIN
    	INSERT INTO @ExceedingQuotas
    	SELECT * FROM dbo.GetPackageExceedingQuotas(@ParentPackageID) WHERE QuotaValue > 0
    END

    SELECT * FROM @ExceedingQuotas

    IF EXISTS(SELECT * FROM @ExceedingQuotas)
    BEGIN
    	ROLLBACK TRAN
    	RETURN
    END

    COMMIT TRAN
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdatePackageAddon]
    (
    	@ActorID int,
    	@PackageAddonID int,
    	@PlanID int,
    	@Quantity int,
    	@PurchaseDate datetime,
    	@StatusID int,
    	@Comments ntext
    )
    AS

    DECLARE @PackageID int
    SELECT @PackageID = PackageID FROM PackageAddons
    WHERE PackageAddonID = @PackageAddonID

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    BEGIN TRAN

    DECLARE @ParentPackageID int
    SELECT @ParentPackageID = ParentPackageID FROM Packages
    WHERE PackageID = @PackageID

    -- update record
    UPDATE PackageAddons SET
    	PlanID = @PlanID,
    	Quantity = @Quantity,
    	PurchaseDate = @PurchaseDate,
    	StatusID = @StatusID,
    	Comments = @Comments
    WHERE PackageAddonID = @PackageAddonID

    DECLARE @ExceedingQuotas AS TABLE (QuotaID int, QuotaName nvarchar(50), QuotaValue int)
    INSERT INTO @ExceedingQuotas
    SELECT * FROM dbo.GetPackageExceedingQuotas(@ParentPackageID) WHERE QuotaValue > 0

    SELECT * FROM @ExceedingQuotas

    IF EXISTS(SELECT * FROM @ExceedingQuotas)
    BEGIN
    	ROLLBACK TRAN
    	RETURN
    END

    COMMIT TRAN

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdatePackageBandwidth]
    (
    	@PackageID int,
    	@xml ntext
    )
    AS
    DECLARE @idoc int
    --Create an internal representation of the XML document.
    EXEC sp_xml_preparedocument @idoc OUTPUT, @xml

    DECLARE @Items TABLE
    (
    	ItemID int,
    	LogDate datetime,
    	BytesSent bigint,
    	BytesReceived bigint
    )

    INSERT INTO @Items
    (
    	ItemID,
    	LogDate,
    	BytesSent,
    	BytesReceived
    )
    SELECT
    	ItemID,
    	CONVERT(datetime, LogDate, 101),
    	BytesSent,
    	BytesReceived
    FROM OPENXML(@idoc, '/items/item',1) WITH
    (
    	ItemID int '@id',
    	LogDate nvarchar(10) '@date',
        BytesSent bigint '@sent',
        BytesReceived bigint '@received'
    )

    -- delete current statistics
    DELETE FROM PackagesBandwidth
    FROM PackagesBandwidth AS PB
    INNER JOIN (
    	SELECT
    		SIT.GroupID,
    		I.LogDate
    	FROM @Items AS I
    	INNER JOIN ServiceItems AS SI ON I.ItemID = SI.ItemID
    	INNER JOIN ServiceItemTypes AS SIT ON SI.ItemTypeID = SIT.ItemTypeID
    	GROUP BY I.LogDate, SIT.GroupID
    ) AS STAT ON PB.LogDate = STAT.LogDate AND PB.GroupID = STAT.GroupID
    WHERE PB.PackageID = @PackageID

    -- insert new statistics
    INSERT INTO PackagesBandwidth (PackageID, GroupID, LogDate, BytesSent, BytesReceived)
    SELECT
    	@PackageID,
    	SIT.GroupID,
    	I.LogDate,
    	SUM(I.BytesSent),
    	SUM(I.BytesReceived)
    FROM @Items AS I
    INNER JOIN ServiceItems AS SI ON I.ItemID = SI.ItemID
    INNER JOIN ServiceItemTypes AS SIT ON SI.ItemTypeID = SIT.ItemTypeID
    GROUP BY I.LogDate, SIT.GroupID

    -- remove document
    exec sp_xml_removedocument @idoc

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdatePackageBandwidthUpdate]
    (
    	@PackageID int,
    	@UpdateDate datetime
    )
    AS

    UPDATE Packages SET BandwidthUpdated = @UpdateDate
    WHERE PackageID = @PackageID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdatePackageDiskSpace]
    (
    	@PackageID int,
    	@xml ntext
    )
    AS
    DECLARE @idoc int
    --Create an internal representation of the XML document.
    EXEC sp_xml_preparedocument @idoc OUTPUT, @xml
    -- Execute a SELECT statement that uses the OPENXML rowset provider.

    DECLARE @Items TABLE
    (
    	ItemID int,
    	Bytes bigint
    )

    INSERT INTO @Items (ItemID, Bytes)
    SELECT ItemID, DiskSpace FROM OPENXML (@idoc, '/items/item',1)
    WITH
    (
    	ItemID int '@id',
    	DiskSpace bigint '@bytes'
    ) as XSI

    -- remove current diskspace
    DELETE FROM PackagesDiskspace
    WHERE PackageID = @PackageID

    -- update package diskspace
    INSERT INTO PackagesDiskspace (PackageID, GroupID, Diskspace)
    SELECT
    	@PackageID,
    	SIT.GroupID,
    	SUM(I.Bytes)
    FROM @Items AS I
    INNER JOIN ServiceItems AS SI ON I.ItemID = SI.ItemID
    INNER JOIN ServiceItemTypes AS SIT ON SI.ItemTypeID = SIT.ItemTypeID
    GROUP BY SIT.GroupID

    -- remove document
    exec sp_xml_removedocument @idoc

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdatePackageName]
    (
    	@ActorID int,
    	@PackageID int,
    	@PackageName nvarchar(300),
    	@PackageComments ntext
    )
    AS

    -- check rights
    DECLARE @UserID int
    SELECT @UserID = UserID FROM Packages
    WHERE PackageID = @PackageID

    IF NOT(dbo.CheckActorPackageRights(@ActorID, @PackageID) = 1
    	OR @UserID = @ActorID
    	OR EXISTS(SELECT UserID FROM Users WHERE UserID = @ActorID AND OwnerID = @UserID AND IsPeer = 1))
    RAISERROR('You are not allowed to access this package', 16, 1)

    -- update package
    UPDATE Packages SET
    	PackageName = @PackageName,
    	PackageComments = @PackageComments
    WHERE
    	PackageID = @PackageID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdatePackageQuotas]
    (
    	@ActorID int,
    	@PackageID int,
    	@Xml ntext
    )
    AS

    /*
    XML Format:

    <plan>
    	<groups>
    		<group id="16" enabled="1" calculateDiskSpace="1" calculateBandwidth="1"/>
    	</groups>
    	<quotas>
    		<quota id="2" value="2"/>
    	</quotas>
    </plan>

    */

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    DECLARE @OverrideQuotas bit
    SELECT @OverrideQuotas = OverrideQuotas FROM Packages
    WHERE PackageID = @PackageID

    IF @OverrideQuotas = 0
    BEGIN
    	-- delete old Package resources
    	DELETE FROM PackageResources
    	WHERE PackageID = @PackageID

    	-- delete old Package quotas
    	DELETE FROM PackageQuotas
    	WHERE PackageID = @PackageID
    END

    IF @OverrideQuotas = 1 AND @Xml IS NOT NULL
    BEGIN
    	-- delete old Package resources
    	DELETE FROM PackageResources
    	WHERE PackageID = @PackageID

    	-- delete old Package quotas
    	DELETE FROM PackageQuotas
    	WHERE PackageID = @PackageID

    	DECLARE @idoc int
    	--Create an internal representation of the XML document.
    	EXEC sp_xml_preparedocument @idoc OUTPUT, @xml

    	-- update Package resources
    	INSERT INTO PackageResources
    	(
    		PackageID,
    		GroupID,
    		CalculateDiskSpace,
    		CalculateBandwidth
    	)
    	SELECT
    		@PackageID,
    		GroupID,
    		CalculateDiskSpace,
    		CalculateBandwidth
    	FROM OPENXML(@idoc, '/plan/groups/group',1) WITH
    	(
    		GroupID int '@id',
    		CalculateDiskSpace bit '@calculateDiskSpace',
    		CalculateBandwidth bit '@calculateBandwidth'
    	) as XRG

    	-- update Package quotas
    	INSERT INTO PackageQuotas
    	(
    		PackageID,
    		QuotaID,
    		QuotaValue
    	)
    	SELECT
    		@PackageID,
    		QuotaID,
    		QuotaValue
    	FROM OPENXML(@idoc, '/plan/quotas/quota',1) WITH
    	(
    		QuotaID int '@id',
    		QuotaValue int '@value'
    	) as PV

    	-- remove document
    	exec sp_xml_removedocument @idoc
    END
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdatePackageSettings]
    (
    	@ActorID int,
    	@PackageID int,
    	@SettingsName nvarchar(50),
    	@Xml ntext
    )
    AS

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    -- delete old properties
    BEGIN TRAN
    DECLARE @idoc int
    --Create an internal representation of the XML document.
    EXEC sp_xml_preparedocument @idoc OUTPUT, @xml

    -- Execute a SELECT statement that uses the OPENXML rowset provider.
    DELETE FROM PackageSettings
    WHERE PackageID = @PackageID AND SettingsName = @SettingsName

    INSERT INTO PackageSettings
    (
    	PackageID,
    	SettingsName,
    	PropertyName,
    	PropertyValue
    )
    SELECT
    	@PackageID,
    	@SettingsName,
    	PropertyName,
    	PropertyValue
    FROM OPENXML(@idoc, '/properties/property',1) WITH
    (
    	PropertyName nvarchar(50) '@name',
    	PropertyValue ntext '@value'
    ) as PV

    -- remove document
    exec sp_xml_removedocument @idoc

    COMMIT TRAN

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdatePrivateNetworVLAN]
    (
     @VlanID int,
     @ServerID int,
     @Vlan int,
     @Comments ntext
    )
    AS
    BEGIN
     IF @ServerID = 0
     SET @ServerID = NULL

     UPDATE PrivateNetworkVLANs SET
      Vlan = @Vlan,
      ServerID = @ServerID,
      Comments = @Comments
     WHERE VlanID = @VlanID
     RETURN
    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[UpdateRDSCollection]
    (
    	@ID INT,
    	@ItemID INT,
    	@Name NVARCHAR(255),
    	@Description NVARCHAR(255),
    	@DisplayName NVARCHAR(255)
    )
    AS

    UPDATE RDSCollections
    SET
    	ItemID = @ItemID,
    	Name = @Name,
    	Description = @Description,
    	DisplayName = @DisplayName
    WHERE ID = @Id
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[UpdateRDSCollectionSettings]
    (
    	@ID INT,
    	@RDSCollectionId INT,
    	@DisconnectedSessionLimitMin INT, 
    	@ActiveSessionLimitMin INT,
    	@IdleSessionLimitMin INT,
    	@BrokenConnectionAction NVARCHAR(20),
    	@AutomaticReconnectionEnabled BIT,
    	@TemporaryFoldersDeletedOnExit BIT,
    	@TemporaryFoldersPerSession BIT,
    	@ClientDeviceRedirectionOptions NVARCHAR(250),
    	@ClientPrinterRedirected BIT,
    	@ClientPrinterAsDefault BIT,
    	@RDEasyPrintDriverEnabled BIT,
    	@MaxRedirectedMonitors INT,
    	@SecurityLayer NVARCHAR(20),
    	@EncryptionLevel NVARCHAR(20),
    	@AuthenticateUsingNLA BIT
    )
    AS

    UPDATE RDSCollectionSettings
    SET
    	RDSCollectionId = @RDSCollectionId,
    	DisconnectedSessionLimitMin = @DisconnectedSessionLimitMin,
    	ActiveSessionLimitMin = @ActiveSessionLimitMin,
    	IdleSessionLimitMin = @IdleSessionLimitMin,
    	BrokenConnectionAction = @BrokenConnectionAction,
    	AutomaticReconnectionEnabled = @AutomaticReconnectionEnabled,
    	TemporaryFoldersDeletedOnExit = @TemporaryFoldersDeletedOnExit,
    	TemporaryFoldersPerSession = @TemporaryFoldersPerSession,
    	ClientDeviceRedirectionOptions = @ClientDeviceRedirectionOptions,
    	ClientPrinterRedirected = @ClientPrinterRedirected,
    	ClientPrinterAsDefault = @ClientPrinterAsDefault,
    	RDEasyPrintDriverEnabled = @RDEasyPrintDriverEnabled,
    	MaxRedirectedMonitors = @MaxRedirectedMonitors,
    	SecurityLayer = @SecurityLayer,
    	EncryptionLevel = @EncryptionLevel,
    	AuthenticateUsingNLA = @AuthenticateUsingNLA
    WHERE ID = @Id
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[UpdateRDSServer]
    (
    	@Id  INT,
    	@ItemID INT,
    	@Name NVARCHAR(255),
    	@FqdName NVARCHAR(255),
    	@Description NVARCHAR(255),
    	@RDSCollectionId INT,
    	@ConnectionEnabled BIT
    )
    AS

    UPDATE RDSServers
    SET
    	ItemID = @ItemID,
    	Name = @Name,
    	FqdName = @FqdName,
    	Description = @Description,
    	RDSCollectionId = @RDSCollectionId,
    	ConnectionEnabled = @ConnectionEnabled
    WHERE ID = @Id
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[UpdateRDSServerSettings]
    (
    	@ServerId int,
    	@SettingsName nvarchar(50),
    	@Xml ntext
    )
    AS

    BEGIN TRAN
    DECLARE @idoc int
    EXEC sp_xml_preparedocument @idoc OUTPUT, @xml

    DELETE FROM RDSServerSettings
    WHERE RDSServerId = @ServerId AND SettingsName = @SettingsName

    INSERT INTO RDSServerSettings
    (
    	RDSServerId,
    	SettingsName,
    	ApplyUsers,
    	ApplyAdministrators,
    	PropertyName,
    	PropertyValue	
    )
    SELECT
    	@ServerId,
    	@SettingsName,
    	ApplyUsers,
    	ApplyAdministrators,
    	PropertyName,
    	PropertyValue
    FROM OPENXML(@idoc, '/properties/property',1) WITH 
    (
    	PropertyName nvarchar(50) '@name',
    	PropertyValue ntext '@value',
    	ApplyUsers BIT '@applyUsers',
    	ApplyAdministrators BIT '@applyAdministrators'
    ) as PV

    exec sp_xml_removedocument @idoc

    COMMIT TRAN

    RETURN 

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdateSchedule]
    (
    	@ActorID int,
    	@ScheduleID int,
    	@TaskID nvarchar(100),
    	@ScheduleName nvarchar(100),
    	@ScheduleTypeID nvarchar(50),
    	@Interval int,
    	@FromTime datetime,
    	@ToTime datetime,
    	@StartTime datetime,
    	@LastRun datetime,
    	@NextRun datetime,
    	@Enabled bit,
    	@PriorityID nvarchar(50),
    	@HistoriesNumber int,
    	@MaxExecutionTime int,
    	@WeekMonthDay int,
    	@XmlParameters ntext
    )
    AS

    -- check rights
    DECLARE @PackageID int
    SELECT @PackageID = PackageID FROM Schedule
    WHERE ScheduleID = @ScheduleID

    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    BEGIN TRAN

    UPDATE Schedule
    SET
    	TaskID = @TaskID,
    	ScheduleName = @ScheduleName,
    	ScheduleTypeID = @ScheduleTypeID,
    	Interval = @Interval,
    	FromTime = @FromTime,
    	ToTime = @ToTime,
    	StartTime = @StartTime,
    	LastRun = @LastRun,
    	NextRun = @NextRun,
    	Enabled = @Enabled,
    	PriorityID = @PriorityID,
    	HistoriesNumber = @HistoriesNumber,
    	MaxExecutionTime = @MaxExecutionTime,
    	WeekMonthDay = @WeekMonthDay
    WHERE
    	ScheduleID = @ScheduleID

    DECLARE @idoc int
    --Create an internal representation of the XML document.
    EXEC sp_xml_preparedocument @idoc OUTPUT, @XmlParameters

    -- Execute a SELECT statement that uses the OPENXML rowset provider.
    DELETE FROM ScheduleParameters
    WHERE ScheduleID = @ScheduleID

    INSERT INTO ScheduleParameters
    (
    	ScheduleID,
    	ParameterID,
    	ParameterValue
    )
    SELECT
    	@ScheduleID,
    	ParameterID,
    	ParameterValue
    FROM OPENXML(@idoc, '/parameters/parameter',1) WITH 
    (
    	ParameterID nvarchar(50) '@id',
    	ParameterValue nvarchar(3000) '@value'
    ) as PV

    -- remove document
    exec sp_xml_removedocument @idoc

    COMMIT TRAN
    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdateServer]
    (
    	@ServerID int,
    	@ServerName nvarchar(100),
    	@ServerUrl nvarchar(255),
    	@Password nvarchar(100),
    	@Comments ntext,
    	@InstantDomainAlias nvarchar(200),
    	@PrimaryGroupID int,
    	@ADEnabled bit,
    	@ADRootDomain nvarchar(200),
    	@ADUsername nvarchar(100),
    	@ADPassword nvarchar(100),
    	@ADAuthenticationType varchar(50),
    	@ADParentDomain nvarchar(200),
    	@ADParentDomainController nvarchar(200),
    	@OSPlatform int,
    	@IsCore bit,
    	@PasswordIsSHA256 bit
    )
    AS

    IF @PrimaryGroupID = 0
    SET @PrimaryGroupID = NULL

    UPDATE Servers SET
    	ServerName = @ServerName,
    	ServerUrl = @ServerUrl,
    	Password = @Password,
    	Comments = @Comments,
    	InstantDomainAlias = @InstantDomainAlias,
    	PrimaryGroupID = @PrimaryGroupID,
    	ADEnabled = @ADEnabled,
    	ADRootDomain = @ADRootDomain,
    	ADUsername = @ADUsername,
    	ADPassword = @ADPassword,
    	ADAuthenticationType = @ADAuthenticationType,
    	ADParentDomain = @ADParentDomain,
    	ADParentDomainController = @ADParentDomainController,
    	OSPlatform = @OSPlatform,
    	IsCore = @IsCore,
    	PasswordIsSHA256 = @PasswordIsSHA256
    WHERE ServerID = @ServerID
    RETURN

    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdateService]
    (
    	@ServiceID int,
    	@ServiceName nvarchar(50),
    	@Comments ntext,
    	@ServiceQuotaValue int,
    	@ClusterID int
    )
    AS

    IF @ClusterID = 0 SET @ClusterID = NULL

    UPDATE Services
    SET
    	ServiceName = @ServiceName,
    	ServiceQuotaValue = @ServiceQuotaValue,
    	Comments = @Comments,
    	ClusterID = @ClusterID
    WHERE ServiceID = @ServiceID

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdateServiceFully]
    (
    	@ServiceID int,
    	@ProviderID int,
    	@ServiceName nvarchar(50),
    	@Comments ntext,
    	@ServiceQuotaValue int,
    	@ClusterID int
    )
    AS

    IF @ClusterID = 0 SET @ClusterID = NULL

    UPDATE Services
    SET
    	ProviderID = @ProviderID,
    	ServiceName = @ServiceName,
    	ServiceQuotaValue = @ServiceQuotaValue,
    	Comments = @Comments,
    	ClusterID = @ClusterID
    WHERE ServiceID = @ServiceID

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdateServiceItem]
    (
    	@ActorID int,
    	@ItemID int,
    	@ItemName nvarchar(500),
    	@XmlProperties ntext
    )
    AS
    BEGIN TRAN

    -- check rights
    DECLARE @PackageID int
    SELECT @PackageID = PackageID FROM ServiceItems
    WHERE ItemID = @ItemID

    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    -- update item
    UPDATE ServiceItems SET ItemName = @ItemName
    WHERE ItemID=@ItemID

    DECLARE @idoc int
    --Create an internal representation of the XML document.
    EXEC sp_xml_preparedocument @idoc OUTPUT, @XmlProperties

    -- Execute a SELECT statement that uses the OPENXML rowset provider.
    DELETE FROM ServiceItemProperties
    WHERE ItemID = @ItemID

    -- Add the xml data into a temp table for the capability and robust
    IF OBJECT_ID('tempdb..#TempTable') IS NOT NULL DROP TABLE #TempTable

    CREATE TABLE #TempTable(
    	ItemID int,
    	PropertyName nvarchar(50),
    	PropertyValue  nvarchar(max))

    INSERT INTO #TempTable (ItemID, PropertyName, PropertyValue)
    SELECT
    	@ItemID,
    	PropertyName,
    	PropertyValue
    FROM OPENXML(@idoc, '/properties/property',1) WITH 
    (
    	PropertyName nvarchar(50) '@name',
    	PropertyValue nvarchar(max) '@value'
    ) as PV

    -- Move data from temp table to real table
    INSERT INTO ServiceItemProperties
    (
    	ItemID,
    	PropertyName,
    	PropertyValue
    )
    SELECT 
    	ItemID, 
    	PropertyName, 
    	PropertyValue
    FROM #TempTable

    DROP TABLE #TempTable

    -- remove document
    exec sp_xml_removedocument @idoc

    COMMIT TRAN

    RETURN 
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdateServiceProperties]
    (
    	@ServiceID int,
    	@Xml ntext
    )
    AS

    -- delete old properties
    BEGIN TRAN
    DECLARE @idoc int
    --Create an internal representation of the XML document.
    EXEC sp_xml_preparedocument @idoc OUTPUT, @xml

    -- Execute a SELECT statement that uses the OPENXML rowset provider.
    DELETE FROM ServiceProperties
    WHERE ServiceID = @ServiceID 
    AND PropertyName IN
    (
    	SELECT PropertyName
    	FROM OPENXML(@idoc, '/properties/property', 1)
    	WITH (PropertyName nvarchar(50) '@name')
    )

    INSERT INTO ServiceProperties
    (
    	ServiceID,
    	PropertyName,
    	PropertyValue
    )
    SELECT
    	@ServiceID,
    	PropertyName,
    	PropertyValue
    FROM OPENXML(@idoc, '/properties/property',1) WITH 
    (
    	PropertyName nvarchar(50) '@name',
    	PropertyValue nvarchar(MAX) '@value'
    ) as PV

    -- remove document
    exec sp_xml_removedocument @idoc

    COMMIT TRAN
    RETURN 
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdateSfBUser]
    (
    	@AccountID int,
    	@SipAddress nvarchar(300)
    )
    AS

    UPDATE SfBUsers SET
    	SipAddress = @SipAddress
    WHERE
    	AccountID = @AccountID

    RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdateSfBUserPlan]
    (
    	@SfBUserPlanId int,
    	@SfBUserPlanName	nvarchar(300),
    	@SfBUserPlanType int,
    	@IM bit,
    	@Mobility bit,
    	@MobilityEnableOutsideVoice bit,
    	@Federation bit,
    	@Conferencing bit,
    	@EnterpriseVoice bit,
    	@VoicePolicy int,
    	@IsDefault bit
    )
    AS

    UPDATE SfBUserPlans SET
    	SfBUserPlanName = @SfBUserPlanName,
    	SfBUserPlanType = @SfBUserPlanType,
    	IM = @IM,
    	Mobility = @Mobility,
    	MobilityEnableOutsideVoice = @MobilityEnableOutsideVoice,
    	Federation = @Federation,
    	Conferencing =@Conferencing,
    	EnterpriseVoice = @EnterpriseVoice,
    	VoicePolicy = @VoicePolicy,
    	IsDefault = @IsDefault
    WHERE SfBUserPlanId = @SfBUserPlanId

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[UpdateStorageSpace]
    (
    	@ID INT,
    	@Name nvarchar(300),
    	@ServiceId INT ,
    	@ServerId INT,
    	@LevelId INT,
    	@Path varchar(max),
    	@FsrmQuotaType INT,
    	@FsrmQuotaSizeBytes BIGINT,
    	@IsShared BIT,
    	@IsDisabled BIT,
    	@UncPath varchar(max)
    )
    AS
    	UPDATE StorageSpaces
    	SET Name = @Name, ServiceId = @ServiceId,ServerId=@ServerId,LevelId=@LevelId, Path=@Path,FsrmQuotaType=@FsrmQuotaType,FsrmQuotaSizeBytes=@FsrmQuotaSizeBytes,IsShared=@IsShared,UncPath=@UncPath,IsDisabled=@IsDisabled
    	WHERE ID = @ID
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdateStorageSpaceFolder]
    (
    	@ID INT,
    	@Name varchar(300),
    	@StorageSpaceId INT,
    	@Path varchar(max),
    	@UncPath varchar(max),
    	@IsShared BIT,
    	@FsrmQuotaType INT,
    	@FsrmQuotaSizeBytes BIGINT 
    )
    AS
    UPDATE StorageSpaceFolders
    SET
    	Name=@Name,
    	StorageSpaceId=@StorageSpaceId,
    	Path=@Path,
    	UncPath=@UncPath,
    	IsShared=@IsShared,
    	FsrmQuotaType=@FsrmQuotaType,
    	FsrmQuotaSizeBytes=@FsrmQuotaSizeBytes
    WHERE ID = @ID

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[UpdateStorageSpaceLevel]
    (
    	@ID INT,
    	@Name nvarchar(300),
    	@Description nvarchar(max)
    )
    AS
    	UPDATE StorageSpaceLevels
    	SET Name = @Name, Description = @Description
    	WHERE ID = @ID
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdateSupportServiceLevel]
    (
    	@LevelID int,
    	@LevelName nvarchar(100),
    	@LevelDescription nvarchar(1000)
    )
    AS
    BEGIN

    	DECLARE @PrevQuotaName nvarchar(100), @PrevLevelName nvarchar(100)

    	SELECT @PrevLevelName = LevelName FROM SupportServiceLevels WHERE LevelID = @LevelID

    	SET @PrevQuotaName = N'ServiceLevel.' + @PrevLevelName

    	UPDATE SupportServiceLevels
    	SET LevelName = @LevelName,
    		LevelDescription = @LevelDescription
    	WHERE LevelID = @LevelID

    	IF EXISTS (SELECT * FROM Quotas WHERE QuotaName = @PrevQuotaName)
    	BEGIN
    		DECLARE @QuotaID INT

    		SELECT @QuotaID = QuotaID FROM Quotas WHERE QuotaName = @PrevQuotaName

    		UPDATE Quotas
    		SET QuotaName = N'ServiceLevel.' + @LevelName,
    			QuotaDescription = @LevelName + ', users'
    		WHERE QuotaID = @QuotaID
    	END

    END

    RETURN 
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER OFF
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdateUser]
    (
    	@ActorID int,
    	@UserID int,
    	@RoleID int,
    	@StatusID int,
    	@SubscriberNumber nvarchar(32),
    	@LoginStatusId int,
    	@IsDemo bit,
    	@IsPeer bit,
    	@Comments ntext,
    	@FirstName nvarchar(50),
    	@LastName nvarchar(50),
    	@Email nvarchar(255),
    	@SecondaryEmail nvarchar(255),
    	@Address nvarchar(200),
    	@City nvarchar(50),
    	@State nvarchar(50),
    	@Country nvarchar(50),
    	@Zip varchar(20),
    	@PrimaryPhone varchar(30),
    	@SecondaryPhone varchar(30),
    	@Fax varchar(30),
    	@InstantMessenger nvarchar(200),
    	@HtmlMail bit,
    	@CompanyName nvarchar(100),
    	@EcommerceEnabled BIT,
    	@AdditionalParams NVARCHAR(max)
    )
    AS

    	-- check actor rights
    	IF dbo.CanUpdateUserDetails(@ActorID, @UserID) = 0
    	BEGIN
    		RETURN
    	END

    	IF @LoginStatusId = 0
    	BEGIN
    		UPDATE Users SET
    			FailedLogins = 0
    		WHERE UserID = @UserID
    	END

    	UPDATE Users SET
    		RoleID = @RoleID,
    		StatusID = @StatusID,
    		SubscriberNumber = @SubscriberNumber,
    		LoginStatusId = @LoginStatusId,
    		Changed = GetDate(),
    		IsDemo = @IsDemo,
    		IsPeer = @IsPeer,
    		Comments = @Comments,
    		FirstName = @FirstName,
    		LastName = @LastName,
    		Email = @Email,
    		SecondaryEmail = @SecondaryEmail,
    		Address = @Address,
    		City = @City,
    		State = @State,
    		Country = @Country,
    		Zip = @Zip,
    		PrimaryPhone = @PrimaryPhone,
    		SecondaryPhone = @SecondaryPhone,
    		Fax = @Fax,
    		InstantMessenger = @InstantMessenger,
    		HtmlMail = @HtmlMail,
    		CompanyName = @CompanyName,
    		EcommerceEnabled = @EcommerceEnabled,
    		[AdditionalParams] = @AdditionalParams
    	WHERE UserID = @UserID

    	RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdateUserFailedLoginAttempt]
    (
    	@UserID int,
    	@LockOut int,
    	@Reset int
    )
    AS

    IF (@Reset = 1)
    BEGIN
    	UPDATE Users SET FailedLogins = 0 WHERE UserID = @UserID
    END
    ELSE
    BEGIN
    	IF (@LockOut <= (SELECT FailedLogins FROM USERS WHERE UserID = @UserID))
    	BEGIN
    		UPDATE Users SET LoginStatusId = 2 WHERE UserID = @UserID
    	END
    	ELSE
    	BEGIN
    		IF ((SELECT FailedLogins FROM Users WHERE UserID = @UserID) IS NULL)
    		BEGIN
    			UPDATE Users SET FailedLogins = 1 WHERE UserID = @UserID
    		END
    		ELSE
    			UPDATE Users SET FailedLogins = FailedLogins + 1 WHERE UserID = @UserID
    	END
    END

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[UpdateUserMfaMode]
    (
    	@ActorID int,
    	@UserID int,
    	@MfaMode int
    )
    AS
    	-- check actor rights
    	IF dbo.CanUpdateUserDetails(@ActorID, @UserID) = 0
    	BEGIN
    		RETURN
    	END
    	UPDATE Users SET
    		MfaMode = @MfaMode 
    	WHERE UserID = @UserID

    	RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[UpdateUserPinSecret]
    (
    	@ActorID int,
    	@UserID int,
    	@PinSecret NVARCHAR(255)
    )
    AS
    	-- check actor rights
    	IF dbo.CanUpdateUserDetails(@ActorID, @UserID) = 0
    	BEGIN
    		RETURN
    	END
    	UPDATE Users SET
    		PinSecret = @PinSecret 
    	WHERE UserID = @UserID

    	RETURN
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdateUserSettings]
    (
    	@ActorID int,
    	@UserID int,
    	@SettingsName nvarchar(50),
    	@Xml ntext
    )
    AS

    -- check rights
    IF dbo.CheckActorUserRights(@ActorID, @UserID) = 0
    RAISERROR('You are not allowed to access this account', 16, 1)

    -- delete old properties
    BEGIN TRAN
    DECLARE @idoc int
    --Create an internal representation of the XML document.
    EXEC sp_xml_preparedocument @idoc OUTPUT, @xml

    -- Execute a SELECT statement that uses the OPENXML rowset provider.
    DELETE FROM UserSettings
    WHERE UserID = @UserID AND SettingsName = @SettingsName

    INSERT INTO UserSettings
    (
    	UserID,
    	SettingsName,
    	PropertyName,
    	PropertyValue
    )
    SELECT
    	@UserID,
    	@SettingsName,
    	PropertyName,
    	PropertyValue
    FROM OPENXML(@idoc, '/properties/property',1) WITH
    (
    	PropertyName nvarchar(50) '@name',
    	PropertyValue ntext '@value'
    ) as PV

    -- remove document
    exec sp_xml_removedocument @idoc

    COMMIT TRAN

    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[UpdateUserThemeSetting]
    (
    	@ActorID int,
    	@UserID int,
    	@PropertyName NVARCHAR(255),
    	@PropertyValue NVARCHAR(255)
    )
    AS

    -- check rights
    IF dbo.CheckActorUserRights(@ActorID, @UserID) = 0
    RAISERROR('You are not allowed to access this account', 16, 1)

    BEGIN
    -- Update if present
    IF EXISTS ( SELECT * FROM UserSettings 
    						WHERE UserID = @UserID
    						AND SettingsName = N'Theme'
    						AND PropertyName = @PropertyName)
    		BEGIN
    			UPDATE UserSettings SET	PropertyValue = @PropertyValue
    				WHERE UserID = @UserID
    				AND SettingsName = N'Theme'
    				AND PropertyName = @PropertyName
    			Return
    		END
    	ELSE
    		BEGIN
    			INSERT UserSettings (UserID, SettingsName, PropertyName, PropertyValue) VALUES (@UserID, N'Theme', @PropertyName, @PropertyValue)
    		END
    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN

    CREATE PROCEDURE [dbo].[UpdateVirtualGroups]
    (
    	@ServerID int,
    	@Xml ntext
    )
    AS

    /*
    XML Format:

    <groups>
    	<group id="16" distributionType="1" bindDistributionToPrimary="1"/>
    </groups>

    */

    BEGIN TRAN
    DECLARE @idoc int
    --Create an internal representation of the XML document.
    EXEC sp_xml_preparedocument @idoc OUTPUT, @xml

    -- delete old virtual groups
    DELETE FROM VirtualGroups
    WHERE ServerID = @ServerID

    -- update HP resources
    INSERT INTO VirtualGroups
    (
    	ServerID,
    	GroupID,
    	DistributionType,
    	BindDistributionToPrimary
    )
    SELECT
    	@ServerID,
    	GroupID,
    	DistributionType,
    	BindDistributionToPrimary
    FROM OPENXML(@idoc, '/groups/group',1) WITH
    (
    	GroupID int '@id',
    	DistributionType int '@distributionType',
    	BindDistributionToPrimary bit '@bindDistributionToPrimary'
    ) as XRG

    -- remove document
    exec sp_xml_removedocument @idoc

    COMMIT TRAN
    RETURN

END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[UpdateWebDavPortalUsersSettings]
    (
    	@AccountId INT,
    	@Settings NVARCHAR(max)
    )
    AS

    UPDATE WebDavPortalUsersSettings
    SET
    	Settings = @Settings
    WHERE AccountId = @AccountId
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET ANSI_NULLS ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    SET QUOTED_IDENTIFIER ON
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    CREATE PROCEDURE [dbo].[UpdateWhoisDomainInfo]
    (
    	@DomainId INT,
    	@DomainCreationDate DateTime,
    	@DomainExpirationDate DateTime,
    	@DomainLastUpdateDate DateTime,
    	@DomainRegistrarName nvarchar(max)
    )
    AS
    UPDATE [dbo].[Domains] SET [CreationDate] = @DomainCreationDate, [ExpirationDate] = @DomainExpirationDate, [LastUpdateDate] = @DomainLastUpdateDate, [RegistrarName] = @DomainRegistrarName WHERE [DomainID] = @DomainId
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    			
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240627111421_InitialCreate'
)
BEGIN
    INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
    VALUES (N'20240627111421_InitialCreate', N'8.0.6');
END;
GO

COMMIT;
GO

BEGIN TRANSACTION;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    ALTER TABLE [BackgroundTaskLogs] DROP CONSTRAINT [FK__Backgroun__TaskI__06ADD4BD];
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    ALTER TABLE [BackgroundTaskParameters] DROP CONSTRAINT [FK__Backgroun__TaskI__03D16812];
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    ALTER TABLE [BackgroundTaskStack] DROP CONSTRAINT [FK__Backgroun__TaskI__098A4168];
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    ALTER TABLE [HostingPlans] DROP CONSTRAINT [FK_HostingPlans_Packages];
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    ALTER TABLE [Packages] DROP CONSTRAINT [FK_Packages_HostingPlans];
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    ALTER TABLE [WebDavAccessTokens] DROP CONSTRAINT [PK__WebDavAc__3214EC27B27DC571];
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    ALTER TABLE [DomainDnsRecords] DROP CONSTRAINT [PK__DomainDn__3214EC2758B0A6F1];
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    ALTER TABLE [BackgroundTaskStack] DROP CONSTRAINT [PK__Backgrou__5E44466F62E48BE6];
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    ALTER TABLE [BackgroundTasks] DROP CONSTRAINT [PK__Backgrou__3214EC271AFAB817];
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    ALTER TABLE [BackgroundTaskParameters] DROP CONSTRAINT [PK__Backgrou__F80C6297E2E5AF88];
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    ALTER TABLE [BackgroundTaskLogs] DROP CONSTRAINT [PK__Backgrou__5E5499A830A1D5BF];
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    ALTER TABLE [AdditionalGroups] DROP CONSTRAINT [PK__Addition__3214EC272F1861EB];
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    ALTER TABLE [AccessTokens] DROP CONSTRAINT [PK__AccessTo__3214EC27A32557FE];
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    EXEC(N'DELETE FROM [Versions]
    WHERE [DatabaseVersion] = ''2.0.0.228'';
    SELECT @@ROWCOUNT');
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    ALTER TABLE [TempIds] ADD [Date] datetime2 NOT NULL DEFAULT '0001-01-01T00:00:00.0000000';
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    ALTER TABLE [PackageVLANs] ADD [IsDmz] bit NOT NULL DEFAULT CAST(0 AS bit);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    ALTER TABLE [WebDavAccessTokens] ADD CONSTRAINT [PK__WebDavAc__3214EC2708781F08] PRIMARY KEY ([ID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    ALTER TABLE [DomainDnsRecords] ADD CONSTRAINT [PK__DomainDn__3214EC27A6FC0498] PRIMARY KEY ([ID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    ALTER TABLE [BackgroundTaskStack] ADD CONSTRAINT [PK__Backgrou__5E44466FB8A5F217] PRIMARY KEY ([TaskStackID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    ALTER TABLE [BackgroundTasks] ADD CONSTRAINT [PK__Backgrou__3214EC273A1145AC] PRIMARY KEY ([ID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    ALTER TABLE [BackgroundTaskParameters] ADD CONSTRAINT [PK__Backgrou__F80C629777BF580B] PRIMARY KEY ([ParameterID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    ALTER TABLE [BackgroundTaskLogs] ADD CONSTRAINT [PK__Backgrou__5E5499A86067A6E5] PRIMARY KEY ([LogID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    ALTER TABLE [AdditionalGroups] ADD CONSTRAINT [PK__Addition__3214EC27E665DDE2] PRIMARY KEY ([ID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    ALTER TABLE [AccessTokens] ADD CONSTRAINT [PK__AccessTo__3214EC27DEAEF66E] PRIMARY KEY ([ID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    CREATE TABLE [DmzIPAddresses] (
        [DmzAddressID] int NOT NULL IDENTITY,
        [ItemID] int NOT NULL,
        [IPAddress] varchar(15) NOT NULL,
        [IsPrimary] bit NOT NULL,
        CONSTRAINT [PK_DmzIPAddresses] PRIMARY KEY ([DmzAddressID]),
        CONSTRAINT [FK_DmzIPAddresses_ServiceItems] FOREIGN KEY ([ItemID]) REFERENCES [ServiceItems] ([ItemID]) ON DELETE CASCADE
    );
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    EXEC(N'UPDATE [Quotas] SET [ItemTypeID] = 71
    WHERE [QuotaID] = 701;
    SELECT @@ROWCOUNT');
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    EXEC(N'UPDATE [Quotas] SET [ItemTypeID] = 72
    WHERE [QuotaID] = 702;
    SELECT @@ROWCOUNT');
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'QuotaID', N'GroupID', N'HideQuota', N'ItemTypeID', N'PerOrganization', N'QuotaDescription', N'QuotaName', N'QuotaOrder', N'QuotaTypeID', N'ServiceQuota') AND [object_id] = OBJECT_ID(N'[Quotas]'))
        SET IDENTITY_INSERT [Quotas] ON;
    EXEC(N'INSERT INTO [Quotas] ([QuotaID], [GroupID], [HideQuota], [ItemTypeID], [PerOrganization], [QuotaDescription], [QuotaName], [QuotaOrder], [QuotaTypeID], [ServiceQuota])
    VALUES (750, 33, NULL, NULL, NULL, N''DMZ Network'', N''VPS2012.DMZNetworkEnabled'', 22, 1, CAST(0 AS bit)),
    (751, 33, NULL, NULL, NULL, N''Number of DMZ IP addresses per VPS'', N''VPS2012.DMZIPAddressesNumber'', 23, 3, CAST(0 AS bit)),
    (752, 33, NULL, NULL, NULL, N''Number of DMZ Network VLANs'', N''VPS2012.DMZVLANsNumber'', 24, 2, CAST(0 AS bit))');
    IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'QuotaID', N'GroupID', N'HideQuota', N'ItemTypeID', N'PerOrganization', N'QuotaDescription', N'QuotaName', N'QuotaOrder', N'QuotaTypeID', N'ServiceQuota') AND [object_id] = OBJECT_ID(N'[Quotas]'))
        SET IDENTITY_INSERT [Quotas] OFF;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    EXEC(N'UPDATE [UserSettings] SET [PropertyValue] = CONCAT(CAST(N''<html xmlns="http://www.w3.org/1999/xhtml">'' AS nvarchar(max)), nchar(13), nchar(10), N''<head>'', nchar(13), nchar(10), N''    <title>Account Summary Information</title>'', nchar(13), nchar(10), N''    <style type="text/css">'', nchar(13), nchar(10), N''		.Summary { background-color: ##ffffff; padding: 5px; }'', nchar(13), nchar(10), N''		.Summary .Header { padding: 10px 0px 10px 10px; font-size: 16pt; background-color: ##E5F2FF; color: ##1F4978; border-bottom: solid 2px ##86B9F7; }'', nchar(13), nchar(10), N''        .Summary A { color: ##0153A4; }'', nchar(13), nchar(10), N''        .Summary { font-family: Tahoma; font-size: 9pt; }'', nchar(13), nchar(10), N''        .Summary H1 { font-size: 1.7em; color: ##1F4978; border-bottom: dotted 3px ##efefef; }'', nchar(13), nchar(10), N''        .Summary H2 { font-size: 1.3em; color: ##1F4978; }'', nchar(13), nchar(10), N''        .Summary TABLE { border: solid 1px ##e5e5e5; }'', nchar(13), nchar(10), N''        .Summary TH,'', nchar(13), nchar(10), N''        .Summary TD.Label { padding: 5px; font-size: 8pt; font-weight: bold; background-color: ##f5f5f5; }'', nchar(13), nchar(10), N''        .Summary TD { padding: 8px; font-size: 9pt; }'', nchar(13), nchar(10), N''        .Summary UL LI { font-size: 1.1em; font-weight: bold; }'', nchar(13), nchar(10), N''        .Summary UL UL LI { font-size: 0.9em; font-weight: normal; }'', nchar(13), nchar(10), N''    </style>'', nchar(13), nchar(10), N''</head>'', nchar(13), nchar(10), N''<body>'', nchar(13), nchar(10), N''<div class="Summary">'', nchar(13), nchar(10), nchar(13), nchar(10), N''<a name="top"></a>'', nchar(13), nchar(10), N''<div class="Header">'', nchar(13), nchar(10), N''	Hosting Account Information'', nchar(13), nchar(10), N''</div>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:if test="#Signup#">'', nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''Hello #user.FirstName#,'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''New user account has been created and below you can find its summary information.'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<h1>Control Panel URL</h1>'', nchar(13), nchar(10), N''<table>'', nchar(13), nchar(10), N''    <thead>'', nchar(13), nchar(10), N''        <tr>'', nchar(13), nchar(10), N''            <th>Control Panel URL</th>'', nchar(13), nchar(10), N''            <th>Username</th>'', nchar(13), nchar(10), N''            <th>Password</th>'', nchar(13), nchar(10), N''        </tr>'', nchar(13), nchar(10), N''    </thead>'', nchar(13), nchar(10), N''    <tbody>'', nchar(13), nchar(10), N''        <tr>'', nchar(13), nchar(10), N''            <td><a href="http://panel.HostingCompany.com">http://panel.HostingCompany.com</a></td>'', nchar(13), nchar(10), N''            <td>#user.Username#</td>'', nchar(13), nchar(10), N''            <td>#user.Password#</td>'', nchar(13), nchar(10), N''        </tr>'', nchar(13), nchar(10), N''    </tbody>'', nchar(13), nchar(10), N''</table>'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<h1>Hosting Spaces</h1>'', nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''    The following hosting spaces have been created under your account:'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), N''<ad:foreach collection="#Spaces#" var="Space" index="i">'', nchar(13), nchar(10), N''<h2>#Space.PackageName#</h2>'', nchar(13), nchar(10), N''<table>'', nchar(13), nchar(10), N''	<tbody>'', nchar(13), nchar(10), N''		<tr>'', nchar(13), nchar(10), N''			<td class="Label">Hosting Plan:</td>'', nchar(13), nchar(10), N''			<td>'', nchar(13), nchar(10), N''				<ad:if test="#not(isnull(Plans[Space.PlanId]))#">#Plans[Space.PlanId].PlanName#<ad:else>System</ad:if>'', nchar(13), nchar(10), N''			</td>'', nchar(13), nchar(10), N''		</tr>'', nchar(13), nchar(10), N''		<ad:if test="#not(isnull(Plans[Space.PlanId]))#">'', nchar(13), nchar(10), N''		<tr>'', nchar(13), nchar(10), N''			<td class="Label">Purchase Date:</td>'', nchar(13), nchar(10), N''			<td>'', nchar(13), nchar(10), N''# Space.PurchaseDate#'', nchar(13), nchar(10), N''			</td>'', nchar(13), nchar(10), N''		</tr>'', nchar(13), nchar(10), N''		<tr>'', nchar(13), nchar(10), N''			<td class="Label">Disk Space, MB:</td>'', nchar(13), nchar(10), N''			<td><ad:NumericQuota space="#SpaceContexts[Space.PackageId]#" quota="OS.Diskspace" /></td>'', nchar(13), nchar(10), N''		</tr>'', nchar(13), nchar(10), N''		<tr>'', nchar(13), nchar(10), N''			<td class="Label">Bandwidth, MB/Month:</td>'', nchar(13), nchar(10), N''			<td><ad:NumericQuota space="#SpaceContexts[Space.PackageId]#" quota="OS.Bandwidth" /></td>'', nchar(13), nchar(10), N''		</tr>'', nchar(13), nchar(10), N''		<tr>'', nchar(13), nchar(10), N''			<td class="Label">Maximum Number of Domains:</td>'', nchar(13), nchar(10), N''			<td><ad:NumericQuota space="#SpaceContexts[Space.PackageId]#" quota="OS.Domains" /></td>'', nchar(13), nchar(10), CONCAT(CAST(N''		</tr>'' AS nvarchar(max)), nchar(13), nchar(10), N''		<tr>'', nchar(13), nchar(10), N''			<td class="Label">Maximum Number of Sub-Domains:</td>'', nchar(13), nchar(10), N''			<td><ad:NumericQuota space="#SpaceContexts[Space.PackageId]#" quota="OS.SubDomains" /></td>'', nchar(13), nchar(10), N''		</tr>'', nchar(13), nchar(10), N''		</ad:if>'', nchar(13), nchar(10), N''	</tbody>'', nchar(13), nchar(10), N''</table>'', nchar(13), nchar(10), N''</ad:foreach>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:if test="#Signup#">'', nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''If you have any questions regarding your hosting account, feel free to contact our support department at any time.'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''Best regards,<br />'', nchar(13), nchar(10), N''SolidCP.<br />'', nchar(13), nchar(10), N''Web Site: <a href="https://solidcp.com">https://solidcp.com</a><br />'', nchar(13), nchar(10), N''E-Mail: <a href="mailto:support@solidcp.com">support@solidcp.com</a>'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:template name="NumericQuota">'', nchar(13), nchar(10), N''	<ad:if test="#space.Quotas.ContainsKey(quota)#">'', nchar(13), nchar(10), N''		<ad:if test="#space.Quotas[quota].QuotaAllocatedValue isnot -1#">#space.Quotas[quota].QuotaAllocatedValue#<ad:else>Unlimited</ad:if>'', nchar(13), nchar(10), N''	<ad:else>'', nchar(13), nchar(10), N''		0'', nchar(13), nchar(10), N''	</ad:if>'', nchar(13), nchar(10), N''</ad:template>'', nchar(13), nchar(10), nchar(13), nchar(10), N''</div>'', nchar(13), nchar(10), N''</body>'', nchar(13), nchar(10), N''</html>''))
    WHERE [PropertyName] = N''HtmlBody'' AND [SettingsName] = N''AccountSummaryLetter'' AND [UserID] = 1;
    SELECT @@ROWCOUNT');
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    EXEC(N'UPDATE [UserSettings] SET [PropertyValue] = CONCAT(CAST(N''================================='' AS nvarchar(max)), nchar(13), nchar(10), N''   MX and NS Changes Information'', nchar(13), nchar(10), N''================================='', nchar(13), nchar(10), N''<ad:if test="#user#">'', nchar(13), nchar(10), N''Hello #user.FirstName#,'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), N''Please, find below details of MX and NS changes.'', nchar(13), nchar(10), nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:foreach collection="#Domains#" var="Domain" index="i">'', nchar(13), nchar(10), nchar(13), nchar(10), N''# Domain.DomainName# - #DomainUsers[Domain.PackageId].FirstName# #DomainUsers[Domain.PackageId].LastName#'', nchar(13), nchar(10), N'' Registrar:      #iif(isnull(Domain.Registrar), "", Domain.Registrar)#'', nchar(13), nchar(10), N'' ExpirationDate: #iif(isnull(Domain.ExpirationDate), "", Domain.ExpirationDate)#'', nchar(13), nchar(10), nchar(13), nchar(10), N''        <ad:foreach collection="#Domain.DnsChanges#" var="DnsChange" index="j">'', nchar(13), nchar(10), N''            DNS:       #DnsChange.DnsServer#'', nchar(13), nchar(10), N''            Type:      #DnsChange.Type#'', nchar(13), nchar(10), N''	    Status:    #DnsChange.Status#'', nchar(13), nchar(10), N''            Old Value: #DnsChange.OldRecord.Value#'', nchar(13), nchar(10), N''            New Value: #DnsChange.NewRecord.Value#'', nchar(13), nchar(10), nchar(13), nchar(10), N''    	</ad:foreach>'', nchar(13), nchar(10), N''</ad:foreach>'', nchar(13), nchar(10), nchar(13), nchar(10), nchar(13), nchar(10), nchar(13), nchar(10), N''If you have any questions regarding your hosting account, feel free to contact our support department at any time.'', nchar(13), nchar(10), nchar(13), nchar(10), N''Best regards'', nchar(13), nchar(10))
    WHERE [PropertyName] = N''TextBody'' AND [SettingsName] = N''DomainLookupLetter'' AND [UserID] = 1;
    SELECT @@ROWCOUNT');
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    EXEC(N'UPDATE [UserSettings] SET [PropertyValue] = CONCAT(CAST(nchar(13) AS nvarchar(max)), nchar(10), N''User have been created. Password request url:'', nchar(13), nchar(10), N''# passwordResetLink#'')
    WHERE [PropertyName] = N''SMSBody'' AND [SettingsName] = N''OrganizationUserPasswordRequestLetter'' AND [UserID] = 1;
    SELECT @@ROWCOUNT');
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    EXEC(N'UPDATE [UserSettings] SET [PropertyValue] = CONCAT(CAST(N''========================================='' AS nvarchar(max)), nchar(13), nchar(10), N''   Password request notification'', nchar(13), nchar(10), N''========================================='', nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:if test="#user#">'', nchar(13), nchar(10), N''Hello #user.FirstName#,'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), N''Your account have been created. In order to create a password for your account, please follow next link:'', nchar(13), nchar(10), nchar(13), nchar(10), N''# passwordResetLink#'', nchar(13), nchar(10), nchar(13), nchar(10), N''If you have any questions regarding your hosting account, feel free to contact our support department at any time.'', nchar(13), nchar(10), nchar(13), nchar(10), N''Best regards'')
    WHERE [PropertyName] = N''TextBody'' AND [SettingsName] = N''OrganizationUserPasswordRequestLetter'' AND [UserID] = 1;
    SELECT @@ROWCOUNT');
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    EXEC(N'UPDATE [UserSettings] SET [PropertyValue] = CONCAT(CAST(N''========================================='' AS nvarchar(max)), nchar(13), nchar(10), N''   Password expiration notification'', nchar(13), nchar(10), N''========================================='', nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:if test="#user#">'', nchar(13), nchar(10), N''Hello #user.FirstName#,'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), N''Your password expiration date is #user.PasswordExpirationDateTime#. You can reset your own password by visiting the following page:'', nchar(13), nchar(10), nchar(13), nchar(10), N''# passwordResetLink#'', nchar(13), nchar(10), nchar(13), nchar(10), N''If you have any questions regarding your hosting account, feel free to contact our support department at any time.'', nchar(13), nchar(10), nchar(13), nchar(10), N''Best regards'')
    WHERE [PropertyName] = N''TextBody'' AND [SettingsName] = N''UserPasswordExpirationLetter'' AND [UserID] = 1;
    SELECT @@ROWCOUNT');
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    EXEC(N'UPDATE [UserSettings] SET [PropertyValue] = CONCAT(CAST(N''Password reset link:'' AS nvarchar(max)), nchar(13), nchar(10), N''# passwordResetLink#'', nchar(13), nchar(10))
    WHERE [PropertyName] = N''PasswordResetLinkSmsBody'' AND [SettingsName] = N''UserPasswordResetLetter'' AND [UserID] = 1;
    SELECT @@ROWCOUNT');
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    EXEC(N'UPDATE [UserSettings] SET [PropertyValue] = CONCAT(CAST(N''========================================='' AS nvarchar(max)), nchar(13), nchar(10), N''   Password reset notification'', nchar(13), nchar(10), N''========================================='', nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:if test="#user#">'', nchar(13), nchar(10), N''Hello #user.FirstName#,'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), N''We received a request to reset the password for your account. If you made this request, click the link below. If you did not make this request, you can ignore this email.'', nchar(13), nchar(10), nchar(13), nchar(10), N''# passwordResetLink#'', nchar(13), nchar(10), nchar(13), nchar(10), N''If you have any questions regarding your hosting account, feel free to contact our support department at any time.'', nchar(13), nchar(10), nchar(13), nchar(10), N''Best regards'')
    WHERE [PropertyName] = N''TextBody'' AND [SettingsName] = N''UserPasswordResetLetter'' AND [UserID] = 1;
    SELECT @@ROWCOUNT');
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    EXEC(N'UPDATE [UserSettings] SET [PropertyValue] = CONCAT(CAST(N''<html xmlns="http://www.w3.org/1999/xhtml">'' AS nvarchar(max)), nchar(13), nchar(10), N''<head>'', nchar(13), nchar(10), N''    <title>Password reset notification</title>'', nchar(13), nchar(10), N''    <style type="text/css">'', nchar(13), nchar(10), N''		.Summary { background-color: ##ffffff; padding: 5px; }'', nchar(13), nchar(10), N''		.Summary .Header { padding: 10px 0px 10px 10px; font-size: 16pt; background-color: ##E5F2FF; color: ##1F4978; border-bottom: solid 2px ##86B9F7; }'', nchar(13), nchar(10), N''        .Summary A { color: ##0153A4; }'', nchar(13), nchar(10), N''        .Summary { font-family: Tahoma; font-size: 9pt; }'', nchar(13), nchar(10), N''        .Summary H1 { font-size: 1.7em; color: ##1F4978; border-bottom: dotted 3px ##efefef; }'', nchar(13), nchar(10), N''        .Summary H2 { font-size: 1.3em; color: ##1F4978; } '', nchar(13), nchar(10), N''        .Summary TABLE { border: solid 1px ##e5e5e5; }'', nchar(13), nchar(10), N''        .Summary TH,'', nchar(13), nchar(10), N''        .Summary TD.Label { padding: 5px; font-size: 8pt; font-weight: bold; background-color: ##f5f5f5; }'', nchar(13), nchar(10), N''        .Summary TD { padding: 8px; font-size: 9pt; }'', nchar(13), nchar(10), N''        .Summary UL LI { font-size: 1.1em; font-weight: bold; }'', nchar(13), nchar(10), N''        .Summary UL UL LI { font-size: 0.9em; font-weight: normal; }'', nchar(13), nchar(10), N''    </style>'', nchar(13), nchar(10), N''</head>'', nchar(13), nchar(10), N''<body>'', nchar(13), nchar(10), N''<div class="Summary">'', nchar(13), nchar(10), N''<div class="Header">'', nchar(13), nchar(10), N''<img src="#logoUrl#">'', nchar(13), nchar(10), N''</div>'', nchar(13), nchar(10), N''<h1>Password reset notification</h1>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:if test="#user#">'', nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''Hello #user.FirstName#,'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''We received a request to reset the password for your account. Your password reset pincode:'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), nchar(13), nchar(10), N''# passwordResetPincode#'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''If you have any questions regarding your hosting account, feel free to contact our support department at any time.'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), nchar(13), nchar(10), N''<p>'', nchar(13), nchar(10), N''Best regards'', nchar(13), nchar(10), N''</p>'', nchar(13), nchar(10), N''</div>'', nchar(13), nchar(10), N''</body>'')
    WHERE [PropertyName] = N''HtmlBody'' AND [SettingsName] = N''UserPasswordResetPincodeLetter'' AND [UserID] = 1;
    SELECT @@ROWCOUNT');
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    EXEC(N'UPDATE [UserSettings] SET [PropertyValue] = CONCAT(CAST(nchar(13) AS nvarchar(max)), nchar(10), N''Your password reset pincode:'', nchar(13), nchar(10), N''# passwordResetPincode#'')
    WHERE [PropertyName] = N''PasswordResetPincodeSmsBody'' AND [SettingsName] = N''UserPasswordResetPincodeLetter'' AND [UserID] = 1;
    SELECT @@ROWCOUNT');
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    EXEC(N'UPDATE [UserSettings] SET [PropertyValue] = CONCAT(CAST(N''========================================='' AS nvarchar(max)), nchar(13), nchar(10), N''   Password reset notification'', nchar(13), nchar(10), N''========================================='', nchar(13), nchar(10), nchar(13), nchar(10), N''<ad:if test="#user#">'', nchar(13), nchar(10), N''Hello #user.FirstName#,'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), N''We received a request to reset the password for your account. Your password reset pincode:'', nchar(13), nchar(10), nchar(13), nchar(10), N''# passwordResetPincode#'', nchar(13), nchar(10), nchar(13), nchar(10), N''If you have any questions regarding your hosting account, feel free to contact our support department at any time.'', nchar(13), nchar(10), nchar(13), nchar(10), N''Best regards'')
    WHERE [PropertyName] = N''TextBody'' AND [SettingsName] = N''UserPasswordResetPincodeLetter'' AND [UserID] = 1;
    SELECT @@ROWCOUNT');
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    EXEC(N'UPDATE [UserSettings] SET [PropertyValue] = CONCAT(CAST(N''================================='' AS nvarchar(max)), nchar(13), nchar(10), N''   Verification code'', nchar(13), nchar(10), N''================================='', nchar(13), nchar(10), N''<ad:if test="#user#">'', nchar(13), nchar(10), N''Hello #user.FirstName#,'', nchar(13), nchar(10), N''</ad:if>'', nchar(13), nchar(10), nchar(13), nchar(10), N''to complete the sign in, enter the verification code on the device.'', nchar(13), nchar(10), nchar(13), nchar(10), N''Verification code'', nchar(13), nchar(10), N''# verificationCode#'', nchar(13), nchar(10), nchar(13), nchar(10), N''Best regards,'', nchar(13), nchar(10))
    WHERE [PropertyName] = N''TextBody'' AND [SettingsName] = N''VerificationCodeLetter'' AND [UserID] = 1;
    SELECT @@ROWCOUNT');
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    EXEC(N'UPDATE [Users] SET [Changed] = ''2010-07-16T10:53:02.453''
    WHERE [UserID] = 1;
    SELECT @@ROWCOUNT');
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    CREATE INDEX [DmzIPAddressesIdx_ItemID] ON [DmzIPAddresses] ([ItemID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    ALTER TABLE [BackgroundTaskLogs] ADD CONSTRAINT [FK__Backgroun__TaskI__7D8391DF] FOREIGN KEY ([TaskID]) REFERENCES [BackgroundTasks] ([ID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    ALTER TABLE [BackgroundTaskParameters] ADD CONSTRAINT [FK__Backgroun__TaskI__7AA72534] FOREIGN KEY ([TaskID]) REFERENCES [BackgroundTasks] ([ID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    ALTER TABLE [BackgroundTaskStack] ADD CONSTRAINT [FK__Backgroun__TaskI__005FFE8A] FOREIGN KEY ([TaskID]) REFERENCES [BackgroundTasks] ([ID]);
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    ALTER TABLE [Packages] ADD CONSTRAINT [FK_Packages_HostingPlans] FOREIGN KEY ([PlanID]) REFERENCES [HostingPlans] ([PlanID]) ON DELETE CASCADE;
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetPackageDmzIPAddresses]
    	@PackageID int
    AS
    BEGIN

    	SELECT
    		DA.DmzAddressID,
    		DA.IPAddress,
    		DA.ItemID,
    		SI.ItemName,
    		DA.IsPrimary
    	FROM DmzIPAddresses AS DA
    	INNER JOIN ServiceItems AS SI ON DA.ItemID = SI.ItemID
    	WHERE SI.PackageID = @PackageID

    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetPackageDmzIPAddressesPaged]
    	@PackageID int,
    	@FilterColumn nvarchar(50) = '',
    	@FilterValue nvarchar(50) = '',
    	@SortColumn nvarchar(50),
    	@StartRow int,
    	@MaximumRows int
    AS
    BEGIN


    -- start
    DECLARE @condition nvarchar(700)
    SET @condition = '
    SI.PackageID = @PackageID
    '

    IF @FilterValue <> '' AND @FilterValue IS NOT NULL
    BEGIN
    	IF @FilterColumn <> '' AND @FilterColumn IS NOT NULL
    		SET @condition = @condition + ' AND ' + @FilterColumn + ' LIKE ''' + @FilterValue + ''''
    	ELSE
    		SET @condition = @condition + '
    			AND (IPAddress LIKE ''' + @FilterValue + '''
    			OR ItemName LIKE ''' + @FilterValue + ''')'
    END

    IF @SortColumn IS NULL OR @SortColumn = ''
    SET @SortColumn = 'DA.IPAddress ASC'

    DECLARE @sql nvarchar(3500)

    set @sql = '
    SELECT COUNT(DA.DmzAddressID)
    FROM dbo.DmzIPAddresses AS DA
    INNER JOIN dbo.ServiceItems AS SI ON DA.ItemID = SI.ItemID
    WHERE ' + @condition + '

    DECLARE @Addresses AS TABLE
    (
    	DmzAddressID int
    );

    WITH TempItems AS (
    	SELECT ROW_NUMBER() OVER (ORDER BY ' + @SortColumn + ') as Row,
    		DA.DmzAddressID
    	FROM dbo.DmzIPAddresses AS DA
    	INNER JOIN dbo.ServiceItems AS SI ON DA.ItemID = SI.ItemID
    	WHERE ' + @condition + '
    )

    INSERT INTO @Addresses
    SELECT DmzAddressID FROM TempItems
    WHERE TempItems.Row BETWEEN @StartRow + 1 and @StartRow + @MaximumRows

    SELECT
    	DA.DmzAddressID,
    	DA.IPAddress,
    	DA.ItemID,
    	SI.ItemName,
    	DA.IsPrimary
    FROM @Addresses AS TA
    INNER JOIN dbo.DmzIPAddresses AS DA ON TA.DmzAddressID = DA.DmzAddressID
    INNER JOIN dbo.ServiceItems AS SI ON DA.ItemID = SI.ItemID
    '

    print @sql

    exec sp_executesql @sql, N'@PackageID int, @StartRow int, @MaximumRows int',
    @PackageID, @StartRow, @MaximumRows

    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN

    CREATE PROCEDURE [dbo].[AddItemDmzIPAddress]
    (
    	@ActorID int,
    	@ItemID int,
    	@IPAddress varchar(15)
    )
    AS
    BEGIN

    	IF EXISTS (SELECT ItemID FROM ServiceItems AS SI WHERE ItemID = @ItemID AND dbo.CheckActorPackageRights(@ActorID, SI.PackageID) = 1)
    	BEGIN

    		INSERT INTO DmzIPAddresses
    		(
    			ItemID,
    			IPAddress,
    			IsPrimary
    		)
    		VALUES
    		(
    			@ItemID,
    			@IPAddress,
    			0 -- not primary
    		)

    	END
    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN

    CREATE PROCEDURE [dbo].[SetItemDmzPrimaryIPAddress]
    (
    	@ActorID int,
    	@ItemID int,
    	@DmzAddressID int
    )
    AS
    BEGIN
    	UPDATE DmzIPAddresses
    	SET IsPrimary = CASE DIP.DmzAddressID WHEN @DmzAddressID THEN 1 ELSE 0 END
    	FROM DmzIPAddresses AS DIP
    	INNER JOIN ServiceItems AS SI ON DIP.ItemID = SI.ItemID
    	WHERE DIP.ItemID = @ItemID
    	AND dbo.CheckActorPackageRights(@ActorID, SI.PackageID) = 1
    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN

    CREATE PROCEDURE DeleteItemDmzIPAddress
    (
    	@ActorID int,
    	@ItemID int,
    	@DmzAddressID int
    )
    AS
    BEGIN
    	DELETE FROM DmzIPAddresses
    	FROM DmzIPAddresses AS DIP
    	INNER JOIN ServiceItems AS SI ON DIP.ItemID = SI.ItemID
    	WHERE DIP.DmzAddressID = @DmzAddressID
    	AND dbo.CheckActorPackageRights(@ActorID, SI.PackageID) = 1
    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetItemDmzIPAddresses]
    (
    	@ActorID int,
    	@ItemID int
    )
    AS
    BEGIN
    SELECT
    	DIP.DmzAddressID AS AddressID,
    	DIP.IPAddress,
    	DIP.IsPrimary
    FROM DmzIPAddresses AS DIP
    INNER JOIN ServiceItems AS SI ON DIP.ItemID = SI.ItemID
    WHERE DIP.ItemID = @ItemID
    AND dbo.CheckActorPackageRights(@ActorID, SI.PackageID) = 1
    ORDER BY DIP.IsPrimary DESC
    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN

    CREATE PROCEDURE DeleteItemDmzIPAddresses
    (
    	@ActorID int,
    	@ItemID int
    )
    AS
    BEGIN
    	DELETE FROM DmzIPAddresses
    	FROM DmzIPAddresses AS DIP
    	INNER JOIN ServiceItems AS SI ON DIP.ItemID = SI.ItemID
    	WHERE DIP.ItemID = @ItemID
    	AND dbo.CheckActorPackageRights(@ActorID, SI.PackageID) = 1
    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN

    CREATE PROCEDURE [dbo].[GetPackageDmzNetworkVLANs]
    (
     @PackageID int,
     @SortColumn nvarchar(50),
     @StartRow int,
     @MaximumRows int
    )
    AS
    BEGIN
    -- start
    DECLARE @condition nvarchar(700)
    SET @condition = '
    dbo.CheckPackageParent(@PackageID, PA.PackageID) = 1
    AND PA.IsDmz = 1
    '

    IF @SortColumn IS NULL OR @SortColumn = ''
    SET @SortColumn = 'V.Vlan ASC'

    DECLARE @sql nvarchar(3500)

    set @sql = '
    SELECT COUNT(PA.PackageVlanID)
    FROM dbo.PackageVLANs PA
    INNER JOIN dbo.PrivateNetworkVLANs AS V ON PA.VlanID = V.VlanID
    INNER JOIN dbo.Packages P ON PA.PackageID = P.PackageID
    INNER JOIN dbo.Users U ON U.UserID = P.UserID
    WHERE ' + @condition + '

    DECLARE @VLANs AS TABLE
    (
     PackageVlanID int
    );

    WITH TempItems AS (
     SELECT ROW_NUMBER() OVER (ORDER BY ' + @SortColumn + ') as Row,
      PA.PackageVlanID
     FROM dbo.PackageVLANs PA
     INNER JOIN dbo.PrivateNetworkVLANs AS V ON PA.VlanID = V.VlanID
     INNER JOIN dbo.Packages P ON PA.PackageID = P.PackageID
     INNER JOIN dbo.Users U ON U.UserID = P.UserID
     WHERE ' + @condition + '
    )

    INSERT INTO @VLANs
    SELECT PackageVlanID FROM TempItems
    WHERE TempItems.Row BETWEEN @StartRow + 1 and @StartRow + @MaximumRows

    SELECT
     PA.PackageVlanID,
     PA.VlanID,
     V.Vlan,
     PA.PackageID,
     P.PackageName,
     P.UserID,
     U.UserName
    FROM @VLANs AS TA
    INNER JOIN dbo.PackageVLANs AS PA ON TA.PackageVlanID = PA.PackageVlanID
    INNER JOIN dbo.PrivateNetworkVLANs AS V ON PA.VlanID = V.VlanID
    INNER JOIN dbo.Packages P ON PA.PackageID = P.PackageID
    INNER JOIN dbo.Users U ON U.UserID = P.UserID
    '

    print @sql

    exec sp_executesql @sql, N'@PackageID int, @StartRow int, @MaximumRows int',
    @PackageID, @StartRow, @MaximumRows

    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN

    DROP PROCEDURE IF EXISTS [dbo].[GetPackageServiceID]
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    CREATE PROCEDURE [dbo].[GetPackageServiceID]
    (
    	@ActorID int,
    	@PackageID int,
    	@GroupName nvarchar(100),
    	@UpdatePackage bit,
    	@ServiceID int OUTPUT
    )
    AS
    BEGIN

    -- check rights
    IF dbo.CheckActorPackageRights(@ActorID, @PackageID) = 0
    RAISERROR('You are not allowed to access this package', 16, 1)

    SET @ServiceID = 0

    -- optimized run when we don't need any changes
    IF @UpdatePackage = 0
    BEGIN
    SELECT
    	@ServiceID = PS.ServiceID
    FROM PackageServices AS PS
    INNER JOIN Services AS S ON PS.ServiceID = S.ServiceID
    INNER JOIN Providers AS P ON S.ProviderID = P.ProviderID
    INNER JOIN ResourceGroups AS RG ON RG.GroupID = P.GroupID
    WHERE PS.PackageID = @PackageID AND RG.GroupName = @GroupName
    RETURN
    END

    -- load group info
    DECLARE @GroupID int
    SELECT @GroupID = GroupID FROM ResourceGroups
    WHERE GroupName = @GroupName

    -- check if user has this resource enabled
    IF dbo.GetPackageAllocatedResource(@PackageID, @GroupID, NULL) = 0
    BEGIN
    	-- remove all resource services from the space
    	DELETE FROM PackageServices FROM PackageServices AS PS
    	INNER JOIN Services AS S ON PS.ServiceID = S.ServiceID
    	INNER JOIN Providers AS P ON S.ProviderID = P.ProviderID
    	WHERE P.GroupID = @GroupID AND PS.PackageID = @PackageID
    	RETURN
    END

    -- check if the service is already distributed
    SELECT
    	@ServiceID = PS.ServiceID
    FROM PackageServices AS PS
    INNER JOIN Services AS S ON PS.ServiceID = S.ServiceID
    INNER JOIN Providers AS P ON S.ProviderID = P.ProviderID
    WHERE PS.PackageID = @PackageID AND P.GroupID = @GroupID

    IF @ServiceID <> 0
    RETURN

    -- distribute services
    EXEC DistributePackageServices @ActorID, @PackageID

    -- get distributed service again
    SELECT
    	@ServiceID = PS.ServiceID
    FROM PackageServices AS PS
    INNER JOIN Services AS S ON PS.ServiceID = S.ServiceID
    INNER JOIN Providers AS P ON S.ProviderID = P.ProviderID
    WHERE PS.PackageID = @PackageID AND P.GroupID = @GroupID

    END
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
                
END;
GO

IF NOT EXISTS (
    SELECT * FROM [__EFMigrationsHistory]
    WHERE [MigrationId] = N'20240709093225_AddedDMZ'
)
BEGIN
    INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
    VALUES (N'20240709093225_AddedDMZ', N'8.0.6');
END;
GO

COMMIT;
GO

