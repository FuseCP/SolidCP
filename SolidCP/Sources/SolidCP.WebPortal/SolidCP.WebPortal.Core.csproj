<Project Sdk="Microsoft.NET.Sdk">
    <PropertyGroup>
        <RootNamespace>SolidCP.WebPortal</RootNamespace>
        <AssemblyName>SolidCP.WebPortal</AssemblyName>
        <TargetFrameworks>net8.0</TargetFrameworks>
        <GenerateAssemblyInfo>false</GenerateAssemblyInfo>
        <AppendRuntimeIdentifierToOutputPath>false</AppendRuntimeIdentifierToOutputPath>
        <AppendTargetFrameworkToOutputPath>false</AppendTargetFrameworkToOutputPath>
        <RestoreSources>$(RestoreSources);../../Lib/WebFormsForCore/nupkg;https://api.nuget.org/v3/index.json</RestoreSources>
        <CopyDebugSymbolFilesFromPackages>true</CopyDebugSymbolFilesFromPackages>
        <GenerateTargetFrameworkAttribute>false</GenerateTargetFrameworkAttribute>
        <GenerateRuntimeConfigurationFiles>true</GenerateRuntimeConfigurationFiles>
        <BaseIntermediateOutputPath>obj\$(Configuration)\$(TargetFramework)\</BaseIntermediateOutputPath>
    </PropertyGroup>
    <PropertyGroup Condition="$(TargetFramework) == 'net48'">
        <OutputPath>bin\</OutputPath>
        <OutputType>Library</OutputType>
    </PropertyGroup>
    <PropertyGroup Condition="$(TargetFramework) != 'net48'">
        <OutputPath>bin_dotnet\</OutputPath>
        <OutputType>Exe</OutputType>
    </PropertyGroup>
    <ItemGroup>
        <PackageReference Include="AdvancedStringBuilder" Version="0.1.1" />
        <PackageReference Include="Antlr" Version="3.5.0.2" />
        <PackageReference Include="BundleTransformer.Core" Version="1.14.1" />
        <PackageReference Include="BundleTransformer.Less" Version="1.14.0" />
        <PackageReference Include="JavaScriptEngineSwitcher.Core" Version="3.24.1" />
        <PackageReference Include="JavaScriptEngineSwitcher.Msie" Version="3.19.0" />
        <PackageReference Include="MsieJavaScriptEngine" Version="3.0.9" />
        <PackageReference Include="Newtonsoft.Json" Version="13.0.3" />
        <PackageReference Include="AntiXSS" Version="4.3.0" />
    </ItemGroup>
    <ItemGroup Condition="'$(TargetFramework)' == 'net48'">
        <PackageReference Include="Microsoft.AspNet.Web.Optimization" Version="1.1.3" />
        <PackageReference Include="Microsoft.Web.Infrastructure" Version="2.0.0" />
        <PackageReference Include="WebGrease" Version="1.6.0" />
        <PackageReference Include="AjaxControlToolkit" Version="20.1" />
    </ItemGroup>
    <ItemGroup Condition="$(TargetFramework) != 'net48'">
        <PackageReference Include="EstrellasDeEsperanza.WebFormsForCore.Web" Version="1.1.2-beta" />
        <PackageReference Include="EstrellasDeEsperanza.WebFormsForCore.Compilers" Version="1.1.2-beta" />
        <PackageReference Include="EstrellasDeEsperanza.WebFormsForCore.Web.Extensions" Version="1.1.2-beta" />
        <PackageReference Include="EstrellasDeEsperanza.WebFormsForCore.Web.Optimization" Version="1.1.2-beta" />
        <PackageReference Include="EstrellasDeEsperanza.WebFormsForCore.Web.Optimization.WebForms" Version="1.1.2-beta" />
        <PackageReference Include="EstrellasDeEsperanza.WebFormsForCore.Web.Infrastructure" Version="1.1.2-beta" />
        <PackageReference Include="EstrellasDeEsperanza.WebFormsForCore.WebGrease" Version="1.1.2-beta" />
        <PackageReference Include="EstrellasDeEsperanza.WebFormsForCore.AjaxControlToolkit" Version="1.1.2-beta" />
    </ItemGroup>
    <ItemGroup>
        <!--<Reference Include="AjaxControlToolkit, Version=3.5.40412.0, Culture=neutral, PublicKeyToken=28f01b0e84b6d53e, processorArchitecture=MSIL">
            <HintPath>..\..\Lib\AjaxControlToolkit.dll</HintPath>
            <SpecificVersion>False</SpecificVersion>
        </Reference>
        <Reference Include="AntiXssLibrary, Version=1.5.0.0, Culture=neutral, PublicKeyToken=5906d2bb3d8a12c4, processorArchitecture=MSIL">
            <HintPath>..\..\Lib\AntiXssLibrary.dll</HintPath>
            <SpecificVersion>False</SpecificVersion>
        </Reference>-->
        <!--<Reference Include="Microsoft.ReportViewer.Common, Version=8.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a, processorArchitecture=MSIL">
            <HintPath>..\..\Lib\Microsoft.ReportViewer.Common.dll</HintPath>
            <Private>True</Private>
            <SpecificVersion>False</SpecificVersion>
        </Reference>
        <Reference Include="Microsoft.ReportViewer.ProcessingObjectModel, Version=8.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a, processorArchitecture=MSIL">
            <HintPath>..\..\Lib\Microsoft.ReportViewer.ProcessingObjectModel.dll</HintPath>
            <Private>True</Private>
            <SpecificVersion>False</SpecificVersion>
        </Reference>
        <Reference Include="Microsoft.ReportViewer.WebForms, Version=8.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a, processorArchitecture=MSIL">
            <HintPath>..\..\Lib\Microsoft.ReportViewer.WebForms.dll</HintPath>
            <Private>True</Private>
            <SpecificVersion>False</SpecificVersion>
        </Reference>-->
        <!--<Reference Include="System.Web" />
        <Reference Include="System.Web.ApplicationServices" />
        <Reference Include="System.Web.Extensions" />
        <Reference Include="System.Configuration" />-->
    </ItemGroup>
    <ItemGroup>
        <Content Include="tinymce\**\*.*" />
        <Content Include="App_Themes\**\*.*" />
        <Content Include="novnc\**\*.*" />
        <Content Include="JavaScript\**\*.*" />
        <Content Include="Styles\**\*.*" />
        <Content Include="**\*.png" Exclude="DesktopModules\**\*.png" />
        <Content Include="**\*.ico" Exclude="DesktopModules\**\*.ico" />
        <Content Include="**\*.svc" Exclude="DesktopModules\**\*.svc" />
        <Content Include="**\*.ascx" Exclude="DesktopModules\**\*.ascx" />
        <Content Include="**\*.ashx" Exclude="DesktopModules\**\*.ashx" />
        <Content Include="App_GlobalResources\*.resx">
            <SubType>Designer</SubType>
        </Content>
        <Content Include="browserconfig.xml" />
        <Content Include="bin\AjaxControlToolkit.dll" />
        <Content Include="bin\AntiXssLibrary.dll" />
        <Content Include="bin\Microsoft.ReportViewer.Common.dll" />
        <Content Include="bin\Microsoft.ReportViewer.ProcessingObjectModel.dll" />
        <Content Include="bin\Microsoft.ReportViewer.WebForms.dll" />
        <Content Include="bin\Microsoft.Web.Services3.dll" />
        <Content Include="bin\SolidCP.Portal.Ecommerce.Modules.dll" />
        <Content Include="bin\SolidCP.Portal.Ecommerce.Modules.pdb" />
        <Content Include="bin\SolidCP.Portal.Modules.dll" />
        <Content Include="bin\SolidCP.Portal.Modules.pdb" />
        <Content Include="bin\SolidCP.Providers.Base.dll" />
        <Content Include="bin\SolidCP.Providers.Base.pdb" />
        <Content Include="bin\SolidCP.WebPortal.dll" />
        <Content Include="bin\SolidCP.WebPortal.pdb" />
        <Content Include="Error.htm" />
    </ItemGroup>
    <ItemGroup>
        <Compile Include="..\VersionInfo.cs" Link="Code\VersionInfo.cs" />
        <Compile Update="Code\WebPortalControlBase.cs">
            <SubType>ASPXCodeBehind</SubType>
        </Compile>
        <Compile Update="Code\PortalControlBase.cs">
            <SubType>ASPXCodeBehind</SubType>
        </Compile>
        <Compile Update="Default.aspx.cs">
            <SubType>ASPXCodeBehind</SubType>
            <DependentUpon>Default.aspx</DependentUpon>
        </Compile>
        <Compile Update="Default.aspx.designer.cs">
            <DependentUpon>Default.aspx</DependentUpon>
        </Compile>
        <Compile Update="Global.asax.cs">
            <DependentUpon>Global.asax</DependentUpon>
        </Compile>
    </ItemGroup>
    <ItemGroup>
        <Content Include="Global.asax" />
    </ItemGroup>
    <ItemGroup>
        <Content Include="Default.aspx" />
        <None Remove="SolidCP.WebPortal.deps.json" />
        <Content Include="SolidCP.WebPortal.deps.json">
          <CopyToOutputDirectory>Always</CopyToOutputDirectory>
        </Content>
        <Content Include="Web6.config">
            <SubType>Designer</SubType>
        </Content>
        <Content Include="Web.config">
            <SubType>Designer</SubType>
        </Content>
    </ItemGroup>
    <ItemGroup>
        <Content Include="App_Browsers\CSSFriendlyAdapters.browser" />
        <Content Include="App_Data\ModulesData.config">
            <SubType>Designer</SubType>
        </Content>
        <Content Include="App_Data\SiteSettings.config">
            <SubType>Designer</SubType>
        </Content>
        <Content Include="App_Data\ESModule_ControlsHierarchy.config">
            <SubType>Designer</SubType>
        </Content>
        <Content Include="bin\SolidCP.Portal.Ecommerce.Modules.dll.config" />
        <Content Include="bin\SolidCP.Portal.Modules.dll.config" />
        <Content Include="bin\SolidCP.WebPortal.dll.config" />
        <Content Include="manifest.json" />
        <None Include="compilerconfig.json" />
        <None Include="compilerconfig.json.defaults">
            <DependentUpon>compilerconfig.json</DependentUpon>
        </None>
        <None Include="Properties\PublishProfiles\Default Settings.pubxml" />
        <EmbeddedResource Include="Code\Adapters\empty.gif" />
    </ItemGroup>
    <ItemGroup>
        <!--<ProjectReference Include="..\..\Lib\WebFormsForCore\src\WebFormsForCore.Web\WebFormsForCore.Web.csproj" />-->
        <ProjectReference Include="..\CPCC\CPCC.csproj" />
        <ProjectReference Include="..\SolidCP.EnterpriseServer.Base\SolidCP.EnterpriseServer.Base.csproj" />
        <ProjectReference Include="..\SolidCP.EnterpriseServer\WebServices\SolidCP.Build\SolidCP.EnterpriseServer.Client.csproj" />
        <ProjectReference Include="..\SolidCP.Providers.Base\SolidCP.Providers.Base.csproj" />
        <ProjectReference Include="..\SolidCP.Web.Clients\SolidCP.Web.Clients.csproj" />
    </ItemGroup>
    <ItemGroup>
        <Compile Remove="DesktopModules\**\*.cs" />
    </ItemGroup>
    <ItemGroup>
      <Compile Include="DesktopModules\SolidCP\Code\Framework\ES.cs" />
    </ItemGroup>
    <ItemGroup>
      <Folder Include="bin_dotnet\" />
    </ItemGroup>

    <Target Name="ChangeAliasesOfNugetRefs" Condition="$(TargetFramework) != 'net48'" BeforeTargets="FindReferenceAssembliesForReferences;ResolveReferences">
        <ItemGroup>
            <!-- Do not import System.Configuration.ConfigurationManager version 8 -->
            <ReferencePath Remove="%(Identity)" Condition="'%(FileName)' == 'System.Configuration.ConfigurationManager' AND $([System.Text.RegularExpressions.Regex]::IsMatch(%(Identity),'\\8.0.0\\'))" />
            <!-- Do not import System.Web -->
            <ReferencePath Remove="%(Identity)" Condition="'%(FileName)' == 'System.Web' AND $([System.Text.RegularExpressions.Regex]::IsMatch(%(Identity),'\\dotnet\\'))" />
        </ItemGroup>
    </Target>

    <Target Name="CopyDepsJson" Condition="$(TargetFramework) != 'net48'" AfterTargets="Build">
        
        <ItemGroup>
            <DepsJson Include="SolidCP.WebPortal.deps.json" />
        </ItemGroup>

        <Copy SourceFiles="@(DepsJson)" DestinationFolder="$(OutputPath)" />
    </Target>
            
</Project>